import{g as e,m as t,s as a}from"./group-e56f61ac.js";import{ai as i,aq as s,o as l,c as o,_ as r,U as g,a as d,K as p,a9 as n,T as m,Y as u,Z as c,R as h,V as y,$ as b}from"./@vue-e400fd81.js";import{_ as T}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const j={class:""},f={key:0,class:"tag-place"},q={class:"g-card"},k={class:"g-card-title mid-action"},v={class:""},S={class:"g-color",style:{color:"var(--color)"}},L={class:"desc"},C={key:0},I={key:1};const V=T({name:"Group",components:{},data:()=>({query:{pageNum:1,pageSize:10,groupName:void 0,groupLeaderName:void 0,tagIds:void 0,beginTime:void 0,endTime:void 0},dateRange:[],loading:!1,ids:[],multiple:!0,lastSyncTime:"",total:0,list:[],queryTag:[],dialogVisible:!1,selectedTag:[],tagDialogType:{title:"选择标签",type:""},makeLabelCustomerList:[]}),computed:{},created(){this.getList()},methods:{getList(t){this.dateRange?(this.query.beginTime=this.dateRange[0],this.query.endTime=this.dateRange[1]):(this.query.beginTime="",this.query.endTime=""),t&&(this.query.pageNum=t),this.query.tagIds=this.queryTag.map((e=>e.tagId))+"",this.loading=!0,e(this.query).then((({rows:e,lastSyncTime:t,total:a})=>{this.list=e.map((e=>(e.tags&&"string"==typeof e.tags&&(e.tags=e.tags.split(",")),e.tagIds&&"string"==typeof e.tagIds&&(e.tagIds=e.tagIds.split(",")),e))),this.lastSyncTime=t,this.total=+a,this.loading=!1})).catch((()=>{this.loading=!1}))},showTagDialog(){this.selectedTag=this.queryTag,this.tagDialogType={title:"选择标签",type:"query"},this.dialogVisible=!0},makeTag(e){this.makeLabelCustomerList=e||this.ids,this.tagDialogType.type="";let t=[];e.tags&&e.tagIds&&(t=e.tags.map(((t,a)=>({name:t,tagName:t,tagId:e.tagIds[a]})))),this.selectedTag=t,this.dialogVisible=!0},submitSelectTag(e){if("query"===this.tagDialogType.type)this.queryTag=e,this.dialogVisible=!1;else{this.loading=!0;let a={chatId:this.makeLabelCustomerList.chatId,tagIds:e.map((e=>e.tagId))};t(a).then((e=>{200==e.code&&(this.msgSuccess("操作成功"),this.getList(),this.loading=!1)})).finally((()=>{this.loading=!1,this.dialogVisible=!1}))}},resetQuery(){this.dateRange=[],this.queryTag=[],this.queryUser=[],this.$refs.queryForm.resetFields(),this.getList(1)},sync(){a().then((e=>{this.getList(1),this.msgSuccess("后台开始同步数据，请稍后关注进度")}))},handleSelectionChange(e){this.ids=e.map((e=>e.id)),this.multiple=!e.length}}},[["render",function(e,t,a,T,V,_){const N=i("el-input"),w=i("el-form-item"),D=i("el-tag"),U=i("el-date-picker"),R=i("el-button"),z=i("el-form"),x=i("ButtonSync"),Y=i("el-table-column"),F=i("TagEllipsis"),M=i("el-table"),$=i("pagination"),B=i("SelectTag"),E=s("loading");return l(),o("div",j,[r(z,{model:V.query,ref:"queryForm",inline:!0,class:"top-search","label-width":"80px"},{default:g((()=>[r(w,{label:"群名",prop:"groupName"},{default:g((()=>[r(N,{modelValue:V.query.groupName,"onUpdate:modelValue":t[0]||(t[0]=e=>V.query.groupName=e),placeholder:"请输入群名",clearable:""},null,8,["modelValue"])])),_:1}),r(w,{label:"群主",prop:"groupLeaderName"},{default:g((()=>[r(N,{modelValue:V.query.groupLeaderName,"onUpdate:modelValue":t[1]||(t[1]=e=>V.query.groupLeaderName=e),placeholder:"请输入群主",clearable:""},null,8,["modelValue"])])),_:1}),r(w,{label:"群标签"},{default:g((()=>[d("div",{class:"tag-input",onClick:t[2]||(t[2]=(...e)=>_.showTagDialog&&_.showTagDialog(...e))},[V.queryTag.length?(l(!0),o(p,{key:1},n(V.queryTag,((e,t)=>(l(),m(D,{key:t},{default:g((()=>[u(c(e.name),1)])),_:2},1024)))),128)):(l(),o("span",f,"请选择"))])])),_:1}),r(w,{label:"创建日期"},{default:g((()=>[r(U,h({clearable:"",modelValue:V.dateRange,"onUpdate:modelValue":t[3]||(t[3]=e=>V.dateRange=e),"value-format":"YYYY-MM-DD",type:"daterange"},e.pickerOptions,{"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"}),null,16,["modelValue"])])),_:1}),r(w,{label:""},{default:g((()=>[r(R,{type:"primary",onClick:t[4]||(t[4]=e=>_.getList(1))},{default:g((()=>[u("查询")])),_:1}),r(R,{onClick:_.resetQuery},{default:g((()=>[u("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),d("div",q,[d("div",k,[d("div",v,[u(" 共 "),d("span",S,c(V.total),1),u(" 个客户群 ")]),d("div",null,[d("span",L,"最近同步："+c(V.lastSyncTime),1),r(x,{lastSyncTime:V.lastSyncTime,onClick:_.sync},{default:g((()=>[u("同步客户群")])),_:1},8,["lastSyncTime","onClick"])])]),y((l(),m(M,{data:V.list,onSelectionChange:_.handleSelectionChange},{default:g((()=>[r(Y,{label:"群名",align:"center",prop:"groupName"}),r(Y,{label:"群主",align:"center",prop:"groupLeaderName"}),r(Y,{label:"群人数",align:"center",prop:"memberNum"}),r(Y,{prop:"tags",label:"群标签",align:"center"},{default:g((({row:e})=>[e.tags?(l(),o("div",C,[r(F,{list:e.tags},null,8,["list"])])):(l(),o("span",I,"无标签"))])),_:1}),r(Y,{label:"创建时间",align:"center",prop:"addTime",width:"180"}),r(Y,{label:"操作",align:"center"},{default:g((t=>[r(R,{text:"",onClick:a=>e.$router.push({path:"./groupDetail",query:{chatId:t.row.chatId}})},{default:g((()=>[u(" 查看详情 ")])),_:2},1032,["onClick"]),r(R,{text:"",onClick:e=>_.makeTag(t.row)},{default:g((()=>[u("标签管理")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[E,V.loading]]),y(r($,{total:V.total,page:V.query.pageNum,"onUpdate:page":t[5]||(t[5]=e=>V.query.pageNum=e),limit:V.query.pageSize,"onUpdate:limit":t[6]||(t[6]=e=>V.query.pageSize=e),onPagination:t[7]||(t[7]=e=>_.getList())},null,8,["total","page","limit"]),[[b,V.total>0]])]),r(B,{ref:"selectTag",visible:V.dialogVisible,"onUpdate:visible":t[8]||(t[8]=e=>V.dialogVisible=e),type:"2",title:V.tagDialogType.title,selected:V.selectedTag,onSuccess:_.submitSelectTag},null,8,["visible","title","selected","onSuccess"])])}]]);export{V as default};
