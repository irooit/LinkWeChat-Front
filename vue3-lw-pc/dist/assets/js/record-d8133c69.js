import{I as t,d as e,U as i,V as s}from"../index-044285d2.js";import{g as a}from"./businessConver-2b86f97c.js";import l from"./MaterialCard-ea409fb9.js";import{_ as r}from"./quill-image-resize-module-c051113e.js";import{ai as o,aq as n,V as p,o as m,c as u,K as d,_ as c,U as g,T as h,Y as y,Z as j,X as f,a as b,a9 as T}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const v={class:"ac"},w={key:1,class:"timeline-time-wrap"},S=["infinite-scroll-disabled"],k={class:"timeline-time"},q={class:"timeline-box-item-title"};const M=r({name:"",props:{userId:{type:String,default:null},userIdAll:{type:String,default:null},trajectoryType:{type:String,default:null},viewType:{type:String,default:""},lastSyncTime:String},components:{MaterialCard:l},data:()=>({stageList:[],query:{pageNum:0,pageSize:10,externalUserid:"",userId:null,trajectoryType:null},loading:!1,total:0,list:[],dictTrackState:t,dateFormat:e,goto:!0}),computed:{},watch:{},created(){this.getList(1),this.getStage()},mounted(){},methods:{getStage(){a().then((t=>{this.stageList=t.data}))},setValue(t){let e="";return this.stageList.forEach((i=>{i.stageVal==t&&(e=i.stageKey)})),e},getList(t){if(Object.assign(this.query,{externalUserid:this.$route.query.externalUserid,weUserId:this.userId,trajectoryType:this.trajectoryType}),this.viewType)t&&(this.query.pageNum=t);else if(this.query.pageNum++,this.query.pageNum>1&&!this.goto)return;this.loading=!0,i(this.query).then((({rows:t,total:e,lastSyncTime:i})=>{if(this.viewType)this.total=+e,this.list=t;else{let i=[],s=[];t.forEach((t=>{let e=this.dateFormat(t.createTime,"YYYYMMDD");s.includes(e)||s.push(e)})),s.sort(((t,e)=>e-t));for(let e=0;e<s.length;e++){let a=[];for(let i=0;i<t.length;i++)s[e]==this.dateFormat(t[i].createTime,"YYYYMMDD")&&a.push(t[i]);i.push(a)}this.total+=t.length,this.list=this.list.concat(i),this.total==+e?this.goto=!1:this.goto=!0}this.$emit("update:lastSyncTime",i),this.loading=!1})).catch((()=>{this.loading=!1}))},sync(){this.loading=!0,s(this.userId||this.userIdAll).then((()=>{this.getList(1),this.msgSuccess("后台开始同步数据，请稍后关注进度"),this.loading=!1})).catch((t=>{this.loading=!1}))}}},[["render",function(t,e,i,s,a,l){const r=o("el-table-column"),M=o("el-tag"),Y=o("el-table"),x=o("el-pagination"),z=o("MaterialCard"),I=o("el-timeline-item"),C=o("el-timeline"),L=o("el-empty"),V=n("infinite-scroll"),_=n("loading");return p((m(),u("div",null,[i.viewType?(m(),u(d,{key:0},[c(Y,{data:a.list},{default:g((()=>[c(r,{label:"员工",align:"center",prop:"userName"}),c(r,{label:"跟进记录",align:"center",prop:"trackContent"}),c(r,{prop:"trackState",label:"商机阶段",align:"center"},{default:g((({row:t})=>[t.trackState?(m(),h(M,{key:0},{default:g((()=>[y(j(l.setValue(t.trackState)),1)])),_:2},1024)):f("",!0)])),_:1}),c(r,{label:"跟进记录时间",align:"center",prop:"createTime"})])),_:1},8,["data"]),b("div",v,[c(x,{class:"mt10",small:"",onCurrentChange:l.getList,"current-page":a.query.pageNum,"page-sizes":[10,20,50],"page-size":a.query.pageSize,layout:"total, prev, pager, next",total:a.total},null,8,["onCurrentChange","current-page","page-size","total"])])],64)):(m(),u("div",w,[p((m(),u("ul",{class:"infinite-list","infinite-scroll-immediate":!0,"infinite-scroll-disabled":a.loading},[a.list.length?(m(!0),u(d,{key:0},T(a.list,((t,e)=>(m(),u("li",{class:"infinite-list-item",key:e},[b("div",k,j(a.dateFormat(t[0].createTime,"YYYY-MM-DD w")),1),c(C,{class:"timeline-box"},{default:g((()=>[(m(!0),u(d,null,T(t,((t,e)=>(m(),h(I,{key:e,class:"timeline-box-item",timestamp:t.createTime.slice(10,16),placement:"top",type:"primary"},{default:g((()=>[b("p",q,j(t.title||"无标题"),1),b("p",null,j(t.content||"无内容"),1),t.weMaterialVo?(m(),h(z,{key:0,weMaterialVo:t.weMaterialVo},null,8,["weMaterialVo"])):f("",!0)])),_:2},1032,["timestamp"])))),128))])),_:2},1024)])))),128)):(m(),h(L,{key:1,"image-size":150}))],8,S)),[[V,l.getList]])]))])),[[_,a.loading]])}],["__scopeId","data-v-0e4fd2a1"]]);export{M as default};
