import{_ as t}from"./quill-image-resize-module-c051113e.js";import{ai as i,o as e,c as a,T as s,U as n,_ as o,a as r,Z as d,X as l,Q as p}from"./@vue-e400fd81.js";import"./quill-c6b3d2fb.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const h={data:()=>({form:{province:"",city:"",area:"",address:"",addrPoint:{lng:0,lat:0}},map:"",mk:"",locationPoint:null}),props:{initData:{type:Object,default:()=>({})},mapWidth:{type:String,default:"500px"},mapHeight:{type:String,default:"300px"},isDetail:{type:Boolean,default:!1},isOnlyShowMap:{type:Boolean,default:!1}},watch:{initData:{handler(t){if(this.initData.area&&!this.initData.address&&(this.form.address="",this.getPoint(this.initData.area),this.initMap()),this.initData.address){if(this.form.address=this.initData.address,this.initData.longitude&&this.initData.latitude)this.form.addrPoint.lng=this.initData.longitude,this.form.addrPoint.lat=this.initData.latitude;else{let t=this.initData.area+this.initData.address;this.getPoint(t)}this.initMap()}},deep:!0}},async mounted(){if(await new Promise((function(t,i){if(void 0!==window.BMap)return t(window.BMap),!0;window.onBMapCallback=function(){t(window.BMap)};let e=document.createElement("script");e.type="text/javascript",e.src="https://api.map.baidu.com/api?v=3.0&ak="+window.lwConfig.BAIDU_MAP_KEY+"&callback=onBMapCallback",e.onerror=i,document.head.appendChild(e)})),this.initData.address)if(this.form.address=this.initData.address,this.initData.longitude&&this.initData.latitude)this.form.addrPoint.lng=this.initData.longitude,this.form.addrPoint.lat=this.initData.latitude;else{let t=this.initData.area+this.initData.address;this.getPoint(t)}this.initMap()},methods:{getCity(t){if(t){let i={},e=0,a=t.indexOf("省");-1==a?(e=t.indexOf("自治区"),i.Province=-1!=e?t.substring(0,e+3):t.substring(0,0)):i.Province=t.substring(0,a+1);let s=t.indexOf("市");i.City=-1==e?t.substring(e+1,s+1):0==e?t.substring(a+1,s+1):t.substring(e+3,s+1);let n=t.indexOf("区");return-1==n?(n=t.indexOf("县"),-1==n?(n=t.indexOf("旗"),i.Country=t.substring(s+1,n+1)):i.Country=t.substring(s+1,n+1)):i.Country=t.substring(s+1,n+1),i.City}return""},getPoint(t){var i=this;(new BMap.Geocoder).getPoint(t,(function(t){t&&(i.form.addrPoint=t,i.$emit("point",t))}),i.getCity(t))},initMap(){var t=this;this.map=new BMap.Map(this.$refs.bMap,{enableMapClick:!1});var i=new BMap.Point(this.form.addrPoint.lng||117.2334414073489,this.form.addrPoint.lat||31.826578293886);this.map.centerAndZoom(i,19),this.mk=new BMap.Marker(i,{enableDragging:!0}),this.map.addOverlay(this.mk),this.mk.addEventListener("dragend",(function(i){t.getAddrByPoint(i.point)})),this.map.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL}));var e=new BMap.GeolocationControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});e.addEventListener("locationSuccess",(function(i){t.getAddrByPoint(i.point)})),e.addEventListener("locationError",(function(t){alert(t.message)})),this.map.addControl(e),this.map.addEventListener("click",(function(i){t.getAddrByPoint(i.point)}))},getDistancs(t,i){return this.map.getDistance(t,i).toFixed(2)},geolocation(){if(!this.isDetail){var t=this;(new BMap.Geolocation).getCurrentPosition((function(i){this.getStatus()==BMAP_STATUS_SUCCESS?(t.getAddrByPoint(i.point),t.locationPoint=i.point):(alert("failed"+this.getStatus()),t.locationPoint=new BMap.Point(117.2334414073489,31.826578293886))}),{enableHighAccuracy:!0})}},getAddrByPoint(t){if(!this.isDetail){var i=this;(new BMap.Geocoder).getLocation(t,(function(e){i.mk.setPosition(t),i.map.panTo(t),i.form.address=e.addressComponents.street+e.addressComponents.streetNumber,i.form.province=e.addressComponents.province,i.form.city=e.addressComponents.city,i.form.area=e.addressComponents.district,i.form.addrPoint=t,i.onSubmit()}))}},querySearchAsync(t,i){var e={onSearchComplete:function(t){var e=[];if(a.getStatus()==BMAP_STATUS_SUCCESS){for(var s=0;s<t.getCurrentNumPois();s++)e.push(t.getPoi(s));i(e)}else i(e)}},a=new BMap.LocalSearch(this.map,e);a.search(t)},splitName(t){if(t){let i={},e=0,a=t.indexOf("省");-1==a?(e=t.indexOf("自治区"),i.Province=-1!=e?t.substring(0,e+3):t.substring(0,0)):i.Province=t.substring(0,a+1);let s=t.indexOf("市");i.City=-1==e?t.substring(e+1,s+1):0==e?t.substring(a+1,s+1):t.substring(e+3,s+1);let n=t.indexOf("区");-1==n?(n=t.indexOf("县"),-1==n?(n=t.indexOf("旗"),i.Country=t.substring(s+1,n+1)):i.Country=t.substring(s+1,n+1)):i.Country=t.substring(s+1,n+1);let o=i.Province+i.City+i.Country;return i.Province&&(this.form.province=i.Province),i.City&&(this.form.city=i.City),this.form.area=i.Country,t.substring(o.length)}return""},handleSelect(t){this.form.province=t.province,this.form.city=t.city,this.form.address=this.splitName(t.address)+t.title,this.form.addrPoint=t.point,this.map.clearOverlays(),this.mk=new BMap.Marker(t.point),this.map.addOverlay(this.mk),this.map.panTo(t.point),this.onSubmit()},setChange(t){t||(this.form={address:"",addrPoint:{lng:0,lat:0}},this.onSubmit())},onSubmit(){this.$emit("update",this.form)}}},c={style:{overflow:"hidden"}},u={class:"title"},m={class:"address ellipsis"};const f=t(h,[["render",function(t,h,f,g,y,b){const C=i("el-icon-search"),P=i("el-autocomplete"),v=i("el-form-item");return e(),a("div",null,[f.isOnlyShowMap?l("",!0):(e(),s(v,{key:0,label:"详细地址",prop:"address"},{default:n((()=>[o(P,{disabled:f.isDetail,onChange:b.setChange,modelValue:y.form.address,"onUpdate:modelValue":h[0]||(h[0]=t=>y.form.address=t),style:{width:"500px"},"popper-class":"autoAddressClass","fetch-suggestions":b.querySearchAsync,"trigger-on-focus":!1,placeholder:"详细地址",clearable:"",onSelect:b.handleSelect},{default:n((({item:t})=>[o(C,{class:"el-icon-search fl mgr10"}),r("div",c,[r("div",u,d(t.title),1),r("span",m,d(t.address),1)])])),_:1},8,["disabled","onChange","modelValue","fetch-suggestions","onSelect"])])),_:1})),o(v,{label:"","label-width":f.isOnlyShowMap?0:"",style:p(f.isOnlyShowMap&&"margin-bottom: 0")},{default:n((()=>[r("div",{ref:"bMap",style:p({width:f.mapWidth,height:f.mapHeight})},null,4)])),_:1},8,["label-width","style"])])}],["__scopeId","data-v-323c29fa"]]);export{f as default};
