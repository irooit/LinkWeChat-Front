import{g as e,a as t,u as a,r as o}from"./actual-d5f6605c.js";import l from"./customer-f0f5dbb4.js";import{ai as i,aq as r,o as s,c as d,a as u,_ as m,U as p,Y as n,K as c,a9 as g,T as f,V as h,R as C,X as b,$ as j,bl as v,bj as y}from"./@vue-e400fd81.js";import{_}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./group-e56f61ac.js";const k={components:{Customer:l},props:{groupCodeId:{type:String,default:""},status:{type:Number,default:-1}},data:()=>({acceptType:["jpg","png"],query:{status:-1,pageNum:1,pageSize:10},statusOptions:[{label:"全部状态",value:-1},{label:"使用中",value:0},{label:"已使用",value:1}],loading:!1,multiRealCode:[],realCodes:[],dialog:!1,customerDialog:!1,exampleDialog:!1,form:{groupName:"",actualGroupQrCode:"",effectTime:"",scanCodeTimesLimit:"",chatId:"",chatGroupName:""},editedRealCodeId:null,customerGroup:[],total:0,rules:{groupName:[{required:!0,message:"请输入群名称",trigger:"blur"}],actualGroupQrCode:[{required:!0,message:"请上传实际群码",trigger:"blur"}],effectTime:[{required:!0,message:"请选择有效期",trigger:"blur"}],scanCodeTimesLimit:[{required:!0,message:"请输入扫码次数",trigger:"blur"},{pattern:/^[1-9][0-9]*$/,message:"扫码次数必须为正整数",trigger:"blur"},{validator:(e,t,a)=>{t<1||t>190?a(new Error("扫码次数必须在1-190之间")):a()},trigger:"blur"}]},datePickerOptions:{disabledDate:e=>e.getTime()<=Date.now()-864e5}}),watch:{dialog(e){!1===e&&(this.$refs.form.resetFields(),this.form.chatId="",this.form.chatGroupName="",this.editedRealCodeId=null)}},created(){this.query.status=this.status,this.getRealCodes()},methods:{getRealCodes(){let t={groupCodeId:this.groupCodeId};t=-1!==this.query.status?Object.assign(t,this.query):Object.assign(t,{pageNum:this.query.pageNum,pageSize:this.query.pageSize}),this.loading=!0,e(t).then((e=>{200===e.code&&(this.realCodes=e.rows,this.total=parseInt(e.total)),this.loading=!1})).catch((()=>{this.loading=!1}))},add(){this.$refs.form.validate((e=>{if(!e)return;const a=Object.assign({},this.form,{groupCodeId:this.groupCodeId});t(a).then((e=>{this.dialog=!1,this.getRealCodes()}))}))},edit(e){this.editedRealCodeId=e.id,this.form={groupName:e.groupName,actualGroupQrCode:e.actualGroupQrCode,effectTime:e.effectTime,scanCodeTimesLimit:e.scanCodeTimesLimit,chatId:e.chatId,chatGroupName:e.chatGroupName},this.dialog=!0},update(){this.$refs.form.validate((e=>{if(!e)return;const t=Object.assign({id:this.editedRealCodeId},this.form);a(t).then((e=>{this.dialog=!1,this.getRealCodes()}))}))},handleSubmit(){if(!this.editedRealCodeId)return this.add();this.update()},handleBulkRemove(){this.$confirm("确认删除当前实际群码?删除操作无法撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.multiRealCode.map((e=>e.id));o(e+"").then((e=>{200===e.code&&this.getRealCodes()}))})).catch((()=>{}))},handleRemove(e){this.$confirm("确认删除当前实际群码?删除操作无法撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{o(e).then((e=>{200===e.code&&this.getRealCodes()}))})).catch((()=>{}))},handleSelectionChange(e){this.multiRealCode=e},handleSelectCustomerGroup(){this.$refs.customer.submit()},getSelectCustomerGroup(e){this.form.chatId=e?e.chatId:"",this.form.chatGroupName=e?e.groupName:"",this.customerDialog=!1}}},T=e=>(v("data-v-44059752"),e=e(),y(),e),I={class:"mid-action"},q={key:0,class:"green-text"},x={key:1,class:"red-text"},G=T((()=>u("div",null,"注: 只支持2M以内的jpg/png格式图片",-1))),R=T((()=>u("div",{class:"tip"},"注: 不超过190",-1))),V={class:"example-code-box"},N={class:"code-box-title"},w={class:"code-content"};const S=_(k,[["render",function(e,t,a,o,l,v){const y=i("el-button"),_=i("el-option"),k=i("el-select"),T=i("el-table-column"),S=i("el-image"),D=i("el-popover"),U=i("el-table"),Q=i("el-input"),z=i("el-form-item"),L=i("upload"),O=i("el-date-picker"),$=i("el-form"),B=i("Customer"),Y=i("el-dialog"),M=i("svg-icon"),P=i("pagination"),E=r("loading");return s(),d("div",null,[u("div",I,[u("div",null,[m(y,{type:"primary",onClick:t[0]||(t[0]=e=>l.dialog=!0)},{default:p((()=>[n("新建实际群码")])),_:1}),m(k,{modelValue:l.query.status,"onUpdate:modelValue":t[1]||(t[1]=e=>l.query.status=e),class:"ml10",onChange:v.getRealCodes},{default:p((()=>[(s(!0),d(c,null,g(l.statusOptions,(e=>(s(),f(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])]),u("div",null,[m(y,{disabled:0===l.multiRealCode.length,onClick:v.handleBulkRemove},{default:p((()=>[n("批量删除")])),_:1},8,["disabled","onClick"])])]),h((s(),f(U,{data:l.realCodes,onSelectionChange:v.handleSelectionChange},{default:p((()=>[m(T,{type:"selection",width:"55",align:"center"}),m(T,{prop:"groupName",label:"群名称",align:"center"}),m(T,{prop:"actualGroupQrCode",label:"实际群码",align:"center",width:"80"},{default:p((({row:e})=>[m(D,{placement:"bottom",trigger:"hover"},{reference:p((()=>[m(S,{src:e.actualGroupQrCode,class:"code-image--small"},null,8,["src"])])),default:p((()=>[m(S,{src:e.actualGroupQrCode,class:"code-image"},null,8,["src"])])),_:2},1024)])),_:1}),m(T,{prop:"effectTime",label:"有效期",align:"center"}),m(T,{prop:"scanCodeTimesLimit",label:"扫码次数限制",align:"center"}),m(T,{prop:"scanCodeTimes",label:"已扫码入群数",align:"center"}),m(T,{prop:"status",label:"使用状态",align:"center"},{default:p((({row:e})=>[0===parseInt(e.status)?(s(),d("div",q,"使用中")):(s(),d("div",x,"已使用"))])),_:1}),m(T,{label:"操作",align:"center"},{default:p((({row:e})=>[m(y,{text:"",onClick:t=>v.edit(e)},{default:p((()=>[n("编辑")])),_:2},1032,["onClick"]),m(y,{text:"",onClick:t=>v.handleRemove(e.id)},{default:p((()=>[n("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[E,l.loading]]),m(Y,{title:"实际群码",modelValue:l.dialog,"onUpdate:modelValue":t[11]||(t[11]=e=>l.dialog=e),"append-to-body":""},{footer:p((()=>[u("div",null,[m(y,{onClick:t[10]||(t[10]=e=>l.dialog=!1)},{default:p((()=>[n("取消")])),_:1}),m(y,{type:"primary",onClick:v.handleSubmit},{default:p((()=>[n("确定")])),_:1},8,["onClick"])])])),default:p((()=>[m($,{model:l.form,ref:"form","label-width":"120px",rules:l.rules},{default:p((()=>[m(z,{label:"群名称",prop:"groupName"},{default:p((()=>[m(Q,{modelValue:l.form.groupName,"onUpdate:modelValue":t[2]||(t[2]=e=>l.form.groupName=e),placeholder:"请输入群名称"},null,8,["modelValue"])])),_:1}),m(z,{label:"实际群码",prop:"actualGroupQrCode"},{default:p((()=>[m(L,{fileUrl:l.form.actualGroupQrCode,"onUpdate:fileUrl":t[3]||(t[3]=e=>l.form.actualGroupQrCode=e),format:l.acceptType,class:"image-uploader"},{tip:p((()=>[G])),_:1},8,["fileUrl","format"]),u("div",null,[m(y,{text:"",onClick:t[4]||(t[4]=e=>l.exampleDialog=!0)},{default:p((()=>[n("查看示例")])),_:1})])])),_:1}),m(z,{label:"有效期",prop:"effectTime"},{default:p((()=>[m(O,C({modelValue:l.form.effectTime,"onUpdate:modelValue":t[5]||(t[5]=e=>l.form.effectTime=e),type:"date",placeholder:"请选择有效期","value-format":"YYYY-MM-DD"},l.datePickerOptions),null,16,["modelValue"])])),_:1}),m(z,{label:"扫码次数限制",prop:"scanCodeTimesLimit"},{default:p((()=>[m(Q,{modelValue:l.form.scanCodeTimesLimit,"onUpdate:modelValue":t[6]||(t[6]=e=>l.form.scanCodeTimesLimit=e),placeholder:"请输入次数",type:"Number"},null,8,["modelValue"]),R])),_:1})])),_:1},8,["model","rules"]),m(Y,{title:"选择客户群","append-to-body":"",modelValue:l.customerDialog,"onUpdate:modelValue":t[8]||(t[8]=e=>l.customerDialog=e)},{footer:p((()=>[u("div",null,[m(y,{onClick:t[7]||(t[7]=e=>l.customerDialog=!1)},{default:p((()=>[n("取消")])),_:1}),m(y,{type:"primary",onClick:v.handleSelectCustomerGroup},{default:p((()=>[n("确定")])),_:1},8,["onClick"])])])),default:p((()=>[l.customerDialog?(s(),f(B,{key:0,ref:"customer",customerGroupId:l.form.chatId,onCallback:v.getSelectCustomerGroup},null,8,["customerGroupId","onCallback"])):b("",!0)])),_:1},8,["modelValue"]),m(Y,{title:"如图所示为标准的微信群二维码",modelValue:l.exampleDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>l.exampleDialog=e),"append-to-body":"",width:"400px"},{default:p((()=>[u("div",V,[u("div",N,[m(M,{icon:"user",class:"code-user"}),n(" 实际群名称 ")]),u("div",w,[m(S,{src:"@/assets/example/groupCode.png"})])])])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),h(m(P,{total:l.total,page:l.query.pageNum,"onUpdate:page":t[12]||(t[12]=e=>l.query.pageNum=e),limit:l.query.pageSize,"onUpdate:limit":t[13]||(t[13]=e=>l.query.pageSize=e),onPagination:v.getRealCodes},null,8,["total","page","limit","onPagination"]),[[j,l.total>0]])])}],["__scopeId","data-v-44059752"]]);export{S as default};
