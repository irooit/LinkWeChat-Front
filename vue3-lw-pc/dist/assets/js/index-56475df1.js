import{b as e,c as t,s as i}from"./dimission-87304ebd.js";import{ai as s,aq as l,o as a,c as o,_ as r,U as n,R as m,Y as p,a as d,Z as c,V as u,T as h,$ as g}from"./@vue-e400fd81.js";import{_ as y}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const f={class:"page"},j={class:"g-card"},b={class:"mid-action"},S={class:"desc"};const w=y({name:"Dimission",components:{},props:{},data:()=>({query:{isAllocate:0,pageNum:1,pageSize:10,userName:void 0,beginTime:void 0,endTime:void 0},loading:!1,isMoreFilter:!1,total:0,form:{user:"",region:""},list:[],currentRow:{},dialogVisibleSelectUser:!1,dateRange:[],lastSyncTime:""}),watch:{},computed:{},created(){this.getList(),this.$store.setBusininessDesc("\n          <div>将离职成员的客户和客户群分配给其他成员跟进并继续提供服务。</div>\n        ")},mounted(){},methods:{getList(t){this.dateRange?(this.query.beginTime=this.dateRange[0],this.query.endTime=this.dateRange[1]):(this.query.beginTime="",this.query.endTime=""),t&&(this.query.pageNum=t),this.loading=!0,e(this.query).then((({rows:e,total:t,lastSyncTime:i})=>{this.list=e,this.total=+t,this.loading=!1,this.lastSyncTime=i})).catch((()=>{this.loading=!1}))},resetForm(e){this.dateRange=[],this.$refs.queryForm.resetFields()},showSelectDialog(){this.currentRow.weUserId?this.dialogVisibleSelectUser=!0:this.$message.warning("请先选择一位员工")},allocate(e){if(e.length>1)return void(this.dialogVisibleSelectUser=!0);let i=this.$loading();t({handoverUserid:this.currentRow.weUserId,takeoverUserid:e[0].userId}).then((()=>{this.msgSuccess("操作成功"),this.getList(),i.close()})).catch((()=>{i.close()}))},handleCurrentChange(e){this.currentRow=e},handleSelectionChange(e){this.currentRow=e[0]},handleSelection(e,t){this.$nextTick((()=>{this.$refs.table.clearSelection(),this.$refs.table.toggleRowSelection(t)}))},sync(){i().then((()=>{this.getList(1),this.msgSuccess("后台开始同步数据，请稍后关注进度")})).catch((e=>{}))}}},[["render",function(e,t,i,y,w,v){const q=s("el-input"),T=s("el-form-item"),U=s("el-date-picker"),k=s("el-button"),C=s("el-form"),R=s("ButtonSync"),N=s("el-table-column"),_=s("el-table"),V=s("pagination"),$=s("SelectUser"),L=l("loading");return a(),o("div",f,[r(C,{ref:"queryForm",inline:!0,model:w.query,"label-width":"",class:"top-search"},{default:n((()=>[r(T,{label:"已离职员工",prop:"userName"},{default:n((()=>[r(q,{clearable:"",modelValue:w.query.userName,"onUpdate:modelValue":t[0]||(t[0]=e=>w.query.userName=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),r(T,{label:"离职日期"},{default:n((()=>[r(U,m({clearable:"",modelValue:w.dateRange,"onUpdate:modelValue":t[1]||(t[1]=e=>w.dateRange=e),type:"daterange","value-format":"YYYY-MM-DD"},e.pickerOptions,{"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"}),null,16,["modelValue"])])),_:1}),r(T,{label:""},{default:n((()=>[r(k,{type:"primary",onClick:t[2]||(t[2]=e=>v.getList(1))},{default:n((()=>[p("查询")])),_:1}),r(k,{onClick:t[3]||(t[3]=e=>v.resetForm("queryForm"))},{default:n((()=>[p("重置")])),_:1})])),_:1})])),_:1},8,["model"]),d("div",j,[d("div",b,[r(k,{type:"primary",onClick:t[4]||(t[4]=t=>e.$router.push({path:"allocatedStaffList"}))},{default:n((()=>[p("已分配的离职员工")])),_:1}),d("div",null,[d("span",S,"最近同步："+c(w.lastSyncTime),1),r(R,{lastSyncTime:w.lastSyncTime,onClick:v.sync},{default:n((()=>[p("同步")])),_:1},8,["lastSyncTime","onClick"]),r(k,{style:{"margin-left":"10px"},type:"primary",onClick:v.showSelectDialog},{default:n((()=>[p("分配给其他员工")])),_:1},8,["onClick"])])]),u((a(),h(_,{ref:"multipleTable",data:w.list,"tooltip-effect":"dark",style:{width:"100%"},"highlight-current-row":"",onSelect:v.handleSelection,onSelectionChange:v.handleSelectionChange},{default:n((()=>[r(N,{type:"selection",align:"center",width:"55"}),r(N,{type:"index",label:"序号",width:"55"}),r(N,{prop:"userName",label:"已离职员工"}),r(N,{prop:"deptNames",label:"所属部门"}),r(N,{prop:"allocateCustomerNum",label:"待分配客户数","show-overflow-tooltip":""}),r(N,{prop:"allocateGroupNum",label:"待分配群聊数","show-overflow-tooltip":""}),r(N,{prop:"dimissionTime",label:"离职时间","show-overflow-tooltip":""},{default:n((e=>[p(c(e.row.dimissionTime),1)])),_:1})])),_:1},8,["data","onSelect","onSelectionChange"])),[[L,w.loading]]),u(r(V,{total:w.total,page:w.query.pageNum,"onUpdate:page":t[5]||(t[5]=e=>w.query.pageNum=e),limit:w.query.pageSize,"onUpdate:limit":t[6]||(t[6]=e=>w.query.pageSize=e),onPagination:t[7]||(t[7]=e=>v.getList())},null,8,["total","page","limit"]),[[g,w.total>0]])]),r($,{visible:w.dialogVisibleSelectUser,"onUpdate:visible":t[8]||(t[8]=e=>w.dialogVisibleSelectUser=e),title:"选择分配人",onSuccess:v.allocate},null,8,["visible","onSuccess"])])}]]);export{w as default};
