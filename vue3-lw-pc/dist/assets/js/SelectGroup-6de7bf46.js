import{g as e}from"./group-e56f61ac.js";import{d as t,ai as l,aq as i,o as s,c as a,_ as o,U as r,a as p,Y as d,K as u,a9 as n,T as m,Z as h,X as g,V as c,$ as f}from"./@vue-e400fd81.js";import{_ as b}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const y=t({name:"select-group",props:{visible:{type:Boolean,default:!1},limit:{type:Number,default:5},defaults:{type:Array,default:()=>[]},appendToBody:{type:Boolean,default:!1}},components:{},data:()=>({query:{pageNum:1,pageSize:10,groupName:"",groupLeaderName:"",tagIds:""},total:0,list:[],loading:!1,groupChildList:[],tagNames:"",showSelectTag:!1,tagList:[]}),computed:{modalVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},watch:{visible(e){e&&this.getList(1),this.groupChildList=JSON.parse(JSON.stringify(this.defaults))}},methods:{getSelectTag(e){this.taglist=e;let t=[],l=[];e.forEach((e=>{t.push(e.name),l.push(e.tagId)})),this.tagNames=t.join(","),this.query.tagIds=l.join(",")},handleClose(e){this.groupChildList.splice(this.groupChildList.indexOf(e),1),this.list.forEach((t=>{t.chatId===e.chatId&&this.$refs.multipleTable.toggleRowSelection(t,!1)}))},resetQuery(){this.query={pageNum:1,pageSize:10,groupName:"",groupLeaderName:"",tagIds:""},this.tagList=[],this.tagNames="",this.getList()},getList(t){this.loading=!0,t&&(this.query.pageNum=t),e(this.query).then((e=>{this.total=Number(e.total),this.list=e.rows,this.loading=!1,setTimeout((()=>{this.toggleSelection()}),300)}))},toggleSelection(){this.groupChildList?this.groupChildList.forEach((e=>{this.list.forEach((t=>{e.chatId===t.chatId&&this.$refs.multipleTable.toggleRowSelection(t)}))})):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){let t=e;this.groupChildList.forEach((e=>{t=t.filter((t=>t.chatId!==e.chatId))})),this.groupChildList.push(...t)},selectFn(e,t){if(!e.includes(t)){let e=this.groupChildList.findIndex((e=>e.chatId===t.chatId));-1!==e&&this.groupChildList.splice(e,1)}},selectAllFn(e){e.length||this.list.forEach((e=>{let t=this.groupChildList.findIndex((t=>t.chatId===e.chatId));-1!==t&&this.groupChildList.splice(t,1)}))},submit(){this.groupChildList.length?this.groupChildList.length>5?this.msgInfo("最多选择五个客群！"):(this.$emit("submit",this.groupChildList),this.list=[],this.modalVisible=!1):this.msgInfo("请至少选择一个客群！")},cancelFn(){this.list=[],this.modalVisible=!1}},created(){}}),j={class:"modal"},C={class:"fixed-content"};const L=b(y,[["render",function(e,t,b,y,L,N){const S=l("el-tag"),q=l("el-input"),I=l("el-form-item"),v=l("el-button"),w=l("el-form"),_=l("el-table-column"),T=l("tag-ellipsis"),V=l("el-table"),k=l("pagination"),x=l("el-dialog"),z=l("SelectTag"),U=i("loading");return s(),a("div",j,[o(x,{title:"选择客群",modelValue:e.modalVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.modalVisible=t),"close-on-click-modal":!1,"append-to-body":e.appendToBody},{footer:r((()=>[p("div",null,[o(v,{onClick:e.cancelFn},{default:r((()=>[d("取 消")])),_:1},8,["onClick"]),o(v,{type:"primary",onClick:e.submit},{default:r((()=>[d("确 定")])),_:1},8,["onClick"])])])),default:r((()=>[p("div",C,[d(" 已选择： "),(s(!0),a(u,null,n(e.groupChildList,((t,l)=>(s(),a(u,{key:l},[t.groupName?(s(),m(S,{key:0,style:{"margin-bottom":"5px"},closable:"",onClose:l=>e.handleClose(t)},{default:r((()=>[d(h(t.groupName),1)])),_:2},1032,["onClose"])):g("",!0)],64)))),128))]),o(w,{model:e.query,ref:"queryForm",inline:!0,class:"top-search","label-width":"40px","label-position":"left"},{default:r((()=>[o(I,{label:"",prop:"groupName"},{default:r((()=>[o(q,{style:{width:"150px"},modelValue:e.query.groupName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.query.groupName=t),placeholder:"请输入群名",clearable:""},null,8,["modelValue"])])),_:1}),o(I,{label:"",prop:"groupLeaderName"},{default:r((()=>[o(q,{style:{width:"150px"},modelValue:e.query.groupLeaderName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.query.groupLeaderName=t),placeholder:"请输入群主",clearable:""},null,8,["modelValue"])])),_:1}),o(I,{label:"",prop:""},{default:r((()=>[o(q,{style:{width:"150px"},"model-value":e.tagNames,readonly:"",onClick:t[2]||(t[2]=t=>e.showSelectTag=!0),placeholder:"请选择客群标签"},null,8,["model-value"])])),_:1}),o(I,{label:""},{default:r((()=>[o(v,{type:"primary",onClick:t[3]||(t[3]=t=>e.getList(1))},{default:r((()=>[d("查询")])),_:1}),o(v,{onClick:e.resetQuery},{default:r((()=>[d("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),c((s(),m(V,{ref:"multipleTable",data:e.list,onSelect:e.selectFn,onSelectAll:e.selectAllFn,onSelectionChange:e.handleSelectionChange},{default:r((()=>[o(_,{type:"selection",width:"55",align:"center"}),o(_,{label:"群名",align:"center",prop:"groupName"}),o(_,{label:"群主",align:"center",prop:"groupLeaderName"}),o(_,{label:"群标签",width:"180"},{default:r((({row:e})=>[e.tags?(s(),m(T,{key:0,list:e.tags.split(","),limit:"1"},null,8,["list"])):g("",!0)])),_:1}),o(_,{label:"群总人数 ",align:"center ",prop:"memberNum"})])),_:1},8,["data","onSelect","onSelectAll","onSelectionChange"])),[[U,e.loading]]),c(o(k,{total:e.total,page:e.query.pageNum,"onUpdate:page":t[4]||(t[4]=t=>e.query.pageNum=t),limit:e.query.pageSize,"onUpdate:limit":t[5]||(t[5]=t=>e.query.pageSize=t),onPagination:t[6]||(t[6]=t=>e.getList())},null,8,["total","page","limit"]),[[f,e.total>0]])])),_:1},8,["modelValue","append-to-body"]),o(z,{visible:e.showSelectTag,"onUpdate:visible":t[8]||(t[8]=t=>e.showSelectTag=t),type:"2",selected:e.tagList,onSuccess:e.getSelectTag},null,8,["visible","selected","onSuccess"])])}],["__scopeId","data-v-68e9ecc2"]]);export{L as default};
