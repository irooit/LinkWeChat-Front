import{e as t,b as e}from"./api-afde1919.js";import{g as a}from"./groupMessage-f31c8fd2.js";import s from"./PreviewInPhone-9ed75a0f.js";import i from"./Step3Type1-66818cc7.js";import r from"./Step3Type2-084f3476.js";import p from"./Step3Type3-32e1f72c.js";import o from"./Step3Type4-e2c75edf.js";import n from"./FriendsCircPreview-70a3a02c.js";import m from"./AppPreview-1f4ca0cc.js";import{_ as l}from"./quill-image-resize-module-c051113e.js";import{ai as d,aq as h,o as b,c as u,_ as D,U as c,a as f,O as g,T as y,X as j,Y as v,V as T,bl as w,bj as k}from"./@vue-e400fd81.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./IdentityAttachment-b9bf008d.js";import"./index-0bf429ac.js";import"./scriptCenter-9e8c6ca2.js";import"./modleCenter-5112f339.js";import"./DragTable-b6be070d.js";import"./sortablejs-b0ad9b27.js";import"./MessageContentForm-5a22ed37.js";import"./staff-48996164.js";import"./PicTitContent-8b500b6d.js";import"./PosterAdd-51b39872.js";import"./index-618cff16.js";import"./tag-13936295.js";import"./fabric-8da0df30.js";import"./poster-241340a9.js";import"./liveCodeTable-73b404a8.js";import"./group-16414119.js";import"./pullNews-68e01d94.js";import"./TemplateLibrary-f59d0076.js";import"./welcome-6ff4c53e.js";import"./SelectCustomer-88c1f692.js";import"./businessConver-2b86f97c.js";import"./SelectEndDate-6c9f798c.js";import"./moment-8163541f.js";import"./SelectSendType-b1e10e8d.js";import"./SelectGroup-82211b43.js";import"./SelectMember-7e073ac7.js";import"./organization-9bed3593.js";import"./SelectDept-7a07b4de.js";import"./SelectPost-d0ccd09d.js";import"./code-ab4e587b.js";const I={components:{PreviewInPhone:s,FriendsCircPreviewVue:n,AppPreviewVue:m,Step3Type1:i,Step3Type2:r,Step3Type3:p,Step3Type4:o},name:"step-third",data:()=>({baseData:{type:0,client:{content:"",type:0,sex:null,trackState:null,addBeginTime:"",addEndTime:"",labelIds:"",userIds:"",sendType:0,taskSendTime:"",taskEndTime:""},attachments:[],senderList:[]},submitLoading:!1,preview:{previewData:[],templateInfo:""}}),props:{isDetail:{type:Boolean,default:!1},data:{type:Object,default:{}},posterObj:{type:Object,default:{}}},watch:{posterObj(){},data:{handler(t,e){t&&(this.baseData=t)},deep:!0,immediate:!0}},methods:{getPreviewInfoText(t){this.preview.templateInfo=t.templateInfo},getPreviewInfo(t){this.preview.previewData=JSON.parse(JSON.stringify(t.previewData)),1==this.baseData.style?this.preview.previewData.unshift({mediaType:"5",materialUrl:this.posterObj.materialUrl,materialName:this.posterObj.materialName,digest:this.posterObj.digest}):this.preview.previewData.unshift({mediaType:"0",materialUrl:"https://link-wechat-1251309172.cos.ap-nanjing.myqcloud.com/2023-03-20/t1679281068694-X76U09uVyhcKs5EW.png"})},submitFn(){0==this.baseData.type?this.submitType1():1==this.baseData.type?this.submitType2():2==this.baseData.type?this.submitType3():this.submitType4()},compareDate:(t,e)=>new Date(t.replace(/\-/g,"/"))>new Date(e.replace(/\-/g,"/")),submitType4(){if(this.$refs.type4.checkFn()){if(1==this.baseData.appMsg.sendType){if(!this.baseData.appMsg.taskSendTime)return void this.msgError("请填写定时发送时间！");if(this.baseData.appMsg.taskEndTime&&this.compareDate(this.baseData.appMsg.taskSendTime,this.baseData.appMsg.taskEndTime))return void this.msgError("结束时间不得小于发送时间！")}this.pushData(this.baseData)}},async submitType3(){if(this.$refs.type3.checkFn()){if(1==this.baseData.moments.sendType){if(!this.baseData.moments.taskSendTime)return void this.msgError("请填写定时发送时间！");if(this.baseData.moments.taskEndTime&&this.compareDate(this.baseData.moments.taskSendTime,this.baseData.moments.taskEndTime))return void this.msgError("结束时间不得小于发送时间！")}if(this.submitLoading=!0,1==this.baseData.moments.type){let t={userIds:this.baseData.moments.userIds,tagIds:this.baseData.moments.labelIds,beginTime:this.baseData.moments.addBeginTime,endTime:this.baseData.moments.addEndTime,gender:this.baseData.moments.sex,trackState:this.baseData.moments.trackState};await a(t).then((t=>{200===t.code&&t.data&&t.data.length&&(this.baseData.senderList=this.newArryById(t.data))}))}this.pushData(this.baseData)}},submitType2(){if(1==this.baseData.group.type){if(!this.baseData.group.userIds)return void this.msgError("请选择群主！");this.baseData.senderList=this.baseData.group.userIds.split(",").map((t=>({userId:t})))}if(1==this.baseData.group.sendType){if(!this.baseData.group.taskSendTime)return void this.msgError("请填写定时发送时间！");if(this.baseData.group.taskEndTime&&this.compareDate(this.baseData.group.taskSendTime,this.baseData.group.taskEndTime))return void this.msgError("结束时间不得小于发送时间！")}this.baseData.group.content&&this.baseData.attachments.unshift({content:this.baseData.group.content,msgType:"text"}),this.pushData(this.baseData)},async submitType1(){if(0==this.baseData.type&&1==this.baseData.client.sendType){if(!this.baseData.client.taskSendTime)return void this.msgError("请填写定时发送时间！");if(this.baseData.client.taskEndTime&&this.compareDate(this.baseData.client.taskSendTime,this.baseData.client.taskEndTime))return void this.msgError("结束时间不得小于发送时间！")}if(this.baseData.client.content&&this.baseData.attachments.unshift({content:this.baseData.client.content,msgType:"text"}),this.submitLoading=!0,1==this.baseData.client.type){let t={userIds:this.baseData.client.userIds,tagIds:this.baseData.client.labelIds,beginTime:this.baseData.client.addBeginTime,endTime:this.baseData.client.addEndTime,gender:this.baseData.client.sex,trackState:this.baseData.client.trackState};await a(t).then((t=>{200===t.code&&t.data&&t.data.length&&(this.baseData.senderList=this.newArryById(t.data))}))}this.pushData(this.baseData)},pushData(a){this.submitLoading=!0,(a.id?t(a):e(a)).then((t=>{200==t.code&&(this.msgSuccess("操作成功!"),this.$router.back()),this.submitLoading=!1})).catch((()=>{if(this.submitLoading=!1,0==this.baseData.type||1==this.baseData.type){let t=[];this.baseData.attachments.forEach((e=>{"text"!=e.msgType&&t.push(e)})),this.baseData.attachments=t}}))},newArryById(t){let e={},a=[];for(let s=0;s<t.length;s++){let i=t[s];if(e[i.firstUserId])for(let t=0;t<a.length;t++){let e=a[t];if(e.userId==i.firstUserId){e.customerList.push(i.externalUserid);break}}else a.push({userId:i.firstUserId,customerList:[i.externalUserid]}),e[i.firstUserId]=i}return a},goPrdSteps(t){this.$emit("steps",t)},getData(t){this.baseData=t,this.$emit("update",this.baseData)}}},S=t=>(w("data-v-feddb77b"),t=t(),k(),t),P={class:"g-card"},x={key:0,class:"g-card",style:{"text-align":"right"}},E={class:"g-card",style:{height:"100%"}},U=S((()=>f("div",{class:"info_title"},"消息预览",-1))),_={class:"g-card",style:{height:"100%"}},L=S((()=>f("div",{class:"info_title"},"朋友圈预览",-1))),C={class:"g-card",style:{height:"100%"}},O=S((()=>f("div",{class:"info_title"},"消息预览",-1)));const A=l(I,[["render",function(t,e,a,s,i,r){const p=d("Step3Type1"),o=d("Step3Type2"),n=d("Step3Type3"),m=d("Step3Type4"),l=d("el-button"),w=d("el-col"),k=d("PreviewInPhone"),I=d("FriendsCircPreviewVue"),S=d("AppPreviewVue"),A=d("el-row"),M=h("loading");return b(),u("div",null,[D(A,{gutter:20,type:"flex",style:{"margin-top":"20px"}},{default:c((()=>[D(w,null,{default:c((()=>[f("div",P,[g(t.$slots,"default",{},void 0,!0),0==i.baseData.type?(b(),y(p,{key:0,isDetail:a.isDetail,data:i.baseData,onUpdate:r.getData,onPreview:r.getPreviewInfo,onPreviewText:r.getPreviewInfoText},null,8,["isDetail","data","onUpdate","onPreview","onPreviewText"])):1==i.baseData.type?(b(),y(o,{key:1,isDetail:a.isDetail,data:i.baseData,onUpdate:r.getData,onPreview:r.getPreviewInfo,onPreviewText:r.getPreviewInfoText},null,8,["isDetail","data","onUpdate","onPreview","onPreviewText"])):2==i.baseData.type?(b(),y(n,{key:2,isDetail:a.isDetail,ref:"type3",data:i.baseData,onUpdate:r.getData,onPreviewText:r.getPreviewInfoText},null,8,["isDetail","data","onUpdate","onPreviewText"])):3==i.baseData.type?(b(),y(m,{key:3,isDetail:a.isDetail,ref:"type4",data:i.baseData,onUpdate:r.getData},null,8,["isDetail","data","onUpdate"])):j("",!0)]),a.isDetail?j("",!0):(b(),u("div",x,[D(l,{plain:"",onClick:e[0]||(e[0]=t=>r.goPrdSteps(1))},{default:c((()=>[v("上一步")])),_:1}),T((b(),y(l,{type:"primary",onClick:r.submitFn},{default:c((()=>[v("确认推广")])),_:1},8,["onClick"])),[[M,i.submitLoading]])]))])),_:3}),0==i.baseData.type||1==i.baseData.type?(b(),y(w,{key:0,style:{"flex-basis":"370px"}},{default:c((()=>[f("div",E,[U,D(k,{list:i.preview.previewData,templateInfo:i.preview.templateInfo},null,8,["list","templateInfo"])])])),_:1})):j("",!0),2==i.baseData.type?(b(),y(w,{key:1,style:{"flex-basis":"370px"}},{default:c((()=>[f("div",_,[L,D(I,{value:i.preview.templateInfo,poster:a.posterObj.materialUrl},null,8,["value","poster"])])])),_:1})):j("",!0),3==i.baseData.type?(b(),y(w,{key:2,style:{"flex-basis":"750px"}},{default:c((()=>[f("div",C,[O,D(S,{title:i.baseData.taskName,value:a.posterObj.materialUrl},null,8,["title","value"])])])),_:1})):j("",!0)])),_:3})])}],["__scopeId","data-v-feddb77b"]]);export{A as default};
