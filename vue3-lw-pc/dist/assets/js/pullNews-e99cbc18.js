import e from"./IdentityAttachment-8108ffd0.js";import t from"./IdentitySelect-1f4fc77b.js";import s from"./PreviewInPhone-9ed75a0f.js";import a from"./PreViewInIdentity-7e6832fa.js";import i from"./cardTable-2c055b95.js";import{_ as l}from"./quill-image-resize-module-c051113e.js";import{ai as r,o,c as m,_ as n,U as p,T as d,a as h,Z as c,X as f,Y as u,bl as g,bj as y}from"./@vue-e400fd81.js";import"./index-0bf429ac.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./scriptCenter-9e8c6ca2.js";import"./modleCenter-5112f339.js";import"./DragTable-97e90e96.js";import"./sortablejs-b0ad9b27.js";import"./MessageContentForm-5a22ed37.js";import"./staff-48996164.js";import"./PicTitContent-8b500b6d.js";import"./PosterAdd-51b39872.js";import"./index-618cff16.js";import"./tag-13936295.js";import"./fabric-8da0df30.js";import"./poster-241340a9.js";import"./liveCodeTable-73b404a8.js";import"./group-16414119.js";import"./pullNews-68e01d94.js";import"./TemplateLibrary-f59d0076.js";import"./welcome-6ff4c53e.js";import"./IdentitySelectBase-8ee7d5fd.js";import"./code-ab4e587b.js";import"./moment-8163541f.js";const j={props:{groupCodeId:{type:String,default:""},query:{type:Object,default:{}}},watch:{query:{handler(e){if(e.businessData){let t=JSON.parse(e.businessData).name,s=JSON.parse(e.businessData).money,a={id:e.businessId,name:t,money:s};this.selectCard(a)}let t=[];e.attachments?e.attachments.forEach((e=>{"text"===e.msgType?(this.templateInfo=e.content,this.attachmentsData.templateInfo=e.content,this.attachmentsData.templateInfo=e.content):t.push(e)})):e.qrAttachments&&e.qrAttachments.forEach((e=>{"text"===e.msgType?(this.templateInfo=e.content,this.attachmentsData.templateInfo=e.content,this.attachmentsData.templateInfo=e.content):t.push(e)})),t&&(this.attachmentsData.attachments=this.setAttachments(t),this.previewData=this.setAttachments(t))},deep:!0,immediate:!0}},components:{IdentityAttachment:e,IdentitySelect:t,PreviewInPhone:s,PreviewInIdentity:a,CardTable:i},data:()=>({dialogVisibleCard:!1,choseDialog:!1,welcomVisible:!1,redId:null,form:{attachments:[]},headImage:null,rules:{},showSelectModal:!1,groupList:[],loading:!1,previewData:[],pullnewsInfo:{qrType:1,materialName:""},templateInfo:"",attachmentsData:{templateInfo:"",attachments:[]},tableList:[]}),mounted(){1===this.query.qrType?this.pullnewsInfo={qrType:1,materialName:""}:this.pullnewsInfo={qrType:2,materialName:"",digest:""}},methods:{radioClick(e){this.dialogVisibleCard=!0,e.length&&(this.redId=e[0].id)},getItemArry(e){this.posterUrl=e[0].materialUrl},selectCard(e){this.tableList=[],this.tableList.push(e),e.name&&(this.pullnewsInfo.materialName=e.name);let t={businessId:e.id,businessData:JSON.stringify({name:e.name,money:e.money})};this.form=Object.assign(this.form,t)},changeInfo(e){this.templateInfo=e},getAttentment(e){let t=[];e.forEach((e=>{e.msgType&&t.push(e)})),this.form.attachments=t},getPhoneData(e){this.previewData=e},selectGroupFn(){this.showSelectModal=!0},setSelectData(e){e&&e.length&&(this.groupList=e,this.form.chatIdList=this.groupList.map((e=>e.chatId)).join(","))},transInfo(){let e=JSON.parse(JSON.stringify(this.form));this.templateInfo&&e.attachments.unshift({content:this.templateInfo,msgType:"text"}),this.$emit("createLiveCode",e)},handleValidateFn(){let e=!0;this.templateInfo||(e=!1,this.msgError("欢迎语不能为空！")),this.form.businessId||(e=!1,1===this.form.qrType?this.msgError("请选择红包"):this.msgError("请选择卡券"));let t=JSON.parse(JSON.stringify(this.form));return t.attachments.unshift({content:this.templateInfo,msgType:"text"}),this.$emit("createLiveCode",t),e},submit(){this.form.attachments.unshift({content:this.templateInfo,msgType:"text"}),this.posterUrl&&(this.form.posterUrl=this.posterUrl),this.$emit("next",this.form)},setAttachments(e){let t=[];return e&&e.length&&e.forEach((e=>{if("image"===e.msgType){let s={mediaType:"0",materialUrl:e.picUrl};t.push(s)}else if("video"===e.msgType){let s={mediaType:"2",materialUrl:e.fileUrl,coverUrl:e.picUrl,digest:e.description,materialName:e.title};t.push(s)}else if("file"===e.msgType){let s={mediaType:"3",materialUrl:e.fileUrl,digest:e.description,materialName:e.title};t.push(s)}else if("text"===e.msgType){let s={mediaType:"4",content:e.content};t.push(s)}else if("link"===e.msgType){let s={mediaType:"9",content:e.content,coverUrl:e.picUrl,materialUrl:e.linkUrl,materialName:e.title};t.push(s)}else if("miniprogram"===e.msgType){let s={mediaType:"11",digest:e.appId,materialName:e.title,coverUrl:e.picUrl,materialUrl:e.fileUrl};t.push(s)}else if("news"===e.msgType){let s={mediaType:"12",digest:e.description,materialUrl:e.fileUrl,coverUrl:e.picUrl,content:e.content,materialName:e.title};t.push(s)}else if("posters"===e.msgType){let s={mediaType:"5",materialUrl:e.fileUrl,materialName:e.title};t.push(s)}})),t}}},b={class:"table-button"},I={class:"red-packet-message"},T={class:"red-packet-text"},w={key:0,class:"sub-des"},v=(e=>(g("data-v-ffda39af"),e=e(),y(),e))((()=>h("div",{class:"sub-des"},"选择卡券之前需要在微信支付商户平台的营销中心提前创建代金券",-1)));const U=l(j,[["render",function(e,t,s,a,i,l){const g=r("el-table-column"),y=r("el-table"),j=r("el-button"),U=r("el-form-item"),D=r("IdentityAttachment"),C=r("el-col"),q=r("el-row"),x=r("el-form"),L=r("PreviewInPhone"),N=r("IdentitySelect"),S=r("CardTable");return o(),m("div",null,[n(q,{gutter:10,type:"flex"},{default:p((()=>[n(C,null,{default:p((()=>[n(x,{model:i.form,rules:i.rules,ref:"form","label-width":"140px"},{default:p((()=>[n(q,null,{default:p((()=>[n(C,{sm:24,md:18},{default:p((()=>[1===s.query.qrType?(o(),d(U,{key:0,label:"选择红包:",required:""},{default:p((()=>[h("div",b,[i.tableList.length?(o(),d(y,{key:0,data:i.tableList,class:"mr10"},{default:p((()=>[n(g,{width:"300",label:"红包",align:"center",prop:"name"},{default:p((({row:e})=>[h("div",I,[h("div",T,c(e.name),1)])])),_:1}),n(g,{label:"红包金额(元)",align:"center",prop:"money"})])),_:1},8,["data"])):f("",!0),n(j,{text:"",onClick:t[0]||(t[0]=e=>l.radioClick(i.tableList)),class:"button"},{default:p((()=>[u(c(i.tableList.length?"修改":"选择红包"),1)])),_:1})]),i.tableList.length?f("",!0):(o(),m("div",w,"选择红包之前需要在红包工具->企业红包中创建红包"))])),_:1})):(o(),d(U,{key:1,label:"选择卡券:",required:""},{default:p((()=>[n(j,{text:"",onClick:t[1]||(t[1]=e=>i.dialogVisibleCard=!0)},{default:p((()=>[u(c(i.tableList.length?"修改":"选择卡券"),1)])),_:1}),v])),_:1})),n(D,{onPhoneData:l.getPhoneData,onSuccess:l.getAttentment,onChangeInfo:l.changeInfo,baseData:i.attachmentsData,maxlengthTwo:8},null,8,["onPhoneData","onSuccess","onChangeInfo","baseData"])])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),n(C,{style:{"flex-basis":"400px"}},{default:p((()=>[n(L,{name:"新客户",list:i.previewData,templateInfo:i.templateInfo,pullnewsInfo:{qrType:1,materialName:i.tableList.length?i.tableList[0].name:""}},null,8,["list","templateInfo","pullnewsInfo"])])),_:1})])),_:1}),n(N,{choseDialog:i.choseDialog,"onUpdate:choseDialog":t[2]||(t[2]=e=>i.choseDialog=e),onItemArry:l.getItemArry,moduleType:5},null,8,["choseDialog","onItemArry"]),i.dialogVisibleCard?(o(),d(S,{key:0,twoVisible:i.dialogVisibleCard,"onUpdate:twoVisible":t[3]||(t[3]=e=>i.dialogVisibleCard=e),qrType:s.query.qrType,redId:i.redId,onSelectCard:l.selectCard},null,8,["twoVisible","qrType","redId","onSelectCard"])):f("",!0)])}],["__scopeId","data-v-ffda39af"]]);export{U as default};
