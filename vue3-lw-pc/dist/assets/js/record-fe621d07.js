import{e,s as t,f as a}from"./groupMessage-f31c8fd2.js";import{ai as i,aq as s,o as l,c as o,_ as r,U as n,aa as d,K as p,a9 as u,T as m,Y as c,a as h,V as g,Z as y,X as f,$ as j}from"./@vue-e400fd81.js";import{_ as b}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const T={class:"g-card"},k={class:"mid-action"};const q=b({name:"Operlog",data:()=>({loading:!1,ids:[],total:0,list:[],dateRange:[],query:{pageNum:1,pageSize:10,content:void 0,chatType:void 0,isTask:void 0,orderByColumn:"create_time",isAsc:"desc"},pushType:{1:"发给客户",2:"发给客户群"},timedTask:{0:"立即发送",1:"定时发送"},pickerOptions:{disabledDate:e=>e.getTime()>Date.now()}}),created(){this.getList()},methods:{getList(t){this.dateRange?(this.query.beginTime=this.dateRange[0],this.query.endTime=this.dateRange[1]):(this.query.beginTime="",this.query.endTime=""),t&&(this.query.pageNum=t),this.loading=!0,e(this.query).then((({rows:e,total:t})=>{this.list=e,this.total=Number(t),this.loading=!1,this.ids=[]})).catch((()=>{this.loading=!1}))},resetQuery(){this.dateRange=[],this.$refs.queryForm.resetFields(),this.getList(1)},handleSelectionChange(e){this.ids=e.map((e=>e.id))},handleDelete(e){const t=e.operId||this.ids;this.$confirm('是否确认删除日志编号为"'+t+'"的数据项?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){})).then((()=>{this.getList(),this.msgSuccess("删除成功")})).catch((function(){}))},async goRoute(e,{id:t,isTask:a,status:i}={}){const s={id:t,isTask:a,status:i};"add"==e&&t&&await this.$confirm("是否确认从当前任务进行复制？点击确定进入复制新建页面","提示"),this.$router.push({path:e,query:s})},syncMsg(e){t(this).then((({data:e})=>{this.msgSuccess("同步成功"),this.getList()})).catch((()=>{}))},cancelSend(e){a(e.id).then((e=>{200==e.code?(this.getList(),this.msgSuccess("操作成功")):this.msgError(e.msg||"操作失败")}))}}},[["render",function(e,t,a,b,q,_){const v=i("el-input"),w=i("el-form-item"),C=i("el-option"),S=i("el-select"),L=i("el-button"),V=i("el-form"),x=i("el-table-column"),R=i("el-table"),z=i("pagination"),U=s("loading");return l(),o("div",null,[r(V,{model:q.query,ref:"queryForm",inline:!0,"label-position":"left",class:"top-search","label-width":"70px"},{default:n((()=>[r(w,{label:"群发内容",prop:"content"},{default:n((()=>[r(v,{modelValue:q.query.content,"onUpdate:modelValue":t[0]||(t[0]=e=>q.query.content=e),placeholder:"请输入群发内容",clearable:"",onKeyup:t[1]||(t[1]=d((e=>_.getList(1)),["enter"]))},null,8,["modelValue"])])),_:1}),r(w,{label:"群发类型",prop:"chatType"},{default:n((()=>[r(S,{modelValue:q.query.chatType,"onUpdate:modelValue":t[2]||(t[2]=e=>q.query.chatType=e),placeholder:"请选择群发类型"},{default:n((()=>[(l(!0),o(p,null,u(q.pushType,((e,t,a)=>(l(),m(C,{label:e,value:t,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(w,{label:"发送类型",prop:"isTask"},{default:n((()=>[r(S,{modelValue:q.query.isTask,"onUpdate:modelValue":t[3]||(t[3]=e=>q.query.isTask=e),placeholder:"请选择发送类型"},{default:n((()=>[(l(!0),o(p,null,u(q.timedTask,((e,t,a)=>(l(),m(C,{label:e,value:t,key:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(w,{"label-width":"0"},{default:n((()=>[r(L,{type:"primary",onClick:t[4]||(t[4]=e=>_.getList(1))},{default:n((()=>[c("查询")])),_:1}),r(L,{onClick:_.resetQuery},{default:n((()=>[c("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),h("div",T,[h("div",k,[r(L,{type:"primary",onClick:t[5]||(t[5]=e=>_.goRoute("add"))},{default:n((()=>[c("新建群发")])),_:1})]),g((l(),m(R,{data:q.list,onSelectionChange:_.handleSelectionChange},{default:n((()=>[r(x,{label:"群发内容",align:"center",prop:"content"}),r(x,{label:"群发类型",align:"center"},{default:n((({row:e})=>[c(y(q.pushType[e.chatType]),1)])),_:1}),r(x,{label:"发送类型",align:"center"},{default:n((({row:e})=>[c(y(q.timedTask[e.isTask]),1)])),_:1}),r(x,{label:"发送时间",align:"center",prop:"sendTime",width:"180"}),r(x,{label:"最近更新时间",align:"center",prop:"createTime",width:"180"}),r(x,{label:"操作",align:"center",width:"180"},{default:n((({row:e})=>[r(L,{text:"",onClick:t=>_.goRoute("detail",e)},{default:n((()=>[c("详情")])),_:2},1032,["onClick"]),r(L,{text:"",onClick:t=>_.goRoute("add",e)},{default:n((()=>[c("复制")])),_:2},1032,["onClick"]),1===e.isTask&&0===e.status?(l(),m(L,{key:0,text:"",onClick:t=>_.cancelSend(e)},{default:n((()=>[c("取消发送")])),_:2},1032,["onClick"])):f("",!0)])),_:1})])),_:1},8,["data","onSelectionChange"])),[[U,q.loading]]),g(r(z,{total:q.total,page:q.query.pageNum,"onUpdate:page":t[6]||(t[6]=e=>q.query.pageNum=e),limit:q.query.pageSize,"onUpdate:limit":t[7]||(t[7]=e=>q.query.pageSize=e),onPagination:t[8]||(t[8]=e=>_.getList())},null,8,["total","page","limit"]),[[j,q.total>0]])])])}],["__scopeId","data-v-1684fcbc"]]);export{q as default};
