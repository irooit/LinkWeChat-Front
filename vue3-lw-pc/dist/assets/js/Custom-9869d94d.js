import e from"./ChartBar-39a01942.js";import t from"./ChartLine-b009fc4d.js";import a from"./SelectDept-7a07b4de.js";import{d as i}from"../index-044285d2.js";import{s,e as r,g as l}from"./circle-2faa2a32.js";import{_ as o}from"./quill-image-resize-module-c051113e.js";import{ai as n,aq as p,o as d,c as u,_ as m,a as c,T as h,U as g,X as y,Y as j,V as v,Z as f}from"./@vue-e400fd81.js";import"./echarts-8e7b9cd7.js";import"./tslib-a4e99503.js";import"./zrender-da4e2cf7.js";import"./lodash.merge-f1a4e0c2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./organization-9bed3593.js";const b={name:"scene-statistics-scene",components:{ChartLine:t,ChartBar:e,SelectDept:a},data:()=>({dialogVisible:!1,userArray:[],userName:"",cardData:[{title:"预计送达客户数 ",tips:"预计能够看到本朋友圈推送的客户数（不去重）",value:0,noArrow:!0},{title:"未送达客户数",tips:"员工未执行该朋友圈任务而未收到相应推送的客户数（不去重）",value:0},{title:"已送达客户数",tips:"员工已执行该朋友圈任务而已收到相应推送的客户数（不去重）",value:0},{title:"送达失败客户数",tips:"因已达送但超过朋友圈可见数量上限导致送达失败的客户数（不去重）",value:0},{title:"今日送达客户数",tips:"员工今日已执行该朋友圈任务并成功收到推送的客户数（不去重）",value:0}],value:[],exportLoading:!1,tableList:[],loading:!1,total:0,query:{pageSize:10,pageNum:1,weUserIds:"",deliveryStatus:""},tableSearch:{},id:void 0,type:void 0,name:""}),mounted(){this.type=this.$route.query.type,this.id=this.$route.query.id,this.name=this.$route.query.name,3===this.type&&this.cardData.shift(),this.getTabTotalFn(),this.getTableChangeSize()},methods:{dealStatus(e){switch(e){case 0:return"已送达";case 1:return"未送达";case 2:return"送达失败"}},getTabTotalFn(){s(this.id).then((e=>{this.cardData[0].value=e.data.predictSend,this.cardData[1].value=e.data.nonSend,this.cardData[2].value=e.data.sent,this.cardData[3].value=e.data.failSend,3!==this.type&&(this.cardData[4].value=e.data.todaySend)}))},exportFn(){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,this.query.weMomentsTaskId=this.id,r(Object.assign({},this.query))))).then((e=>{if(!e)return;const t=new Blob([e],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(t,"客户统计");else{const e=URL.createObjectURL(t),a=document.createElement("a");a.style.display="none",a.href=e,a.download=i(new Date,"YYYY-MM-DD")+"-"+this.name+"-客户统计.xlsx",a.click(),URL.revokeObjectURL(a.href)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},getSelectUser(e){this.userArray=e,this.userName=this.userArray.map((function(e,t){return e.name})).join(","),this.query.weUserIds=this.userArray.map((function(e,t){return e.userId})).join(",")},getTableChangeSize(){this.loading=!0,this.query.weMomentsTaskId=this.id,l(this.query).then((e=>{this.tableList=e.rows,this.total=+e.total,this.loading=!1}))},resetQuery(){this.query={pageSize:10,pageNum:1,weUserIds:"",deliveryStatus:""},this.userArray=[],this.userName="",this.getTableChangeSize()},handleSearch(){this.getTableChangeSize()}},created(){}},S={class:"g-card"},w=c("div",{class:"g-card-title"},"客户记录",-1),q={style:{display:"flex","align-items":"center","justify-content":"space-between"}},x={style:{display:"flex","align-items":"center"}};const C=o(b,[["render",function(e,t,a,i,s,r){const l=n("CardGroupIndex"),o=n("el-input"),b=n("el-option"),C=n("el-select"),U=n("el-button"),z=n("el-table-column"),k=n("el-table"),D=n("pagination"),L=n("SelectUser"),T=p("loading");return d(),u("div",null,[m(l,{data:s.cardData},null,8,["data"]),c("div",S,[w,c("div",q,[c("div",x,[m(o,{style:{width:"150px","margin-right":"20px"},"model-value":s.userName,readonly:"",onClick:t[0]||(t[0]=e=>s.dialogVisible=!0),placeholder:"请选择成员"},null,8,["model-value"]),3!==s.type?(d(),h(C,{key:0,modelValue:s.query.deliveryStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>s.query.deliveryStatus=e),placeholder:"请选择状态",style:{width:"150px","margin-right":"20px"}},{default:g((()=>[m(b,{label:"已送达",value:0}),m(b,{label:"未送达",value:1}),m(b,{label:"送达失败",value:2})])),_:1},8,["modelValue"])):y("",!0),m(U,{type:"primary",onClick:r.handleSearch},{default:g((()=>[j("查询")])),_:1},8,["onClick"]),m(U,{onClick:r.resetQuery},{default:g((()=>[j("清空")])),_:1},8,["onClick"])]),c("div",null,[v((d(),h(U,{type:"primary",onClick:r.exportFn},{default:g((()=>[j("导出")])),_:1},8,["onClick"])),[[T,s.exportLoading]])])]),v((d(),h(k,{data:s.tableList,style:{width:"100%","margin-bottom":"20px"}},{default:g((()=>[m(z,{label:"客户名称",align:"center",prop:"customerName","min-width":"100","show-overflow-tooltip":""}),m(z,{label:"对应成员",align:"center",prop:"userName","show-overflow-tooltip":""}),m(z,{label:"送达状态",align:"center",prop:"timeOutNum","show-overflow-tooltip":""},{default:g((({row:e})=>[c("div",null,f(r.dealStatus(e.deliveryStatus)),1)])),_:1})])),_:1},8,["data"])),[[T,s.loading]]),m(D,{total:s.total,page:s.query.pageNum,"onUpdate:page":t[2]||(t[2]=e=>s.query.pageNum=e),limit:s.query.pageSize,"onUpdate:limit":t[3]||(t[3]=e=>s.query.pageSize=e),onPagination:t[4]||(t[4]=e=>r.getTableChangeSize())},null,8,["total","page","limit"])]),m(L,{visible:s.dialogVisible,"onUpdate:visible":t[5]||(t[5]=e=>s.dialogVisible=e),title:"组织架构",defaultValues:s.userArray,onSuccess:r.getSelectUser},null,8,["visible","defaultValues","onSuccess"])])}]]);export{C as default};
