import e from"./ChartLine-b009fc4d.js";import t from"./SearchTitle-ceb204ee.js";import{c as a,q as i,f as l}from"./api-49257dfd.js";import s from"./SelectDept-7a07b4de.js";import{d as r}from"../index-044285d2.js";import{_ as o}from"./quill-image-resize-module-c051113e.js";import{ai as n,aq as p,o as u,c as d,_ as m,a as c,U as h,Y as g,V as b,T as j,Z as v}from"./@vue-e400fd81.js";import"./echarts-8e7b9cd7.js";import"./tslib-a4e99503.js";import"./zrender-da4e2cf7.js";import"./lodash.merge-f1a4e0c2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./moment-8163541f.js";import"./organization-9bed3593.js";const y={name:"records-statistic",components:{SearchTitle:t,ChartLine:e,SelectDept:s},data:()=>({deptArray:[],deptName:"",dialogDeptVisible:!1,dialogVisible:!1,userArray:[],userName:"",cardData:[{title:"本周督导成员数",value:0},{title:"客户会话数",value:0},{title:"客群会话数",value:0},{title:"成员回复次数",value:0},{title:"成员超时次数",value:0},{title:"成员超时率",value:0},{title:"客户会话超时率",value:0},{title:"客群会话超时率",value:0}],value:[],id:"",exportLoading:!1,tableList:[],loading:!1,total:0,query:{pageSize:10,pageNum:1,beginTime:"",endTime:"",deptIds:"",userIds:""},tableSearch:{}}),methods:{exportFn(){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,a(this.id,Object.assign({},this.query))))).then((e=>{if(!e)return;const t=new Blob([e],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(t,"质检详情");else{const e=URL.createObjectURL(t),a=document.createElement("a");a.style.display="none",a.href=e,a.download=r(new Date,"YYYY-MM-DD")+"-质检详情.xlsx",a.click(),URL.revokeObjectURL(a.href)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},handleSearch(){this.getTableChangeSize()},resetQuery(){this.query={pageSize:10,pageNum:1,beginTime:"",endTime:"",deptIds:"",userIds:""},this.userArray=[],this.userName="",this.deptArray=[],this.deptName="",this.getTableChangeSize()},getSelectUser(e){this.userArray=e,this.userName=this.userArray.map((function(e,t){return e.name})).join(","),this.query.userIds=this.userArray.map((function(e,t){return e.userId})).join(",")},selectedDept(e){this.deptArray=e,this.deptName=this.deptArray.map((function(e,t){return e.deptName})).join(","),this.query.deptIds=this.userArray.map((function(e,t){return e.deptId})).join(",")},getTabTotalFn(){i(this.id).then((e=>{this.cardData[0].value=e.data.staffNum,this.cardData[1].value=e.data.chatNum,this.cardData[2].value=e.data.groupChatNum,this.cardData[3].value=e.data.replyNum,this.cardData[4].value=e.data.timeOutNum,this.cardData[5].value=100*Number(e.data.timeOutRate)+"%",this.cardData[6].value=100*Number(e.data.chatTimeOutRate)+"%",this.cardData[7].value=100*Number(e.data.chatTimeOutRate)+"%"}))},getTableChangeSize(){this.loading=!0,l(this.id,Object.assign({},this.query)).then((e=>{this.tableList=e.rows,this.total=Number(e.total),this.loading=!1}))},getTableFn(e){this.loading=!0,this.query.beginTime=e.beginTime,this.query.endTime=e.endTime,this.getTableChangeSize()}},created(){this.id=this.$route.query.id,this.getTabTotalFn()}},f={class:"g-card"},w=c("div",{class:"g-card-title"},"数据报表",-1),T={style:{display:"flex","align-items":"center","justify-content":"space-between"}},N={style:{display:"flex","align-items":"center"}};const S=o(y,[["render",function(e,t,a,i,l,s){const r=n("CardGroupIndex"),o=n("search-title"),y=n("el-input"),S=n("el-button"),D=n("el-table-column"),x=n("el-table"),q=n("pagination"),C=n("SelectUser"),O=n("SelectDept"),z=p("loading");return u(),d("div",null,[m(r,{data:l.cardData},null,8,["data"]),c("div",f,[w,c("div",T,[c("div",N,[m(o,{showMore:!0,onSearch:s.getTableFn},null,8,["onSearch"]),m(y,{style:{width:"150px"},"model-value":l.userName,readonly:"",onClick:t[0]||(t[0]=e=>l.dialogVisible=!0),placeholder:"请选择成员"},null,8,["model-value"]),m(y,{style:{width:"150px",margin:"0 20px"},"model-value":l.deptName,readonly:"",onClick:t[1]||(t[1]=e=>l.dialogDeptVisible=!0),placeholder:"请选择部门"},null,8,["model-value"]),m(S,{type:"primary",onClick:s.handleSearch},{default:h((()=>[g("查询")])),_:1},8,["onClick"]),m(S,{onClick:s.resetQuery},{default:h((()=>[g("重置")])),_:1},8,["onClick"])]),b((u(),j(S,{type:"primary",onClick:s.exportFn},{default:h((()=>[g("导出Excel")])),_:1},8,["onClick"])),[[z,l.exportLoading]])]),b((u(),j(x,{data:l.tableList,style:{width:"100%"}},{default:h((()=>[m(D,{label:"成员名称",align:"center",prop:"userName","min-width":"100","show-overflow-tooltip":""}),m(D,{label:"所属部门",align:"center",prop:"deptName","show-overflow-tooltip":""}),m(D,{label:"超时次数",align:"center",prop:"timeOutNum","show-overflow-tooltip":""}),m(D,{label:"超时率",align:"center",prop:"timeOutRate","show-overflow-tooltip":""},{default:h((({row:e})=>[c("div",null,v(100*Number(e.timeOutRate)+"%"),1)])),_:1}),m(D,{label:"客户会话超时率",align:"center",prop:"chatTimeOutRate","show-overflow-tooltip":""},{default:h((({row:e})=>[c("div",null,v(100*Number(e.chatTimeOutRate)+"%"),1)])),_:1}),m(D,{label:"客群会话超时率",align:"center",prop:"groupChatTimeOutRate","show-overflow-tooltip":""},{default:h((({row:e})=>[c("div",null,v(100*Number(e.groupChatTimeOutRate)+"%"),1)])),_:1})])),_:1},8,["data"])),[[z,l.loading]]),m(q,{total:l.total,page:l.query.pageNum,"onUpdate:page":t[2]||(t[2]=e=>l.query.pageNum=e),limit:l.query.pageSize,"onUpdate:limit":t[3]||(t[3]=e=>l.query.pageSize=e),onPagination:t[4]||(t[4]=e=>s.getTableChangeSize())},null,8,["total","page","limit"])]),m(C,{visible:l.dialogVisible,"onUpdate:visible":t[5]||(t[5]=e=>l.dialogVisible=e),title:"组织架构",defaultValues:l.userArray,onSuccess:s.getSelectUser},null,8,["visible","defaultValues","onSuccess"]),m(O,{defaultValues:l.deptArray,visible:l.dialogDeptVisible,"onUpdate:visible":t[6]||(t[6]=e=>l.dialogDeptVisible=e),title:"选择部门",onSuccess:s.selectedDept},null,8,["defaultValues","visible","onSuccess"])])}]]);export{S as default};
