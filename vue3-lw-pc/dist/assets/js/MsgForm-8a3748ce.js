import{_ as e}from"./quill-image-resize-module-c051113e.js";import{ai as l,o as t,c as a,T as s,U as r,a as o,Y as m,Z as i,_ as d,K as p,X as f,R as u,a9 as n,P as g,bl as y,bj as c}from"./@vue-e400fd81.js";import"./quill-c6b3d2fb.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";var h=(e,l,t)=>{/^https?:\/\//gi.test(l)?t():t(new Error("必须以 http://或 https://开头"))};const b={name:"",components:{},props:{data:{type:Object,default:()=>({})},disabled:{type:Boolean}},data(){return{form:Object.assign({scopeType:1,sendType:1,weMessageTemplate:{msgType:"text"}},this.data),rules:Object.freeze({content:[{required:!0,message:"不能为空",trigger:"blur"}],fileUrl:[{required:!0,message:"不能为空",trigger:"change"}],title:[{required:!0,message:"不能为空",trigger:"blur"}],msgTitle:[{required:!0,message:"不能为空",trigger:"blur"}],description:[{required:!0,message:"不能为空",trigger:"blur"}],picUrl:[{required:!0,message:"不能为空",trigger:"blur"}],sendTime:[{required:!0,message:"不能为空",trigger:"blur"}],linkUrl:[{required:!0,message:"不能为空",trigger:"blur"},{validator:h,trigger:"blur"}]}),typeDict:{text:"文本",image:"图片",news:"图文",video:"视频",file:"文件"},dialogVisible:!1}},computed:{},watch:{"form.weMessageTemplate.msgType"(e,l){this.disabled||(this.form.weMessageTemplate={msgType:e},this.$route.query.posterId&&"image"==e&&(this.form.weMessageTemplate.picUrl=this.$route.query.posterId))}},created(){this.form.toParty?"string"==typeof this.form.toParty&&(this.form.toParty=this.form.toParty.split(","),this.form.toPartyName=this.form.toPartyName.split(",")):(this.form.toParty=[],this.form.toPartyName=[]),this.form.toUser?"string"==typeof this.form.toUser&&(this.form.toUser=this.form.toUser.split(","),this.form.toUserName=this.form.toUserName.split(",")):(this.form.toUser=[],this.form.toUserName=[]),this.form.robotId&&delete this.typeDict.video,this.$route.query.posterId&&(this.form.weMessageTemplate.msgType="image",this.form.weMessageTemplate.picUrl=this.$route.query.posterId)},mounted(){},methods:{selectedUser(e){this.form.toParty=[],this.form.toPartyName=[],this.form.toUser=[],this.form.toUserName=[],e.map((l=>{if(l.isParty)this.form.toParty.push(l.userId),this.form.toPartyName.push(l.name);else{l.userDepts.some((l=>e.some((e=>e.userId===l.deptId))))||(this.form.toUser.push(l.userId),this.form.toUserName.push(l.name))}}))},async submit(e){let l=JSON.parse(JSON.stringify(this.form)),t=await this.$refs.form.validate();t=await this.$refs.formCon.validate(),t&&(2!=l.scopeType||l.toParty.concat(l.toUser).length?2==l.sendType&&new Date(l.sendTime).getTime()<=Date.now()?this.msgError("定时发送时间不能小于当前时间"):(l.status=e,this.$emit("submit",l)):this.msgError("发送范围不能为空"))}}},T=e=>(y("data-v-211ba9f5"),e=e(),c(),e),U={class:""},w={class:"title"},V=T((()=>o("span",null,"消息设置",-1))),_={style:{"font-size":"12px","margin-left":"10px"}},M={class:"theme"},v=T((()=>o("div",{class:"title"},"消息内容",-1))),x=T((()=>o("div",null,"支持jpg/jpeg/png格式，图片大小不超过2M",-1))),k=T((()=>o("div",null,"支持jpg/jpeg/png格式，建议200*200",-1))),j=T((()=>o("div",null,"支持mp4/mov格式，视频大小不超过10M",-1))),P=T((()=>o("div",null,"支持pdf/ppt/word文件，单个文件大小不超过20M",-1))),N={key:2,class:"mt20 ar"};const q=e(b,[["render",function(e,y,c,h,b,T){const q=l("el-input"),D=l("el-form-item"),I=l("el-radio"),S=l("el-radio-group"),z=l("el-button"),$=l("TagEllipsis"),O=l("el-date-picker"),C=l("el-form"),E=l("Upload"),R=l("SelectUser");return t(),a("div",{style:{margin:"0 20px"},class:g(c.disabled&&"detail-form")},[b.form.agentId?(t(),s(C,{key:0,class:"mb20",ref:"form",model:b.form,rules:b.rules,disabled:c.disabled,"label-width":"100px"},{default:r((()=>[o("div",U,[o("div",w,[V,o("span",_,[m(" 将通过应用 "),o("span",M,"【"+i(b.form.agentName)+"】",1),m(" 发送消息 ")])]),d(D,{label:"消息标题",prop:"msgTitle"},{default:r((()=>[d(q,{modelValue:b.form.msgTitle,"onUpdate:modelValue":y[0]||(y[0]=e=>b.form.msgTitle=e),placeholder:"请输入标题",maxlength:"30","show-word-limit":""},null,8,["modelValue"])])),_:1}),d(D,{label:"发送范围",prop:"scopeType"},{default:r((()=>[d(S,{modelValue:b.form.scopeType,"onUpdate:modelValue":y[1]||(y[1]=e=>b.form.scopeType=e),class:"mr20"},{default:r((()=>[d(I,{label:1},{default:r((()=>[m("全部")])),_:1}),d(I,{label:2},{default:r((()=>[m("自定义")])),_:1})])),_:1},8,["modelValue"]),2==b.form.scopeType?(t(),a(p,{key:0},[c.disabled?f("",!0):(t(),s(z,{key:0,class:"mr10",text:"",onClick:y[2]||(y[2]=e=>b.dialogVisible=!0)},{default:r((()=>[m("选择范围")])),_:1})),b.form.toPartyName.concat(b.form.toUserName).length?(t(),s($,{key:1,list:b.form.toPartyName.concat(b.form.toUserName)},null,8,["list"])):f("",!0)],64)):f("",!0)])),_:1}),d(D,{label:"发送类型",prop:"sendType"},{default:r((()=>[d(S,{modelValue:b.form.sendType,"onUpdate:modelValue":y[3]||(y[3]=e=>b.form.sendType=e)},{default:r((()=>[d(I,{label:1},{default:r((()=>[m("立即发送")])),_:1}),d(I,{label:2},{default:r((()=>[m("定时发送")])),_:1})])),_:1},8,["modelValue"])])),_:1}),2==b.form.sendType?(t(),s(D,{key:0,label:"发送时间",modelValue:b.form.sendType,"onUpdate:modelValue":y[5]||(y[5]=e=>b.form.sendType=e),prop:"sendTime"},{default:r((()=>[d(O,u({modelValue:b.form.sendTime,"onUpdate:modelValue":y[4]||(y[4]=e=>b.form.sendTime=e),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"选择日期时间"},{disabledDate(e){let l=new Date;return e.getTime()<l.setDate(l.getDate()-1)}}),null,16,["modelValue"])])),_:1},8,["modelValue"])):f("",!0)])])),_:1},8,["model","rules","disabled"])):f("",!0),v,b.form.robotId?(t(),s(C,{key:1,class:"",ref:"form",model:b.form,rules:b.rules,disabled:c.disabled,"label-width":"100px"},{default:r((()=>[d(D,{label:"消息标题",prop:"msgTitle"},{default:r((()=>[d(q,{modelValue:b.form.msgTitle,"onUpdate:modelValue":y[6]||(y[6]=e=>b.form.msgTitle=e),placeholder:"请输入标题",maxlength:"30","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules","disabled"])):f("",!0),d(C,{ref:"formCon",model:b.form.weMessageTemplate,rules:b.rules,disabled:c.disabled,"label-width":"100px"},{default:r((()=>[d(D,{label:"内容类型",prop:"msgType"},{default:r((()=>[d(S,{modelValue:b.form.weMessageTemplate.msgType,"onUpdate:modelValue":y[7]||(y[7]=e=>b.form.weMessageTemplate.msgType=e)},{default:r((()=>[(t(!0),a(p,null,n(b.typeDict,((e,l,a)=>(t(),s(I,{key:a,label:l},{default:r((()=>[m(i(e),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),"text"===b.form.weMessageTemplate.msgType?(t(),s(D,{key:0,label:"文本内容",prop:"content"},{default:r((()=>[d(q,{modelValue:b.form.weMessageTemplate.content,"onUpdate:modelValue":y[8]||(y[8]=e=>b.form.weMessageTemplate.content=e),type:"textarea",autosize:{minRows:2,maxRows:50},placeholder:"请输入内容",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])])),_:1})):"image"===b.form.weMessageTemplate.msgType?(t(),s(D,{key:1,label:"图片",prop:"picUrl"},{default:r((()=>[d(E,{fileUrl:b.form.weMessageTemplate.picUrl,"onUpdate:fileUrl":y[9]||(y[9]=e=>b.form.weMessageTemplate.picUrl=e),maxSize:2,type:"0"},{tip:r((()=>[x])),_:1},8,["fileUrl"])])),_:1})):"news"===b.form.weMessageTemplate.msgType?(t(),a(p,{key:2},[d(D,{label:"图文地址",prop:"linkUrl"},{default:r((()=>[d(q,{modelValue:b.form.weMessageTemplate.linkUrl,"onUpdate:modelValue":y[10]||(y[10]=e=>b.form.weMessageTemplate.linkUrl=e),type:"text",placeholder:"请输入图文地址，以http://或https://开头"},null,8,["modelValue"])])),_:1}),d(D,{label:"图文标题",prop:"title"},{default:r((()=>[d(q,{modelValue:b.form.weMessageTemplate.title,"onUpdate:modelValue":y[11]||(y[11]=e=>b.form.weMessageTemplate.title=e),type:"text",maxlength:60,"show-word-limit":"",placeholder:"请输入图文标题"},null,8,["modelValue"])])),_:1}),d(D,{label:"图文描述",prop:"description"},{default:r((()=>[d(q,{modelValue:b.form.weMessageTemplate.description,"onUpdate:modelValue":y[12]||(y[12]=e=>b.form.weMessageTemplate.description=e),type:"textarea",maxlength:100,"show-word-limit":"",autosize:{minRows:2,maxRows:50},placeholder:"请输入"},null,8,["modelValue"])])),_:1}),d(D,{label:"图文封面"},{default:r((()=>[d(E,{fileUrl:b.form.weMessageTemplate.picUrl,"onUpdate:fileUrl":y[13]||(y[13]=e=>b.form.weMessageTemplate.picUrl=e),type:"0"},{tip:r((()=>[k])),_:1},8,["fileUrl"])])),_:1})],64)):"video"===b.form.weMessageTemplate.msgType?(t(),s(D,{key:3,label:"上传视频",prop:"fileUrl"},{default:r((()=>[d(E,{fileUrl:b.form.weMessageTemplate.fileUrl,"onUpdate:fileUrl":y[14]||(y[14]=e=>b.form.weMessageTemplate.fileUrl=e),maxSize:10,format:["mp4","mov"],type:"2"},{tip:r((()=>[j])),_:1},8,["fileUrl"])])),_:1})):"file"===b.form.weMessageTemplate.msgType?(t(),s(D,{key:4,label:"上传文件",prop:"fileUrl"},{default:r((()=>[d(E,{fileUrl:b.form.weMessageTemplate.fileUrl,"onUpdate:fileUrl":y[15]||(y[15]=e=>b.form.weMessageTemplate.fileUrl=e),maxSize:20,type:"3",isThree:!0},{tip:r((()=>[P])),_:1},8,["fileUrl"])])),_:1})):f("",!0)])),_:1},8,["model","rules","disabled"]),c.disabled?f("",!0):(t(),a("div",N,[d(z,{onClick:y[16]||(y[16]=l=>e.$emit("submit"))},{default:r((()=>[m("取 消")])),_:1}),d(z,{type:"primary",onClick:y[17]||(y[17]=e=>T.submit(1))},{default:r((()=>[m("确定发送")])),_:1}),b.form.agentId?(t(),s(z,{key:0,type:"primary",onClick:y[18]||(y[18]=e=>T.submit(0))},{default:r((()=>[m("存为草稿")])),_:1})):f("",!0)])),b.dialogVisible?(t(),s(R,{key:3,visible:b.dialogVisible,"onUpdate:visible":y[19]||(y[19]=e=>b.dialogVisible=e),"append-to-body":"",title:"选择成员",isOnlyLeaf:!1,isSigleSelect:!1,"destroy-on-close":!1,defaultValues:b.form.toParty.concat(b.form.toUser),onSuccess:T.selectedUser},null,8,["visible","defaultValues","onSuccess"])):f("",!0)],2)}],["__scopeId","data-v-211ba9f5"]]);export{q as default};
