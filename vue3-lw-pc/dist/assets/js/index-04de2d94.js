import{A as e,l as t,m as i,g as o,a as s,r as a,f as l,u as r,b as d,c as n}from"./add-3bfba670.js";import{_ as m}from"./quill-image-resize-module-c051113e.js";import{ai as p,aq as u,o as g,c,a as h,_ as f,Y as v,U as y,K as j,a9 as w,P as C,Z as b,T as F,X as _,V as k}from"./@vue-e400fd81.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const x={style:{height:"100%"}},I={class:"g-left-right"},L={class:"left g-card"},q={class:"title"},V={class:"title-name"},S=["onClick"],U={class:"name"},G={class:"dot"},A={class:"right"},N={class:"g-card"},T={class:"mid-action"},z={class:"dialog-footer"};const B=m({name:"OrderInfo",components:{Add:e},data:()=>({query:{pageNum:1,pageSize:10,catalogueId:""},qrUserName:void 0,userArray:[],userArrayStr:"",dialogVisible:!1,loading:!1,ids:[],total:0,list:[],form:{codeType:3,qrcode:"",isJoinConfirmFriends:0,weEmpleCodeTags:[],weEmpleCodeUseScops:[]},groupList:[],groupVisible:!1,groupForm:{name:""},rules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}]},groupIndex:0,visible:!1,typeList:[],editId:void 0}),created(){this.getCodeCategoryListFn(),this.$store.setBusininessDesc("\n        <div>可自定义修改客户画像中的订单信息项供企业个性化使用</div>\n      ")},mounted(){},methods:{getListMove(e,i,o){t({id:i,direction:o,catalogueId:e}).then((e=>{this.getList()}))},add(e){this.visible=!0,this.editId=e},move(e,t){i({direction:e,id:t}).then((e=>{200===e.code&&this.getCodeCategoryListFn()}))},addGroup(){this.groupForm={name:""},this.groupVisible=!0},getCodeCategoryListFn(){o().then((e=>{200==e.code&&(this.groupList=e.data,this.query.catalogueId=this.groupList[0].id,this.groupIndex=0,this.query.pageNum=1,this.getList())}))},switchGroup(e,t){this.groupIndex=e,this.query.catalogueId=t.id,this.getList()},getList(){this.loading=!0,s(this.query).then((({rows:e,total:t})=>{e[0]&&(e[0].isFirst=!0,e[e.length-1].isLast=!0),this.list=e,this.total=Number(t),this.loading=!1,this.ids=[]})).finally((()=>{this.loading=!1}))},handleSelectionChange(e){this.ids=e.map((e=>e.id))},removeFn(e,t){if("mult"===e&&!this.ids.length)return void this.msgInfo("请选择要删除项！");const i=this.ids.join(",");this.$confirm("是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>t?a(t):l(i))).then((()=>{this.msgSuccess("删除成功"),this.getList()})).catch((function(){}))},onAddOrUpdateGroup(){this.$refs.groupForm.validate((e=>{if(this.groupForm.id){let e={id:this.groupForm.id,name:this.groupForm.name};this.groupForm=e}e&&(this.groupForm.id?r:d)(this.groupForm).then((e=>{this.groupVisible=!1,this.groupForm={name:""},this.$refs.groupForm.clearValidate(),this.getCodeCategoryListFn()}))}))},onGroupCommand(e,t){"1"!==t.id?"edit"==e?this.editGroup(t):"remove"==e?this.removeGroup(t.id):"moveUp"==e?this.move(0,t.id):"moveDown"==e&&this.move(1,t.id):this.msgInfo("默认分组不可操作！")},editGroup(e){this.groupForm=JSON.parse(JSON.stringify(e)),this.groupVisible=!0},removeGroup(e){this.$confirm("是否确认删除当前分组？删除后该分组下所有字段同步删除，该操作不可撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{n(e).then((e=>{this.getCodeCategoryListFn()}))})).catch((()=>{}))}}},[["render",function(e,t,i,o,s,a){const l=p("el-icon-arrow-up"),r=p("el-icon-MoreFilled"),d=p("el-dropdown-item"),n=p("el-dropdown-menu"),m=p("el-dropdown"),B=p("el-scrollbar"),M=p("el-button"),O=p("el-table-column"),$=p("el-table"),D=p("pagination"),J=p("el-input"),E=p("el-form-item"),K=p("el-form"),P=p("el-dialog"),X=p("Add"),Y=u("loading");return g(),c("div",x,[h("div",I,[h("div",L,[h("div",q,[h("div",V,[f(l,{class:"el-icon-arrow-up mr5"}),v(" 全部 ")]),h("div",{class:"title-btn",onClick:t[0]||(t[0]=e=>a.addGroup(0))},"添加")]),f(B,{class:"item-list"},{default:y((()=>[(g(!0),c(j,null,w(s.groupList,((e,t)=>(g(),c("div",{class:C(["item",{active:s.groupIndex==t}]),key:e.id,onClick:i=>a.switchGroup(t,e)},[h("div",U,b(e.name),1),s.groupIndex==t?(g(),F(m,{key:0,class:"dropdown",onCommand:t=>a.onGroupCommand(t,e)},{dropdown:y((()=>[f(n,null,{default:y((()=>[0!==t?(g(),F(d,{key:0,command:"moveUp"},{default:y((()=>[v("上移")])),_:1})):_("",!0),t!==s.groupList.length-1?(g(),F(d,{key:1,command:"moveDown"},{default:y((()=>[v("下移")])),_:1})):_("",!0),f(d,{command:"edit"},{default:y((()=>[v("修改分组")])),_:1}),1!==e.fixed?(g(),F(d,{key:2,command:"remove"},{default:y((()=>[v("删除分组")])),_:1})):_("",!0)])),_:2},1024)])),default:y((()=>[h("span",G,[f(r,{class:"el-icon-MoreFilled"})])])),_:2},1032,["onCommand"])):_("",!0)],10,S)))),128))])),_:1})]),h("div",A,[h("div",N,[h("div",T,[f(M,{type:"primary",onClick:t[1]||(t[1]=e=>a.add())},{default:y((()=>[v("新建字段")])),_:1}),h("div",null,[f(M,{type:"primary",plain:"",onClick:t[2]||(t[2]=e=>a.removeFn("mult"))},{default:y((()=>[v("批量删除")])),_:1})])]),k((g(),F($,{data:s.list,onSelectionChange:a.handleSelectionChange,"default-sort":{prop:"sort",order:"descending"}},{default:y((()=>[f(O,{type:"selection",width:"55",align:"center"}),f(O,{label:"字段名称",align:"center","min-width":"100",prop:"name","show-overflow-tooltip":""}),f(O,{label:"字段类型",align:"center","min-width":"100",prop:"type","show-overflow-tooltip":""},{default:y((({row:e})=>[v(b(e.typeStr),1)])),_:1}),f(O,{label:"字段说明/字段值",align:"center","min-width":"100",prop:"type","show-overflow-tooltip":""},{default:y((({row:e})=>[v(b(e.expound?e.expound:e.value?e.value:"-"),1)])),_:1}),f(O,{label:"最近操作记录",align:"center",width:"180"},{default:y((({row:e})=>[h("div",null,b(e.updateBy),1),h("div",null,b(e.updateTime),1)])),_:1}),f(O,{label:"操作",align:"center",fixed:"right",width:"180"},{default:y((({row:e})=>[e.isFirst?_("",!0):(g(),F(M,{key:0,text:"",onClick:t=>a.getListMove(e.catalogueId,e.id,0)},{default:y((()=>[v("上移")])),_:2},1032,["onClick"])),e.isLast?_("",!0):(g(),F(M,{key:1,text:"",onClick:t=>a.getListMove(e.catalogueId,e.id,1)},{default:y((()=>[v("下移")])),_:2},1032,["onClick"])),f(M,{text:"",onClick:t=>a.add(e.id)},{default:y((()=>[v("编辑")])),_:2},1032,["onClick"]),1!==e.fixed?(g(),F(M,{key:2,text:"",onClick:t=>a.removeFn("single",e.id)},{default:y((()=>[v("删除")])),_:2},1032,["onClick"])):_("",!0)])),_:1})])),_:1},8,["data","onSelectionChange"])),[[Y,s.loading]]),f(D,{total:s.total,page:s.query.pageNum,"onUpdate:page":t[3]||(t[3]=e=>s.query.pageNum=e),limit:s.query.pageSize,"onUpdate:limit":t[4]||(t[4]=e=>s.query.pageSize=e),onPagination:t[5]||(t[5]=e=>a.getList())},null,8,["total","page","limit"])])])]),f(P,{title:(s.groupForm.id?"修改":"新建")+"分组",modelValue:s.groupVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>s.groupVisible=e),width:"30%"},{footer:y((()=>[h("div",z,[f(M,{onClick:t[7]||(t[7]=e=>s.groupVisible=!1)},{default:y((()=>[v("取 消")])),_:1}),f(M,{type:"primary",onClick:a.onAddOrUpdateGroup},{default:y((()=>[v("确 定")])),_:1},8,["onClick"])])])),default:y((()=>[f(K,{model:s.groupForm,rules:s.rules,ref:"groupForm"},{default:y((()=>[f(E,{label:"分组名称",prop:"name","label-width":"80px"},{default:y((()=>[f(J,{modelValue:s.groupForm.name,"onUpdate:modelValue":t[6]||(t[6]=e=>s.groupForm.name=e),clearable:"",autocomplete:"off",maxlength:"15","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),f(X,{modelValue:s.visible,"onUpdate:modelValue":t[9]||(t[9]=e=>s.visible=e),catalogueId:s.query.catalogueId,editId:s.editId,onSuccess:t[10]||(t[10]=e=>a.getList())},null,8,["modelValue","catalogueId","editId"])])}],["__scopeId","data-v-49f6f75a"]]);export{B as default};
