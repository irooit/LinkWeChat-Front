import{e,w as a,d as t}from"./liveBroadcast-636e81cb.js";import{d as l}from"../index-044285d2.js";import{_ as i}from"./quill-image-resize-module-c051113e.js";import{ai as s,aq as r,o,c as n,a as d,_ as u,X as c,Z as m,U as p,Y as y,K as v,a9 as h,T as b,V as g,P as f,Q as j,bl as w,bj as k}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const x={data:()=>({detailData:{},descripList:[],activeName:"first",dialogVisible:!1,query:{pageNum:1,pageSize:10,watchUserType:2},companyCustomer:[{value:0,label:"否"},{value:1,label:"是"}],comment:[{value:0,label:"否"},{value:1,label:"是"}],mic:[{value:0,label:"否"},{value:1,label:"是"}],cardData:[{title:"观看直播总人数",tips:"观看本场直播的总人数数量",value:0,noArrow:!0},{title:"当前在线观看人数 ",tips:"当前时间段观看直播的人数数量（实时更新）",value:0},{title:"连麦发言人数 ",tips:"参与本场直播连麦发言的观众总人数",value:0},{title:"直播评论人数",tips:"参与本场直播进行评论的观众总人数",value:0}],userArray:[],exportLoading:!1,total:0,list:[],id:""}),created(){this.id=this.$route.query.id,this.getDeatil(this.id),this.getList()},components:{},methods:{tabClick(){this.query={pageNum:1,pageSize:10},this.getList()},exportFn(a){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,e({watchUserType:a,liveId:this.id})))).then((e=>{if(!e)return;const t=new Blob([e],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(t,"咨询记录");else{let e=1===a?"员工":"客户";const i=URL.createObjectURL(t),s=document.createElement("a");s.style.display="none",s.href=i,s.download=l(new Date,"YYYY-MM-DD")+"_"+e+"列表.xlsx",s.click(),URL.revokeObjectURL(s.href)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},dealType:e=>0===e?"否":"是",getSelectUser(e){this.userArray=e,Array.isArray(this.userArray)&&(this.query.remarks=this.userArray.filter((e=>e.isParty)).map((e=>e.deptName)).join(","))},getList(e){e&&(this.query.pageNum=e),this.loading=!0,this.query.watchUserType="first"===this.activeName?2:1,this.query.liveId=this.$route.query.id,a(this.query).then((e=>{this.list=e.rows,this.total=+e.total,this.loading=!1})).catch((()=>{this.loading=!1}))},resetQuery(){let e=this.query.pageSize;this.query={pageNum:1,pageSize:e},this.getList()},lookBack(e){var a=document.createElement("textarea");a.textContent=e,a.style.position="fixed",document.body.appendChild(a),a.select();try{document.execCommand("copy"),this.$message.success("链接复制成功，请在微信中打开")}catch(t){return this.$message.error("链接复制失败"),!1}finally{document.body.removeChild(a)}},getDeatil(e){t(e).then((e=>{this.cardData[0].value=e.data.viewerNum,this.cardData[1].value=e.data.onlineCount,this.cardData[2].value=e.data.micNum,this.cardData[3].value=e.data.commentNum,this.detailData=e.data;let a=e.data,t=this.dealState(e.data.liveState);1===e.data.liveState&&(a.livingActualDurationDesc="--"),a.liveDesc=a.liveDesc?this.coverContent(a.liveDesc):"",this.descripList=[{title:"直播标题",name:a.liveTitle},{title:"直播预约开始时间",name:a.liveStartDate+" "+a.liveStartTime},{title:"直播实际开始时间",name:a.actualStartTime},{title:"直播状态",name:t},{title:"直播预约持续时长",name:a.livingDurationDesc},{title:"直播实际持续时间",name:a.livingActualDurationDesc},{title:"直播简介",name:a.liveDesc},{title:"直播员工",name:a.liveUserName},{title:"员工所在部门",name:a.deptName}]})).catch((()=>{}))},coverContent:e=>(e&&e.length>20&&(e=e.substr(0,20)+"..."),e),dealState(e){switch(e){case 0:return"预约中";case 1:return"直播中";case 2:return"已结束";case 3:return"已过期";case 4:return"已取消"}},dealBackType(e){switch(e){case 0:return"生成成功";case 1:return"生成中";case 2:return"回放已删除";case 3:return"生成失败"}}}},D=e=>(w("data-v-1432e96d"),e=e(),k(),e),q={class:"flex"},C={class:"boxCard"},_=D((()=>d("span",null,"直播回放",-1))),U={key:0},S=[D((()=>d("span",{class:"noBack"},"主播未开启本场直播回放功能",-1)))],V={key:0},N={class:"backStyle"},L={class:"g-card"},T={class:"g-card mt20"},A={key:0},B={class:"fr mt10"},z={class:"cp flex aic"},O={class:"ml10"},M={class:"bottom"};const R=i(x,[["render",function(e,a,t,l,i,w){const k=s("CardGroupIndex"),x=s("el-button"),D=s("el-descriptions-item"),R=s("el-descriptions"),I=s("el-input"),Y=s("el-form-item"),$=s("el-option"),E=s("el-select"),P=s("el-form"),Q=s("el-image"),F=s("svg-icon"),J=s("el-icon-Avatar"),K=s("el-table-column"),G=s("el-table"),X=s("pagination"),Z=s("el-tab-pane"),H=s("el-tabs"),W=s("SelectUser"),ee=r("loading");return o(),n("div",null,[d("div",null,[d("div",q,[u(k,{data:i.cardData},null,8,["data"]),d("div",C,[d("div",null,[_,0===i.detailData.openReplay?(o(),n("div",U,S)):c("",!0)]),1===i.detailData.openReplay?(o(),n("div",V,[d("div",N,m(w.dealBackType(i.detailData.replayStatus)),1),u(x,{type:"primary",disabled:0!==i.detailData.replayStatus,onClick:a[0]||(a[0]=e=>w.lookBack(i.detailData.shareOrJoinUrl))},{default:p((()=>[y(" 查看回放 ")])),_:1},8,["disabled"])])):c("",!0)])]),d("div",L,[u(R,{title:"基本信息"},{default:p((()=>[(o(!0),n(v,null,h(i.descripList,((e,a)=>(o(),b(D,{label:e.title,"label-class-name":"my-label","content-class-name":"my-content",key:a},{default:p((()=>[y(m(e.name),1)])),_:2},1032,["label"])))),128)),y(" > ")])),_:1})]),d("div",T,[u(H,{modelValue:i.activeName,"onUpdate:modelValue":a[10]||(a[10]=e=>i.activeName=e),onTabChange:w.tabClick},{default:p((()=>[u(Z,{label:"客户列表",name:"first"},{default:p((()=>["first"===i.activeName?(o(),n("div",A,[u(P,{"label-position":"left",inline:"","label-width":"80px"},{default:p((()=>[u(Y,{"label-width":"0"},{default:p((()=>[u(I,{placeholder:"请输入客户名称",modelValue:i.query.watchUserName,"onUpdate:modelValue":a[1]||(a[1]=e=>i.query.watchUserName=e),style:{width:"180px"}},null,8,["modelValue"])])),_:1}),u(Y,{"label-width":"0"},{default:p((()=>[u(E,{modelValue:i.query.isCompanyCustomer,"onUpdate:modelValue":a[2]||(a[2]=e=>i.query.isCompanyCustomer=e),placeholder:"请选择是否为企业客户",style:{width:"180px"}},{default:p((()=>[(o(!0),n(v,null,h(i.companyCustomer,(e=>(o(),b($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(Y,{"label-width":"0"},{default:p((()=>[u(E,{modelValue:i.query.isComment,"onUpdate:modelValue":a[3]||(a[3]=e=>i.query.isComment=e),placeholder:"请选择评论状态",style:{width:"180px"}},{default:p((()=>[(o(!0),n(v,null,h(i.comment,(e=>(o(),b($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(Y,{"label-width":"0"},{default:p((()=>[u(E,{modelValue:i.query.isMic,"onUpdate:modelValue":a[4]||(a[4]=e=>i.query.isMic=e),placeholder:"发言状态",style:{width:"180px"}},{default:p((()=>[(o(!0),n(v,null,h(i.mic,(e=>(o(),b($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(Y,{"label-width":"0"},{default:p((()=>[u(x,{type:"primary",onClick:a[5]||(a[5]=e=>w.getList(0))},{default:p((()=>[y("查询")])),_:1}),u(x,{onClick:w.resetQuery},{default:p((()=>[y("重置")])),_:1},8,["onClick"])])),_:1}),d("div",B,[g((o(),b(x,{type:"primary",plain:"",onClick:a[6]||(a[6]=e=>w.exportFn(2))},{default:p((()=>[y("导出Excel")])),_:1})),[[ee,i.exportLoading]])])])),_:1}),g((o(),b(G,{data:i.list},{default:p((()=>[u(K,{label:"客户名称",align:"center"},{default:p((({row:e})=>[d("div",z,[e.watchAvatar?(o(),b(Q,{key:0,style:{width:"50px",height:"50px",flex:"none"},src:e.watchAvatar,fit:"fill"},null,8,["src"])):(o(),b(F,{key:1,icon:"service",class:"code-user"})),d("div",O,[d("p",null,m(e.watchUserName),1),u(J,{class:f(["el-icon-Avatar",{1:"man",2:"woman"}[e.gender]])},null,8,["class"]),d("span",{style:j({color:["@微信","@微信用户"].includes(e.remarks)?"#4bde03":"#f9a90b"})},m(e.remarks),5)])])])),_:1}),u(K,{label:"是否为企业客户",align:"center"},{default:p((e=>[y(m(w.dealType(e.row.isCompanyCustomer)),1)])),_:1}),u(K,{label:"观看时长",align:"center",prop:"watchTime"}),u(K,{label:"是否评论",align:"center"},{default:p((e=>[y(m(w.dealType(e.row.isComment)),1)])),_:1}),u(K,{label:"是否连麦发言",align:"center"},{default:p((e=>[y(m(w.dealType(e.row.isMic)),1)])),_:1})])),_:1},8,["data"])),[[ee,e.loading]]),d("div",M,[u(X,{total:i.total,page:i.query.pageNum,"onUpdate:page":a[7]||(a[7]=e=>i.query.pageNum=e),limit:i.query.pageSize,"onUpdate:limit":a[8]||(a[8]=e=>i.query.pageSize=e),onPagination:a[9]||(a[9]=e=>w.getList())},null,8,["total","page","limit"])])])):c("",!0)])),_:1})])),_:1},8,["modelValue","onTabChange"])])]),u(W,{visible:i.dialogVisible,"onUpdate:visible":a[11]||(a[11]=e=>i.dialogVisible=e),title:"组织架构",defaultValues:i.userArray,onSuccess:w.getSelectUser,isOnlyLeaf:!1},null,8,["visible","defaultValues","onSuccess"])])}],["__scopeId","data-v-1432e96d"]]);export{R as default};
