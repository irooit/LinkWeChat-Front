import{b as e}from"./qrcode-fb057d44.js";import{c as t,g as s,e as o,f as i}from"./staff-48996164.js";import{d as l,u as r,a,b as n,c as d}from"./smartForms-eaa9db9a.js";import m from"./formsDetail-43ee5d84.js";import{S as h}from"./index-618cff16.js";import c from"./index-8d7b31e3.js";import{d as p}from"../index-044285d2.js";import{ai as u,o as f,c as g,a as b,_ as y,U as F,V as v,$ as C,K as I,a9 as D,T,X as U,a5 as w,Y as S,R as L,Z as x,bl as N,bj as _}from"./@vue-e400fd81.js";import{_ as k}from"./quill-image-resize-module-c051113e.js";import"./encode-utf8-2ec93547.js";import"./dijkstrajs-38d0b2a1.js";import"./vant-b6a5d036.js";import"./@vant-a2ba62fc.js";import"./RightPanel-299cad40.js";import"./TreeNodeDialog-1d89ab66.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./ali-oss-912914b8.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./IconsDialog-a9f799a3.js";import"./vuedraggable-6f5e6033.js";import"./vue-afbfa742.js";import"./CodeTypeDialog-a4fd582c.js";import"./DraggableItem-8beb6ac6.js";import"./tag-13936295.js";import"./index-0bf429ac.js";import"./file-saver-40ca0bfd.js";import"./js-beautify-7c0eaa99.js";const j={components:{SelectMaterial:h,Build:c,FormsDetail:m},watch:{One:function(e,t){0==e&&(this.OneToOne=0)},OneToOne:function(e,t){1==e&&(this.One=1)}},data:()=>({pickerOptions:{disabledDate(e){let t=new Date;return e.getTime()<=t.setDate(t.getDate()-1)}},dataFormList:"",ChannelsList:[],channelsName:"",formIdN:"",visibility:"0",ifPhoneZ:!1,ifNameZ:!1,baseFormUrl4:"http://localhost/formsDetail",searchDate:"",operationIndex:null,formTemp:{},formId:"",materialData:{welcomeMsg:"",materialMsgList:[]},title:"新建",currentActive:1,ifFormDescription:0,ifFormLogo:0,One:0,OneToOne:0,ifChannelsName:1,baseForm:{channelsName:"",visibility:0,surveyName:"",groupId:"",styles:"",fillingRules:0,surveyState:0,formDescription:"",formLogo:"",tinyint:0,anAuth:0,channelsPath:""},channelsPathList:[],baseRules:{surveyName:[{required:!0,message:"请输入表单名称",trigger:"blur"}],groupId:[{required:!0,message:"请选择分组",trigger:"blur"}]},pageDataAll:null,codeForm:{qrType:1,qrRuleType:1,weEmpleCodeUseScops:[],empleCodeRosterDto:[{type:0,weEmpleCodeUseScops:[],weekday:[1,2,3,4,5,6,7],qrRuleType:2,startDate:"00:00",endDate:"23:59"}]},codeRules:{qrType:[{required:!0,message:"请选择",trigger:"blur"}],qrRuleType:[{required:!0,message:"请选择",trigger:"blur"}],weEmpleCodeUseScops:[{required:!0,message:"请选择",trigger:"blur",validator:(e,t,s)=>{0==t.length?s(new Error("请选择")):s()}}]},isInsertClientName:!0,dialogVisibleSelectUser:!1,dialogVisibleSelectTag:!1,dialogVisibleSelectMaterial:!1,dialogVisibleSelectWel:!1,loading:!1,codeCategoryList:[],selectedUserList:[],selectedTagList:[],timeConflict:!1}),created(){let e=this.$route.query.id,t=this.$route.query.groupId;this.formId=this.formIdN=this.$route.query.formId,this.formId&&this.selectInfoToSurvey(),t&&(this.baseForm.groupId=t),this.$route.query.currentActiveA&&(this.currentActive=Number(this.$route.query.currentActiveA),this.selectInfoToSurvey()),this.getCodeCategoryList(),e&&(this.title="编辑",this.getDetailFn(e))},mounted(){this.clipboard=new this.ClipboardJS(".copy-btn")},unmounted(){this.clipboard.destroy()},methods:{removeFn(){this.$confirm("是否确认取消新建当前表单，取消后不可恢复，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>l(this.formId))).then((()=>{this.$router.back()})).catch((function(){}))},deletChannels(e,t){let s=this;s.ChannelsList.length<2?this.$alert("当前渠道不可删除","提示",{confirmButtonText:"我知道了"}):(s.ChannelsList.splice(t,1),s.channelsPathList.splice(t,1))},addFormS(e){let t=this;this.baseForm.surveyState=0,this.baseForm.tinyint&&(this.baseForm.timingStart=this.searchDate[0]+" 00:00:00",this.baseForm.timingEnd=this.searchDate[1]+" 23:59:59",this.baseForm.anTiming=this.baseForm.tinyint),0==this.One&&0==this.OneToOne?this.baseForm.fillingRules=2:this.One?this.baseForm.fillingRules=0:this.OneToOne&&(this.baseForm.fillingRules=1),this.baseForm.htmlPath="/formsDetail";let s=JSON.parse(this.baseForm.styles);if(this.baseForm.styles=JSON.stringify(s),this.baseForm.id=t.formIdN,0!=this.ChannelsList.length){this.baseForm.channelsName="",this.baseForm.channelsPath="";for(let e=0;e<this.ChannelsList.length;e++)if(this.baseForm.channelsName){if(!this.ChannelsList[e])return void this.msgError("渠道不能为空！");if(this.baseForm.channelsName=this.baseForm.channelsName+","+this.ChannelsList[e],!this.channelsPathList[e])return void this.msgError("渠道标识不能为空！");this.baseForm.channelsPath=this.baseForm.channelsPath+","+this.channelsPathList[e]}else this.baseForm.channelsName=this.ChannelsList[e],this.baseForm.channelsPath=this.channelsPathList[e]}else this.baseForm.channelsName="默认渠道",this.baseForm.channelsPath="Default",this.channelsPathList=["Default"];if(this.isRepeat(this.ChannelsList))return void this.msgError('渠道"'+this.isRepeat(this.ChannelsList)+'"重复');if(this.isRepeat(this.channelsPathList))return void this.msgError('渠道标识"'+this.isRepeat(this.channelsPathList)+'"重复');for(let i=0;i<s.length;i++)for(let e=0;e<s[i].length;e++)0==s[i][e].formCodeId?t.readonly=!1:9==s[i][e].formCodeId&&(s[i][e].options=[]);let o=0;for(let i=0;i<s.length;i++)for(let e=0;e<s[i].length;e++)0==s[i][e].formCodeId&&(s[i][e].readonly=!0),0!=s[i][e].formCodeId&&1!=s[i][e].formCodeId?(o++,s[i][e].page=i+1,s[i][e].pageNo=e+1,s[i][e].label.indexOf("."),s[i][e].TitleNumber=o):(s[i][e].page=i+1,s[i][e].label="");this.baseForm.styles=JSON.stringify(s),"fb"==e&&(t.updateSurveyStatus(t.dataFormList.id,1,t.dataFormList),delete t.baseForm.surveyState),r(t.baseForm).then((s=>{"to3"!=e&&t.cancelFn()}))},uploadFile(e){uploadFile(e).then((e=>{}))},addChannels(){this.ChannelsList.push("")},selectInfoToSurvey(){a(this.formId).then((({data:e})=>{this.dataFormList=e,e&&(e.channelsName&&(this.ChannelsList=e.channelsName.split(","),this.channelsPathList=e.channelsPath.split(",")),this.baseForm.surveyName=e.surveyName,e.formDescription&&(this.ifFormDescription=1,this.baseForm.formDescription=e.formDescription),e.formLogo&&(this.ifFormLogo=1,this.baseForm.formLogo=e.formLogo,this.baseForm.logoUrl=e.formLogo),this.pageDataAll=JSON.parse(e.styles)),this.baseFormUrl4=window.location.origin+"/formsDetail?id=true&formId="+this.formId,this.creatQrCode()}))},updateInfoToSurvey(e){let t=this;r(e).then((e=>{t.selectInfoToSurvey()})).catch((()=>{}))},updateSurveyStatus(e,t,s){let o=this;if(0!=s.surveyState||s.timingStart){new Date<new Date(s.timingStart)&&(t=4)}else{let t={id:e,timingStart:p(new Date)};this.updateInfoToSurvey(t)}n({id:e,surveyState:t}).then((e=>{200==e.code?o.$message({message:"操作成功",type:"success"}):o.msgError(e.msg)})).catch((()=>{}))},base64ToBlob(e){let t=e.split(";base64,"),s=t[0].split(":")[1],o=window.atob(t[1]),i=o.length,l=new Uint8Array(i);for(let r=0;r<i;++r)l[r]=o.charCodeAt(r);return new Blob([l],{type:s})},downloadFile(e,t){let s=document.createElement("a"),o=this.base64ToBlob(t);document.createEvent("HTMLEvents").initEvent("click",!0,!0),s.download=e,s.href=URL.createObjectURL(o),s.click()},creatQrCode(){e.toDataURL(this.$refs.qrCodeUrl,window.location.origin+"/formsDetail?id=q&formId="+this.formId,{width:150,margin:4,errorCorrectionLevel:"H"})},btnDownload(){this.downloadFile("表单二维码",this.$refs.qrCodeUrl.childNodes[1].src)},toStyles(e){let t=[];for(let o=0;o<e.length;o++){t.push([]);for(let s=0;s<e[o].length;s++)t[t.length-1].push(e[o][s])}let s=0;for(let o=0;o<t.length;o++)for(let e=0;e<t[o].length;e++)0!=t[o][e].formCodeId&&1!=t[o][e].formCodeId?(s++,t[o][e].page=o+1,t[o][e].pageNo=e+1,-1!=t[o][e].label.indexOf(".")&&(t[o][e].TitleNumber=s),"625"==t[o][e].formCodeId&&"626"==t[o][e].formCodeId&&t[o].splice(e,1)):(t[o][e].page=o+1,t[o][e].label="");0!=t.length?this.baseForm.styles=JSON.stringify(t):this.baseForm.styles=""},handleUploadedHeadImage(e){const t=new FileReader;t.onload=()=>{this.baseForm.logoUrl=t.result}},checkStartEnd(e,t){this.timeConflict=!1,this.operationIndex=t,this.allTimeConflict()&&this.codeForm.empleCodeRosterDto[this.operationIndex].weekday.length&&(this.codeForm.empleCodeRosterDto[this.operationIndex].endDate||this.codeForm.empleCodeRosterDto[this.operationIndex].startDate)&&this.someTimeConflict()},someTimeConflict(){let e=[],t=[],s=this.codeForm.empleCodeRosterDto[this.operationIndex].weEmpleCodeUseScops.map((e=>({userId:e.businessId,name:e.businessName})));this.codeForm.empleCodeRosterDto.forEach(((e,s)=>{e.weEmpleCodeUseScops.map(((e,o)=>{s!=this.operationIndex&&t.push({userId:e.businessId,name:e.businessName,index:s,week:[],goto1:!0,goto2:!0})}))})),s.map((s=>{t.map((t=>{s.userId===t.userId&&e.push(t)}))}));let o=this.codeForm.empleCodeRosterDto[this.operationIndex].weekday;e.forEach((e=>{const t=this.codeForm.empleCodeRosterDto[e.index].weekday;for(var s=0;s<t.length;s++)-1!=o.indexOf(t[s])&&e.week.push(t[s])})),e.forEach((e=>{if(e.week.length){let t=this.codeForm.empleCodeRosterDto[e.index].startDate,s=this.codeForm.empleCodeRosterDto[e.index].endDate;t&&s&&(this.codeForm.empleCodeRosterDto[this.operationIndex].startDate&&(e.goto1=this.checkAuditTime(t,s,this.codeForm.empleCodeRosterDto[this.operationIndex].startDate)),this.codeForm.empleCodeRosterDto[this.operationIndex].endDate&&(e.goto2=this.checkAuditTime(t,s,this.codeForm.empleCodeRosterDto[this.operationIndex].endDate)))}}));let i="";e.forEach((e=>{if(!e.goto1||!e.goto2){let t=e.week.map((e=>7===e?"日":e));i+="员工"+e.name+"在周"+t.join("、")+"时间存在冲突;"}})),i?(this.timeConflict=!0,this.msgError(i)):this.timeConflict=!1},allTimeConflict(){if(0===this.operationIndex)return!0;let e=this.codeForm.empleCodeRosterDto[this.operationIndex].weEmpleCodeUseScops.map((e=>({userId:e.businessId,name:e.businessName}))),t=this.codeForm.empleCodeRosterDto[0].weEmpleCodeUseScops.map((e=>({userId:e.businessId,name:e.businessName}))),s=[];if(e.map((e=>{t.map((t=>{e.userId===t.userId&&s.push(e)}))})),s.length){let e=s.map(((e,t)=>e.name)).join(",");return this.msgError("员工 "+e+" 已是全天在线，时间存在冲突！"),this.timeConflict=!0,!1}return this.timeConflict=!1,!0},checkAuditTime(e,t,s){let o=e.split(":");if(2!=o.length)return!1;let i=t.split(":");if(2!=i.length)return!1;let l=s.split(":");if(2!=l.length)return!1;let r=new Date,a=new Date,n=new Date;return r.setHours(o[0]),r.setMinutes(o[1]),a.setHours(i[0]),a.setMinutes(i[1]),n.setHours(l[0]),n.setMinutes(l[1]),!(n.getTime()-r.getTime()>=0&&n.getTime()-a.getTime()<=0)},cancelFn(){this.$router.back()},CancelTheNewOne(){this.$confirm("是否确认取消新建当前表单，取消后不可恢复，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$router.back()})).catch((()=>{}))},getWelData(e){this.submit(e)},changeType(e){1===e&&(this.codeForm.qrRuleType=1)},nextStep(e,t){let s=this,o="";if(2==e){if(o="baseForm",this.baseForm.visibility=this.visibility,!this.baseForm.surveyName)return void this.msgError("表单名称不能为空！");if(this.ifFormDescription&&!this.baseForm.formDescription)return void this.msgError("表单说明不能为空！");if(this.ifFormLogo&&(this.baseForm.logoUrl||(this.baseForm.logoUrl=this.baseForm.formLogo),!this.baseForm.logoUrl))return void this.msgError("表单logo不能为空！");this.currentActive=e}else{if(3==e){let s=JSON.parse(this.baseForm.styles);if(0==s.length)return void this.msgError("表单不能为空!");for(let e=0;e<s.length;e++)for(let t=0;t<s[e].length;t++){let o=s[e][t].label.substring(s[e][t].label.indexOf(".")+1);if(0==s[e][t].formCodeId&&!s[e][t].defaultValue)return void this.msgError("第"+s[e][t].page+"页,[文字说明]不能为空");if(1==s[e][t].formCodeId&&!s[e][t].src)return void this.msgError("第"+s[e][t].page+"页,[图片]不能为空");if(6==s[e][t].formCodeId){if(!s[e][t].options||0==s[e][t].options.length)return void this.msgError("第"+s[e][t].page+"页,"+o+",[下拉选择]不能为空");for(let i=0;i<s[e][t].options.length;i++)if(!s[e][t].options[i].label)return void this.msgError("第"+s[e][t].page+"页,"+o+",[下拉选择]名称不能为空")}if(7==s[e][t].formCodeId&&(!s[e][t].options||0==s[e][t].options.length))return void this.msgError("第"+s[e][t].page+"页,"+o+",[级联选择]不能为空");if(8==s[e][t].formCodeId&&(!s[e][t].options||0==s[e][t].options.length))return void this.msgError("第"+s[e][t].page+"页,"+o+",[选项组]不能为空")}return 4==t&&this.addFormS("to3"),void(this.currentActive=e)}if(4==e){if(this.baseForm.surveyState=0,this.baseForm.tinyint){if(!this.searchDate[0])return void this.msgError("定时收集不能为空!");this.baseForm.timingStart=this.searchDate[0]+" 00:00:00",this.baseForm.timingEnd=this.searchDate[1]+" 23:59:59",this.baseForm.anTiming=this.baseForm.tinyint}0==this.One&&0==this.OneToOne?this.baseForm.fillingRules=2:this.One&&0==this.OneToOne?this.baseForm.fillingRules=0:this.OneToOne&&(this.baseForm.fillingRules=1),this.baseForm.htmlPath="/formsDetail";let t=JSON.parse(this.baseForm.styles);for(let e=0;e<t.length;e++)for(let o=0;o<t[e].length;o++)0==t[e][o].formCodeId?s.readonly=!1:9==t[e][o].formCodeId&&(t[e][o].options=[]);let o=0;for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)0==t[e][s].formCodeId&&(t[e][s].readonly=!0),0!=t[e][s].formCodeId&&1!=t[e][s].formCodeId?(o++,t[e][s].page=e+1,t[e][s].pageNo=s+1,t[e][s].label.indexOf("."),t[e][s].TitleNumber=o):(t[e][s].page=e+1,t[e][s].label="");if(this.baseForm.styles=JSON.stringify(t),this.baseForm.id=s.formId,0!=this.ChannelsList.length){this.baseForm.channelsName="",this.baseForm.channelsPath="";for(let e=0;e<this.ChannelsList.length;e++)if(this.baseForm.channelsName){if(!this.ChannelsList[e])return void this.msgError("渠道不能为空！");if(this.baseForm.channelsName=this.baseForm.channelsName+","+this.ChannelsList[e],!this.channelsPathList[e])return void this.msgError("渠道标识不能为空！");this.baseForm.channelsPath=this.baseForm.channelsPath+","+this.channelsPathList[e]}else this.baseForm.channelsName=this.ChannelsList[e],this.baseForm.channelsPath=this.channelsPathList[e]}else this.baseForm.channelsName="默认渠道",this.baseForm.channelsPath="Default",this.channelsPathList=["Default"];return void(this.formIdN?r(this.baseForm).then((t=>{if(200==t.code)return s.selectInfoToSurvey(),void(s.currentActive=e);this.msgError(t.msg)})):d(this.baseForm).then((t=>{if(200==t.code)return s.formId=t.data,s.formIdN=t.data,s.selectInfoToSurvey(),void(s.currentActive=e);this.msgError(t.msg)})))}}this.$refs[o].validate((e=>{}))},isRepeat(e){for(var t=0;t<e.length;t++)if(e.indexOf(e[t])!=t)return e[t];return!1},getDetailFn(e){this.loading=!0,t(e).then((e=>{this.formTemp=e.data;let t=JSON.parse(JSON.stringify(e.data));if(this.baseForm={surveyName:t.name,groupId:t.groupId,qrAutoAdd:t.autoAdd,weEmpleCodeTags:t.qrTags},this.codeForm.qrType=t.type,this.codeForm.qrRuleType=t.ruleType,1===t.ruleType){let e=[];t.qrUserInfos[0].weQrUserList.forEach((s=>{let o={scopeId:t.qrUserInfos[0].scopeId,businessId:s.userId,businessName:s.userName};e.push(o)})),this.codeForm.weEmpleCodeUseScops=e}else{let e=[];t.qrUserInfos.forEach((t=>{let s={type:t.type,startDate:t.beginTime,endDate:t.endTime,weekday:t.workCycle?t.workCycle.split(",").map((e=>parseInt(e,0))):[],scopeId:t.scopeId,weEmpleCodeUseScops:t.weQrUserList.map((e=>({businessId:e.userId,businessName:e.userName})))};e.push(s)})),this.codeForm.empleCodeRosterDto=e}this.materialData={welcomeMsg:t.qrAttachments?t.qrAttachments[0].content:"",materialMsgList:t.qrAttachments?this.setEditList(t.qrAttachments):[]},this.loading=!1}))},setEditList(e){let t=[];return e&&e.length&&e.forEach((e=>{if("image"===e.msgType){let s={msgType:"0",materialUrl:e.picUrl};t.push(s)}else if("link"===e.msgType){let s={msgType:"8",materialName:e.title,materialUrl:e.linkUrl};t.push(s)}else if("miniprogram"===e.msgType){let s={msgType:"9",digest:e.appId,materialName:e.title,coverUrl:e.picUrl,materialUrl:e.linkUrl};t.push(s)}})),t},getCodeCategoryList(){s({mediaType:15}).then((e=>{this.codeCategoryList=e.data}))},selectedUser(e){let t={userIds:[],departmentIds:[]};const s=e.map((e=>(e.userId&&t.userIds.push(e.userId),e.id&&t.departmentIds.push(e.id),{businessId:e.userId||e.id,businessName:e.name,businessIdType:e.userId?2:1})));t.userIds+="",t.departmentIds+="",1==this.codeForm.qrRuleType?this.codeForm.weEmpleCodeUseScops=s:(this.codeForm.empleCodeRosterDto[this.selectedRosterIndex].weEmpleCodeUseScops=s,this.checkStartEnd(null,this.selectedRosterIndex))},onSelectUser(e){if(this.selectedUserList=[],2==this.codeForm.qrRuleType){this.selectedRosterIndex=e;let t=[];t=this.codeForm.empleCodeRosterDto[this.selectedRosterIndex].weEmpleCodeUseScops.map((e=>({userId:e.businessId,name:e.businessName}))),this.selectedUserList=t}else{let e=[];e=this.codeForm.weEmpleCodeUseScops.map((e=>({userId:e.businessId,name:e.businessName}))),this.selectedUserList=e}this.dialogVisibleSelectUser=!0},onAddRoster(){this.codeForm.empleCodeRosterDto.push({weEmpleCodeUseScops:[],weekday:[],type:1,startDate:"",endDate:""})},onRemoveRoster(e){this.codeForm.empleCodeRosterDto.splice(e,1)},onRosterTimeChange(e,t){const[s,o]=e;this.codeForm.empleCodeRosterDto[t].startDate=s,this.codeForm.empleCodeRosterDto[t].endDate=o,this.codeForm.empleCodeRosterDto[t].time=e},selectedFn(){this.baseForm.weEmpleCodeTags&&(this.selectedTagList=this.baseForm.weEmpleCodeTags.map((e=>({tagId:e.tagId,name:e.tagName})))),this.dialogVisibleSelectTag=!0},submitSelectTag(e){this.baseForm.weEmpleCodeTags=e.map((e=>({tagId:e.tagId,tagName:e.name})))},resetData(e){let t=[];return e&&e.length&&e.forEach((e=>{if("0"===e.msgType){let s={msgType:"image",picUrl:e.materialUrl};t.push(s)}else if("8"===e.msgType){let s={msgType:"link",title:e.materialName,linkUrl:e.materialUrl};t.push(s)}else if("9"===e.msgType){let s={msgType:"miniprogram",appId:e.digest,title:e.materialName,picUrl:e.coverUrl,linkUrl:e.materialUrl};t.push(s)}})),t},submit(e){let t=this.resetData(e.materialMsgList),s={attachments:[{content:e.welcomeMsg,msgType:"text"}]};if(s.attachments.push(...t),1===this.codeForm.qrRuleType){let e={type:0,scopeId:this.codeForm.weEmpleCodeUseScops[0].scopeId?this.codeForm.weEmpleCodeUseScops[0].scopeId:"",userIds:this.codeForm.weEmpleCodeUseScops.map((e=>e.businessId))};this.codeForm.qrUserInfos=[e]}else this.codeForm.qrUserInfos=[],this.codeForm.empleCodeRosterDto.forEach((e=>{let t={scopeId:e.scopeId?e.scopeId:"",type:e.type,beginTime:e.startDate,endTime:e.endDate,userIds:e.weEmpleCodeUseScops.map((e=>e.businessId)),workCycle:e.weekday};this.codeForm.qrUserInfos.push(t)}));this.baseForm.qrTags=this.baseForm.weEmpleCodeTags.map((e=>e.tagId));let l=Object.assign({},this.baseForm,this.codeForm,s);delete l.weEmpleCodeTags,delete l.weEmpleCodeUseScops,delete l.empleCodeRosterDto,this.formTemp.id&&(l.qrId=this.formTemp.id,l.configId=this.formTemp.configId),(this.formTemp.id?o:i)(l).then((({data:e})=>{this.msgSuccess("操作成功"),this.loading=!1,this.$router.back()})).catch((()=>{this.loading=!1}))}}},q=e=>(N("data-v-35535667"),e=e(),_(),e),E={class:"g-card"},R={class:"g-card tab-content form1"},V={class:"fxbw"},O={key:0},A=q((()=>b("div",{class:"sub-des"},"开启后，表单首页或表单顶部会有说明文案",-1))),P={key:0},$=q((()=>b("div",{class:"sub-des"},"开启后，表单首页或表单顶部会有logo图",-1))),M=q((()=>b("div",null,"建议大小2M以内，仅支持png/jpg等图片类型",-1))),Y={style:{display:"flex","justify-content":"center"}},J={style:{display:"flex","justify-content":"center"}},B={class:"g-card tab-content",style:{height:"calc(100vh - 216px)"}},z={class:"ar"},H={key:0,class:"g-card tab-content form3"},Q={style:{width:"350px"}},W=q((()=>b("div",{class:"sub-des"},"开启后会授权登录，提供微信昵称、性别、城市信息",-1))),Z=q((()=>b("div",{class:"sub-des"},"填写并提交成功后重复打开问卷时则直接跳转结束页",-1))),K={class:"g-card tab-content form4"},X={class:"flex"},G={style:{"flex-basis":"65%"}},ee={style:{display:"flex","align-items":"center"}},te={style:{display:"flex"}},se={style:{"margin-left":"15px",display:"flex","flex-shrink":"0","z-index":"9"}},oe=["data-clipboard-text"],ie={style:{display:"flex"}},le={class:"qrcode",ref:"qrCodeUrl"},re=q((()=>b("div",{class:"sub-des",style:{position:"relative",top:"-10px"}},"支持手机扫码预览",-1))),ae=q((()=>b("div",{class:"sub-des",style:{position:"relative",top:"-10px"}}," 开启后将会在默认链接基础上增加渠道标识 ",-1))),ne={key:0,class:"add_form4_qd"},de=q((()=>b("div",{class:"add_form4_qd_ul"},[b("div",{class:"add_form4_qd_li1 add_form4_qd_li"},"渠道"),b("div",{class:"add_form4_qd_li2 add_form4_qd_li"},"渠道标识"),b("div",{class:"add_form4_qd_li3 add_form4_qd_li"},"操作")],-1))),me={class:"add_form4_qd_li1 add_form4_qd_li"},he={style:{display:"flex","justify-content":"center","":"flex"}},ce={class:"add_form4_qd_li2 add_form4_qd_li"},pe=q((()=>b("label",{for:""},null,-1))),ue={class:"add_form4_qd_li3 add_form4_qd_li"},fe=["onClick"],ge={key:0,style:{"flex-basis":"35%"}};const be=k(j,[["render",function(e,t,s,o,i,l){const r=u("el-step"),a=u("el-steps"),n=u("el-input"),d=u("el-form-item"),m=u("el-option"),h=u("el-select"),c=u("el-switch"),p=u("upload"),N=u("el-button"),_=u("el-form"),k=u("FormsDetail"),j=u("el-radio"),q=u("Build"),be=u("el-date-picker"),ye=u("SelectTag"),Fe=u("SelectUser");return f(),g("div",null,[b("div",E,[y(a,{active:i.currentActive,"align-center":"","finish-status":"success"},{default:F((()=>[y(r,{title:"基础信息"}),y(r,{title:"表单画布"}),y(r,{title:"表单设置"}),y(r,{title:"预览发布"})])),_:1},8,["active"])]),v(b("div",R,[b("div",V,[y(_,{style:{width:"30%"},ref:"baseForm",rules:i.baseRules,model:i.baseForm,"label-position":"left","label-width":"80px"},{default:F((()=>[y(d,{label:"表单名称",prop:"surveyName"},{default:F((()=>[y(n,{modelValue:i.baseForm.surveyName,"onUpdate:modelValue":t[0]||(t[0]=e=>i.baseForm.surveyName=e),maxlength:"15","show-word-limit":"",clearable:""},null,8,["modelValue"])])),_:1}),y(d,{label:"表单分组",prop:"groupId"},{default:F((()=>[y(h,{modelValue:i.baseForm.groupId,"onUpdate:modelValue":t[1]||(t[1]=e=>i.baseForm.groupId=e)},{default:F((()=>[(f(!0),g(I,null,D(i.codeCategoryList,(e=>(f(),T(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(d,{label:"表单说明"},{default:F((()=>[y(c,{modelValue:i.ifFormDescription,"onUpdate:modelValue":t[2]||(t[2]=e=>i.ifFormDescription=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),1==i.ifFormDescription?(f(),g("div",O,[A,y(n,{ref:"msgTextarea",type:"textarea",modelValue:i.baseForm.formDescription,"onUpdate:modelValue":t[3]||(t[3]=e=>i.baseForm.formDescription=e),maxlength:"200","show-word-limit":"",placeholder:"请填写表单说明",autosize:{minRows:5,maxRows:20},clearable:""},null,8,["modelValue"])])):U("",!0)])),_:1}),y(d,{label:"表单logo"},{default:F((()=>[y(c,{modelValue:i.ifFormLogo,"onUpdate:modelValue":t[4]||(t[4]=e=>i.ifFormLogo=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),1==i.ifFormLogo?(f(),g("div",P,[$,y(p,{fileUrl:i.baseForm.formLogo,"onUpdate:fileUrl":t[5]||(t[5]=e=>i.baseForm.formLogo=e),class:"image-uploader","onUpdate:file":l.handleUploadedHeadImage},{tip:F((()=>[M])),_:1},8,["fileUrl","onUpdate:file"])])):U("",!0)])),_:1}),y(d,null,{default:F((()=>[y(N,{plain:"",onClick:w(l.CancelTheNewOne,["stop"])},{default:F((()=>[S("取消")])),_:1},8,["onClick"]),y(N,{type:"primary",onClick:t[6]||(t[6]=w((e=>l.nextStep(2)),["stop"]))},{default:F((()=>[S("下一步")])),_:1})])),_:1})])),_:1},8,["rules","model"]),b("div",null,[y(k,{type:1,index:1,surveyName:i.baseForm.surveyName,ifFormDescription:i.ifFormDescription,formDescription:i.baseForm.formDescription,ifFormLogo:i.ifFormLogo,logoUrl:i.baseForm.formLogo,FormIdY:i.formIdN,id:"y"},null,8,["surveyName","ifFormDescription","formDescription","ifFormLogo","logoUrl","FormIdY"]),b("div",Y,[y(j,{modelValue:i.visibility,"onUpdate:modelValue":t[7]||(t[7]=e=>i.visibility=e),label:"0"},{default:F((()=>[S("独立首页")])),_:1},8,["modelValue"])])]),b("div",null,[y(k,{type:1,index:2,unionDomId:"FormsDetail3",surveyName:i.baseForm.surveyName,ifFormDescription:i.ifFormDescription,formDescription:i.baseForm.formDescription,ifFormLogo:i.ifFormLogo,logoUrl:i.baseForm.formLogo,FormIdY:i.formIdN,id:"y"},null,8,["surveyName","ifFormDescription","formDescription","ifFormLogo","logoUrl","FormIdY"]),b("div",J,[y(j,{modelValue:i.visibility,"onUpdate:modelValue":t[8]||(t[8]=e=>i.visibility=e),label:"1"},{default:F((()=>[S("表单首页")])),_:1},8,["modelValue"])])])])],512),[[C,1===i.currentActive]]),v(b("div",B,[y(q,{pageDataAll:i.pageDataAll,onToStyles:l.toStyles},null,8,["pageDataAll","onToStyles"]),b("div",z,[y(N,{plain:"",onClick:w(l.CancelTheNewOne,["stop"])},{default:F((()=>[S("取消")])),_:1},8,["onClick"]),y(N,{onClick:t[9]||(t[9]=w((e=>i.currentActive=1),["stop"]))},{default:F((()=>[S("上一步")])),_:1}),y(N,{type:"primary",onClick:t[10]||(t[10]=w((e=>l.nextStep(3)),["stop"]))},{default:F((()=>[S("下一步")])),_:1})])],512),[[C,2===i.currentActive]]),3==i.currentActive?(f(),g("div",H,[y(_,{style:{"margin-left":"30%",width:"500px"}},{default:F((()=>[y(d,{label:"定时收集"},{default:F((()=>[y(c,{modelValue:i.baseForm.tinyint,"onUpdate:modelValue":t[11]||(t[11]=e=>i.baseForm.tinyint=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),b("div",Q,[i.baseForm.tinyint?(f(),T(be,L({key:0,style:{"margin-top":"20px"},modelValue:i.searchDate,"onUpdate:modelValue":t[12]||(t[12]=e=>i.searchDate=e),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},i.pickerOptions),null,16,["modelValue"])):U("",!0)])])),_:1}),y(d,{label:"只允许在微信中填写"},{default:F((()=>[y(c,{modelValue:i.baseForm.anAuth,"onUpdate:modelValue":t[13]||(t[13]=e=>i.baseForm.anAuth=e),"active-value":1,"inactive-value":0,onChange:t[14]||(t[14]=e=>0==e&&(i.One=0))},null,8,["modelValue"]),W])),_:1}),1==i.baseForm.anAuth?(f(),T(d,{key:0,label:"每人限制填写1次"},{default:F((()=>[y(c,{modelValue:i.One,"onUpdate:modelValue":t[15]||(t[15]=e=>i.One=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})):U("",!0),1==i.One?(f(),T(d,{key:1,style:{},label:"每人每天限制填写1次"},{default:F((()=>[y(c,{modelValue:i.OneToOne,"onUpdate:modelValue":t[16]||(t[16]=e=>i.OneToOne=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),Z])),_:1})):U("",!0),y(d,{style:{"margin-left":"auto !important",width:"280px","text-align":"right"}},{default:F((()=>[y(N,{plain:"",onClick:w(l.CancelTheNewOne,["stop"])},{default:F((()=>[S("取消")])),_:1},8,["onClick"]),y(N,{onClick:t[17]||(t[17]=w((e=>i.currentActive=2),["stop"]))},{default:F((()=>[S("上一步")])),_:1}),y(N,{type:"primary",onClick:t[18]||(t[18]=w((e=>l.nextStep(4)),["stop"]))},{default:F((()=>[S("下一步")])),_:1})])),_:1})])),_:1})])):U("",!0),v(b("div",K,[b("div",X,[b("div",G,[y(_,{ref:"baseForm","label-position":"left","label-width":"150px"},{default:F((()=>[b("div",ee,[y(d,{label:"表单链接"},{default:F((()=>[b("div",te,[b("div",null,[y(n,{style:{width:"400px"},modelValue:i.baseFormUrl4,"onUpdate:modelValue":t[19]||(t[19]=e=>i.baseFormUrl4=e),disabled:"","show-word-limit":"",clearable:""},null,8,["modelValue"])])])])),_:1}),b("div",se,[b("div",{style:{color:"var(--color)",cursor:"pointer"},type:"button",class:"copy-btn","data-clipboard-text":i.baseFormUrl4}," 复制 ",8,oe)])]),y(d,{label:"表单二维码"},{default:F((()=>[b("div",null,[b("div",null,[b("div",ie,[b("div",null,[b("canvas",le,null,512)]),b("div",{onClick:t[20]||(t[20]=w(((...e)=>l.btnDownload&&l.btnDownload(...e)),["stop"])),style:{display:"flex","align-items":"flex-end","margin-bottom":"5px",color:"var(--color)",cursor:"pointer","margin-left":"10px"}}," 下载二维码 ")]),re])])])),_:1}),y(d,{label:"是否开启渠道链接"},{default:F((()=>[b("div",null,[b("div",null,[b("div",null,[y(c,{modelValue:i.ifChannelsName,"onUpdate:modelValue":t[21]||(t[21]=e=>i.ifChannelsName=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),ae,i.ifChannelsName?(f(),g("div",ne,[de,(f(!0),g(I,null,D(i.ChannelsList,((e,t)=>(f(),g("div",{class:"add_form4_qd_ul",key:t},[b("div",me,[b("div",he,[y(n,{style:{width:"80%"},type:"text",placeholder:"请输入渠道标识",modelValue:i.ChannelsList[t],"onUpdate:modelValue":e=>i.ChannelsList[t]=e},null,8,["modelValue","onUpdate:modelValue"])])]),b("div",ce,[S(x(i.baseFormUrl4+"&dataSource=")+" ",1),y(n,{type:"text",placeholder:"请输入渠道标识",modelValue:i.channelsPathList[t],"onUpdate:modelValue":e=>i.channelsPathList[t]=e},null,8,["modelValue","onUpdate:modelValue"]),pe]),b("div",ue,[b("span",{style:{color:"var(--color)",cursor:"pointer"},onClick:w((s=>l.deletChannels(e,t)),["stop"])}," 取消 ",8,fe)])])))),128))])):U("",!0),i.ifChannelsName?(f(),g("div",{key:1,style:{color:"var(--color)",cursor:"pointer"},onClick:t[22]||(t[22]=w(((...e)=>l.addChannels&&l.addChannels(...e)),["stop"]))}," +继续添加 ")):U("",!0)])])])),_:1}),y(d,null,{default:F((()=>[e.$route.query.currentActiveA?U("",!0):(f(),T(N,{key:0,plain:"",onClick:w(l.removeFn,["stop"])},{default:F((()=>[S("取消新建")])),_:1},8,["onClick"])),e.$route.query.currentActiveA?(f(),T(N,{key:1,plain:"",onClick:w(l.cancelFn,["stop"])},{default:F((()=>[S("取消")])),_:1},8,["onClick"])):U("",!0),e.$route.query.currentActiveA?U("",!0):(f(),T(N,{key:2,type:"primary",onClick:t[23]||(t[23]=w((e=>l.nextStep(3,4)),["stop"]))},{default:F((()=>[S(" 上一步 ")])),_:1})),e.$route.query.currentActiveA?U("",!0):(f(),T(N,{key:3,type:"primary",onClick:t[24]||(t[24]=w((e=>l.addFormS("fb")),["stop"]))},{default:F((()=>[S(" 确认发布 ")])),_:1})),e.$route.query.currentActiveA?(f(),T(N,{key:4,type:"primary",onClick:t[25]||(t[25]=w((e=>l.addFormS()),["stop"]))},{default:F((()=>[S("确认修改")])),_:1})):U("",!0)])),_:1})])),_:1},512)]),4==i.currentActive?(f(),g("div",ge,[y(k,{FormIdY:i.formIdN,unionDomId:"FormsDetail4",id:"y"},null,8,["FormIdY"])])):U("",!0)])],512),[[C,4===i.currentActive]]),y(ye,{visible:i.dialogVisibleSelectTag,"onUpdate:visible":t[26]||(t[26]=e=>i.dialogVisibleSelectTag=e),selected:i.selectedTagList,onSuccess:l.submitSelectTag},null,8,["visible","selected","onSuccess"]),(f(),T(Fe,{key:i.codeForm.qrType,defaultValues:i.selectedUserList,visible:i.dialogVisibleSelectUser,"onUpdate:visible":t[27]||(t[27]=e=>i.dialogVisibleSelectUser=e),title:"选择使用员工",isOnlyLeaf:!0,isSigleSelect:1==i.codeForm.qrType,onSuccess:l.selectedUser},null,8,["defaultValues","visible","isSigleSelect","onSuccess"]))])}],["__scopeId","data-v-35535667"]]);export{be as default};
