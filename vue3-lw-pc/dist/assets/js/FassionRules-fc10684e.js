import{e,a as t}from"./api-0004a25c.js";import{y as l}from"../index-044285d2.js";import{_ as s}from"./quill-image-resize-module-c051113e.js";import{ai as a,aq as i,o,c as r,a as n,_ as d,U as m,Y as p,X as u,K as c,a9 as h,T as g,Z as f,V as b,bl as x,bj as j}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const y=(e,t,s)=>{""===t||l(t)?s():s(new Error("链接格式不正确"))},U={name:"task-steps-rules",data:()=>({loading:!1,dialogVisibleSelectUser:!1,selectedUserList:[],form:{fassionType:1,exchangeTip:null,exchangeType:3,exchangeContent:{redemptionLink:"",redemptionRule:"",weUserId:"",userName:""}},ruleForm:{exchangeTip:[{required:!0,message:"请输入数字",trigger:"blur"},{pattern:/^[1-9]\d*$/,message:"请输入正确数字",trigger:"blur"}],"exchangeContent.redemptionLink":[{required:!0,message:"请输入兑奖链接",trigger:"blur"},{validator:y,trigger:"blur"}],"exchangeContent.redemptionRule":[{required:!0,message:"请输入兑奖规则",trigger:"blur"}],"exchangeContent.weUserId":[{required:!0,message:"请选择客服",trigger:"blur"}]}}),props:{isDetail:{type:Boolean,default:!1},baseData:{type:Object,defalult:{}}},watch:{baseData:{handler(e){this.form=e,this.setData()},immediate:!0}},methods:{gotoPre(){this.$emit("updata",this.form),this.$emit("next",1)},changeType(e){this.$refs.ruleForm.clearValidate(),1==e?(this.selectedUserList=[],this.form.exchangeContent.weUserId=""):(this.form.exchangeContent.redemptionLink="",this.form.exchangeContent.redemptionRule="")},selectedUser(e){this.selectedUserList=e;let t=[],l=[];e.forEach((e=>{t.push(e.userId),l.push(e.name)})),this.form.exchangeContent.weUserId=t.join(","),this.form.exchangeContent.userName=l.join(",")},setData(){var e;if(2==this.form.exchangeType&&(null==(e=this.form.exchangeContent)?void 0:e.weUserId)){this.selectedUserList=[];let e=this.form.exchangeContent.weUserId.split(","),t=this.form.exchangeContent.userName.split(",");e.forEach(((e,l)=>{let s={userId:e,name:t[l]};this.selectedUserList.push(s)}))}},submit(){this.$refs.ruleForm.validate((l=>{l&&(this.loading=!0,(this.$route.query.id?e(this.form):t(this.form)).then((e=>{200==e.code&&(this.msgSuccess("操作成功!"),this.$router.back()),this.loading=!1})).catch((()=>{this.loading=!1})))}))}}},C={class:"g-card",style:{"margin-top":"20px"}},w={key:0},k={key:0,class:"select_content"},_={key:1,class:"select_content"},v=(e=>(x("data-v-c71887c3"),e=e(),j(),e))((()=>n("div",{class:"sub-des"},"仅做链接的跳转，不做具体兑奖的逻辑处理",-1))),V={key:2,class:"select_content"},T={key:0},L={key:0,class:"g-footer-sticky"};const q=s(U,[["render",function(e,t,l,s,x,j){const y=a("el-input"),U=a("el-form-item"),q=a("el-radio"),D=a("el-radio-group"),I=a("el-tag"),S=a("el-button"),R=a("el-form"),$=a("el-col"),F=a("el-row"),z=a("SelectUser"),E=i("loading");return o(),r("div",null,[n("div",C,[d(F,null,{default:m((()=>[d($,{span:15},{default:m((()=>[d(R,{model:x.form,rules:x.ruleForm,ref:"ruleForm","label-width":"140px",labelPosition:"right"},{default:m((()=>[d(U,{label:"兑奖条件",prop:"exchangeTip"},{default:m((()=>[p(" 客户成功邀请 "),d(y,{disabled:l.isDetail,style:{width:"100px"},modelValue:x.form.exchangeTip,"onUpdate:modelValue":t[0]||(t[0]=e=>x.form.exchangeTip=e)},null,8,["disabled","modelValue"]),p(" 人 "),2==x.form.fassionType?(o(),r("span",w,"入群")):u("",!0),p(" ，可参与兑奖 ")])),_:1}),d(U,{label:"兑奖方式",required:"",prop:"exchangeType"},{default:m((()=>[d(D,{modelValue:x.form.exchangeType,"onUpdate:modelValue":t[1]||(t[1]=e=>x.form.exchangeType=e),onChange:j.changeType,disabled:l.isDetail},{default:m((()=>[d(q,{label:3},{default:m((()=>[p("自助兑奖")])),_:1}),d(q,{label:1},{default:m((()=>[p("跳转链接兑奖")])),_:1}),d(q,{label:2},{default:m((()=>[p("添加客服兑奖")])),_:1})])),_:1},8,["modelValue","onChange","disabled"])])),_:1}),3==x.form.exchangeType?(o(),r("div",k,[d(U,{"label-width":"80px",label:"兑奖规则",prop:"exchangeContent.redemptionRule"},{default:m((()=>[d(y,{disabled:l.isDetail,type:"textarea",style:{border:"none",width:"364px"},modelValue:x.form.exchangeContent.redemptionRule,"onUpdate:modelValue":t[2]||(t[2]=e=>x.form.exchangeContent.redemptionRule=e),rows:"5",placeholder:"请输入兑奖规则",maxlength:"2000","show-word-limit":""},null,8,["disabled","modelValue"])])),_:1})])):u("",!0),1==x.form.exchangeType?(o(),r("div",_,[d(U,{"label-width":"80px",label:"兑奖链接",prop:"exchangeContent.redemptionLink"},{default:m((()=>[d(y,{disabled:l.isDetail,modelValue:x.form.exchangeContent.redemptionLink,"onUpdate:modelValue":t[3]||(t[3]=e=>x.form.exchangeContent.redemptionLink=e),placeholder:"请输入兑奖链接"},null,8,["disabled","modelValue"]),v])),_:1}),d(U,{"label-width":"80px",label:"兑奖规则",prop:"exchangeContent.redemptionRule"},{default:m((()=>[d(y,{disabled:l.isDetail,type:"textarea",style:{border:"none",width:"364px"},modelValue:x.form.exchangeContent.redemptionRule,"onUpdate:modelValue":t[4]||(t[4]=e=>x.form.exchangeContent.redemptionRule=e),rows:"5",placeholder:"请输入兑奖规则",maxlength:"2000","show-word-limit":""},null,8,["disabled","modelValue"])])),_:1})])):u("",!0),2==x.form.exchangeType?(o(),r("div",V,[d(U,{"label-width":"80px",label:"选择客服",prop:"exchangeContent.weUserId"},{default:m((()=>[x.selectedUserList.length>0?(o(),r("div",T,[(o(!0),r(c,null,h(x.selectedUserList,((e,t)=>(o(),g(I,{key:t},{default:m((()=>[p(f(e.name),1)])),_:2},1024)))),128))])):u("",!0),l.isDetail?u("",!0):(o(),g(S,{key:1,icon:"el-icon-plus",type:"primary",plain:"",onClick:t[5]||(t[5]=e=>x.dialogVisibleSelectUser=!0)},{default:m((()=>[p(f(x.form.exchangeContent.weUserId?"编辑":"选择")+"客服 ",1)])),_:1}))])),_:1})])):u("",!0)])),_:1},8,["model","rules"])])),_:1})])),_:1})]),l.isDetail?u("",!0):(o(),r("div",L,[d(S,{plain:"",onClick:j.gotoPre},{default:m((()=>[p("上一步")])),_:1},8,["onClick"]),b((o(),g(S,{type:"primary",onClick:j.submit},{default:m((()=>[p(" 确认"+f(e.$route.query.id?"保存":"创建"),1)])),_:1},8,["onClick"])),[[E,x.loading]])])),d(z,{visible:x.dialogVisibleSelectUser,"onUpdate:visible":t[6]||(t[6]=e=>x.dialogVisibleSelectUser=e),title:"选择成员",isOnlyLeaf:!0,isSigleSelect:!0,defaultValues:x.selectedUserList,onSuccess:j.selectedUser},null,8,["visible","defaultValues","onSuccess"])])}],["__scopeId","data-v-c71887c3"]]);export{q as default};
