import{i as e}from"./echarts-8e7b9cd7.js";import{r as t}from"../index-044285d2.js";import{_ as a}from"./quill-image-resize-module-c051113e.js";import{ai as i,aq as o,o as l,c as s,_ as r,a as n,U as d,Y as p,V as m,T as c,Z as h}from"./@vue-e400fd81.js";import"./tslib-a4e99503.js";import"./zrender-da4e2cf7.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const g=window.lwConfig.services.wecom+"/RedEnvelopes";const u={name:"total-data",components:{},data:()=>({timeRange:7,dateRange:[],loading:!1,loadingChart:!1,query:{pageNum:1,pageSize:10},list:[],total:0,cardData:[]}),mounted(){this.$store.setBusininessDesc("\n        <div>统计分析企业支出金额及笔数情况</div>\n      "),this.getList(),this.setTime(7),this.getRecordList()},methods:{getList(){this.loading=!0,t({url:g+"/countTab"}).then((({data:e})=>{this.cardData=[{title:"累计支出金额（元）",value:e.totalMoney/100,noArrow:!0},{title:"累计支出笔数",value:e.totalNum,noArrow:!0},{title:"今日支出金额（元）",value:e.currentMoney/100,noArrow:!0},{title:"今日支出笔数",value:e.currentNum,noArrow:!0}]})).catch((e=>{})).finally((()=>{this.loading=!1}))},getChartList(){var e;this.loadingChart=!0,this.dateRange?(this.query.beginTime=this.dateRange[0],this.query.endTime=this.dateRange[1]):(this.query.beginTime="",this.query.endTime=""),(e=this.query,t({url:g+"/countLineChart",params:e})).then((({data:e})=>{let t=[];t[0]=e.map((e=>e.totalMoney/100)),t[1]=e.map((e=>e.totalNum));let a=e.map((e=>e.createTime.slice(0,10)));this.setEchart(a,t)})).catch((e=>{})).finally((()=>{this.loadingChart=!1}))},getRecordList(e){var a;e&&(this.query.pageNum=e),this.loading=!0,(a=this.query,t({url:g+"/findRecordGroupByUserId",params:a})).then((({rows:e,total:t})=>{e.forEach((e=>{e.totalMoney/=100})),this.list=e,this.total=+t})).catch((e=>{})).finally((()=>{this.loading=!1}))},handleSelectionChange(){},setTime(e){this.timeRange=e;let t=new Date;t.setDate(t.getDate()-e),this.dateRange=[this.getTime(t),this.getTime()],this.getChartList()},getTime(e){const t=e?new Date(e):new Date;return t.getFullYear()+"-"+this.getHandledValue(t.getMonth()+1)+"-"+this.getHandledValue(t.getDate())},getHandledValue:e=>e<10?"0"+e:e,setEchart(e,t){setTimeout((()=>{this.drawLine("chart",["支出金额","支出笔数"],e,t,["#5AD2D2","#637BC0"])}),0)},drawLine(t,a,i,o,l){const s=document.getElementById(t);let r=s.parentNode.offsetWidth||window.innerWidth-100;s.style.width=r+"px",s.style.height="400px";const n=e(s);let d=[],p=[];o.forEach(((e,t)=>{let i=e.slice().sort(((e,t)=>t-e))[0];i=10*Math.ceil(i/10),p.push({name:a[t],type:"value",min:0,max:i,interval:i/5,axisLine:{lineStyle:{color:"#ccc"}}}),d.push({name:a[t],type:0===t?"line":"bar",yAxisIndex:t,smooth:!0,data:e,itemStyle:{normal:{lineStyle:{color:l[t]}}},textStyle:{color:"#fff"}})}));let m={color:l,tooltip:{trigger:"axis"},legend:{data:a,bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"40px",containLabel:!0},xAxis:{type:"category",data:i,axisLine:{lineStyle:{color:"#ccc"}}},yAxis:p,series:d};n.setOption(m),new ResizeObserver((e=>{n.resize()})).observe(s)}}},y={class:"g-card"},j=n("div",{class:"g-card-title"},"支出趋势",-1),f={id:"chart",ref:"chart",style:{width:"90%",height:"400px"}},v={class:"g-card"},w=n("div",{class:"g-card-title"},"支出记录",-1);const b=a(u,[["render",function(e,t,a,g,u,b){const x=i("CardGroupIndex"),q=i("el-button"),C=i("el-button-group"),T=i("el-date-picker"),R=i("el-table-column"),D=i("el-table"),L=i("pagination"),S=o("loading");return l(),s("div",null,[r(x,{data:u.cardData},null,8,["data"]),n("div",y,[j,n("div",null,[r(C,null,{default:d((()=>[r(q,{type:"primary",plain:7!=u.timeRange,onClick:t[0]||(t[0]=e=>b.setTime(7))},{default:d((()=>[p("近7日")])),_:1},8,["plain"]),r(q,{type:"primary",plain:30!=u.timeRange,onClick:t[1]||(t[1]=e=>b.setTime(30))},{default:d((()=>[p("近30日")])),_:1},8,["plain"])])),_:1}),r(T,{modelValue:u.dateRange,"onUpdate:modelValue":t[2]||(t[2]=e=>u.dateRange=e),class:"ml20",style:{width:"260px"},"value-format":"YYYY-MM-DD",type:"daterange",clearable:!1,"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:b.getList},null,8,["modelValue","onChange"])]),m((l(),s("div",null,[n("div",f,null,512)])),[[S,u.loadingChart]])]),n("div",v,[w,m((l(),c(D,{data:u.list,onSelectionChange:b.handleSelectionChange,"max-height":"600"},{default:d((()=>[r(R,{label:"员工名称",align:"center",prop:"userName","show-overflow-tooltip":""}),r(R,{label:"发送类型",align:"center",prop:"receiveType"},{default:d((({row:e})=>[p(h({1:"好友客户",2:"群成员"}[e.receiveType]),1)])),_:1}),r(R,{label:"发送时间",align:"center",prop:"createTime"}),r(R,{label:"发送金额(元)",align:"center",prop:"totalMoney",width:"180"})])),_:1},8,["data","onSelectionChange"])),[[S,u.loading]]),r(L,{total:u.total,page:u.query.pageNum,"onUpdate:page":t[3]||(t[3]=e=>u.query.pageNum=e),limit:u.query.pageSize,"onUpdate:limit":t[4]||(t[4]=e=>u.query.pageSize=e),onPagination:t[5]||(t[5]=e=>b.getRecordList())},null,8,["total","page","limit"])])])}]]);export{b as default};
