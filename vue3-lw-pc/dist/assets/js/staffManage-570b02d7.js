import{r as e}from"../index-044285d2.js";import{_ as t}from"./quill-image-resize-module-c051113e.js";import{n as s,ai as i,aq as a,o as l,c as r,_ as o,U as d,a as m,K as u,a9 as n,T as c,Y as p,Z as g,V as b,X as h,bl as y,bj as f}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const v=window.lwConfig.services.wecom+"/RedEnvelopes";function U(t){return e({url:v+"/addOrUpdateUserRedEnvelopsLimit",method:"post",data:t})}function j(t){return e({url:v+"/batchUpdateUserRedEnvelopsLimit",method:"post",data:t})}let C={weUserId:"",users:[],singleCustomerReceiveNum:1,singleCustomerReceiveMoney:1};const I={name:"member",data(){let e=this;return{addVisible:!1,loading:!1,list:[],total:0,query:{pageNum:1,pageSize:10,userId:""},queryUser:[],addMemberForm:C,addRules:{weUserId:[{required:!0,message:"必填项",trigger:"change"}],singleCustomerReceiveNum:[{required:!0,message:"必填项",trigger:"blur"},{validator:function(t,s,i){let a=e.addMemberForm.singleCustomerReceiveNumMin;s=Number(s),Number.isNaN(s)||s<a||s>999999||!Number.isInteger(s)?i(`请输入 ${a}-999999 的正整数，修改次数不得小于已发送次数`):i()},trigger:"blur"}],singleCustomerReceiveMoney:[{required:!0,message:"必填项",trigger:"change"},{validator:function(e,t,s){t=Number(t),Number.isNaN(t)||t<1||t>5e3?s("请输入1.00-5000.00的数字"):s()},trigger:"change"}]},dialogVisibleSelectUser:!1,selectedIds:[],selectUserData:{isSigleSelect:!1,type:""},batchUpdate:!1}},watch:{},created(){this.getList()},methods:{getList(){var t;this.loading=!0,(t=this.query,e({url:v+"/findLimitUserRedEnvelops",params:t})).then((({rows:e,total:t})=>{e.forEach((e=>{e.singleCustomerReceiveMoney=(e.singleCustomerReceiveMoney/100).toFixed(2),e.todayIssuedAmount=(e.todayIssuedAmount/100).toFixed(2),e.todayNoIssuedAmount=(e.todayNoIssuedAmount/100).toFixed(2),e.totalIssuedAmount=(e.totalIssuedAmount/100).toFixed(2)})),this.list=e,this.total=+t})).finally((()=>this.loading=!1))},resetQuery(){this.queryUser=[],this.query.userId="",this.$refs.queryForm.resetFields(),this.getList(1)},edit(e=C){this.addMemberForm=Object.assign({},e),e.userName&&(this.addMemberForm.users=e.userName.split(",")),this.addMemberForm.singleCustomerReceiveNumMin=+this.addMemberForm.todayIssuedNum||1,this.addVisible=!0,s((()=>this.$refs.addMemberForm.clearValidate()))},handleSelectionChange(e){this.selectedIds=e.map((e=>e.id))},selectUser(e){this.selectUserData.type=e,this.selectUserData.isSigleSelect=1==e,this.dialogVisibleSelectUser=!0},submitSelectUser(e){1==this.selectUserData.type?(this.queryUser=e,this.query.userId=e.map((e=>e.userId)).join(),this.getList(1)):(this.addMemberForm.users=e.map((e=>({weUserId:e.userId,name:e.name}))),this.addMemberForm.weUserId=e.map((e=>e.userId))+"",this.$refs.addMemberForm.validateField("weUserId"))},addOrUpdate(){this.batchUpdate&&(this.addMemberForm.ids=this.selectedIds+""),this.$refs.addMemberForm.validate((e=>{if(!e)return;let t=Object.assign({},this.addMemberForm);t.singleCustomerReceiveMoney*=100,delete t.todayIssuedAmount,delete t.todayNoIssuedAmount,delete t.totalIssuedAmount,(this.batchUpdate?j:U)(t).then((e=>{this.getList(),this.addVisible=!1,this.msgSuccess("操作成功")}))}))},remove(t){this.$confirm("是否确认删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var s;t=t||this.selectedIds.join(","),(s=t,e({url:v+"/deleteLimitUserRedEnvelops/"+s,method:"DELETE"})).then((e=>{this.getList(),this.msgSuccess("删除成功")}))}))}}},M=e=>(y("data-v-9b280dd8"),e=e(),f(),e),N={key:0,class:"tag-place"},F={class:"g-card"},w={class:"mid-action"},S={class:"bottom"},_=M((()=>m("div",{style:{"align-self":"flex-end"}},null,-1))),q=M((()=>m("div",{class:"sub-des"},"支持多选",-1))),R={class:"sub-des"},V=M((()=>m("div",{class:"sub-des"},"精确到小数点后两位，可输入1.00-5000.00",-1))),k={class:"dialog-footer"};const x=t(I,[["render",function(e,t,s,y,f,v){const U=i("el-tag"),j=i("el-form-item"),C=i("el-button"),I=i("el-form"),M=i("el-table-column"),x=i("el-table"),L=i("pagination"),A=i("el-input"),E=i("el-input-number"),D=i("el-dialog"),z=i("SelectUser"),O=a("loading");return l(),r("div",null,[o(I,{ref:"queryForm",inline:!0,model:f.query,"label-width":"70px",class:"top-search"},{default:d((()=>[o(j,{label:"选择员工",prop:"userId"},{default:d((()=>[m("div",{class:"tag-input",onClick:t[0]||(t[0]=e=>v.selectUser(1))},[f.queryUser.length?(l(!0),r(u,{key:1},n(f.queryUser,((e,t)=>(l(),c(U,{key:t},{default:d((()=>[p(g(e.name),1)])),_:2},1024)))),128)):(l(),r("span",N,"请选择员工"))])])),_:1}),o(j,{"label-width":""},{default:d((()=>[o(C,{type:"primary",onClick:t[1]||(t[1]=e=>v.getList(1))},{default:d((()=>[p("查询")])),_:1}),o(C,{onClick:v.resetQuery},{default:d((()=>[p("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),m("div",F,[m("div",w,[o(C,{type:"primary",onClick:t[2]||(t[2]=e=>{f.batchUpdate=!1,v.edit()})},{default:d((()=>[p("新建员工限额")])),_:1})]),b((l(),c(x,{data:f.list,onSelectionChange:v.handleSelectionChange},{default:d((()=>[o(M,{type:"selection",width:"55",align:"center"}),o(M,{prop:"userName",label:"员工姓名",align:"center"}),o(M,{prop:"singleCustomerReceiveNum",label:"限额总笔数/总金额",align:"center"},{default:d((({row:e})=>[p(g(e.singleCustomerReceiveNum)+"/"+g(e.singleCustomerReceiveMoney),1)])),_:1}),o(M,{label:"今日已发放金额/剩余金额",align:"center"},{default:d((({row:e})=>[p(g(e.todayIssuedAmount)+"/"+g(e.todayNoIssuedAmount),1)])),_:1}),o(M,{label:"今日已发放次数/剩余次数",align:"center"},{default:d((({row:e})=>[p(g(e.todayIssuedNum)+"/"+g(e.todayNoIssuedNum),1)])),_:1}),o(M,{label:"累计已发放次数/金额",align:"center",width:"180"},{default:d((({row:e})=>[p(g(e.totalIssuedNum)+"/"+g(e.totalIssuedAmount),1)])),_:1}),o(M,{label:"操作",align:"center"},{default:d((({row:e})=>[o(C,{text:"",onClick:t=>{f.batchUpdate=!1,v.edit(e)}},{default:d((()=>[p("编辑")])),_:2},1032,["onClick"]),o(C,{text:"",onClick:t=>v.remove(e.id)},{default:d((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[O,f.loading]]),m("div",S,[_,o(L,{total:f.total,page:f.query.pageNum,"onUpdate:page":t[3]||(t[3]=e=>f.query.pageNum=e),limit:f.query.pageSize,"onUpdate:limit":t[4]||(t[4]=e=>f.query.pageSize=e),onPagination:t[5]||(t[5]=e=>v.getList())},null,8,["total","page","limit"])])]),o(D,{title:(f.addMemberForm.id?"编辑":"新建")+"员工限额",modelValue:f.addVisible,"onUpdate:modelValue":t[10]||(t[10]=e=>f.addVisible=e),width:"40%","close-on-click-modal":!1},{footer:d((()=>[m("span",k,[o(C,{onClick:t[9]||(t[9]=e=>f.addVisible=!1)},{default:d((()=>[p("取 消")])),_:1}),o(C,{type:"primary",onClick:v.addOrUpdate},{default:d((()=>[p("确 定")])),_:1},8,["onClick"])])])),default:d((()=>[o(I,{ref:"addMemberForm",model:f.addMemberForm,rules:f.addRules,position:"right","label-width":"180px"},{default:d((()=>[f.batchUpdate?h("",!0):(l(),c(j,{key:0,label:"选择员工",prop:"weUserId"},{default:d((()=>[(l(!0),r(u,null,n(f.addMemberForm.users,((e,t)=>(l(),c(U,{key:t},{default:d((()=>[p(g(e.name||e),1)])),_:2},1024)))),128)),f.addMemberForm.id?h("",!0):(l(),r(u,{key:0},[o(C,{type:"primary",plain:"",onClick:t[6]||(t[6]=e=>v.selectUser(2))},{default:d((()=>[p("选择员工")])),_:1}),q],64))])),_:1})),o(j,{label:"单日员工发红包次数",prop:"singleCustomerReceiveNum"},{default:d((()=>[o(A,{modelValue:f.addMemberForm.singleCustomerReceiveNum,"onUpdate:modelValue":t[7]||(t[7]=e=>f.addMemberForm.singleCustomerReceiveNum=e),placeholder:"请输入次数"},null,8,["modelValue"]),m("div",R,"输入 "+g(f.addMemberForm.singleCustomerReceiveNumMin)+"-999999 的正整数",1)])),_:1}),o(j,{label:"单日员工发红包总额(元)",prop:"singleCustomerReceiveMoney"},{default:d((()=>[o(E,{modelValue:f.addMemberForm.singleCustomerReceiveMoney,"onUpdate:modelValue":t[8]||(t[8]=e=>f.addMemberForm.singleCustomerReceiveMoney=e),placeholder:"请输入",precision:2,step:.1,min:.3,max:5e3},null,8,["modelValue"]),V])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),o(z,{visible:f.dialogVisibleSelectUser,"onUpdate:visible":t[11]||(t[11]=e=>f.dialogVisibleSelectUser=e),title:"选择员工",isOnlyLeaf:!0,isSigleSelect:f.selectUserData.isSigleSelect,defaultValues:1==f.selectUserData.type?f.queryUser:f.list.map((e=>e.weUserId)).join().split(","),onSuccess:v.submitSelectUser},null,8,["visible","isSigleSelect","defaultValues","onSuccess"])])}],["__scopeId","data-v-9b280dd8"]]);export{x as default};
