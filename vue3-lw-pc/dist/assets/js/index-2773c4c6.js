import{u as e,b as t,f as i,d as o}from"./smartForms-eaa9db9a.js";import{d as a}from"../index-044285d2.js";import l from"./formsDetail-43ee5d84.js";import r from"./Channels-5746c92b.js";import{g as s,j as n,u as d,b as u,r as m}from"./staff-48996164.js";import{ai as p,aq as c,o as h,c as g,a as y,K as f,a9 as v,P as w,Z as S,T as j,ab as b,U as k,_ as C,Y as q,X as I,aa as _,R as F,V,a5 as x,bl as D,bj as N}from"./@vue-e400fd81.js";import{_ as U}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./vant-b6a5d036.js";import"./@vant-a2ba62fc.js";import"./RightPanel-299cad40.js";import"./TreeNodeDialog-1d89ab66.js";import"./IconsDialog-a9f799a3.js";import"./vuedraggable-6f5e6033.js";import"./vue-afbfa742.js";import"./CodeTypeDialog-a4fd582c.js";import"./DraggableItem-8beb6ac6.js";import"./qrcode-fb057d44.js";import"./encode-utf8-2ec93547.js";import"./dijkstrajs-38d0b2a1.js";const T={mediaType:15,name:""},L={name:"CodeStaff",components:{FormsDetail:l,Channels:r},data:()=>({newData:"",ifChannels:!1,newGroupId:"",FormIdY:"",Preview:!1,DefaultGroupingId:"",seachDate:"",query:{createTime:"",pageNum:1,pageSize:10,groupId:"",surveyName:"",surveyState:void 0},dateRange:[],userArray:[],userArrayStr:"",dialogVisible:!1,loading:!1,ids:[],total:0,list:[],form:{codeType:3,qrcode:"",isJoinConfirmFriends:0,weEmpleCodeTags:[],weEmpleCodeUseScops:[]},groupList:[],groupVisible:!1,groupForm:JSON.parse(JSON.stringify(T)),rules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}]},groupIndex:0}),created(){this.getCodeCategoryListFn()},mounted(){},methods:{openPreview(e){this.FormIdY=e,this.Preview=!0},openChannels(e){this.FormIdY=e,this.ifChannels=!0},updateInfoToSurvey(t){e(t).then((e=>{})).catch((()=>{}))},updateSurveyStatus(e,i,o,l){let r=this;if(0!=o.surveyState||o.timingStart){if(0==o.surveyState&&o.timingStart){let t={id:e,timingStart:o.timingStart,timingEnd:o.timingEnd};this.updateInfoToSurvey(t)}}else{let t={id:e,timingStart:a(new Date)};this.updateInfoToSurvey(t)}if(1==i){if(o.timingStart){if(new Date<new Date(o.timingStart)){i=1;let t={id:e,timingStart:a(new Date),timingEnd:o.timingEnd};this.updateInfoToSurvey(t)}}if(o.timingEnd){new Date>new Date(o.timingEnd)&&(i=3)}}if(3==i){let t={id:e,timingEnd:a(new Date)};this.updateInfoToSurvey(t)}t({id:e,surveyState:i}).then((e=>{[1,2,3].includes(i)&&"no"!=l&&this.msgSuccess("操作成功"),r.getList()})).catch((()=>{}))},addGroup(){this.groupForm=JSON.parse(JSON.stringify(T)),this.groupVisible=!0},getCodeCategoryListFn(){s({mediaType:T.mediaType}).then((({data:e})=>{this.groupList=e;let t=this.$route.query&&this.$route.query.groupId,i=e.findIndex((e=>e.id===t));t&&-1!=i?(this.query.groupId=t,this.query.groupName=e[i].name,this.groupIndex=i):(this.query.groupId=void 0,this.query.groupName=void 0,this.groupIndex=void 0),this.query.pageNum=1;for(let o=0;o<e.length;o++)"默认分组"==e[o].name&&(this.newGroupId=e[o].id);this.getList()}))},switchGroup(e,t){this.groupIndex=e,this.query.groupName=t.name,this.$router.replace({query:{groupId:t.id}}),this.query.groupId=t.id,this.search()},getSelectUser(e){this.userArray=e,this.query.qrUserName=this.userArray.map((function(e,t){return e.name})).join(",")},search(){this.query.pageNum=1,this.getList()},getList(){this.dateRange?(this.query.startDate=this.dateRange[0],this.query.endDate=this.dateRange[1]):(this.query.startDate="",this.query.endDate=""),this.loading=!0,i(this.query).then((e=>{this.total=Number(e.total),this.list=e.rows;for(let t=0;t<this.list.length;t++)if(4==this.list[t].surveyState){if(this.list[t].timingStart){new Date<new Date(this.list[t].timingStart)?this.list[t].surveyState=4:(this.list[t].surveyState=1,this.updateSurveyStatus(this.list[t].id,1,this.list[t],"no"))}if(this.list[t].timingEnd){new Date>new Date(this.list[t].timingEnd)&&(this.list[t].surveyState=3)}}this.loading=!1,this.ids=[]})).catch((()=>{this.loading=!1}))},resetQuery(){this.query.createTime="",this.query.surveyState="",this.query.surveyName="",this.query.id="",this.search()},goRoute(e,t,i,o,a){this.$router.push({path:e,query:{id:t,formId:i,currentActiveA:o,currentActiveB:a,groupId:this.query.groupId}})},handleSelectionChange(e){this.ids=e.map((e=>e.id))},removeFn(e,t){if("mult"===e&&!this.ids.length)return void this.msgInfo("请选择要删除项！");const i=t||this.ids.join(",");this.$confirm("是否确定删除当前问卷？该操作同步删除所有数据，且不可恢复，请谨慎操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>o(i))).then((()=>{this.search(),this.msgSuccess("删除成功")})).catch((function(){}))},download(e,t,i){let o=t+"-"+i+".png";n(e).then((e=>{if(null!=e){let t=new Blob([e],{type:"application/zip"}),i=window.URL.createObjectURL(t);const a=document.createElement("a");a.href=i,a.download=o,a.click(),URL.revokeObjectURL(i)}}))},downloadBatch(e){this.ids.length?this.$confirm("是否确认下载所有图片吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>n(this.ids.join(",")))).then((e=>{if(null!=e){let t=new Blob([e],{type:"application/zip"}),i=window.URL.createObjectURL(t);const o=document.createElement("a");o.href=i,o.download="批量员工活码.zip",o.click(),URL.revokeObjectURL(i)}})).catch((function(){})):this.msgInfo("请先勾选下载项！")},onAddOrUpdateGroup(){this.$refs.groupForm.validate((e=>{if(this.groupForm.id){let e={id:this.groupForm.id,name:this.groupForm.name,mediaType:T.mediaType};this.groupForm=e}e&&(this.groupForm.id?d:u)(this.groupForm).then((e=>{this.groupVisible=!1,this.groupForm=JSON.parse(JSON.stringify(T)),this.$refs.groupForm.clearValidate(),this.msgSuccess("操作成功"),this.getCodeCategoryListFn()}))}))},onGroupCommand(e,t){"1"!==t.id?"edit"==e?this.editGroup(t):"remove"==e&&this.removeGroup(t.id):this.msgInfo("默认分组不可操作！")},editGroup(e){this.groupForm=JSON.parse(JSON.stringify(e)),this.groupVisible=!0},removeGroup(e){let t=this;this.$confirm("是否确认删除当前分组，删除后所有表单将设置为默认分组，该操作不可撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t.newGroupId,m(e).then((e=>{this.msgSuccess("操作成功"),t.getCodeCategoryListFn()}))})).catch((()=>{}))}}},R=e=>(D("data-v-ee464adc"),e=e(),N(),e),G={class:"g-left-right"},Y={class:"left g-card"},E={class:"title"},O=R((()=>y("div",{class:"title-name"},"表单分组",-1))),B={class:"item-list"},z=["onClick"],A={class:"name"},J={key:0},P={key:0,class:"dot"},$={class:"right"},M={class:"g-card"},Q={class:"mid-action"},K={style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},W={key:0},X={key:0},Z={key:0},H={key:1},ee={key:2},te={key:3},ie={style:{display:"flex","align-items":"center"}},oe=R((()=>y("div",null,"总访问量/有效收集量",-1))),ae={style:{"margin-left":"10px"}},le=R((()=>y("p",null,"总访问量:PV;",-1))),re=R((()=>y("p",null,"有效收集量:成功提交表单的UV",-1))),se={class:"dialog-footer"};const ne=U(L,[["render",function(e,t,i,o,a,l){const r=p("el-icon-MoreFilled"),s=p("el-dropdown-item"),n=p("el-dropdown-menu"),d=p("el-dropdown"),u=p("el-input"),m=p("el-form-item"),D=p("el-date-picker"),N=p("el-option"),U=p("el-select"),T=p("el-button"),L=p("el-form"),R=p("el-table-column"),ne=p("el-icon-QuestionFilled"),de=p("el-popover"),ue=p("el-table"),me=p("pagination"),pe=p("el-dialog"),ce=p("FormsDetail"),he=p("Channels"),ge=c("loading");return h(),g("div",null,[y("div",G,[y("div",Y,[y("div",E,[O,y("div",{class:"title-btn",onClick:t[0]||(t[0]=(...e)=>l.addGroup&&l.addGroup(...e))},"添加")]),y("div",B,[(h(!0),g(f,null,v(a.groupList,((e,t)=>(h(),g("div",{class:w(["item",{active:a.groupIndex==t}]),key:e.id,onClick:i=>l.switchGroup(t,e)},[y("div",A,S(e.name),1),a.groupIndex==t&&0===e.flag?(h(),j(d,{key:0,class:"dropdown",onCommand:t=>l.onGroupCommand(t,e)},b({default:k((()=>[e?(h(),g("div",J,["默认分组"!=e.name?(h(),g("span",P,[C(r,{class:"el-icon-MoreFilled"})])):I("",!0)])):I("",!0)])),_:2},[e?{name:"dropdown",fn:k((()=>[C(n,null,{default:k((()=>[C(s,{command:"edit"},{default:k((()=>[q("修改分组")])),_:1}),C(s,{command:"remove"},{default:k((()=>[q("删除分组")])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["onCommand"])):I("",!0)],10,z)))),128))])]),y("div",$,[C(L,{inline:!0,"label-width":"70px","label-position":"left",class:"top-search"},{default:k((()=>[C(m,{label:"表单ID"},{default:k((()=>[C(u,{onkeyup:"value=value.replace(/[^\\d]/g,'')",modelValue:a.query.id,"onUpdate:modelValue":t[1]||(t[1]=e=>a.query.id=e),placeholder:"请输入表单ID",clearable:"",onKeyup:t[2]||(t[2]=_((e=>l.search()),["enter"]))},null,8,["modelValue"])])),_:1}),C(m,{label:"表单名称"},{default:k((()=>[C(u,{modelValue:a.query.surveyName,"onUpdate:modelValue":t[3]||(t[3]=e=>a.query.surveyName=e),clearable:"",placeholder:"请输入表单名称",onKeyup:t[4]||(t[4]=_((e=>l.search()),["enter"]))},null,8,["modelValue"])])),_:1}),C(m,{label:"创建时间"},{default:k((()=>[C(D,F({modelValue:a.dateRange,"onUpdate:modelValue":t[5]||(t[5]=e=>a.dateRange=e),"value-format":"YYYY-MM-DD",type:"daterange"},e.pickerOptions,{"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"}),null,16,["modelValue"])])),_:1}),C(m,{label:"选择状态",prop:"addState"},{default:k((()=>[C(U,{modelValue:a.query.surveyState,"onUpdate:modelValue":t[6]||(t[6]=e=>a.query.surveyState=e)},{default:k((()=>[C(N,{label:"未发布",value:0}),C(N,{label:"收集中",value:1}),C(N,{label:"已暂停",value:2}),C(N,{label:"已结束",value:3})])),_:1},8,["modelValue"])])),_:1}),C(m,{"label-width":"0"},{default:k((()=>[C(T,{type:"primary",onClick:t[7]||(t[7]=e=>l.search())},{default:k((()=>[q("查询")])),_:1}),C(T,{onClick:l.resetQuery},{default:k((()=>[q("重置")])),_:1},8,["onClick"])])),_:1})])),_:1}),y("div",M,[y("div",Q,[C(T,{type:"primary",onClick:t[8]||(t[8]=e=>l.goRoute("add"))},{default:k((()=>[q("新建表单")])),_:1}),y("div",null,[C(T,{type:"primary",plain:"",onClick:t[9]||(t[9]=e=>l.removeFn("mult"))},{default:k((()=>[q("删除")])),_:1})])]),V((h(),j(ue,{data:a.list,onSelectionChange:l.handleSelectionChange,style:{width:"100%"}},{default:k((()=>[C(R,{type:"selection",width:"50",align:"center"}),C(R,{label:"表单ID&名称","min-width":"170",align:"center",prop:"id","show-overflow-tooltip":""},{default:k((({row:e})=>[y("div",null,"ID："+S(e.id),1),y("div",null,"名称："+S(e.surveyName),1)])),_:1}),C(R,{label:"表单分组",align:"center","min-width":"100",prop:"groupName","show-overflow-tooltip":""},{default:k((({row:e})=>[y("div",K,S(e.groupName),1)])),_:1}),C(R,{label:"创建人&时间",align:"center","min-width":"130",prop:"createTime","show-overflow-tooltip":""},{default:k((({row:e})=>[y("div",null,S(e.createBy),1),y("div",null,S(e.createTime),1)])),_:1}),C(R,{label:"收集开始&结束时间",align:"center","min-width":"200",prop:"qrUserInfos","show-overflow-tooltip":""},{default:k((({row:e})=>[y("div",null,[q(" 开始时间:"+S(e.timingStart)+" ",1),e.timingStart?I("",!0):(h(),g("span",W,"永久"))]),y("div",null,[q(" 结束时间:"+S(e.timingEnd)+" ",1),e.timingEnd?I("",!0):(h(),g("span",X,"永久"))])])),_:1}),C(R,{label:"表单状态",align:"center","min-width":"100",prop:"qrGroupName","show-overflow-tooltip":""},{default:k((({row:e})=>[0==e.surveyState?(h(),g("div",Z,"未发布")):I("",!0),1==e.surveyState?(h(),g("div",H,"收集中")):I("",!0),2==e.surveyState?(h(),g("div",ee,"已暂停")):I("",!0),3==e.surveyState?(h(),g("div",te,"已结束")):I("",!0)])),_:1}),C(R,{label:"总访问量/有效收集量",align:"center","min-width":"180",prop:"qrGroupName","show-overflow-tooltip":""},{header:k((e=>[y("div",ie,[oe,y("div",ae,[C(de,{width:"250",trigger:"hover"},{reference:k((()=>[C(ne,{class:"el-icon-QuestionFilled"})])),default:k((()=>[le,re])),_:1})])])])),default:k((({row:e})=>[y("div",null,S(e.totalVisits)+"/"+S(e.collectionVolume),1)])),_:1}),C(R,{label:"最近操作人&时间",align:"center","min-width":"130",prop:"qrGroupName","show-overflow-tooltip":""},{default:k((({row:e})=>[y("div",null,S(e.updateBy),1),y("div",null,S(e.updateTime),1)])),_:1}),C(R,{label:"操作",align:"center",fixed:"right",width:"260"},{default:k((({row:e})=>[C(T,{text:"",onClick:x((t=>l.openPreview(e.id)),["stop"])},{default:k((()=>[q("预览")])),_:2},1032,["onClick"]),[0,2].includes(+e.surveyState)?(h(),j(T,{key:0,text:"",onClick:t=>l.updateSurveyStatus(e.id,1,e)},{default:k((()=>[q(" 开启 ")])),_:2},1032,["onClick"])):I("",!0),0==e.surveyState?(h(),j(T,{key:1,text:"",onClick:t=>l.goRoute("add","",e.id)},{default:k((()=>[q("编辑")])),_:2},1032,["onClick"])):I("",!0),[1,2].includes(+e.surveyState)?(h(),j(T,{key:2,onClick:x((t=>l.openChannels(e.id)),["stop"]),text:""},{default:k((()=>[q(" 分享 ")])),_:2},1032,["onClick"])):I("",!0),[1,4].includes(+e.surveyState)?(h(),j(T,{key:3,text:"",onClick:t=>l.updateSurveyStatus(e.id,2,e)},{default:k((()=>[q(" 暂停 ")])),_:2},1032,["onClick"])):I("",!0),[1,2].includes(+e.surveyState)?(h(),j(T,{key:4,text:"",onClick:t=>l.updateSurveyStatus(e.id,3,e)},{default:k((()=>[q(" 结束 ")])),_:2},1032,["onClick"])):I("",!0),1!=e.surveyState?(h(),j(T,{key:5,text:"",onClick:t=>l.removeFn("single",e.id)},{default:k((()=>[q("删除")])),_:2},1032,["onClick"])):I("",!0),0!=e.surveyState?(h(),j(T,{key:6,text:"",onClick:t=>l.goRoute("smartFormStatistics",e.id)},{default:k((()=>[q(" 统计 ")])),_:2},1032,["onClick"])):I("",!0)])),_:1})])),_:1},8,["data","onSelectionChange"])),[[ge,a.loading]]),C(me,{total:a.total,page:a.query.pageNum,"onUpdate:page":t[10]||(t[10]=e=>a.query.pageNum=e),limit:a.query.pageSize,"onUpdate:limit":t[11]||(t[11]=e=>a.query.pageSize=e),onPagination:t[12]||(t[12]=e=>l.getList())},null,8,["total","page","limit"])])])]),C(pe,{title:(a.groupForm.id?"修改":"新建")+"分组",modelValue:a.groupVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>a.groupVisible=e),width:"30%"},{footer:k((()=>[y("div",se,[C(T,{onClick:t[14]||(t[14]=e=>a.groupVisible=!1)},{default:k((()=>[q("取 消")])),_:1}),C(T,{type:"primary",onClick:l.onAddOrUpdateGroup},{default:k((()=>[q("确 定")])),_:1},8,["onClick"])])])),default:k((()=>[C(L,{model:a.groupForm,rules:a.rules,ref:"groupForm"},{default:k((()=>[C(m,{label:"分组名称",prop:"name","label-width":"80px"},{default:k((()=>[C(u,{modelValue:a.groupForm.name,"onUpdate:modelValue":t[13]||(t[13]=e=>a.groupForm.name=e),clearable:"",autocomplete:"off",maxlength:"15","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),C(pe,{title:"表单预览",modelValue:a.Preview,"onUpdate:modelValue":t[16]||(t[16]=e=>a.Preview=e),width:"auto","destroy-on-close":""},{default:k((()=>[(h(),j(ce,{style:{margin:"0 5px"},FormIdY:a.FormIdY,id:"y",key:a.FormIdY},null,8,["FormIdY"]))])),_:1},8,["modelValue"]),C(pe,{title:"表单分享",modelValue:a.ifChannels,"onUpdate:modelValue":t[17]||(t[17]=e=>a.ifChannels=e),width:"auto","destroy-on-close":""},{default:k((()=>[(h(),j(he,{FormIdY:a.FormIdY,key:a.FormIdY},null,8,["FormIdY"]))])),_:1},8,["modelValue"])])}],["__scopeId","data-v-ee464adc"]]);export{ne as default};
