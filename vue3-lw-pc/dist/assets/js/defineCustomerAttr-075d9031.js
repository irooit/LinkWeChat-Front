import{S as e}from"./sortablejs-b0ad9b27.js";import{r as t}from"../index-044285d2.js";import{ai as l,aq as a,o as i,c as s,_ as o,U as r,K as n,a9 as d,T as u,a as m,Y as p,Z as h,V as f,X as c,aa as g,bl as b,bj as y}from"./@vue-e400fd81.js";import{_ as v}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const w=window.lwConfig.services.wecom+"/field";function _(e){return t({url:w+"/addSysField",data:e,method:"post"})}function j(e){return t({url:w+"/updateSysField",data:e,method:"put"})}const k={name:"define-customer-attr",components:{},data:()=>({queryTag:[],dialogVisible:!1,loading:!1,infoType:[{name:"文本",key:1},{name:"时间",key:2},{name:"勾选项",key:3}],query:{labelName:"",type:null,visualTagIds:""},list:[],dialog:{title:"新建信息项",state:"add",show:!1},tagList:[],showSelectTag:!1,form:{labelName:"",businessType:1,visualTagIds:"",type:1,otherContent:[]},visibleAdd:!1,newInput:"",rules:{labelName:[{required:!0,message:"信息项名称不能为空",trigger:"blur"}],type:[{required:!0,message:"信息项属性不能为空",trigger:"blur"}],typeSub:[{required:!0,message:"勾选项性质不能为空",trigger:"blur"}],otherContent:[{required:!0,message:"勾选项内容不能为空",trigger:"blur"}]}}),methods:{updateSort(){var e;this.list.forEach(((e,t)=>{e.labelSort=this.list.length-t})),e=this.list,t({url:w+"/batchUpdateSysField",method:"post",data:e})},closeTag(e,t){this.form.otherContent.splice(t,1)},dragSort(){const t=this.$refs.table.$el.querySelectorAll(".el-table__body-wrapper table > tbody")[0];this.sortable=e.create(t,{ghostClass:"sortable-ghost",setData:function(e){e.setData("Text","")},onEnd:e=>{if(e.oldIndex!==e.newIndex){const t=this.list.splice(e.oldIndex,1)[0];this.list.splice(e.newIndex,0,t),this.updateSort()}}})},setValue(e){let t="";return this.infoType.forEach((l=>{l.key==e&&(t=l.name)})),t},deleteFn(e){this.$confirm("是否确认删除当前画像信息项？该操作不可恢复，请谨慎操作。","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var l;(l=e.id,t({url:w+"/"+l,method:"delete"})).then((e=>{this.getList("delete")}))})).catch((()=>{}))},editFn(e){this.form=e,this.form.visualTagIds&&(this.tagList=[{tagId:this.form.visualTagIds,name:this.form.visualTagName}]),this.dialog.show=!0},setChange(e){3!==e&&(delete this.form.typeSub,this.form.otherContent=[])},submit(){this.$refs.form.validate((e=>{e&&(!this.form.id&&(this.form.labelSort=this.list.length+1),(this.form.id?j:_)(this.form).then((e=>{this.getList(1),this.msgSuccess("操作成功！"),this.dialog.show=!1})).catch((e=>{this.msgError("操作失败！")})))}))},setField(e){this.form={labelName:"",businessType:1,visualTagIds:"",type:1,otherContent:[]},this.tagList=[],this.dialog.show=!0},showInput(){this.visibleAdd=!0,this.$nextTick((e=>{this.$refs.saveTagInput.$refs.input.focus()}))},newInputConfirm(){let e=this.newInput;if(e){if(Array.isArray(this.form.otherContent)||(this.form.otherContent=[]),this.form.otherContent.some((t=>t.labelName===e)))return void this.msgError("内容项已存在，不可重复添加");this.form.otherContent.push({labelName:e})}this.visibleAdd=!1,this.newInput=""},resetQuery(){this.query.labelName="",this.query.type=null,this.query.visualTagIds="",this.queryTag=[],this.getList()},submitSelectTag(e){this.tagList=e,this.form.visualTagIds=e.map((e=>e.tagId)).join(",")},querySelectFn(e){this.queryTag=e,this.query.visualTagIds=e.map((e=>e.tagId)).join(",")},getList(e){var l;this.loading=!0,(l=this.query,t({url:w+"/list",method:"get",params:l})).then((t=>{this.loading=!1,this.list=t.data,"init"==e&&this.dragSort(),"delete"==e&&this.updateSort()}))}},mounted(){this.getList("init")},created(){this.$store.setBusininessDesc("\n          <div>可自定义修改企业客户的画像信息项供企业个性化使用</div>\n        ")}},C={key:0,class:"tag-place"},T={class:"g-card"},S={class:"g-card-title mid-action"},I={key:0},q={key:1},V=(e=>(b("data-v-505092d7"),e=e(),y(),e))((()=>m("div",{class:"sub-des"},"选择后则打上此标签的客户会增加此信息项供成员填写，如为空则全部客户都增加此信息项",-1)));const x=v(k,[["render",function(e,t,b,y,v,w){const _=l("el-input"),j=l("el-form-item"),k=l("el-option"),x=l("el-select"),N=l("el-tag"),F=l("el-button"),L=l("el-form"),U=l("svg-icon"),A=l("el-table-column"),$=l("el-icon-QuestionFilled"),B=l("el-popover"),D=l("el-table"),E=l("SelectTag"),z=l("el-radio"),K=l("el-radio-group"),Q=l("el-dialog"),M=a("loading");return i(),s("div",null,[o(L,{ref:"queryForm",model:v.query,inline:"",class:"top-search","label-position":"left"},{default:r((()=>[o(j,{label:""},{default:r((()=>[o(_,{modelValue:v.query.labelName,"onUpdate:modelValue":t[0]||(t[0]=e=>v.query.labelName=e),placeholder:"请输入信息项名称"},null,8,["modelValue"])])),_:1}),o(j,{label:""},{default:r((()=>[o(x,{"popper-append-to-body":!1,modelValue:v.query.type,"onUpdate:modelValue":t[1]||(t[1]=e=>v.query.type=e),placeholder:"请选择信息项类型"},{default:r((()=>[(i(!0),s(n,null,d(v.infoType,((e,t)=>(i(),u(k,{key:t,label:e.name,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(j,{label:""},{default:r((()=>[m("div",{class:"tag-input",onClick:t[2]||(t[2]=e=>v.dialogVisible=!0)},[v.queryTag.length?(i(!0),s(n,{key:1},d(v.queryTag,((e,t)=>(i(),u(N,{key:t},{default:r((()=>[p(h(e.name),1)])),_:2},1024)))),128)):(i(),s("span",C,"请选择"))])])),_:1}),o(j,{label:" "},{default:r((()=>[o(F,{type:"primary",onClick:w.getList},{default:r((()=>[p("查询")])),_:1},8,["onClick"]),o(F,{onClick:w.resetQuery},{default:r((()=>[p("清空")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),m("div",T,[m("div",S,[o(F,{type:"primary",onClick:w.setField},{default:r((()=>[p("新建信息项")])),_:1},8,["onClick"])]),f((i(),u(D,{ref:"table","row-key":"id",data:v.list},{default:r((()=>[o(A,{label:"",width:"50",align:"left"},{default:r((()=>[o(U,{icon:"dragIcon",style:{cursor:"move"}})])),_:1}),o(A,{label:"信息项名称",align:"center",prop:"labelName"}),o(A,{label:"信息项类型",align:"center"},{default:r((({row:e})=>[p(h(w.setValue(e.type)),1)])),_:1}),o(A,{label:"客户标签",align:"center"},{default:r((({row:e})=>[e.visualTagIds?(i(),s("div",I,[o(N,null,{default:r((()=>[p(h(e.visualTagName),1)])),_:2},1024)])):(i(),s("div",q,"全部客户"))])),_:1}),o(A,{label:"操作",align:"center",width:"200",fixed:"right"},{header:r((()=>[m("div",null,[p(" 操作 "),o(B,{trigger:"hover"},{reference:r((()=>[o($,{class:"el-icon-QuestionFilled"})])),default:r((()=>[p(" 可通过拖动操作移动信息项排名，移动后会同步影响员工手机端查看的客户信息先后排序。 ")])),_:1})])])),default:r((({row:e})=>[o(F,{text:"",disabled:1==e.isDefault,onClick:t=>w.editFn(e)},{default:r((()=>[p("编辑")])),_:2},1032,["disabled","onClick"]),o(F,{text:"",disabled:1==e.isDefault,onClick:t=>w.deleteFn(e)},{default:r((()=>[p("删除")])),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"])),[[M,v.loading]])]),o(E,{ref:"selectTag",visible:v.dialogVisible,"onUpdate:visible":t[3]||(t[3]=e=>v.dialogVisible=e),title:"选择标签",onSuccess:w.querySelectFn},null,8,["visible","onSuccess"]),o(Q,{title:v.dialog.title,modelValue:v.dialog.show,"onUpdate:modelValue":t[10]||(t[10]=e=>v.dialog.show=e),"close-on-click-modal":!1},{footer:r((()=>[m("div",null,[o(F,{onClick:t[9]||(t[9]=e=>v.dialog.show=!1)},{default:r((()=>[p("取 消")])),_:1}),o(F,{type:"primary",onClick:w.submit},{default:r((()=>[p("确 定")])),_:1},8,["onClick"])])])),default:r((()=>[m("div",null,[o(L,{ref:"form",rules:v.rules,model:v.form,"label-position":"left","label-width":"120px"},{default:r((()=>[o(j,{label:"信息项名称",prop:"labelName"},{default:r((()=>[o(_,{style:{width:"250px"},modelValue:v.form.labelName,"onUpdate:modelValue":t[4]||(t[4]=e=>v.form.labelName=e),placeholder:"请输入信息项名称",maxlength:"10","show-word-limit":""},null,8,["modelValue"])])),_:1}),o(j,{label:"选择标签"},{default:r((()=>[V,(i(!0),s(n,null,d(v.tagList,((e,t)=>(i(),s(n,{key:t},[e.name?(i(),u(N,{key:0},{default:r((()=>[p(h(e.name),1)])),_:2},1024)):c("",!0)],64)))),128)),m("div",null,[o(F,{type:"primary",icon:"el-icon-plus",onClick:t[5]||(t[5]=e=>v.showSelectTag=!0)},{default:r((()=>[p(h(v.tagList.length?"编辑":"添加")+"标签 ",1)])),_:1})])])),_:1}),o(j,{label:"信息项属性",prop:"type"},{default:r((()=>[o(K,{modelValue:v.form.type,"onUpdate:modelValue":t[6]||(t[6]=e=>v.form.type=e),onChange:w.setChange},{default:r((()=>[o(z,{label:1},{default:r((()=>[p("文本")])),_:1}),o(z,{label:2},{default:r((()=>[p("时间")])),_:1}),o(z,{label:3},{default:r((()=>[p("勾选项")])),_:1})])),_:1},8,["modelValue","onChange"])])),_:1}),3==v.form.type?(i(),u(j,{key:0,label:"勾选项性质",prop:"typeSub"},{default:r((()=>[o(K,{modelValue:v.form.typeSub,"onUpdate:modelValue":t[7]||(t[7]=e=>v.form.typeSub=e)},{default:r((()=>[o(z,{label:1},{default:r((()=>[p("单选")])),_:1}),o(z,{label:2},{default:r((()=>[p("多选")])),_:1})])),_:1},8,["modelValue"])])),_:1})):c("",!0),3==v.form.type?(i(),u(j,{key:1,label:"勾选项内容",prop:"otherContent"},{default:r((()=>[(i(!0),s(n,null,d(v.form.otherContent,((e,t)=>(i(),u(N,{key:t,type:"primary",closable:"",onClose:l=>w.closeTag(e,t)},{default:r((()=>[p(h(e.labelName),1)])),_:2},1032,["onClose"])))),128)),v.visibleAdd?(i(),u(_,{key:0,style:{"margin-left":"10px",width:"200px"},class:"input-new-tag",modelValue:v.newInput,"onUpdate:modelValue":t[8]||(t[8]=e=>v.newInput=e),modelModifiers:{trim:!0},ref:"saveTagInput",maxlength:"10","show-word-limit":"",onKeyup:g(w.newInputConfirm,["enter"]),onBlur:w.newInputConfirm},null,8,["modelValue","onKeyup","onBlur"])):(i(),u(F,{key:1,style:{"margin-left":"10px"},type:"primary",plain:"",class:"button-new-tag",onClick:w.showInput},{default:r((()=>[p(" + 添加内容项 ")])),_:1},8,["onClick"]))])),_:1})):c("",!0)])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue"]),o(E,{ref:"selectTag",visible:v.showSelectTag,"onUpdate:visible":t[11]||(t[11]=e=>v.showSelectTag=e),title:"选择标签",selected:v.tagList,onSuccess:w.submitSelectTag,isSingle:!0},null,8,["visible","selected","onSuccess"])])}],["__scopeId","data-v-505092d7"]]);export{x as default};
