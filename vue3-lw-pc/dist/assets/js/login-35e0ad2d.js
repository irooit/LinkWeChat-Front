import{c as e,e as o,f as s,h as i}from"../index-044285d2.js";import{a as r}from"./js-cookie-8253c38e.js";import{c as a,_ as l,U as t,ai as n,o as m,a as d,Z as p,K as c,aa as g,T as u,Y as h,X as f,a5 as w,bl as j,bj as y}from"./@vue-e400fd81.js";import{_}from"./quill-image-resize-module-c051113e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const b={name:"Login",data:()=>({loginType:"url",codeUrl:"",wechatCodeUrl:"",cookiePassword:"",isPassword:!0,loginForm:{username:"",password:"",rememberMe:!1,code:"",uuid:""},loginRules:{username:[{required:!0,trigger:"blur",message:"用户名不能为空"}],password:[{required:!0,trigger:"blur",message:"密码不能为空"}],code:[{required:!0,trigger:"change",message:"验证码不能为空"}]},authLink:"",loading:!1,redirect:void 0,dialogVisible:!0,isDemonstrationLogin:!1}),watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect},immediate:!0}},created(){e().then((({data:e,code:o,msg:s})=>{200===o?(this.authLink=e.loginQr,this.wechatCodeUrl=e.joinCorpQr):226===o&&(this.msgError(s),this.loginType="account",this.getCode(),this.getCookie())}))},methods:{changeLoginType(e){this.loginType=e,"account"===e&&(this.getCode(),this.getCookie())},getCode(){o().then((({data:e})=>{this.codeUrl="data:image/gif;base64,"+e.img,this.loginForm.uuid=e.uuid}))},getCookie(){const e=r.get("username"),o=r.get("password"),i=r.get("rememberMe");this.loginForm={username:void 0===e?this.loginForm.username:e,password:void 0===o?this.loginForm.password:s(o),rememberMe:void 0!==i&&Boolean(i)}},handleLogin(){this.$refs.loginForm.validate((e=>{if(e){this.loading=!0,this.loginForm.rememberMe?(r.set("username",this.loginForm.username,{expires:30}),r.set("password",i(this.loginForm.password),{expires:30}),r.set("rememberMe",this.loginForm.rememberMe,{expires:30})):(r.remove("username"),r.remove("password"),r.remove("rememberMe"));let e=JSON.parse(JSON.stringify(this.loginForm));e.password=i(this.loginForm.password),this.$store.Login(e).then((()=>{this.$router.push(this.redirect||window.lwConfig.BASE_URL)})).catch((()=>{this.loading=!1,this.getCode()}))}}))},goVote(){window.open("https://www.oschina.net/p/linkwechat")},changeDemonAccount(e){this.loginForm.username=e?"lw":"",this.loginForm.password=e?"123456":""}}},C=e=>(j("data-v-bd3e9b57"),e=e(),y(),e),v={class:"login cc fcbw"},k=["src"],F={class:"login-title"},L=C((()=>d("div",{class:"login-text"},"登录你的账户",-1))),x={class:"fxbw"},V=["src"],T={class:"fxbw g-margin-b"},U={key:0},M={key:1},q={key:1,class:"ac"},E=["src"],K=C((()=>d("div",{class:"desc"},"扫码体验完整功能",-1))),A=["href"],D=C((()=>d("img",{src:"/assets/png/login-da132cbd.png",class:"login-img",alt:""},null,-1)));const I=_(b,[["render",function(e,o,s,i,r,j){const y=n("svg-icon"),_=n("el-input"),b=n("el-form-item"),C=n("el-checkbox"),I=n("el-button"),O=n("el-form");return m(),a("div",v,[l(O,{ref:"loginForm",model:r.loginForm,rules:r.loginRules,class:"login-form"},{default:t((()=>[d("img",{class:"logo",src:e.$store.app.isDark?e.lwConfig.LOGO_TEXT_LIGHT:e.lwConfig.LOGO_TEXT_DARK,alt:""},null,8,k),d("div",F,"欢迎来到"+p(e.lwConfig.SYSTEM_NAME),1),L,"account"===r.loginType?(m(),a(c,{key:0},[l(b,{prop:"username"},{default:t((()=>[l(_,{modelValue:r.loginForm.username,"onUpdate:modelValue":o[0]||(o[0]=e=>r.loginForm.username=e),type:"text","auto-complete":"off",placeholder:"账号"},{prefix:t((()=>[l(y,{style:{height:"33px"},icon:"user",class:"el-input__icon input-icon"})])),_:1},8,["modelValue"])])),_:1}),l(b,{prop:"password"},{default:t((()=>[l(_,{modelValue:r.loginForm.password,"onUpdate:modelValue":o[2]||(o[2]=e=>r.loginForm.password=e),type:r.isPassword?"password":"text","auto-complete":"off",placeholder:"密码",onKeyup:g(j.handleLogin,["enter"])},{prefix:t((()=>[l(y,{style:{height:"33px"},icon:"password",class:"el-input__icon input-icon"})])),suffix:t((()=>[l(y,{style:{height:"33px"},icon:r.isPassword?"eye":"eye-open",class:"el-input__icon input-icon cp",onClick:o[1]||(o[1]=e=>r.isPassword=!r.isPassword)},null,8,["icon"])])),_:1},8,["modelValue","type","onKeyup"])])),_:1}),l(b,{prop:"code"},{default:t((()=>[d("div",x,[l(_,{modelValue:r.loginForm.code,"onUpdate:modelValue":o[3]||(o[3]=e=>r.loginForm.code=e),"auto-complete":"off",placeholder:"验证码",onKeyup:g(j.handleLogin,["enter"])},{prefix:t((()=>[l(y,{icon:"validCode",style:{height:"33px"},class:"el-input__icon input-icon"})])),_:1},8,["modelValue","onKeyup"]),d("img",{class:"login-code-img ml10",src:r.codeUrl,onClick:o[4]||(o[4]=(...e)=>j.getCode&&j.getCode(...e))},null,8,V)])])),_:1}),d("div",T,[e.lwConfig.IS_LINKWECHAT?(m(),u(C,{key:0,modelValue:r.isDemonstrationLogin,"onUpdate:modelValue":o[5]||(o[5]=e=>r.isDemonstrationLogin=e),onChange:j.changeDemonAccount},{default:t((()=>[h(" 演示账号登录 ")])),_:1},8,["modelValue","onChange"])):f("",!0),l(C,{class:"fr",modelValue:r.loginForm.rememberMe,"onUpdate:modelValue":o[6]||(o[6]=e=>r.loginForm.rememberMe=e)},{default:t((()=>[h("记住密码")])),_:1},8,["modelValue"])]),l(b,null,{default:t((()=>[l(I,{loading:r.loading,type:"primary",style:{width:"100%"},onClick:w(j.handleLogin,["prevent"])},{default:t((()=>[r.loading?(m(),a("span",M,"登 录 中...")):(m(),a("span",U,"登 录"))])),_:1},8,["loading","onClick"])])),_:1}),d("div",{class:"link",onClick:o[7]||(o[7]=e=>j.changeLoginType("url"))},"企微登录")],64)):(m(),a("div",q,[e.lwConfig.IS_LINKWECHAT?(m(),a(c,{key:0},[d("img",{class:"wechat-code",src:r.wechatCodeUrl,alt:""},null,8,E),K],64)):f("",!0),d("a",{href:r.authLink},[l(I,{loading:r.loading,type:"primary",style:{width:"100%"}},{default:t((()=>[h("企业微信登录")])),_:1},8,["loading"])],8,A),d("div",{class:"link",onClick:o[8]||(o[8]=e=>j.changeLoginType("account"))},"账号密码登录")]))])),_:1},8,["model","rules"]),D])}],["__scopeId","data-v-bd3e9b57"]]);export{I as default};
