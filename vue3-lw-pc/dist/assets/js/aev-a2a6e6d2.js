import{_ as e}from"../index-044285d2.js";import{a as o,b as t,g as i,c as r,d as a,r as l,e as s,f as d}from"./api-a484694c.js";import{_ as m}from"./quill-image-resize-module-c051113e.js";import{aU as u,ai as p,aq as n,o as c,c as f,a as g,Y as h,T as b,U as y,X as j,_ as v,P as k,Z as w,V as _,K as V,bl as D,bj as x}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const C={components:{Preview:u((()=>e((()=>import("./Preview-dc9d8231.js")),["assets/js/Preview-dc9d8231.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css","assets/js/api-a484694c.js","assets/css/Preview-1b838944.css"]))),DragSortable:u((()=>e((()=>import("./DragSortable-1a0e238b.js")),["assets/js/DragSortable-1a0e238b.js","assets/js/sortablejs-b0ad9b27.js","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/js/@vue-e400fd81.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css"]))),FormAutoCreateGroup:u((()=>e((()=>import("./FormAutoCreateGroup-88be534d.js")),["assets/js/FormAutoCreateGroup-88be534d.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css"])))},data:()=>({loading:!1,form:{keyWordGroupSubs:[]},dialogVisible:!1,formKeywords:{},rules:Object.freeze({title:[{required:!0,message:"必填项",trigger:"blur"}],descrition:[{required:!0,message:"必填项",trigger:"blur"}],keyWordGroupSubs:[{required:!0,message:"必填项",trigger:"change"}],keyword:[{required:!0,message:"必填项",trigger:"blur"}],codeName:[{required:!0,message:"必填项",trigger:"blur"}]})}),computed:{isDetail(){return this.$route.path.endsWith("detail")}},created(){var e;(e=this.form).id??(e.id=this.$route.query.id),this.getDetail()},methods:{getDetail(){let e=this.$route.query.id;this.$store.loading=!0,Promise.resolve().then((()=>e?t(e).then((({data:e})=>(this.form=e,this.getDetailList()))):o().then((({data:e})=>{this.form.id=e})))).finally((()=>this.$store.loading=!1))},getDetailList(){return this.$store.loading=!0,i({pageNum:1,pageSize:1e3,keywordGroupId:this.form.id}).then((({rows:e})=>{(e??(e=[])).forEach((e=>{var o,t,i;let r=null==(o=e.chatIdList)?void 0:o.split(",");e.groups=null==(i=null==(t=e.groupCodeName)?void 0:t.split(","))?void 0:i.map(((e,o)=>({chatId:r[o],groupName:e})))})),this.form.keyWordGroupSubs=e})).finally((()=>this.$store.loading=!1))},addOrUpdate(e={}){this.formKeywords=Object.assign({},e),this.dialogVisible=!0},sort(e){this.$store.loading=!0,this.form.keyWordGroupSubs=e,r(this.form).then((()=>(this.msgSuccess(),this.getDetailList()))).finally((()=>{this.$store.loading=!1}))},submitFormKeywords(){this.$refs.FormAutoCreateGroup.validate().then((()=>{var e,o;this.loading=!0;let t=JSON.parse(JSON.stringify(this.formKeywords));t.chatIdList=null==(o=null==(e=t.groups)?void 0:e.map((e=>e.chatId)))?void 0:o.join(","),delete t.groups,t.keywordGroupId??(t.keywordGroupId=this.form.id),a(t).then((({data:e})=>{t.id?this.form.keyWordGroupSubs.some(((o,i,r)=>o.id===t.id&&(r[i]=e))):this.form.keyWordGroupSubs.push(e),this.dialogVisible=!1})).finally((()=>{this.loading=!1}))}))},remove(e,o){this.$confirm().then((()=>{this.$store.loading=!0,l(e).then((()=>(this.msgSuccess(),this.getDetailList()))).finally((()=>{this.$store.loading=!1}))}))},cancel(){s(this.form),this.$router.back()},submit(){this.$refs.form.validate().then((()=>{var e;this.$store.loading=!0,null==(e=JSON.parse(JSON.stringify(this.form)).keyWordGroupSubs)||e.forEach(((e,o)=>{var t,i;e.chatIdList=null==(i=null==(t=e.groups)?void 0:t.map((e=>e.chatId)))?void 0:i.join(","),delete e.groups,e.sort=o})),d(this.form).then((()=>{this.msgSuccess("更新成功"),this.$router.back()})).finally((()=>{this.$store.loading=!1}))}))}}},S={class:"flex"},$={class:"fxauto g-margin-r"},U={class:"g-card"},G={class:"g-card-title fxbw"},I={class:"g-card"},q={class:"g-card-title fxbw"},N={class:"blod"},O={class:"preview-wrap g-card mt0",style:{flex:"1 1 414px"}},L=(e=>(D("data-v-07de5d91"),e=e(),x(),e))((()=>g("div",{class:"g-card-title"},"链接预览",-1))),A={key:0,class:"g-footer-sticky",style:{"z-index":"10"}};const E=m(C,[["render",function(e,o,t,i,r,a){const l=p("el-tag"),s=p("el-input"),d=p("el-form-item"),m=p("el-form"),u=p("el-button"),D=p("el-table-column"),x=p("el-image"),C=p("DragSortable"),E=p("Preview"),K=p("FormAutoCreateGroup"),W=p("el-dialog"),z=n("loading");return c(),f(V,null,[g("div",S,[g("div",$,[g("div",U,[g("div",G,[h(" 基础信息 "),a.isDetail?(c(),b(l,{key:0,class:"cp",size:"large",effect:"dark",onClick:a.getDetail},{default:y((()=>[h("同步")])),_:1},8,["onClick"])):j("",!0)]),v(m,{model:r.form,ref:"form",rules:r.rules,"label-width":"100px",class:k(["fxauto g-margin-r",a.isDetail&&"form-detail"]),disabled:a.isDetail},{default:y((()=>[v(d,{label:"链接标题",prop:"title"},{default:y((()=>[v(s,{modelValue:r.form.title,"onUpdate:modelValue":o[0]||(o[0]=e=>r.form.title=e),maxlength:"15","show-word-limit":"",placeholder:"请输入",clearable:""},null,8,["modelValue"])])),_:1}),v(d,{label:"链接描述",prop:"descrition"},{default:y((()=>[v(s,{type:"textarea",modelValue:r.form.descrition,"onUpdate:modelValue":o[1]||(o[1]=e=>r.form.descrition=e),placeholder:"请输入",maxlength:"50","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules","class","disabled"])]),g("div",I,[g("div",q,[h(" 关键词 "),a.isDetail?j("",!0):(c(),b(u,{key:0,type:"primary",onClick:o[2]||(o[2]=e=>a.addOrUpdate())},{default:y((()=>[h("新建关键词")])),_:1}))]),v(C,{data:r.form.keyWordGroupSubs,"onUpdate:data":a.sort,disabled:a.isDetail},{default:y((()=>[v(D,{label:"关键词",align:"center",prop:"keyword"}),v(D,{align:"center",prop:"codeName",label:"群活码"},{default:y((({row:e})=>[g("div",N,w(e.codeName||"—"),1),v(x,{src:e.groupCodeUrl,class:"code-image"},null,8,["src"])])),_:1}),a.isDetail?j("",!0):(c(),b(D,{key:0,label:"操作",align:"center"},{default:y((({row:e,$index:o})=>[v(u,{text:"",onClick:o=>a.addOrUpdate(e)},{default:y((()=>[h("编辑")])),_:2},1032,["onClick"]),v(u,{text:"",onClick:t=>a.remove(e.id,o)},{default:y((()=>[h("删除")])),_:2},1032,["onClick"])])),_:1}))])),_:1},8,["data","onUpdate:data","disabled"])])]),g("div",O,[L,v(E,{data:r.form},null,8,["data"])])]),a.isDetail?j("",!0):(c(),f("div",A,[v(u,{type:"primary",onClick:a.submit},{default:y((()=>[h("保存")])),_:1},8,["onClick"]),v(u,{onClick:a.cancel},{default:y((()=>[h("取消")])),_:1},8,["onClick"])])),v(W,{title:"关键词",modelValue:r.dialogVisible,"onUpdate:modelValue":o[5]||(o[5]=e=>r.dialogVisible=e),width:"600","append-to-body":""},{footer:y((()=>[g("div",null,[v(u,{type:"primary",onClick:a.submitFormKeywords},{default:y((()=>[h("确定")])),_:1},8,["onClick"]),v(u,{onClick:o[4]||(o[4]=e=>r.dialogVisible=!1)},{default:y((()=>[h("取消")])),_:1})])])),default:y((()=>[_((c(),b(K,{ref:"FormAutoCreateGroup",form:r.formKeywords,"onUpdate:form":o[3]||(o[3]=e=>r.formKeywords=e),"append-to-body":"",rules:r.rules,isDetail:a.isDetail},{default:y((({form:e})=>[v(d,{label:"关键词",prop:"keyword"},{default:y((()=>[v(s,{clearable:"",modelValue:e.keyword,"onUpdate:modelValue":o=>e.keyword=o,placeholder:"请输入",maxlength:"15","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),v(d,{label:"群活码名称",prop:"codeName"},{default:y((()=>[v(s,{clearable:"",modelValue:e.codeName,"onUpdate:modelValue":o=>e.codeName=o,placeholder:"请输入",maxlength:"15","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1},8,["form","rules","isDetail"])),[[z,r.loading]])])),_:1},8,["modelValue"])],64)}],["__scopeId","data-v-07de5d91"]]);export{E as default};
