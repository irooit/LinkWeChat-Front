import e from"./SelectDept-7a07b4de.js";import{d as t}from"../index-044285d2.js";import{d as a,r as i,f as s,h as l}from"./circle-2faa2a32.js";import{_ as o}from"./quill-image-resize-module-c051113e.js";import{ai as r,aq as n,o as d,c as p,_ as u,a as m,U as c,Y as h,T as g,X as y,V as j,Z as v}from"./@vue-e400fd81.js";import"./organization-9bed3593.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./ali-oss-912914b8.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const b={name:"scene-statistics-scene",components:{SelectDept:e},data:()=>({deptArray:[],deptName:"",dialogDeptVisible:!1,dialogVisible:!1,userArray:[],userName:"",cardData:[{title:"目标执行员工数 ",tips:"应执行本朋友圈任务的员工总数",value:0,noArrow:!0},{title:"未执行员工数",tips:"当前未执行本朋友圈任务的员工数",value:0},{title:"已执行员工数",tips:"当前已执行本朋友圈任务的员工数",value:0},{title:"今日执行员工数",tips:"今日已执行本朋友圈任务的员工数",value:0},{title:"已提醒次数",tips:"本朋友圈任务对未执行成员已提醒执行的次数",value:0}],value:[],exportLoading:!1,tableList:[],loading:!1,total:0,query:{pageSize:10,pageNum:1,status:"",deptIds:"",weUserIds:[]},tableSearch:{},id:void 0,type:void 0,name:"",showRemaind:0}),mounted(){this.type=this.$route.query.type,this.id=this.$route.query.id,this.name=this.$route.query.name,this.showRemaind=+this.$route.query.showRemaind,this.getTabTotalFn(),this.getTableChangeSize()},methods:{dealStatus(e){switch(e){case 0:return"未执行";case 1:return"已执行"}},getTabTotalFn(){a(this.id).then((e=>{this.cardData[0].value=e.data.targetExecute,this.cardData[1].value=e.data.nonExecute,this.cardData[2].value=e.data.executed,this.cardData[3].value=e.data.todayExecute,this.cardData[4].value=e.data.remindCount}))},remind(e){this.$confirm("提醒执行将针对本任务未执行的成员再次催促执行，是否确认提醒？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{i(e).then((e=>{200===e.code&&this.msgSuccess(e.msg)}))})).catch((()=>{}))},exportFn(){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,this.query.weMomentsTaskId=this.id,s(Object.assign({},this.query))))).then((e=>{if(!e)return;const a=new Blob([e],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(a,"客户统计");else{const e=URL.createObjectURL(a),i=document.createElement("a");i.style.display="none",i.href=e,i.download=t(new Date,"YYYY-MM-DD")+"-"+this.name+"-员工统计.xlsx",i.click(),URL.revokeObjectURL(i.href)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},getSelectUser(e){this.userArray=e,this.userName=this.userArray.map((function(e,t){return e.name})).join(","),this.query.weUserIds=this.userArray.map((function(e,t){return e.userId})).join(",")},selectedDept(e){this.deptArray=e,this.deptName=this.deptArray.map((function(e,t){return e.deptName})).join(","),this.query.deptIds=this.deptArray.map((function(e,t){return e.deptId})).join(",")},getTableChangeSize(){this.loading=!0,this.query.weMomentsTaskId=this.id,l(this.query).then((e=>{this.tableList=e.rows,this.total=+e.total,this.loading=!1}))},resetQuery(){this.query={pageSize:10,pageNum:1,status:"",deptIds:"",weUserIds:""},this.userArray=[],this.userName="",this.deptArray=[],this.deptName="",this.getTableChangeSize()},handleSearch(){this.getTableChangeSize()}},created(){}},f={class:"g-card"},w=m("div",{class:"g-card-title"},"员工记录",-1),x={style:{display:"flex","align-items":"center","justify-content":"space-between"}},S={style:{display:"flex","align-items":"center"}};const q=o(b,[["render",function(e,t,a,i,s,l){const o=r("CardGroupIndex"),b=r("el-input"),q=r("el-option"),D=r("el-select"),C=r("el-button"),U=r("el-table-column"),k=r("el-table"),T=r("pagination"),V=r("SelectUser"),N=r("SelectDept"),z=n("loading");return d(),p("div",null,[u(o,{data:s.cardData},null,8,["data"]),m("div",f,[w,m("div",x,[m("div",S,[u(b,{style:{width:"150px"},"model-value":s.userName,readonly:"",onClick:t[0]||(t[0]=e=>s.dialogVisible=!0),placeholder:"请选择成员"},null,8,["model-value"]),u(b,{style:{width:"150px",margin:"0 20px"},"model-value":s.deptName,readonly:"",onClick:t[1]||(t[1]=e=>s.dialogDeptVisible=!0),placeholder:"请选择部门"},null,8,["model-value"]),u(D,{modelValue:s.query.status,"onUpdate:modelValue":t[2]||(t[2]=e=>s.query.status=e),placeholder:"请选择状态",style:{width:"150px","margin-right":"20px"}},{default:c((()=>[u(q,{label:"未执行",value:0}),u(q,{label:"已执行",value:1})])),_:1},8,["modelValue"]),u(C,{type:"primary",onClick:l.handleSearch},{default:c((()=>[h("查询")])),_:1},8,["onClick"]),u(C,{onClick:l.resetQuery},{default:c((()=>[h("清空")])),_:1},8,["onClick"])]),m("div",null,[s.showRemaind?(d(),g(C,{key:0,type:"primary",onClick:t[3]||(t[3]=e=>l.remind(s.id))},{default:c((()=>[h("提醒执行")])),_:1})):y("",!0),j((d(),g(C,{type:"primary",onClick:l.exportFn},{default:c((()=>[h("导出")])),_:1},8,["onClick"])),[[z,s.exportLoading]])])]),j((d(),g(k,{data:s.tableList,style:{width:"100%","margin-bottom":"20px"}},{default:c((()=>[u(U,{label:"执行人名称",align:"center",prop:"userName","min-width":"100","show-overflow-tooltip":""}),u(U,{label:"执行人所属部门",align:"center",prop:"deptName","show-overflow-tooltip":""}),u(U,{label:"执行状态",align:"center",prop:"executeStatus","show-overflow-tooltip":""},{default:c((({row:e})=>[m("div",null,v(l.dealStatus(e.executeStatus)),1)])),_:1}),u(U,{label:"提醒执行次数",align:"center",prop:"executeCount","show-overflow-tooltip":""})])),_:1},8,["data"])),[[z,s.loading]]),u(T,{total:s.total,page:s.query.pageNum,"onUpdate:page":t[4]||(t[4]=e=>s.query.pageNum=e),limit:s.query.pageSize,"onUpdate:limit":t[5]||(t[5]=e=>s.query.pageSize=e),onPagination:t[6]||(t[6]=e=>l.getTableChangeSize())},null,8,["total","page","limit"])]),u(V,{visible:s.dialogVisible,"onUpdate:visible":t[7]||(t[7]=e=>s.dialogVisible=e),title:"组织架构",defaultValues:s.userArray,onSuccess:l.getSelectUser},null,8,["visible","defaultValues","onSuccess"]),u(N,{defaultValues:s.deptArray,visible:s.dialogDeptVisible,"onUpdate:visible":t[8]||(t[8]=e=>s.dialogDeptVisible=e),title:"选择部门",onSuccess:l.selectedDept},null,8,["defaultValues","visible","onSuccess"])])}]]);export{q as default};
