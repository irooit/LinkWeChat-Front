import e from"./SelectDept-7a07b4de.js";import{f as t,h as s}from"./organization-9bed3593.js";import{_ as l}from"./quill-image-resize-module-c051113e.js";import{ai as i,o as r,c as o,a,_ as d,U as m,K as p,a9 as n,T as u,Y as c,Z as h,X as f}from"./@vue-e400fd81.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const b={style:{"margin-top":"20px"}},j={class:"bottom"};const g=l({name:"roles-add-edit",components:{SelectDept:e},data:()=>({form:{dataScope:"1",users:[],menuIds:[],depts:[],roleName:"",roleSort:12,roleSort:0,status:"0"},dialogVisibleSelectUser:!1,dialogVisibleSelectDept:!1,defaultProps:{children:"children",label:"label"},dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]},selectedUserList:[],selectedDeptList:[]}),props:{list:{type:Array,default:()=>[]},status:{type:String,default:""},data:{type:Object,defaultL:()=>{}}},mounted(){"edit"===this.status&&this.setData()},created(){this.setDisabledTreeData(this.list)},methods:{setDisabledTreeData(e){e.map((e=>{"roles"==e.labelKey&&(e.disabled=!0),e.children&&e.children.length>0&&this.setDisabledTreeData(e.children)}))},setData(){if(this.form=this.data,this.form.users&&this.form.users.length){let e=[];this.selectedUserList=this.form.users.map((t=>(e.push(t.userId),{name:t.userName,userId:t.weUserId,userIdOrigin:t.userId}))),this.form.users=e}if(this.form.depts&&this.form.depts.length){let e=[];this.selectedDeptList=this.form.depts.map((t=>(e.push(t.deptId),{deptName:t.deptName,deptId:t.deptId}))),this.form.deptIds=e,delete this.form.depts}if(this.form.menus&&this.form.menus.length){let e=this.form.menus.map((e=>e.menuId));this.$refs.menu&&this.$refs.menu.setCheckedKeys(e)}},onSelectDept(){this.dialogVisibleSelectDept=!0},onSelectUser(){this.dialogVisibleSelectUser=!0},selectedUser(e){this.selectedUserList=e;let t=e.map((e=>e.userIdOrigin));this.form.users=t},selectedDept(e){if(this.selectedDeptList=e,e&&e.length){let t=e.map((e=>e.deptId));this.form.deptIds=t}},getMenuAllCheckedKeys(){let e=this.$refs.menu.getHalfCheckedKeys(),t=this.$refs.menu.getCheckedKeys();return e.unshift.apply(e,t),e},submitFn(){"add"===this.status?(this.form.menuIds=this.getMenuAllCheckedKeys(),this.form.roleKey="11",t(this.form).then((e=>{this.$emit("update")}))):this.$confirm("是否确认修改当前角色？修改后即时生效。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.form.menuIds=this.getMenuAllCheckedKeys(),delete this.form.menus,s(this.form).then((e=>{this.$emit("update")}))})).catch((function(){}))},cancelFn(){this.$emit("cancel")}}},[["render",function(e,t,s,l,g,y){const S=i("el-input"),D=i("el-form-item"),v=i("el-input-number"),U=i("el-tag"),k=i("el-button"),I=i("el-tree"),V=i("el-form"),L=i("SelectUser"),_=i("SelectDept");return r(),o("div",null,[a("div",b,[d(V,{ref:"form","label-position":"right","label-width":"80px"},{default:m((()=>[d(D,{label:"角色名称",prop:"roleName"},{default:m((()=>[d(S,{modelValue:g.form.roleName,"onUpdate:modelValue":t[0]||(t[0]=e=>g.form.roleName=e),maxlength:"10","show-word-limit":"",clearable:""},null,8,["modelValue"])])),_:1}),d(D,{label:"角色顺序",prop:"roleSort"},{default:m((()=>[d(v,{modelValue:g.form.roleSort,"onUpdate:modelValue":t[1]||(t[1]=e=>g.form.roleSort=e),"controls-position":"right",min:0},null,8,["modelValue"])])),_:1}),d(D,{label:"角色员工",prop:"users"},{default:m((()=>[(r(!0),o(p,null,n(g.selectedUserList,((e,t)=>(r(),o(p,{key:t},[e.name?(r(),u(U,{key:0},{default:m((()=>[c(h(e.name),1)])),_:2},1024)):f("",!0)],64)))),128)),a("div",null,[d(k,{type:"primary",icon:"el-icon-plus",onClick:y.onSelectUser},{default:m((()=>[c(h(0==g.form.users.length?"添加":"编辑"),1)])),_:1},8,["onClick"])])])),_:1}),d(D,{label:"功能权限"},{default:m((()=>[d(I,{data:s.list,"show-checkbox":"",ref:"menu","node-key":"id","empty-text":"加载中，请稍后",props:g.defaultProps},null,8,["data","props"])])),_:1})])),_:1},512)]),a("div",j,[d(k,{plain:"",onClick:y.cancelFn},{default:m((()=>[c("取消")])),_:1},8,["onClick"]),d(k,{type:"primary",onClick:y.submitFn},{default:m((()=>[c("确定")])),_:1},8,["onClick"])]),d(L,{defaultValues:g.selectedUserList,visible:g.dialogVisibleSelectUser,"onUpdate:visible":t[2]||(t[2]=e=>g.dialogVisibleSelectUser=e),title:"选择员工",isOnlyLeaf:!0,onSuccess:y.selectedUser},null,8,["defaultValues","visible","onSuccess"]),d(_,{defaultValues:g.selectedDeptList,visible:g.dialogVisibleSelectDept,"onUpdate:visible":t[3]||(t[3]=e=>g.dialogVisibleSelectDept=e),title:"选择部门",isOnlyLeaf:!1,onSuccess:y.selectedDept},null,8,["defaultValues","visible","onSuccess"])])}],["__scopeId","data-v-36499054"]]);export{g as default};
