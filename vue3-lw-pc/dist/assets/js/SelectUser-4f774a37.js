import{g as e,a as s}from"./organization-9bed3593.js";import{T as t,U as i,R as a,ai as l,aq as r,o as d,_ as o,Y as n,a as u,aa as h,V as c,$ as p,c as m,K as f,a9 as y,Z as I,X as k,a0 as j,bl as g,bj as v}from"./@vue-e400fd81.js";import{_ as b}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const C={name:"SelectUser",components:{},props:{isWechat:{type:Boolean,default:!0},visible:{type:Boolean,default:!1},title:{type:String,default:"组织架构"},isOnlyDepart:{type:Boolean,default:!1},isOnlyLeaf:{type:Boolean,default:!0},isSigleSelect:{type:Boolean,default:!1},defaultValues:{type:Array,default:()=>[],validator:e=>e.every((e=>e.userId&&e.name))},disabledValues:{type:Array,default:()=>[]},destroyOnClose:Boolean,departReplaceUser:{type:Boolean,default:!1}},data:()=>({treeData:[],userList:[],defaultKeys:[],deptId:"",keywords:"",searchResult:[],searchState:!1,checked:[],loading:!1}),watch:{defaultValues:{handler(e){const s=[];Array.isArray(e)&&0!=e.length?(e.forEach((e=>{(e.userId||e.id)&&s.push(e)})),this.userList=s):this.userList=[]},immediate:!0,deep:!0},Pvisible(e){this.keywords="",this.searchState=!1,setTimeout((()=>{var s;e&&(null==(s=this.$refs.tree)||s.setCheckedKeys(this.defaultValues.map((e=>e.userId||e.id))))}),0)}},computed:{Pvisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},defaultProps(){let e=this;return{label:"name",children:"children",disabled:(s,t)=>e.isOnlyLeaf&&s.isParty||e.disabledValues.some((e=>e==(s.userId||s.id))),isLeaf:(e,s)=>!e.id}},dealedUserList(){if(this.isOnlyLeaf||!this.departReplaceUser)return this.userList;let e=this.userList.filter((e=>e.isParty)),s=this.userList.filter((s=>!s.isParty&&!e.some((e=>{var t;return(null==(t=s.userDepts[0])?void 0:t.deptId)==e.deptId}))));return e=e.filter((s=>!e.some((e=>s.parentId==e.id)))),e.push(...s),e}},created(){},mounted(){},methods:{setChange(e){e||(this.searchState=!1,this.$refs.tree.setCheckedKeys(this.userList.map((e=>e.userId||e.id))))},setSearch(){this.keywords&&(this.searchState=!0,this.loading=!0,this.checked=this.userList.map((e=>e.userId)),e({userName:this.keywords}).then((e=>{this.searchResult=this.handleUser(e.rows)||[]})).finally((()=>{this.loading=!1})))},setSelectChange(e,s){e?(this.isSigleSelect?this.userList[0]=this.searchResult[s]:this.userList.push(this.searchResult[s]),this.checked=this.userList.map((e=>e.userId))):this.cancle(this.searchResult[s].userId)},treeFormat(e){let s=[];return e.forEach((t=>{let i=e.findIndex((e=>e.id===t.parentId));!t.parentId&&0!==t.parentId&&!1!==t.parentId||-1===i?s.push(t):(e[i].children||(e[i].children=[]),e[i].children.push(t))})),s},loadNode(t,i){0===t.level?(Array.isArray(this.defaultValues)&&0!=this.defaultValues.length||(this.userList=[]),s().then((({data:e})=>{let s=this.handleDepart(e),t=this.treeFormat(s);t.length&&(this.deptId=t[0].deptId),i(t)}))):this.isOnlyDepart?i(t.data.children):e({deptId:t.data.id}).then((({rows:e})=>{let s=this.handleUser(e);t.data.children&&s.push(...t.data.children),t.checked&&setTimeout((()=>{s.forEach((e=>{this.handleCheckChange(e,!0)}))}),200),i(s)}))},handleDepart:e=>e.map((e=>(e.deptId&&(e.userId=e.deptId,e.name=e.deptName,e.id=e.deptId,e.isParty=!0),e))),handleUser(e){return e.map((e=>(e.userName&&(e.userIdOrigin=e.userId,e.userId=this.isWechat?e.weUserId:e.userId,e.name=e.userName),e)))},handleCheckChange(e,s,t){if(s)if(this.isSigleSelect&&this.$refs.tree.setCheckedKeys([e.userId]),this.isOnlyLeaf)e.userId&&!e.isParty&&this.userList.push(e);else{!(this.userList.findIndex((s=>s.userId===e.userId))>-1)&&this.userList.push(e)}else{let s=this.userList.findIndex((s=>s.userId===e.userId));s>-1&&this.userList.splice(s,1)}this.userList=this.unique(this.userList)},unique(e){for(var s=0;s<e.length;s++)for(var t=s+1;t<e.length;t++)e[s].userId.split("_")[0]==e[t].userId.split("_")[0]&&(e.splice(t,1),t--);return e},submit(){this.Pvisible=!1,this.$emit("success",[...this.dealedUserList])},cancle(e){this.$refs.tree.setChecked(e,!1);let s=this.userList.findIndex((s=>s.userId===e));s>-1&&this.userList.splice(s,1);let t=this.defaultValues.findIndex((s=>s.userId===e));t>-1&&this.defaultValues.slice().splice(t,1)}}},L={class:"content"},S={class:"left"},V={class:"search-input"},U={class:"search-list"},w={key:0,class:"ac"},x={class:"head-container"},P={class:"right user-list"},_=(e=>(g("data-v-8b4a48f4"),e=e(),v(),e))((()=>u("div",null,"已选列表",-1))),O={class:"user-name"};const R=b(C,[["render",function(e,s,g,v,b,C){const R=l("el-button"),$=l("el-input"),q=l("el-checkbox"),B=l("el-checkbox-group"),K=l("el-tree"),A=l("el-icon-UserFilled"),D=l("el-icon-minus"),z=l("el-dialog"),N=r("loading");return d(),t(z,a(e.$attrs,{title:g.title,modelValue:C.Pvisible,"onUpdate:modelValue":s[3]||(s[3]=e=>C.Pvisible=e),"close-on-click-modal":!1,"destroy-on-close":g.destroyOnClose}),{footer:i((()=>[o(R,{onClick:s[2]||(s[2]=e=>C.Pvisible=!1)},{default:i((()=>[n("取 消")])),_:1}),o(R,{type:"primary",onClick:C.submit},{default:i((()=>[n("确 定")])),_:1},8,["onClick"])])),default:i((()=>{var e;return[u("div",L,[u("div",S,[u("div",V,[o($,{modelValue:b.keywords,"onUpdate:modelValue":s[0]||(s[0]=e=>b.keywords=e),onKeyup:h(C.setSearch,["enter"]),placeholder:"请输入员工名称",clearable:"",onChange:C.setChange},{append:i((()=>[o(R,{icon:"el-icon-search",onClick:C.setSearch},null,8,["onClick"])])),_:1},8,["modelValue","onKeyup","onChange"])]),c((d(),m("div",U,[o(B,{modelValue:b.checked,"onUpdate:modelValue":s[1]||(s[1]=e=>b.checked=e)},{default:i((()=>[(d(!0),m(f,null,y(b.searchResult,((e,s)=>(d(),m("div",{key:s},[(d(),t(q,{label:e.userId,key:s,onChange:e=>C.setSelectChange(e,s)},{default:i((()=>[n(I(e.name),1)])),_:2},1032,["label","onChange"]))])))),128))])),_:1},8,["modelValue"]),(null==(e=b.searchResult)?void 0:e.length)||b.loading?k("",!0):(d(),m("div",w,"暂无数据"))])),[[p,b.searchState],[N,b.loading]]),o(j,{name:"fade"},{default:i((()=>[c(u("div",x,[o(K,{"node-key":"userId",ref:"tree",lazy:"",accordion:"","show-checkbox":"","check-on-click-node":!1,"expand-on-click-node":!0,load:C.loadNode,props:C.defaultProps,"check-strictly":g.isOnlyLeaf,onCheckChange:C.handleCheckChange},null,8,["load","props","check-strictly","onCheckChange"])],512),[[p,!b.searchState]])])),_:1})]),u("div",P,[_,(d(!0),m(f,null,y(C.dealedUserList,((e,s)=>(d(),m("div",{key:s,class:"flex aic"},[o(A,{class:"el-icon-UserFilled"}),u("span",O,I(e.name),1),o(D,{class:"el-icon-minus cp",title:"取消选择",onClick:s=>C.cancle(e.userId)},null,8,["onClick"])])))),128))])])]})),_:1},16,["title","modelValue","destroy-on-close"])}],["__scopeId","data-v-8b4a48f4"]]);export{R as default};
