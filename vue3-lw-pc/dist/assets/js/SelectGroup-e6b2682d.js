import{g as e}from"./group-e56f61ac.js";import{ai as t,aq as l,o as i,c as s,_ as a,U as o,a as r,Y as p,K as d,a9 as u,T as n,Z as m,X as h,V as g,$ as c}from"./@vue-e400fd81.js";import{_ as f}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const b={name:"select-group",props:{visible:{type:Boolean,default:!1},limit:{type:Number,default:5},defaults:{type:Array,default:()=>[]}},components:{},data:()=>({query:{pageNum:1,pageSize:10,groupName:"",groupLeaderName:"",tagIds:""},total:0,list:[],loading:!1,groupChildList:[],tagNames:"",showSelectTag:!1,tagList:[]}),computed:{modalVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},watch:{visible(e){e&&this.getList(1),this.groupChildList=JSON.parse(JSON.stringify(this.defaults))}},methods:{getSelectTag(e){this.taglist=e;let t=[],l=[];e.forEach((e=>{t.push(e.name),l.push(e.tagId)})),this.tagNames=t.join(","),this.query.tagIds=l.join(",")},handleClose(e){this.groupChildList.splice(this.groupChildList.indexOf(e),1),this.list.forEach((t=>{t.chatId===e.chatId&&this.$refs.multipleTable.toggleRowSelection(t,!1)}))},resetQuery(){this.query={pageNum:1,pageSize:10,groupName:"",groupLeaderName:"",tagIds:""},this.tagList=[],this.tagNames="",this.getList()},getList(t){this.loading=!0,t&&(this.query.pageNum=t),e(this.query).then((e=>{this.total=Number(e.total),this.list=e.rows,this.loading=!1,setTimeout((()=>{this.toggleSelection()}),300)}))},toggleSelection(){this.groupChildList?this.groupChildList.forEach((e=>{this.list.forEach((t=>{e.chatId===t.chatId&&this.$refs.multipleTable.toggleRowSelection(t)}))})):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){let t=e;this.groupChildList.forEach((e=>{t=t.filter((t=>t.chatId!==e.chatId))})),this.groupChildList.push(...t)},selectFn(e,t){if(!e.includes(t)){let e=this.groupChildList.findIndex((e=>e.chatId===t.chatId));-1!==e&&this.groupChildList.splice(e,1)}},selectAllFn(e){e.length||this.list.forEach((e=>{let t=this.groupChildList.findIndex((t=>t.chatId===e.chatId));-1!==t&&this.groupChildList.splice(t,1)}))},submit(){this.groupChildList.length?this.groupChildList.length>5?this.msgInfo("最多选择五个客群！"):(this.$emit("submit",this.groupChildList),this.list=[],this.modalVisible=!1):this.msgInfo("请至少选择一个客群！")},cancelFn(){this.list=[],this.modalVisible=!1}},created(){}},j={class:"modal"},y={class:"fixed-content"};const C=f(b,[["render",function(e,f,b,C,L,N){const S=t("el-tag"),q=t("el-input"),I=t("el-form-item"),v=t("el-button"),w=t("el-form"),_=t("el-table-column"),V=t("tag-ellipsis"),k=t("el-table"),T=t("pagination"),x=t("el-dialog"),z=t("SelectTag"),U=l("loading");return i(),s("div",j,[a(x,{title:"选择客群",modelValue:N.modalVisible,"onUpdate:modelValue":f[7]||(f[7]=e=>N.modalVisible=e),"close-on-click-modal":!1},{footer:o((()=>[r("div",null,[a(v,{onClick:N.cancelFn},{default:o((()=>[p("取 消")])),_:1},8,["onClick"]),a(v,{type:"primary",onClick:N.submit},{default:o((()=>[p("确 定")])),_:1},8,["onClick"])])])),default:o((()=>[r("div",y,[p(" 已选择： "),(i(!0),s(d,null,u(L.groupChildList,((e,t)=>(i(),s(d,{key:t},[e.groupName?(i(),n(S,{key:0,style:{"margin-bottom":"5px"},closable:"",onClose:t=>N.handleClose(e)},{default:o((()=>[p(m(e.groupName),1)])),_:2},1032,["onClose"])):h("",!0)],64)))),128))]),a(w,{model:L.query,ref:"queryForm",inline:!0,class:"top-search","label-width":"40px","label-position":"left"},{default:o((()=>[a(I,{label:"",prop:"groupName"},{default:o((()=>[a(q,{style:{width:"150px"},modelValue:L.query.groupName,"onUpdate:modelValue":f[0]||(f[0]=e=>L.query.groupName=e),placeholder:"请输入群名",clearable:""},null,8,["modelValue"])])),_:1}),a(I,{label:"",prop:"groupLeaderName"},{default:o((()=>[a(q,{style:{width:"150px"},modelValue:L.query.groupLeaderName,"onUpdate:modelValue":f[1]||(f[1]=e=>L.query.groupLeaderName=e),placeholder:"请输入群主",clearable:""},null,8,["modelValue"])])),_:1}),a(I,{label:"",prop:""},{default:o((()=>[a(q,{style:{width:"150px"},"model-value":L.tagNames,readonly:"",onClick:f[2]||(f[2]=e=>L.showSelectTag=!0),placeholder:"请选择客群标签"},null,8,["model-value"])])),_:1}),a(I,{label:""},{default:o((()=>[a(v,{type:"primary",onClick:f[3]||(f[3]=e=>N.getList(1))},{default:o((()=>[p("查询")])),_:1}),a(v,{onClick:N.resetQuery},{default:o((()=>[p("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),g((i(),n(k,{ref:"multipleTable",data:L.list,onSelect:N.selectFn,onSelectAll:N.selectAllFn,onSelectionChange:N.handleSelectionChange},{default:o((()=>[a(_,{type:"selection",width:"55",align:"center"}),a(_,{label:"群名",align:"center",prop:"groupName"}),a(_,{label:"群主",align:"center",prop:"groupLeaderName"}),a(_,{label:"群标签",width:"180"},{default:o((({row:e})=>[e.tags?(i(),n(V,{key:0,list:e.tags.split(","),limit:"1"},null,8,["list"])):h("",!0)])),_:1}),a(_,{label:"群总人数 ",align:"center ",prop:"memberNum"})])),_:1},8,["data","onSelect","onSelectAll","onSelectionChange"])),[[U,L.loading]]),g(a(T,{total:L.total,page:L.query.pageNum,"onUpdate:page":f[4]||(f[4]=e=>L.query.pageNum=e),limit:L.query.pageSize,"onUpdate:limit":f[5]||(f[5]=e=>L.query.pageSize=e),onPagination:f[6]||(f[6]=e=>N.getList())},null,8,["total","page","limit"]),[[c,L.total>0]])])),_:1},8,["modelValue"]),a(z,{visible:L.showSelectTag,"onUpdate:visible":f[8]||(f[8]=e=>L.showSelectTag=e),type:"2",selected:L.tagList,onSuccess:N.getSelectTag},null,8,["visible","selected","onSuccess"])])}],["__scopeId","data-v-d4dba1dc"]]);export{C as default};
