import{_ as e}from"../index-044285d2.js";import{g as l,s as a,u as o,a as i}from"./api-8af93ec8.js";import{g as s}from"./groupMessage-f31c8fd2.js";import{_ as t}from"./quill-image-resize-module-c051113e.js";import{aU as r,ai as d,aq as m,o as u,c as n,V as p,T as g,U as c,a as f,Y as h,X as j,_ as b,K as v,a9 as k,Z as y,P as w,bl as V,bj as _}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const D={components:{SelectGroup:r((()=>e((()=>import("./SelectGroup-6de7bf46.js")),["assets/js/SelectGroup-6de7bf46.js","assets/js/group-e56f61ac.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css","assets/css/SelectGroup-f405b962.css"])))},data:()=>({id:"",dialogVisibleSelectGroup:!1,loading:!1,form:{taskName:"",welcomeMsg:"",sendScope:"0"},rules:Object.freeze({taskName:[{required:!0,message:"必填项",trigger:"blur"}],welcomeMsg:[{required:!0,message:"必填项",trigger:"blur"}],groups:[{required:!0,message:"必填项",trigger:"blur"}],sendScope:[{required:!0,message:"必填项",trigger:"blur"}],linkTitle:[{required:!0,message:"必填项",trigger:"blur"}],linkDesc:[{required:!0,message:"必填项",trigger:"blur"}]})}),computed:{isDetail(){return this.$route.path.endsWith("detail")}},watch:{},created(){this.id=this.$route.query.id,this.id&&this.getDetail(this.id)},methods:{getDetail(e){this.loading=!0,l(e).then((({data:e})=>{this.form=e})).finally((()=>{this.loading=!1}))},sync(){this.loading=!1,a(this.id).then((()=>{this.msgSuccess("操作成功")})).finally((()=>{this.loading=!1}))},submit(){this.$refs.form.validate((e=>{var l,a,o,i,t,r,d,m,u,n,p,g,c;if(e){let e=JSON.parse(JSON.stringify(this.form));if(1==e.sendScope){let f=e.weCustomersQuery,h=f&&{genders:null==(l=f.genders)?void 0:l.join(","),customerTypes:null==(a=f.customerTypes)?void 0:a.join(","),tagIds:null==(i=null==(o=f.tags)?void 0:o.map((e=>e.tagId)))?void 0:i.join(","),tagNames:null==(r=null==(t=f.tags)?void 0:t.map((e=>e.name)))?void 0:r.join(","),userIds:null==(m=null==(d=f.users)?void 0:d.map((e=>e.userId)))?void 0:m.join(","),userNames:null==(n=null==(u=f.users)?void 0:u.map((e=>e.name)))?void 0:n.join(","),beginTime:null==(p=f.dateRange)?void 0:p[0],endTime:null==(g=f.dateRange)?void 0:g[1],trackState:f.trackState,isContain:(null==(c=f.tags)?void 0:c.length)?f.isContain:void 0};this.loading=!0,s(h,1).then((({data:l})=>{(null==l?void 0:l.length)?(e.senderList=l,this.sendData(e)):(this.msgError("未找到可发送客户！"),this.loading=!1)})).catch((()=>{this.loading=!1}))}else this.sendData(e)}}))},sendData(e){this.loading=!0,(this.id?o:i)(e).then((()=>{this.msgSuccess("添加成功"),this.$router.back()})).finally((()=>{this.loading=!1}))}}},S=e=>(V("data-v-14afe033"),e=e(),_(),e),U={class:"flex"},C={class:"g-card"},x={class:"g-card-title fxbw"},q={class:"g-card"},N=S((()=>f("div",{class:"g-card-title"},"拉群设置",-1))),T=S((()=>f("div",{class:"g-tip"},"最多选择五个客群",-1))),I=S((()=>f("div",{class:"g-tip"},"默认以第一个群的群主作为新建群的群主",-1))),z=S((()=>f("div",null,"支持jpg/jpeg/png格式，图片大小不超过2M",-1))),M={key:0,class:"g-footer-sticky",style:{"z-index":"10"}},R={class:"preview-wrap g-card mt0 sticky-t"},B=S((()=>f("div",{class:"g-card-title"},"预览",-1)));const G=t(D,[["render",function(e,l,a,o,i,s){const t=d("el-tag"),r=d("el-input"),V=d("el-form-item"),_=d("el-radio"),D=d("el-radio-group"),S=d("CustomerRangeForm"),G=d("TextareaExtend"),E=d("el-button"),$=d("SelectGroup"),O=d("TagEllipsis"),P=d("el-switch"),A=d("el-input-number"),J=d("upload"),L=d("el-form"),Q=d("PhoneDialog"),F=m("loading");return u(),n("div",U,[p((u(),g(L,{model:i.form,ref:"form",rules:i.rules,"label-width":"100px",class:w(["fxauto g-margin-r",s.isDetail&&"form-detail"]),disabled:s.isDetail},{default:c((()=>[f("div",C,[f("div",x,[h(" 群发设置 "),s.isDetail?(u(),g(t,{key:0,class:"cp",size:"large",effect:"dark",onClick:s.sync},{default:c((()=>[h("同步")])),_:1},8,["onClick"])):j("",!0)]),b(V,{label:"任务名称",prop:"taskName"},{default:c((()=>[b(r,{modelValue:i.form.taskName,"onUpdate:modelValue":l[0]||(l[0]=e=>i.form.taskName=e),"show-word-limit":"",placeholder:"请输入",clearable:""},null,8,["modelValue"])])),_:1}),b(V,{label:"发送范围",prop:"sendScope"},{default:c((()=>[b(D,{modelValue:i.form.sendScope,"onUpdate:modelValue":l[1]||(l[1]=e=>i.form.sendScope=e)},{default:c((()=>[(u(),n(v,null,k({0:"全部客户",1:"部分客户"},((e,l)=>b(_,{key:l,label:l},{default:c((()=>[h(y(e),1)])),_:2},1032,["label"]))),64))])),_:1},8,["modelValue"])])),_:1}),1==i.form.sendScope?(u(),g(S,{key:0,data:i.form.weCustomersQuery,"onUpdate:data":l[2]||(l[2]=e=>i.form.weCustomersQuery=e),disabled:s.isDetail,isDetail:s.isDetail,"label-width":"100px"},null,8,["data","disabled","isDetail"])):j("",!0)]),f("div",q,[N,b(V,{label:"加群引导语",prop:"welcomeMsg"},{default:c((()=>[b(G,{modelValue:i.form.welcomeMsg,"onUpdate:modelValue":l[3]||(l[3]=e=>i.form.welcomeMsg=e),maxlength:"220","show-word-limit":"",autosize:{minRows:5,maxRows:20},placeholder:"请输入",clearable:""},null,8,["modelValue"])])),_:1}),b(V,{label:"活码客群:",prop:"groups"},{default:c((()=>[s.isDetail?j("",!0):(u(),n(v,{key:0},[b(E,{type:"primary",onClick:l[4]||(l[4]=e=>i.dialogVisibleSelectGroup=!0)},{default:c((()=>[h("选择客群")])),_:1}),T,b($,{visible:i.dialogVisibleSelectGroup,"onUpdate:visible":l[5]||(l[5]=e=>i.dialogVisibleSelectGroup=e),defaults:i.form.groups,onSubmit:l[6]||(l[6]=l=>(i.form.groups=l,e.$refs.form.validateField("groups")))},null,8,["visible","defaults"])],64)),b(O,{list:i.form.groups,limit:"5",defaultProps:"groupName"},null,8,["list"])])),_:1}),b(V,{label:"群满自动建群:"},{default:c((()=>[b(P,{modelValue:i.form.autoCreateRoom,"onUpdate:modelValue":l[7]||(l[7]=e=>i.form.autoCreateRoom=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),I])),_:1}),i.form.autoCreateRoom?(u(),n(v,{key:0},[b(V,{label:"群名前缀:",prop:"roomBaseName"},{default:c((()=>[b(r,{"show-word-limit":"",maxlength:"20",modelValue:i.form.roomBaseName,"onUpdate:modelValue":l[8]||(l[8]=e=>i.form.roomBaseName=e),placeholder:"请输入群名前缀"},null,8,["modelValue"])])),_:1}),b(V,{label:"群起始序号:",prop:"roomBaseId"},{default:c((()=>[b(A,{modelValue:i.form.roomBaseId,"onUpdate:modelValue":l[9]||(l[9]=e=>i.form.roomBaseId=e),"controls-position":"right",min:1},null,8,["modelValue"])])),_:1})],64)):j("",!0),b(V,{label:"链接标题",prop:"linkTitle"},{default:c((()=>[b(r,{modelValue:i.form.linkTitle,"onUpdate:modelValue":l[10]||(l[10]=e=>i.form.linkTitle=e),maxlength:"20","show-word-limit":"",placeholder:"请输入",clearable:""},null,8,["modelValue"])])),_:1}),b(V,{label:"链接描述",prop:"linkDesc"},{default:c((()=>[b(r,{modelValue:i.form.linkDesc,"onUpdate:modelValue":l[11]||(l[11]=e=>i.form.linkDesc=e),maxlength:"30","show-word-limit":"",placeholder:"请输入",clearable:""},null,8,["modelValue"])])),_:1}),b(V,{label:"链接封面",prop:"linkCoverUrl"},{default:c((()=>[b(J,{fileUrl:i.form.linkCoverUrl,"onUpdate:fileUrl":l[12]||(l[12]=e=>i.form.linkCoverUrl=e),type:"0",maxSize:2,format:["jpg","jpeg","png"]},{tip:c((()=>[z])),_:1},8,["fileUrl"])])),_:1})]),s.isDetail?j("",!0):(u(),n("div",M,[b(E,{type:"primary",onClick:s.submit},{default:c((()=>[h("保存")])),_:1},8,["onClick"]),b(E,{onClick:l[13]||(l[13]=l=>e.$router.back())},{default:c((()=>[h("取消")])),_:1})]))])),_:1},8,["model","rules","class","disabled"])),[[F,i.loading]]),f("div",null,[f("div",R,[B,b(Q,{list:[{text:i.form.welcomeMsg||"请输入加群引导语"},{title:i.form.linkTitle,desc:i.form.linkDesc,image:i.form.linkCoverUrl}]},null,8,["list"])])])])}],["__scopeId","data-v-14afe033"]]);export{G as default};
