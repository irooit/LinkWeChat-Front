import{u as e,d as t,g as a,r as s,a as i}from"./seas-95bb2d56.js";import"../index-044285d2.js";import{ai as l,aq as o,o as r,c as n,_ as d,U as m,aa as u,Y as p,a as c,V as f,T as g,X as h,$ as b,K as y,a9 as S,Z as j,bl as w,bj as v}from"./@vue-e400fd81.js";import{_}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const C={name:"CodeStaff",components:{},data:()=>({submitLoading:!1,headers:window.lwConfig.headers,currentActive:"sea",importDialogVisible:!1,dialogVisibleSelectTag:!1,query:{pageNum:1,pageSize:10,customerName:void 0,phone:void 0,addUserName:void 0,addState:void 0},dateRange:[],dialogVisible:!1,loading:!1,ids:[],total:0,list:[],form:{customerSeasTags:[],weCustomerStaffs:[]},formRules:{},selectedUserList:[],actionUrl:"...",selectedTagList:[]}),created(){this.getList(),this.$store.setBusininessDesc("\n\t\t\t     <div>管理员在后台将客户导入后，系统根据分配规则自动分配给员工，员工可以一键复制客户手机号，快速添加客户，并支持添加效果统计。</div>\n\t\t\t   ")},mounted(){},methods:{clearData(){this.$refs.upload.clearFiles(),this.form.file=""},submitImport(){if(!this.form.file)return this.msgError("请先上传表格！"),!1;if(!this.form.weCustomerStaffs.length)return this.msgError("请先选择员工！"),!1;let t={file:this.form.file,addUserId:this.form.weCustomerStaffs.map((e=>e.staffId)).join(","),addUserName:this.form.weCustomerStaffs.map((e=>e.staffName)).join(","),tagIds:this.form.customerSeasTags.length?this.form.customerSeasTags.map((e=>e.tagId)).join(","):"",tagNames:this.form.customerSeasTags.length?this.form.customerSeasTags.map((e=>e.tagName)).join(","):""};this.submitLoading=!0,e(this.toFormData(t)).then((e=>{200===e.code?(this.form={file:{},customerSeasTags:[],weCustomerStaffs:[]},this.selectedUserList=[],this.selectedTagList=[],this.getList(),this.msgSuccess(e.data),this.importDialogVisible=!1):this.msgError(e.msg),this.submitLoading=!1})).catch((()=>{}))},toFormData(e){let t=new FormData;for(let s in e)a(e[s],s);function a(e,s){if(null==e||"function"==typeof e)return!1;if("object"!=typeof e)t.append(s,e);else if(e instanceof Array){if(0!==e.length)for(let t in e)for(let i in e[t])a(e[t][i],`${s}[${t}].${i}`)}else{if(-1==Object.keys(e).indexOf("uid"))for(let t in e)a(e[t],`${s}.${t}`);else t.append(`${s}`,e)}}return t},submitSelectTagFn(e){this.form.customerSeasTags=e.map((e=>({tagId:e.tagId,tagName:e.name})))},selectedFn(){this.form.customerSeasTags&&(this.selectedTagList=this.form.customerSeasTags.map((e=>({tagId:e.tagId,name:e.tagName})))),this.dialogVisibleSelectTag=!0},selectUserFn(){this.selectedUserList=[];let e=[];e=this.form.weCustomerStaffs.map((e=>({userId:e.staffId,name:e.staffName}))),this.selectedUserList=e,this.dialogVisible=!0},selectedUserFn(e){const t=e.map((e=>({staffId:e.id||e.userId,staffName:e.name})));this.form.weCustomerStaffs=t},setFileData(e,t){this.form.file=e.raw},handleRemove(){this.form.file=""},downloadFn(){t().then((e=>{if(null!=e){let t=new Blob([e],{type:"application/vnd.ms-excel"}),a=window.URL.createObjectURL(t);const s=document.createElement("a");s.href=a,s.download="模板.xlsx",s.click(),URL.revokeObjectURL(a)}}))},getList(e){e&&(this.query.pageNum=e),this.loading=!0,a(this.query).then((({rows:e,total:t})=>{this.list=e,this.total=+t,this.loading=!1,this.ids=[]})).catch((()=>{this.loading=!1}))},resetQuery(){this.dateRange=[],this.$refs.queryForm.resetFields(),this.getList(1)},goRoute(e,t){this.$router.push({path:e,query:{id:t}})},handleSelectionChange(e){this.ids=e.map((e=>e.id))},removeFn(e){this.$confirm("是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{s(e).then((e=>{200===e.code?(this.getList(),this.msgSuccess("删除成功")):this.msgError(e.msg)}))}),(()=>{}))},removeMult(){this.ids.length?this.$confirm("是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{s(this.ids.join(",")).then((e=>{200===e.code?(this.getList(),this.msgSuccess("删除成功")):this.msgError(e.msg)}))}),(()=>{})):this.msgInfo("请先勾选要操作项！")},tipFn(e){this.$confirm("是否确定发送员工跟进客户提醒？确定后提醒将发送至对应员工","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{i(e).then((e=>{200===e.code?this.msgSuccess("提醒成功！"):this.msgError(e.msg)}))}),(()=>{}))},tipMulFn(){this.ids.length?this.$confirm("是否确定发送员工跟进客户提醒？确定后提醒将发送至对应员工","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{i(this.ids.join(",")).then((e=>{200===e.code?(this.msgSuccess("提醒成功！"),this.ids=[],this.$refs.myTable.clearSelection()):this.msgError(e.msg)}))}),(()=>{})):this.msgInfo("请先勾选要操作项！")}}},k=e=>(w("data-v-5be10170"),e=e(),v(),e),T={class:"g-card"},U={class:"mid-action"},V={key:0},x={key:0},L={style:{display:"flex"}},N=k((()=>c("div",{class:"sub-des"},"公海客户平均分配给选择的员工",-1))),q=k((()=>c("div",{class:"sub-des"},"添加成功后，该客户系统添加此标签",-1))),F={class:"dialog-footer"};const I=_(C,[["render",function(e,t,a,s,i,w){const v=l("el-input"),_=l("el-form-item"),C=l("el-option"),k=l("el-select"),I=l("el-button"),D=l("el-form"),$=l("el-table-column"),R=l("TagEllipsis"),B=l("el-tag"),E=l("el-table"),z=l("pagination"),K=l("SelectUser"),M=l("SelectTag"),O=l("el-upload"),A=l("el-dialog"),Q=o("loading");return r(),n("div",null,[d(D,{model:i.query,"label-position":"left",ref:"queryForm",inline:!0,"label-width":"70px",class:"top-search"},{default:m((()=>[d(_,{label:"电话",prop:"phone","label-width":"40px"},{default:m((()=>[d(v,{modelValue:i.query.phone,"onUpdate:modelValue":t[0]||(t[0]=e=>i.query.phone=e),placeholder:"请输入电话",clearable:"",onKeyup:t[1]||(t[1]=u((e=>w.getList(1)),["enter"]))},null,8,["modelValue"])])),_:1}),d(_,{label:"客户备注名",prop:"customerName","label-width":"90px"},{default:m((()=>[d(v,{modelValue:i.query.customerName,"onUpdate:modelValue":t[2]||(t[2]=e=>i.query.customerName=e),placeholder:"请输入客户备注名",clearable:"",onKeyup:t[3]||(t[3]=u((e=>w.getList(1)),["enter"]))},null,8,["modelValue"])])),_:1}),d(_,{label:"员工名",prop:"addUserName"},{default:m((()=>[d(v,{modelValue:i.query.addUserName,"onUpdate:modelValue":t[4]||(t[4]=e=>i.query.addUserName=e),placeholder:"请输入员工名",clearable:"",onKeyup:t[5]||(t[5]=u((e=>w.getList(1)),["enter"]))},null,8,["modelValue"])])),_:1}),d(_,{label:"添加状态",prop:"addState"},{default:m((()=>[d(k,{clearable:"",modelValue:i.query.addState,"onUpdate:modelValue":t[6]||(t[6]=e=>i.query.addState=e)},{default:m((()=>[d(C,{label:"待添加",value:0}),d(C,{label:"已添加",value:1}),d(C,{label:"待通过",value:3})])),_:1},8,["modelValue"])])),_:1}),d(_,{"label-width":"0"},{default:m((()=>[d(I,{type:"primary",onClick:t[7]||(t[7]=e=>w.getList(1))},{default:m((()=>[p("查询")])),_:1}),d(I,{onClick:w.resetQuery},{default:m((()=>[p("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),c("div",T,[c("div",U,[d(I,{type:"primary",onClick:t[8]||(t[8]=e=>i.importDialogVisible=!0)},{default:m((()=>[p("导入客户")])),_:1}),c("div",null,[d(I,{type:"primary",plain:"",onClick:t[9]||(t[9]=e=>w.removeMult())},{default:m((()=>[p("批量删除")])),_:1}),d(I,{type:"primary",plain:"",onClick:w.tipMulFn},{default:m((()=>[p("批量提醒")])),_:1},8,["onClick"])])]),f((r(),g(E,{ref:"myTable",data:i.list,onSelectionChange:w.handleSelectionChange},{default:m((()=>[d($,{type:"selection",width:"55",align:"center"}),d($,{label:"电话号码",align:"center",prop:"phone","min-width":"180px","show-overflow-tooltip":""}),d($,{label:"客户备注姓名",align:"center",prop:"customerName","show-overflow-tooltip":""}),d($,{label:"客户标签",align:"center",prop:"tagNames","min-width":"180px","show-overflow-tooltip":""},{default:m((({row:e})=>[e.tagNames?(r(),n("div",V,[d(R,{list:e.tagNames.split(",")},null,8,["list"])])):h("",!0)])),_:1}),d($,{label:"分配员工",align:"center",prop:"addUserName"}),d($,{label:"当前状态",align:"center",prop:"addState"},{default:m((({row:e})=>[0===e.addState?(r(),g(B,{key:0,type:"danger"},{default:m((()=>[p("待添加")])),_:1})):h("",!0),1===e.addState?(r(),g(B,{key:1,type:"success"},{default:m((()=>[p("已添加")])),_:1})):h("",!0),3===e.addState?(r(),g(B,{key:2,type:"warning"},{default:m((()=>[p("待通过")])),_:1})):h("",!0)])),_:1}),d($,{label:"导入时间",align:"center",prop:"createTime",width:"180"}),d($,{label:"操作",align:"center"},{default:m((({row:e})=>[0==e.addState?(r(),g(I,{key:0,text:"",onClick:t=>w.tipFn(e.id)},{default:m((()=>[p("提醒")])),_:2},1032,["onClick"])):h("",!0),d(I,{text:"",onClick:t=>w.removeFn(e.id)},{default:m((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[Q,i.loading]]),f(d(z,{total:i.total,page:i.query.pageNum,"onUpdate:page":t[10]||(t[10]=e=>i.query.pageNum=e),limit:i.query.pageSize,"onUpdate:limit":t[11]||(t[11]=e=>i.query.pageSize=e),onPagination:t[12]||(t[12]=e=>w.getList())},null,8,["total","page","limit"]),[[b,i.total>0]])]),d(K,{defaultValues:i.selectedUserList,visible:i.dialogVisible,"onUpdate:visible":t[13]||(t[13]=e=>i.dialogVisible=e),title:"选择员工",onSuccess:w.selectedUserFn},null,8,["defaultValues","visible","onSuccess"]),i.dialogVisibleSelectTag?(r(),n("div",x,[d(M,{visible:i.dialogVisibleSelectTag,"onUpdate:visible":t[14]||(t[14]=e=>i.dialogVisibleSelectTag=e),selected:i.selectedTagList,onSuccess:w.submitSelectTagFn},null,8,["visible","selected","onSuccess"])])):h("",!0),d(A,{title:"导入客户","close-on-click-modal":!1,"show-close":!1,modelValue:i.importDialogVisible,"onUpdate:modelValue":t[17]||(t[17]=e=>i.importDialogVisible=e),width:"40%"},{footer:m((()=>[c("span",F,[d(I,{onClick:t[16]||(t[16]=e=>{i.importDialogVisible=!1,w.clearData()})},{default:m((()=>[p("取 消")])),_:1}),f((r(),g(I,{type:"primary",onClick:w.submitImport},{default:m((()=>[p("确 定")])),_:1},8,["onClick"])),[[Q,i.submitLoading]])])])),default:m((()=>[d(D,{ref:"importForm",model:i.form,rules:i.formRules,"label-position":"right"},{default:m((()=>[d(_,{label:"选择表格",prop:"file",required:""},{default:m((()=>[c("div",L,[d(O,{accept:".xls, .xlsx",action:i.actionUrl,limit:1,headers:i.headers,ref:"upload","on-remove":w.handleRemove,"on-change":w.setFileData,"auto-upload":!1},{default:m((()=>[d(I,{type:"primary",plain:"",onClick:t[15]||(t[15]=e=>w.clearData())},{default:m((()=>[p("上传表格")])),_:1})])),_:1},8,["action","headers","on-remove","on-change"]),d(I,{style:{"margin-left":"10px",flex:"0"},text:"",plain:"",onClick:w.downloadFn},{default:m((()=>[p("下载模板")])),_:1},8,["onClick"])])])),_:1}),d(_,{label:"选择员工",prop:"weCustomerStaffs",required:""},{default:m((()=>[(r(!0),n(y,null,S(i.form.weCustomerStaffs,((e,t)=>(r(),g(B,{key:t},{default:m((()=>[p(j(e.staffName),1)])),_:2},1024)))),128)),d(I,{type:"primary",plain:"",onClick:w.selectUserFn},{default:m((()=>[p(j(i.form.weCustomerStaffs.length?"编辑":"选择")+"员工 ",1)])),_:1},8,["onClick"]),N])),_:1}),d(_,{label:"新客户标签",prop:"customerSeasTags"},{default:m((()=>[(r(!0),n(y,null,S(i.form.customerSeasTags,((e,t)=>(r(),n(y,{key:t},[e.tagName?(r(),g(B,{key:0},{default:m((()=>[p(j(e.tagName),1)])),_:2},1024)):h("",!0)],64)))),128)),d(I,{type:"primary",plain:"",onClick:w.selectedFn},{default:m((()=>[p("选择标签")])),_:1},8,["onClick"]),q])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}],["__scopeId","data-v-5be10170"]]);export{I as default};
