import{_ as e,a2 as t}from"../index-044285d2.js";import i from"./BaiduMap-b1208569.js";import{s as r,a as o}from"./store-1f3cfa19.js";import{_ as a}from"./quill-image-resize-module-c051113e.js";import{aU as s,ai as l,o as d,c as u,_ as p,U as m,a as n,Y as h,X as c,bl as f,bj as g}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const v={name:"store-add",props:{isDetail:{type:Boolean,default:!1}},components:{BaiduMap:i,FormAutoCreateGroup:s((()=>e((()=>import("./FormAutoCreateGroup-88be534d.js")),["assets/js/FormAutoCreateGroup-88be534d.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css"])))},data:()=>({areaArray:[],current:{province:"",city:"",area:""},form:{storeState:1,storeName:"",area:"",provinceId:"",cityId:"",areaId:"",longitude:"",latitude:"",shopGuideId:"",shopGuideName:"",address:"",groupCodeUrl:"",groupCodeName:"",groupCodeId:"",shopGuideUrl:"",addGroupCode:{}},addGroupCode:{},selectedUserList:[],dialogVisibleSelectUser:!1,dialogVisibleSelectGroup:!1,selectedCodeList:[],cityTree:[],props:{label:"name",value:"name"},rule:{storeName:[{required:!0,message:"请输入门店名称",trigger:"blur"}],area:[{required:!0,message:"请选择所属地区",trigger:"blur"}],address:[{required:!0,message:"请选择详细地址",trigger:"blur"}]}}),computed:{isDetail(){return this.$route.path.endsWith("detail")}},created(){t({isExtName:!0}).then((({data:e})=>{this.cityTree=e})),this.$route.query.id&&(this.$store.loading=!0,r(this.$route.query.id).then((({data:e})=>{var t,i,r,o,a,s,l,d,u,p,m,n;let h=null==(o=null==(r=null==(i=null==(t=e.addWeUserOrGroupCode)?void 0:t.weQrAddQuery)?void 0:i.qrUserInfos)?void 0:r[0])?void 0:o.userIds;e.users=null==(s=null==(a=e.shopGuideName)?void 0:a.split(","))?void 0:s.map(((e,t)=>({userId:null==h?void 0:h[t],name:e})));let c=null==(u=null==(d=null==(l=e.addWeUserOrGroupCode)?void 0:l.addGroupCode)?void 0:d.chatIdList)?void 0:u.split(",");this.addGroupCode={...null==(p=e.addWeUserOrGroupCode)?void 0:p.addGroupCode,groups:null==(n=null==(m=e.groupCodeName)?void 0:m.split(","))?void 0:n.map(((e,t)=>({chatId:null==c?void 0:c[t],groupName:e})))},this.form=e,this.setDetail()})).finally((()=>{this.$store.loading=!1})))},methods:{getPoint(e){this.form.longitude=e.lng.toString(),this.form.latitude=e.lat.toString()},handleChange(e){e.address&&(this.form.address=e.address,this.form.area=e.province+e.city+e.area,e.province&&(this.areaArray=[e.province,e.city,e.area]),this.form.longitude=e.addrPoint.lng.toString(),this.form.latitude=e.addrPoint.lat.toString())},handleTree(e){this.form.area=this.areaArray.join(""),this.form.address="",this.form.longitude="",this.form.latitude=""},switchFn(){var e,t;return!(!(null==(e=this.addGroupCode.groups)?void 0:e.length)&&!(null==(t=this.form.users)?void 0:t.length))||(this.msgError("开启门店必须要求导购人员或群活码至少设置一项"),!1)},submit(){var e,t;0!=this.form.storeState||(null==(e=this.addGroupCode.groups)?void 0:e.length)||(null==(t=this.form.users)?void 0:t.length)?this.$refs.form.validate((e=>{var t,i,r,a,s,l,d,u;if(e){let e=JSON.parse(JSON.stringify(this.form));e.shopGuideName=null==(i=null==(t=e.users)?void 0:t.map((e=>e.name)))?void 0:i.join(","),e.groupCodeName=null==(s=null==(a=null==(r=this.addGroupCode)?void 0:r.groups)?void 0:a.map((e=>e.groupName)))?void 0:s.join(","),e.addWeUserOrGroupCode={weQrAddQuery:{qrUserInfos:[{userIds:null==(l=e.users)?void 0:l.map((e=>e.userId))}]},addGroupCode:{...this.addGroupCode,chatIdList:null==(u=null==(d=this.addGroupCode.groups)?void 0:d.map((e=>e.chatId)))?void 0:u.join(",")}},delete e.users,this.$store.loading=!0,o(e).then((e=>{this.msgSuccess("操作成功"),this.$router.back()})).finally((()=>{this.$store.loading=!1}))}})):this.msgError("门店状态开启时必须要求导购人员或群活码至少设置一项")},cancel(){this.$confirm(`是否确认取消${this.$route.query.id?"编辑":"新建"}？取消后不可恢复，请谨慎操作。`).then((()=>{this.$router.back()})).catch((function(){}))},setDetail(){if(this.form.groupCodeId&&(this.selectedCodeList[0]={id:this.form.groupCodeId}),this.form.area){let e=/.+?(省|市|自治区|自治州|县|区|旗)/g,t=this.form.area.match(e);this.areaArray=t}if(this.form.shopGuideId){this.selectedUserList=[];let e=this.form.shopGuideId.split(","),t=this.form.shopGuideName.split(","),i=[];e.forEach(((e,r)=>{i.push({name:t[r],userId:e})})),this.selectedUserList=[...i]}}}},y=e=>(f("data-v-66fa8036"),e=e(),g(),e),j={class:"g-card"},b=y((()=>n("div",{class:"card-title",style:{display:"inline-block"}},"基础信息",-1))),C={key:0,style:{float:"right"}},G={class:"g-card"},U=y((()=>n("div",{class:"card-title"},"门店设置",-1))),I={key:0},_={key:0,class:"g-footer-sticky"};const N=a(v,[["render",function(e,t,i,r,o,a){const s=l("el-button"),f=l("el-input"),g=l("el-form-item"),v=l("el-cascader"),y=l("BaiduMap"),N=l("SelectUser"),D=l("TagEllipsis"),V=l("FormAutoCreateGroup"),S=l("el-card"),w=l("el-switch"),q=l("el-form");return d(),u("div",null,[p(q,{"label-width":"120px","label-position":"right",ref:"form",rules:o.rule,model:o.form},{default:m((()=>[n("div",j,[b,a.isDetail?(d(),u("div",C,[p(s,{type:"primary",onClick:t[0]||(t[0]=t=>e.$router.push({path:"add",query:{id:e.$route.query.id,obj:encodeURIComponent(JSON.stringify(o.form))}}))},{default:m((()=>[h(" 编辑 ")])),_:1})])):c("",!0),p(g,{label:"门店名称",prop:"storeName"},{default:m((()=>[p(f,{disabled:a.isDetail,modelValue:o.form.storeName,"onUpdate:modelValue":t[1]||(t[1]=e=>o.form.storeName=e),placeholder:"请输入门店名称",style:{width:"400px"},"show-word-limit":"",maxlength:"30"},null,8,["disabled","modelValue"])])),_:1}),p(g,{label:"所属地区",prop:"area"},{default:m((()=>[p(v,{disabled:a.isDetail,modelValue:o.areaArray,"onUpdate:modelValue":t[2]||(t[2]=e=>o.areaArray=e),props:o.props,options:o.cityTree,ref:"tree",onChange:a.handleTree},null,8,["disabled","modelValue","props","options","onChange"])])),_:1}),p(y,{onUpdate:a.handleChange,onPoint:a.getPoint,isDetail:a.isDetail,initData:o.form},null,8,["onUpdate","onPoint","isDetail","initData"])]),n("div",G,[U,p(g,{label:"门店导购"},{default:m((()=>[a.isDetail?c("",!0):(d(),u("div",I,[p(s,{type:"primary",plain:"",onClick:t[3]||(t[3]=e=>o.dialogVisibleSelectUser=!0)},{default:m((()=>[h("选择员工")])),_:1}),p(N,{visible:o.dialogVisibleSelectUser,"onUpdate:visible":t[4]||(t[4]=e=>o.dialogVisibleSelectUser=e),title:"选择员工",defaultValues:o.form.users,onSuccess:t[5]||(t[5]=e=>o.form.users=e)},null,8,["visible","defaultValues"])])),p(D,{list:o.form.users,limit:"10",emptyText:a.isDetail&&"无"},null,8,["list","emptyText"])])),_:1}),p(g,{label:"门店客群"},{default:m((()=>[p(S,{shadow:"always",style:{width:"600px"},"body-style":{padding:"20px"}},{default:m((()=>[p(V,{ref:"FormAutoCreateGroup",form:o.addGroupCode,"onUpdate:form":t[6]||(t[6]=e=>o.addGroupCode=e),isDetail:a.isDetail},{default:m((({form:e})=>[p(g,{label:"群活码名称",prop:"activityName",rules:{activityName:[{required:!0,message:"必填项",trigger:"blur"}]}},{default:m((()=>[p(f,{modelValue:e.activityName,"onUpdate:modelValue":t=>e.activityName=t,maxlength:"15","show-word-limit":"",placeholder:"请输入",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:1},8,["form","isDetail"])])),_:1})])),_:1}),p(g,{label:"门店状态"},{default:m((()=>[p(w,{disabled:a.isDetail,modelValue:o.form.storeState,"onUpdate:modelValue":t[7]||(t[7]=e=>o.form.storeState=e),"before-change":a.switchFn,"active-text":"启用","inactive-text":"停用","active-value":0,"inactive-value":1},null,8,["disabled","modelValue","before-change"])])),_:1})])])),_:1},8,["rules","model"]),a.isDetail?c("",!0):(d(),u("div",_,[p(s,{plain:"",onClick:a.cancel},{default:m((()=>[h("取消")])),_:1},8,["onClick"]),p(s,{type:"primary",onClick:a.submit},{default:m((()=>[h("确定")])),_:1},8,["onClick"])]))])}],["__scopeId","data-v-66fa8036"]]);export{N as default};
