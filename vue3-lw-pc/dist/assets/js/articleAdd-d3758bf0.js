import{_ as e,Q as t}from"./quill-image-resize-module-c051113e.js";import{g as i,u as l,b as o,a}from"./index-0bf429ac.js";import s from"./PreviewInPhone-9ed75a0f.js";import{ai as r,aq as m,o as d,c as p,_ as n,U as u,a as g,Y as c,V as h,T as f,bl as j,bj as b}from"./@vue-e400fd81.js";import"./quill-c6b3d2fb.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";const y={components:{QuillEditor:t,PreviewInPhone:s},data:()=>({form:{},mobForm:[],dialogVisible:!1,rules:Object.freeze({categoryId:[{required:!0,message:"不能为空",trigger:"change"}],materialName:[{required:!0,message:"不能为空",trigger:"change"}]}),submitLoading:!1,treeData:[{}],groupProps:{expandTrigger:"hover",checkStrictly:!0,children:"children",label:"name",value:"id",emitPath:!1},dialogVisibleSelectTag:!1,selectedTagList:[]}),created(){this.getTree(),this.$route.query.id&&this.getDeatil(),this.$route.query.categoryId&&(this.form.categoryId=this.$route.query.categoryId)},mounted(){},methods:{preview(){this.dialogVisible=!0,this.mobForm=[],this.form.mediaType="12",this.mobForm.push(this.form)},getTree(){i(12).then((({data:e})=>{e.forEach((e=>{e.children=null})),this.treeData=[{id:"",name:"全部",parentId:"0",hasParent:!1,hasChildren:!0,children:e||[]}]}))},submit(){this.submitLoading=!0,this.times&&clearTimeout(this.times),this.$refs.form.validate((e=>{e?this.times=setTimeout((()=>{var e;let t=JSON.parse(JSON.stringify(this.form));if(t.tagIds=(null==(e=t.tags)?void 0:e.map(((e,t)=>e.tagId)))+"",t.mediaType=12,t.coverUrl){let e=new Image;e.src=t.coverUrl,t.width=e.width,t.height=e.height,t.pixelSize=e.width*e.height}(t.id?l:o)(t).then((()=>{this.msgSuccess("操作成功"),this.$refs.form.resetFields(),this.submitLoading=!1,this.$router.push("list")})).catch((()=>{this.submitLoading=!1}))}),300):this.submitLoading=!1}))},getDeatil(){this.loading=!0;let e={};e.mediaType=this.$route.query.type,e.materialId=this.$route.query.id,a(e).then((({rows:e,total:t})=>{var i,l;this.form=e[0];let o=null==(i=this.form.tagNames)?void 0:i.split(",");this.form.tags=null==(l=this.form.tagIds)?void 0:l.split(",").map(((e,t)=>({tagId:e,name:null==o?void 0:o[t]}))),this.loading=!1})).catch((()=>{this.loading=!1}))},goList(){this.$router.push("list")}}},v=e=>(j("data-v-52e8cffd"),e=e(),b(),e),V=v((()=>g("div",{class:"g-tip"},"素材打开后，该客户将会自动设置以上选择标签",-1))),w=v((()=>g("div",null,"支持jpg/jpeg/png格式，建议200*200",-1))),_={class:"dialog-footer fr mt20"},I={style:{display:"flex","justify-content":"space-around"}};const U=e(y,[["render",function(e,t,i,l,o,a){const s=r("QuillEditor"),j=r("el-form-item"),b=r("el-col"),y=r("el-cascader"),v=r("el-input"),U=r("TagEllipsis"),S=r("el-button"),T=r("SelectTag"),x=r("upload"),q=r("el-row"),z=r("el-form"),k=r("PreviewInPhone"),L=r("el-dialog"),P=m("loading");return d(),p("div",null,[n(z,{ref:"form",model:o.form,rules:o.rules,"label-width":"80px"},{default:u((()=>[n(q,{type:"flex",justify:"space-between"},{default:u((()=>[n(b,{span:18,class:"g-card",style:{"margin-right":"16px","margin-top":"10px"}},{default:u((()=>[n(j,{"label-width":"0px"},{default:u((()=>[n(s,{modelValue:o.form.content,"onUpdate:modelValue":t[0]||(t[0]=e=>o.form.content=e),ref:"myQuillEditor"},null,8,["modelValue"])])),_:1})])),_:1}),n(b,{span:6,class:"g-card"},{default:u((()=>[n(j,{label:"选择分组",prop:"categoryId"},{default:u((()=>[n(y,{modelValue:o.form.categoryId,"onUpdate:modelValue":t[1]||(t[1]=e=>o.form.categoryId=e),options:o.treeData[0].children,props:o.groupProps},null,8,["modelValue","options","props"])])),_:1}),n(j,{label:"文章标题",prop:"materialName"},{default:u((()=>[n(v,{modelValue:o.form.materialName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.form.materialName=e),placeholder:"请输入文章标题",maxlength:30,"show-word-limit":""},null,8,["modelValue"])])),_:1}),n(j,{label:"文章描述"},{default:u((()=>[n(v,{modelValue:o.form.digest,"onUpdate:modelValue":t[3]||(t[3]=e=>o.form.digest=e),type:"textarea",placeholder:"请输入文章描述",maxlength:100,"show-word-limit":""},null,8,["modelValue"])])),_:1}),n(j,{label:"客户标签"},{default:u((()=>[n(U,{list:o.form.tags,limit:"4"},null,8,["list"]),g("div",null,[n(S,{type:"primary",onClick:t[4]||(t[4]=e=>o.dialogVisibleSelectTag=!0)},{default:u((()=>[c("选择标签")])),_:1}),n(T,{visible:o.dialogVisibleSelectTag,"onUpdate:visible":t[5]||(t[5]=e=>o.dialogVisibleSelectTag=e),selected:o.form.tags,onSuccess:t[6]||(t[6]=e=>o.form.tags=e)},null,8,["visible","selected"])]),V])),_:1}),n(j,{label:"文章封面"},{default:u((()=>[n(x,{fileUrl:o.form.coverUrl,"onUpdate:fileUrl":t[7]||(t[7]=e=>o.form.coverUrl=e),imgSize:o.form.memorySize,"onUpdate:imgSize":t[8]||(t[8]=e=>o.form.memorySize=e),type:"0"},{tip:u((()=>[w])),_:1},8,["fileUrl","imgSize"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"]),g("div",_,[n(S,{onClick:a.goList},{default:u((()=>[c("取 消")])),_:1},8,["onClick"]),n(S,{onClick:a.preview},{default:u((()=>[c("预览")])),_:1},8,["onClick"]),h((d(),f(S,{type:"primary",onClick:a.submit},{default:u((()=>[c("确 定")])),_:1},8,["onClick"])),[[P,o.submitLoading]])]),n(L,{title:"文章预览",modelValue:o.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>o.dialogVisible=e),width:"50%"},{default:u((()=>[g("div",I,[n(k,{list:o.mobForm},null,8,["list"]),n(k,{name:o.form.materialName,article:o.form.content},null,8,["name","article"])])])),_:1},8,["modelValue"])])}],["__scopeId","data-v-52e8cffd"]]);export{U as default};
