import{s as e,a as t}from"./vant-b6a5d036.js";import{m as i,n as a,t as s,o,p as r}from"../index-044285d2.js";import{s as l,i as n,a as d}from"./smartForms-eaa9db9a.js";import{R as m,f,i as p}from"./RightPanel-299cad40.js";import g from"./CodeTypeDialog-a4fd582c.js";import h from"./DraggableItem-8beb6ac6.js";import{c as u,V as c,P as y,T as v,U as D,X as I,_ as b,a as L,Z as w,a5 as j,Q as k,ai as N,aq as x,o as C,K as S,a9 as P,$ as V,bl as T,bj as M}from"./@vue-e400fd81.js";import{_ as F}from"./quill-image-resize-module-c051113e.js";import"./@vant-a2ba62fc.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./TreeNodeDialog-1d89ab66.js";import"./IconsDialog-a9f799a3.js";import"./vuedraggable-6f5e6033.js";import"./vue-afbfa742.js";let q,z;const Y={props:["FormIdY","id","type","index","surveyName","ifFormDescription","formDescription","ifFormLogo","logoUrl","unionDomId"],components:{RightPanel:m,CodeTypeDialog:g,DraggableItem:h},data(){return{loading:!0,Ifcontainer:!0,ifEnd:!1,style:"false",formData:{userName:void 0,mobile:""},rules:{userName:[{required:!0,message:"请输入你的姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1(3|4|5|7|8|9)\d{9}$/,message:"手机号格式错误",trigger:"blur"}]},TimeNumber:0,TimeNumberF:null,dataSource:"默认渠道",anTime:"",userIp:"",fromList:{fromLogo:"",formDescription:"",surveyName:""},formId:"",code:"",logo:this.lwConfig.LOGO_DARK,idGlobal:100,formConf:f,inputComponents:p,labelWidth:100,drawingList:[],drawingData:{},activeId:"",drawerVisible:!1,dialogVisible:!1,generateConf:null,showFileName:!1,activeData:[],pageData:[],page:1,unionidN:"",openIdN:"",isMobile:!0}},computed:{cpUnionDomId(){return this.unionDomId||"unionDomId1"}},watch:{surveyName:{handler(e){this.fromList.surveyName=e}},index:{handler(e){this.fromList.visibility=1==e?0:1}},fromLogo:{handler(e){this.fromList.fromLogo=e}},formDescription:{handler(e){this.fromList.formDescription=e}},"activeData.label":function(e,t){void 0!==this.activeData.placeholder&&this.activeData.tag&&q===this.activeId&&(this.activeData.placeholder=this.activeData.placeholder.replace(t,""))},activeId:{handler(e){q=e},immediate:!0},drawingList:{handler(e){this.pageData[this.page-1]=e;for(let i=0;i<this.pageData.length;i++)for(let e=0;e<this.pageData[i].length;e++)this.pageData[i][e].page=i+1,this.pageData[i][e].pageNo=e+1,9==this.pageData[i][e].formCodeId&&this.getProCityListZ(i,e,this.pageData[i][e].defaultValue[2]),10==this.pageData[i][e].formCodeId&&this.formateDate(i,e,this.pageData[i][e].defaultValue);try{localStorage.setItem("pageData",this.pageData)}catch(t){}this.$emit("toStyles",this.drawingList)},deep:!0}},mounted(){this.isMobile=this._isMobile(),this.fromList.surveyName=this.surveyName,this.fromList.visibility=1==this.index?0:1,this.fromList.fromLogo=this.fromLogo,this.fromList.formDescription=this.formDescription,this.dataSource=i("dataSource")||this.dataSource,this.anTime=new Date,this.formId=this.FormIdY||i("formId"),this.style=this.id||i("id")||"y",this.isMobile||"y"==this.style||(this.Ifcontainer=!1),this.formId&&localStorage.setItem("formId",this.formId),"y"==this.style||this.formId||(this.formId=localStorage.getItem("formId")),this.selectInfoToSurvey(),this.pageData[this.page-1]=this.drawingList;for(let e=0;e<this.pageData.length;e++)for(let t=0;t<this.pageData[e].length;t++)this.pageData[e][t].page=e+1,this.pageData[e][t].pageNo=t+1},methods:{deepCopy(e){var t=JSON.stringify(e);return JSON.parse(t)},back(){this.$router.go(-1)},startFillIn(){if("y"!=this.style||1!=this.index){if("y"!=this.style&&1==this.fromList.anAuth&&!this.unionidN)return void e({title:"提示",message:"需要微信授权登录",showCancelButton:!0}).then((()=>{this.getAccessToken()})).catch((()=>{}));this.fromList.visibility=1}},validate(e){let t=this.pageData;for(let i=(e=e||t.length)?e-1:0;i<e;i++)for(let e=0;e<t[i].length;e++){let a=JSON.parse(JSON.stringify(t[i][e]));if(a.required&&![0,1].includes(+a.formCodeId)){let e=a.label.substring(a.label.indexOf(".")+1);if(""===a.defaultValue||void 0===a.defaultValue||0===a.defaultValue.length)return void this.toast(`第${a.page}页,${e}不能为空`);if(4==a.formCodeId){if(a.max&&a.defaultValue>a.max)return void this.toast(`第${a.page}页,${e},数字文本中数字不能大于${a.max}`);if(a.min&&a.defaultValue<a.min)return void this.toast(`第${a.page}页,${e},数字文本中数字不能小于${a.min}`)}let t=p.find((e=>e.formCodeId===a.formCodeId));if(Array.isArray(t.regList)&&0!=t.regList.length){if(!t.regList.every((t=>!!a.defaultValue.match(t.pattern)||(this.toast(`第${a.page}页,${e},${t.message}`),!1))))return}}}return!0},async submit(){if(!this.validate())return;try{this.userIp=this.userIp||await a()}catch(r){return void this.toast("获取ip失败")}let e=[],t=this.pageData;for(let a=0;a<t.length;a++)for(let i=0;i<t[a].length;i++){let s=t[a][i];if(![0,1].includes(+s.formCodeId)){let t=JSON.parse(JSON.stringify(s));if(t.questionNumber=e.length,e.push(t),11==s.formCodeId?this.formData.userName=s.defaultValue:5==s.formCodeId?this.formData.mobile=s.defaultValue:[6,7,8,9].includes(+t.formCodeId)?(t.formId=this.formId,9==t.formCodeId?(t.defaultValue+="",t.options=[]):t.options=t.options.map((e=>e.label)).join(",")):10==s.formCodeId&&(s.timeS=this.formateDate(a,s.defaultValue,s)),8==t.formCodeId&&Array.isArray(t.defaultValue))if(1===t.defaultValue.length)t.defaultValue+="";else{let i=t.defaultValue.slice();for(let a=0;a<i.length;a++)if(0==a)t.defaultValue=i[a]+"";else{let s=this.deepCopy(t);s.defaultValue=i[a]+"",e.push(s)}}}}let i=this.fromList.channelsName.split(","),s=this.fromList.channelsPath.split(",");for(let a=0;a<i.length;a++){if(s[a]==this.dataSource){this.dataSource=i[a];break}if(this.clannelsName==this.dataSource&&"默认渠道"!=i[a])break}let o={mobile:this.formData.mobile,name:this.formData.userName,anTime:this.anTime,totalTime:(new Date).getTime()-new Date(this.anTime).getTime(),ipAddr:this.userIp,belongId:this.formId,anEffective:0,dataSource:this.dataSource,quNum:e.length,answer:JSON.stringify(e)};"y"!=this.style&&"q"!=this.style?(this.unionidN&&(o.unionId=this.unionidN),this.openIdN&&(o.openId=this.openIdN),this.loading=!0,l(o).then((e=>{200==e.code?this.ifEnd=!0:this.toast(e.msg)})).finally((()=>{this.loading=!1}))):this.toast("预览情况下，不能提交")},formateDate(e,t,i){if(!i)return;let a=new Date(t).getTime();const s=new Date(a),o=s.getFullYear()+"-",r=(s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1)+"-",l=(s.getDate()<10?"0"+s.getDate():s.getDate())+"  ",n=s.getHours()<10?"0"+s.getHours():s.getHours(),d=s.getMinutes()<10?":0"+s.getMinutes():":"+s.getMinutes(),m=s.getSeconds()<10?":0"+s.getSeconds():":"+s.getSeconds();let f;return"YYYY-MM-DD"==i.format?f=o+r+l:"YYYY-MM-DD HH:mm"==i.format?f=o+r+l+n+d:"YYYY-MM-DD HH:mm:ss"==i.format&&(f=o+r+l+n+d+m),f},async getProCityListZ(e,t,i){if(i){if(!z){let e=s(await o(),"children",((e,t,i)=>{let a=t.find((t=>t.id==e.parentId));e.level=i,e.treeNames=(a?(a.treeNames||a.name)+"/":"")+e.name}));z=e.filter((e=>2==e.level))}z?this.pageData[e][t].ssq=z.find((e=>e.id==i)).treeNames:this.toast("获取省市区数据失败，请稍后再试")}},getAccessToken(){i("code")||(this.formId?localStorage.setItem("formId",this.formId):localStorage.removeItem("formId")),r().then((e=>{this.loading=!1,this.unionidN=e.unionId,this.openIdN=e.openId,this.formData.userName=e.nickName,this.isCompleteSurveyF()}))},isCompleteSurveyF(){let e={belongId:this.formId,openId:this.openIdN,dataSource:this.dataSource};2!=this.fromList.fillingRules&&(1==this.fromList.fillingRules&&(e.createTime=new Date),n(e).then((e=>{1==(null==e?void 0:e.data)&&(this.ifEnd=!0)})))},_isMobile:()=>navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),async selectInfoToSurvey(){let t=this;if(this.formId){if(!["y","q"].includes(this.style))try{this.userIp=this.userIp||await a()}catch(i){return void this.toast("获取ip失败")}d(this.formId,this.userIp,this.dataSource).then((i=>{if(200==i.code){t.fromList=i.data;let a=t.fromList.channelsName.split(","),s=t.fromList.channelsPath.split(",");for(let e=0;e<a.length;e++){if(s[e]==t.dataSource){t.dataSource=a[e];break}if(t.clannelsName==t.dataSource&&"默认渠道"!=a[e])break}if(i.data.timingStart){let e=new Date(i.data.timingStart);new Date<e&&(t.fromList.surveyState=0)}if(i.data.timingEnd){let e=new Date(i.data.timingEnd);new Date>e&&(t.fromList.surveyState=3)}let o=JSON.parse(i.data.styles);if(t.pageData=[[]],"y"!=t.style&&"q"!=t.style){let i={0:"当前问卷暂未开放回收，暂时无法填写。",2:"当前问卷已暂停回收，暂时无法填写。",3:"当前问卷已结束回收，无法填写。"};if(Object.keys(i).includes(t.fromList.surveyState+""))return this.loading=!1,void e({title:"提示",message:i[t.fromList.surveyState],confirmButtonText:"我知道了"}).then((()=>{}))}let r=1;for(let e=0;e<o.length;e++)o[e][0].page==r?t.pageData[e]=o[e]:(r++,t.pageData[r-1]=o[e]);if(t.drawingList=this.pageData[this.page-1],t.$forceUpdate(),t.activeData=t.drawingList[0],1==t.fromList.anAuth){if("y"==t.style||"q"==t.style)return void(this.loading=!1);t.getAccessToken()}else if(this.loading=!1,1==t.fromList.visibility&&("y"==t.style||"q"==t.style))return}else e(i.msg)}))}else this.loading=!1},dePage(){this.page--,this.drawingList=this.pageData[this.page-1]},addPage(){this.validate(this.page)&&(this.page++,this.drawingList=this.pageData[this.page-1])},toast(e){t({message:e,teleport:"#"+this.cpUnionDomId})}}},$=e=>(T("data-v-97bdaf54"),e=e(),M(),e),E=["id"],O={style:{display:"flex","justify-content":"center","margin-top":"30px"}},A={key:0,class:"form-logo",style:{}},_={key:0,class:"ac mt20",style:{"font-size":"20px","font-weight":"700"}},U={key:1,style:{"font-size":"16px",padding:"30px 30px 0","line-height":"20px"}},J={key:2,style:{padding:"15px","margin- top":"10px"}},B={key:3},H={key:0},R={key:1,style:{padding:"15px",position:"relative"}},W=$((()=>L("div",{style:{color:"transparent",position:"relative",top:"500px"}},[L("span",{style:{color:"transparent",position:"relative",top:"500px"}},"1")],-1))),K={key:2,style:{padding:"1rem",position:"relative",top:"0.5rem"}},Q={key:3,style:{padding:"1rem",position:"relative",top:"0.5rem"}},Z={key:4,style:{padding:"1rem",position:"relative",top:"0.5rem"}},G={key:5,style:{padding:"1rem",position:"relative",top:"0.5rem",display:"flex","justify-content":"space-between"}},X={key:1,class:"container"},ee={key:0,style:{display:"flex","justify-content":"center","margin-top":"30px"}},te={key:1,class:"ac mt20"},ie={style:{"font-size":"20px","font-weight":"700"}},ae={key:2,style:{"font-size":"16px",padding:"30px 30px 0","line-height":"20px"}},se={key:3,style:{padding:"15px","margin- top":"8px"}},oe={key:4},re=$((()=>L("div",{style:{color:"transparent","margin-top":"50px"}},"1",-1))),le={key:0,style:{padding:"1rem",position:"relative",top:"0.5rem"}},ne={key:1,style:{padding:"1rem",position:"relative",top:"0.5rem"}},de={key:2,style:{padding:"1rem",position:"relative",top:"0.5rem"}},me=[$((()=>L("div",{class:"formDetailPush"},"您已完成填写",-1)))],fe={key:3,style:{padding:"1rem",position:"relative",top:"0.5rem"}},pe={key:4,style:{padding:"1rem",position:"relative",top:"0.5rem",display:"flex","justify-content":"space-between"}},ge={key:5,style:{"text-align":"center",margin:"100px 0 10px",color:"#2aa515"}},he=$((()=>L("div",{style:{"font-size":"24px","margin-top":"30px","font-weight":"700"}},"您已完成填写",-1)));const ue=F(Y,[["render",function(e,t,i,a,s,o){const r=N("el-image"),l=N("DraggableItem"),n=N("el-form"),d=N("el-input"),m=N("el-form-item"),f=N("phone-template"),p=N("el-icon-SuccessFilled"),g=x("loading");return C(),u("div",{style:k(s.Ifcontainer?"height: 100%;":"background:#666;display: flex;justify-content: center;height: 100%;")},[c((C(),u("div",{class:y(s.Ifcontainer?"container":"container containerPC"),"data-title":"调查问卷",id:o.cpUnionDomId},["y"==s.style&&s.fromList?(C(),v(f,{key:0,style:{margin:"0 auto"},title:s.fromList.surveyName},{default:D((()=>[L("div",O,[!i.ifFormLogo||s.formId||s.fromList.formLogo?I("",!0):(C(),u(S,{key:0},[i.logoUrl?(C(),v(r,{key:1,fit:"cover",src:i.logoUrl,class:"form-logo"},null,8,["src"])):(C(),u("div",A,"Logo"))],64)),s.fromList.formLogo?(C(),v(r,{key:1,fit:"cover",src:s.fromList.formLogo,class:"form-logo"},null,8,["src"])):I("",!0)]),s.fromList.surveyName?(C(),u("div",_,w(s.fromList.surveyName),1)):I("",!0),s.fromList.formDescription?(C(),u("div",U,w(s.fromList.formDescription),1)):I("",!0),0==s.fromList.visibility?(C(),u("div",J,[L("div",{onClick:t[0]||(t[0]=j((e=>o.startFillIn()),["stop"])),class:"formDetailPush"},"开始填写")])):I("",!0),1==s.fromList.visibility&&0!=s.fromList.surveyState&&2!=s.fromList.surveyState&&3!=s.fromList.surveyState||1==s.fromList.visibility&&"y"==s.style?(C(),u("div",B,[0!=s.drawingList.length?(C(),u("div",H,[b(n,{size:s.formConf.size,"label-position":s.formConf.labelPosition,"label-width":s.formConf.labelWidth+"px"},{default:D((()=>[(C(!0),u(S,null,P(s.drawingList,((e,t)=>c((C(),v(l,{key:e.renderKey,"drawing-list":s.drawingList,element:e,index:t,"active-id":s.activeId,"form-conf":s.formConf},null,8,["drawing-list","element","index","active-id","form-conf"])),[[V,0!=e.formCodeId]]))),128))])),_:1},8,["size","label-position","label-width"])])):I("",!0),0==s.drawingList.length&&s.fromList.surveyName?(C(),u("div",R,[b(n,{ref:"elForm",model:s.formData,rules:s.rules,"label-width":"100px","label-position":"top"},{default:D((()=>[W,b(m,{label:"姓名",prop:"userName"},{default:D((()=>[b(d,{modelValue:s.formData.userName,"onUpdate:modelValue":t[1]||(t[1]=e=>s.formData.userName=e),placeholder:"请输入你的姓名",clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),b(m,{label:"手机号",prop:"mobile"},{default:D((()=>[b(d,{modelValue:s.formData.mobile,"onUpdate:modelValue":t[2]||(t[2]=e=>s.formData.mobile=e),placeholder:"请输入手机号",maxlength:11,"show-word-limit":"",clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])):I("",!0),s.page==s.pageData.length&&1!=s.page?(C(),u("div",K,[L("div",{onClick:t[3]||(t[3]=(...e)=>o.dePage&&o.dePage(...e)),class:"formDetailPush"},"上一页")])):I("",!0),s.page==s.pageData.length?(C(),u("div",Q,[L("div",{onClick:t[4]||(t[4]=j((e=>o.submit()),["stop"])),class:"formDetailPush"},"确认提交")])):I("",!0),s.page!=s.pageData.length&&1==s.page?(C(),u("div",Z,[L("div",{onClick:t[5]||(t[5]=(...e)=>o.addPage&&o.addPage(...e)),class:"formDetailPush"},"下一页")])):I("",!0),s.page!=s.pageData.length&&1!=s.page?(C(),u("div",G,[L("div",{onClick:t[6]||(t[6]=(...e)=>o.dePage&&o.dePage(...e)),style:{width:"45%"},class:"formDetailPush"},"上一页"),L("div",{onClick:t[7]||(t[7]=(...e)=>o.addPage&&o.addPage(...e)),style:{width:"45%"},class:"formDetailPush"},"下一页")])):I("",!0)])):I("",!0)])),_:1},8,["title"])):I("",!0),"y"!=s.style&&0!=s.drawingList.length?(C(),u("div",X,[s.fromList.formLogo&&!s.ifEnd?(C(),u("div",ee,[b(r,{fit:"cover",src:s.fromList.formLogo,class:"form-logo"},null,8,["src"])])):I("",!0),s.fromList.surveyName?(C(),u("div",te,[L("span",ie,w(s.fromList.surveyName),1)])):I("",!0),s.fromList.formDescription&&!s.ifEnd?(C(),u("div",ae,w(s.fromList.formDescription),1)):I("",!0),0!=s.fromList.visibility||s.ifEnd?I("",!0):(C(),u("div",se,[L("div",{onClick:t[8]||(t[8]=j((e=>o.startFillIn()),["stop"])),class:"formDetailPush"},"开始填写")])),1!=s.fromList.visibility||s.ifEnd?I("",!0):(C(),u("div",oe,[b(n,{size:s.formConf.size,"label-position":s.formConf.labelPosition,"label-width":s.formConf.labelWidth+"px"},{default:D((()=>[(C(!0),u(S,null,P(s.drawingList,((e,t)=>(C(),u("div",{key:e.renderKey},[c(b(l,{"drawing-list":s.drawingList,element:e,index:t,"active-id":s.activeId,"form-conf":s.formConf},null,8,["drawing-list","element","index","active-id","form-conf"]),[[V,0!=e.formCodeId]]),c(L("div",{style:{padding:"10px","padding-bottom":"0"}},w(e.defaultValue),513),[[V,0==e.formCodeId]])])))),128))])),_:1},8,["size","label-position","label-width"]),re,L("div",null,[s.page==s.pageData.length&&1!=s.page?(C(),u("div",le,[L("div",{onClick:t[9]||(t[9]=(...e)=>o.dePage&&o.dePage(...e)),class:"formDetailPush"},"上一页")])):I("",!0),s.page!=s.pageData.length||s.ifEnd?I("",!0):(C(),u("div",ne,[L("div",{onClick:t[10]||(t[10]=j((e=>o.submit()),["stop"])),class:"formDetailPush"},"确认提交")])),s.page==s.pageData.length&&s.ifEnd?(C(),u("div",de,me)):I("",!0),s.page!=s.pageData.length&&1==s.page?(C(),u("div",fe,[L("div",{onClick:t[11]||(t[11]=(...e)=>o.addPage&&o.addPage(...e)),class:"formDetailPush"},"下一页")])):I("",!0),s.page!=s.pageData.length&&1!=s.page?(C(),u("div",pe,[L("div",{onClick:t[12]||(t[12]=(...e)=>o.dePage&&o.dePage(...e)),style:{width:"45%"},class:"formDetailPush"},"上一页"),L("div",{onClick:t[13]||(t[13]=(...e)=>o.addPage&&o.addPage(...e)),style:{width:"45%"},class:"formDetailPush"},"下一页")])):I("",!0)])])),s.ifEnd?(C(),u("div",ge,[b(p,{class:"el-icon-SuccessFilled",style:{"font-size":"150px"}}),he])):I("",!0)])):I("",!0)],10,E)),[[g,s.loading]])],4)}],["__scopeId","data-v-97bdaf54"]]);export{ue as default};
