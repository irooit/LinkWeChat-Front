import{g as e,c as t,o as l,l as i,b as a}from"./liveBroadcast-636e81cb.js";import{d as o}from"../index-044285d2.js";import{_ as r}from"./quill-image-resize-module-c051113e.js";import{ai as s,aq as n,o as d,c as u,_ as c,U as p,K as m,a9 as h,T as g,Y as y,a as f,V as v,Z as w,X as b}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const j={class:"g-card"},k={class:"mid-action"},x={class:"bottom"};const C=r({data:()=>({freshLoadng:!1,exportLoading:!1,userArray:[],qrUserName:void 0,query:{pageNum:1,pageSize:10,liveWeUserid:void 0},dialogVisible:!1,dateRange:[],loading:!1,list:[],total:0,status:[{value:0,label:"预约中"},{value:1,label:"直播中"},{value:2,label:"已结束"},{value:3,label:"已过期"},{value:4,label:"已取消"}]}),created(){this.getList(),this.$store.setBusininessDesc("\n      <div>创建企业的预约直播，用于员工内部培训或外部产品宣讲直播</div>\n    ")},methods:{getList(t){t&&(this.query.pageNum=t),this.loading=!0,this.query.beginTime=this.dateRange[0],this.query.endTime=this.dateRange[1],e(this.query).then((({rows:e,total:t})=>{this.list=e,this.total=+t,this.loading=!1})).catch((()=>{this.loading=!1}))},resetQuery(){let e=this.query.pageSize;this.userArray=[],this.qrUserName="",this.dateRange=[],this.query={},this.query.pageNum=1,this.query.pageSize=e,this.getList()},getSelectUser(e){this.userArray=e,this.qrUserName=this.userArray.map((function(e,t){return e.name})).join(","),this.query.liveWeUserid=this.userArray.map((function(e,t){return e.userId})).join(",")},coverContent:e=>(e&&e.length>20&&(e=e.substr(0,20)+"..."),e),copyURL(e){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{document.execCommand("copy"),this.$message.success("链接复制成功，请在微信中打开")}catch(l){return this.$message.error("链接复制失败"),!1}finally{document.body.removeChild(t)}},goAdd(){this.$router.push({path:"add"})},goEdit(e){this.$router.push({path:"add",query:{id:e}})},goDetail(e){this.$router.push({path:"detail",query:{id:e}})},cancelLive(e){this.$confirm("是否确认取消当前直播？取消后不可撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>t({id:e}))).then((()=>{this.getList(),this.msgSuccess("取消成功")}))},shareCount(e){this.$router.push({path:"share",query:{id:e}})},refresh(){this.freshLoadng=!0,l().then((e=>{200===e.code&&(this.getList(),this.freshLoadng=!1)})).catch((()=>{this.freshLoadng=!1}))},remove(e){this.$confirm("是否确认删除此条直播数据？删除后不可撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>i(e))).then((()=>{this.getList(),this.msgSuccess("删除成功")}))},exportFn(){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,a()))).then((e=>{if(!e)return;const t=new Blob([e],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(t,"咨询记录");else{const e=URL.createObjectURL(t),l=document.createElement("a");l.style.display="none",l.href=e,l.download=o(new Date,"YYYY-MM-DD")+"_直播列表.xlsx",l.click(),URL.revokeObjectURL(l.href)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},dealState(e){switch(e){case 0:return"预约中";case 1:return"直播中";case 2:return"已结束";case 3:return"已过期";case 4:return"已取消"}}}},[["render",function(e,t,l,i,a,o){const r=s("el-input"),C=s("el-form-item"),q=s("el-option"),S=s("el-select"),U=s("el-date-picker"),_=s("el-button"),L=s("el-form"),V=s("el-table-column"),R=s("el-table"),D=s("pagination"),T=s("SelectUser"),B=n("loading");return d(),u("div",null,[c(L,{"label-position":"left",inline:"","label-width":"80px",class:"top-search"},{default:p((()=>[c(C,{"label-width":"0",prop:"qrUserName"},{default:p((()=>[c(r,{"model-value":a.qrUserName,readonly:"",onClick:t[0]||(t[0]=e=>a.dialogVisible=!0),placeholder:"请选择直播成员"},null,8,["model-value"])])),_:1}),c(C,{"label-width":"0"},{default:p((()=>[c(S,{modelValue:a.query.liveState,"onUpdate:modelValue":t[1]||(t[1]=e=>a.query.liveState=e),placeholder:"请选择直播状态"},{default:p((()=>[(d(!0),u(m,null,h(a.status,(e=>(d(),g(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),c(C,{"label-width":"0"},{default:p((()=>[c(r,{placeholder:"请输入直播标题",modelValue:a.query.liveTitle,"onUpdate:modelValue":t[2]||(t[2]=e=>a.query.liveTitle=e),style:{width:"260px"}},null,8,["modelValue"])])),_:1}),c(C,{"label-width":"0"},{default:p((()=>[c(U,{modelValue:a.dateRange,"onUpdate:modelValue":t[3]||(t[3]=e=>a.dateRange=e),type:"datetimerange",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm","start-placeholder":"预约开始时间","end-placeholder":"预约结束时间",style:{width:"260px"}},null,8,["modelValue"])])),_:1}),c(C,{"label-width":"0"},{default:p((()=>[c(_,{type:"primary",onClick:t[4]||(t[4]=e=>o.getList(0))},{default:p((()=>[y("查询")])),_:1}),c(_,{onClick:o.resetQuery},{default:p((()=>[y("重置")])),_:1},8,["onClick"])])),_:1})])),_:1}),f("div",j,[f("div",k,[f("div",null,[c(_,{type:"primary",onClick:o.goAdd},{default:p((()=>[y("新建预约直播")])),_:1},8,["onClick"]),c(_,{type:"primary",onClick:o.refresh,loading:a.freshLoadng},{default:p((()=>[y("同步直播状态")])),_:1},8,["onClick","loading"])]),c(_,{style:{"align-self":"flex-end"},type:"primary",plain:"",loading:a.exportLoading,onClick:o.exportFn},{default:p((()=>[y(" 导出 Excel ")])),_:1},8,["loading","onClick"])]),v((d(),g(R,{data:a.list},{default:p((()=>[c(V,{label:"直播成员",prop:"liveUserName",align:"center"}),c(V,{label:"直播标题",align:"center","min-width":"120","show-overflow-tooltip":""},{default:p((e=>[y(w(o.coverContent(e.row.liveTitle)),1)])),_:1}),c(V,{label:"所属部门",align:"center","min-width":"100","show-overflow-tooltip":""},{default:p((e=>[y(w(o.coverContent(e.row.deptName)),1)])),_:1}),c(V,{label:"直播状态",align:"center","show-overflow-tooltip":""},{default:p((e=>[y(w(o.dealState(e.row.liveState)),1)])),_:1}),c(V,{label:"预约开始时间",align:"center"},{default:p((e=>[y(w(e.row.liveStartDate+" "+e.row.liveStartTime),1)])),_:1}),c(V,{label:"预约持续时间",align:"center",prop:"livingDurationDesc"}),c(V,{label:"创建人",align:"center",prop:"createBy"}),c(V,{label:"创建时间",align:"center",prop:"createTime"}),c(V,{label:"操作",align:"center",fixed:"right",width:"300"},{default:p((e=>[[0,1].includes(e.row.liveState)?(d(),g(_,{key:0,text:"",onClick:t=>o.copyURL(e.row.shareOrJoinUrl)},{default:p((()=>[y(" 分享直播 ")])),_:2},1032,["onClick"])):b("",!0),[1].includes(e.row.liveState)?(d(),g(_,{key:1,text:"",onClick:t=>o.copyURL(e.row.shareOrJoinUrl)},{default:p((()=>[y(" 进入直播 ")])),_:2},1032,["onClick"])):b("",!0),[2].includes(e.row.liveState)&&0===e.row.replayStatus&&1===e.row.openReplay?(d(),g(_,{key:2,text:"",onClick:t=>o.copyURL(e.row.shareOrJoinUrl)},{default:p((()=>[y(" 查看回放 ")])),_:2},1032,["onClick"])):b("",!0),c(_,{text:"",onClick:t=>o.shareCount(e.row.id)},{default:p((()=>[y("分享统计")])),_:2},1032,["onClick"]),[0].includes(e.row.liveState)?(d(),g(_,{key:3,text:"",onClick:t=>o.goEdit(e.row.id)},{default:p((()=>[y("修改直播")])),_:2},1032,["onClick"])):b("",!0),[0].includes(e.row.liveState)?(d(),g(_,{key:4,text:"",onClick:t=>o.cancelLive(e.row.id)},{default:p((()=>[y(" 取消直播 ")])),_:2},1032,["onClick"])):b("",!0),[1,2].includes(e.row.liveState)?(d(),g(_,{key:5,text:"",onClick:t=>o.goDetail(e.row.id)},{default:p((()=>[y(" 直播详情 ")])),_:2},1032,["onClick"])):b("",!0),[2,3,4].includes(e.row.liveState)?(d(),g(_,{key:6,text:"",onClick:t=>o.remove(e.row.id)},{default:p((()=>[y(" 删除 ")])),_:2},1032,["onClick"])):b("",!0)])),_:1})])),_:1},8,["data"])),[[B,a.loading]]),f("div",x,[c(D,{total:a.total,page:a.query.pageNum,"onUpdate:page":t[5]||(t[5]=e=>a.query.pageNum=e),limit:a.query.pageSize,"onUpdate:limit":t[6]||(t[6]=e=>a.query.pageSize=e),onPagination:t[7]||(t[7]=e=>o.getList())},null,8,["total","page","limit"])])]),c(T,{visible:a.dialogVisible,"onUpdate:visible":t[8]||(t[8]=e=>a.dialogVisible=e),title:"组织架构",defaultValues:a.userArray,onSuccess:o.getSelectUser,isSigleSelect:!0},null,8,["visible","defaultValues","onSuccess"])])}]]);export{C as default};
