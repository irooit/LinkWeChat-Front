import{g as e,n as t,r as l}from"./pullNews-68e01d94.js";import{S as o}from"./ShowTag-d66e41cb.js";import{ai as a,aq as i,o as r,c as n,_ as s,U as d,K as p,a9 as u,T as c,Y as m,a as h,V as g,Z as f,$ as b,bl as y,bj as w}from"./@vue-e400fd81.js";import{_ as j}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const C={components:{ShowTag:o},data:()=>({query:{pageNum:1,pageSize:10,qrName:"",type:""},options:[{value:"1",label:"红包拉新"},{value:"2",label:"卡券拉新"}],loading:!1,searchDate:"",multiGroupCode:[],groupCodes:[],total:0,clipboard:null,showSelectTag:!1,tagIndex:1,loading:!1}),watch:{searchDate:{deep:!0,handler(e){e&&2===e.length?[this.query.beginTime,this.query.endTime]=e:(this.query.beginTime="",this.query.endTime="")}}},mounted(){this.clipboard=new this.ClipboardJS(".copy-btn")},created(){this.getGroupCodes(),this.$store.setBusininessDesc("\n        <div>通过红包、卡券等方式吸引新客户扫码添加</div>\n      ")},unmounted(){this.clipboard.destroy()},methods:{getGroupCodes(){const t=Object.assign({},this.query);this.loading=!0,e(t).then((e=>{200===e.code&&(this.groupCodes=e.rows,this.total=parseInt(e.total)),this.loading=!1})).catch((()=>{this.loading=!1}))},handleSearch(){this.getGroupCodes()},resetQuery(){this.$refs.queryForm.resetFields(),this.$nextTick((()=>{this.getGroupCodes()}))},handleBulkDownload(){this.multiGroupCode.map((e=>e.id)),this.$confirm("是否确认下载所有图片吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>t())).then((e=>{if(null!=e){let t=new Blob([e],{type:"application/zip"}),l=window.URL.createObjectURL(t);const o=document.createElement("a");o.href=l,o.download="批量群活码.zip",o.click(),URL.revokeObjectURL(l)}})).catch((function(){}))},handleBulkRemove(){this.$confirm("确认删除当前拉新活码?删除操作无法撤销，请谨慎操作。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.multiGroupCode.map((e=>e.id));l(e+"").then((e=>{200===e.code&&this.getGroupCodes()}))})).catch((()=>{}))},handleDownload(e,t){let l=t+".png";this.downloadByBlob(e,l)},downloadByBlob(e,t){let l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=e,l.onload=()=>{let e=document.createElement("canvas");e.width=l.width,e.height=l.height,e.getContext("2d").drawImage(l,0,0,l.width,l.height),e.toBlob((e=>{let l=URL.createObjectURL(e);this.downloadFn(l,t),URL.revokeObjectURL(l)}))}},downloadFn(e,t){let l=document.createElement("a");l.download=t,l.href=e,l.click(),l.remove()},handleRemove(e){this.$confirm("确认删除当前拉新活码?删除操作无法撤销，请谨慎操作。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l(e).then((e=>{200===e.code&&this.getGroupCodes()}))})).catch((()=>{}))},handleSelectionChange(e){this.multiGroupCode=e}}},v=e=>(y("data-v-97e0e230"),e=e(),w(),e),_={class:"g-card"},q={class:"fxbw"},k=v((()=>h("div",null,"通过当前活码新增的客户总数",-1))),x=v((()=>h("div",null,"新增客户领取的红包/卡券总数",-1)));const U=j(C,[["render",function(e,t,l,o,y,w){const j=a("el-input"),C=a("el-form-item"),v=a("el-option"),U=a("el-select"),B=a("el-button"),T=a("el-form"),S=a("el-table-column"),G=a("el-image"),R=a("el-popover"),N=a("el-icon-QuestionFilled"),F=a("el-icon-MoreFilled"),$=a("el-dropdown-item"),z=a("el-dropdown-menu"),L=a("el-dropdown"),I=a("el-table"),D=a("pagination"),O=i("loading");return r(),n("div",null,[s(T,{ref:"queryForm",model:y.query,inline:"",class:"top-search","label-position":"left","label-width":"80px"},{default:d((()=>[s(C,{"label-width":"0",prop:"qrName"},{default:d((()=>[s(j,{clearable:"",modelValue:y.query.qrName,"onUpdate:modelValue":t[0]||(t[0]=e=>y.query.qrName=e),placeholder:"请输入活码名称"},null,8,["modelValue"])])),_:1}),s(C,{"label-width":"0",prop:"type"},{default:d((()=>[s(U,{modelValue:y.query.type,"onUpdate:modelValue":t[1]||(t[1]=e=>y.query.type=e),placeholder:"请选择拉新方式"},{default:d((()=>[(r(!0),n(p,null,u(y.options,(e=>(r(),c(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(C,{label:""},{default:d((()=>[s(B,{type:"primary",onClick:w.handleSearch},{default:d((()=>[m("查询")])),_:1},8,["onClick"]),s(B,{type:"",onClick:w.resetQuery},{default:d((()=>[m("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),h("div",_,[h("div",q,[s(B,{type:"primary",onClick:t[2]||(t[2]=t=>e.$router.push("/drainageCode/qrCode/pullNews/add"))},{default:d((()=>[m("新建活码")])),_:1}),h("div",null,[s(B,{type:"primary",plain:"",disabled:0===y.multiGroupCode.length,onClick:w.handleBulkRemove},{default:d((()=>[m(" 批量删除 ")])),_:1},8,["disabled","onClick"])])]),g((r(),c(I,{data:y.groupCodes,onSelectionChange:w.handleSelectionChange},{default:d((()=>[s(S,{type:"selection",width:"55",align:"center"}),s(S,{prop:"name",label:"活码名称",align:"center"}),s(S,{prop:"type",label:"拉新方式",align:"center"},{default:d((({row:e})=>[m(f(1===e.type?"红包拉新":"卡券拉新"),1)])),_:1}),s(S,{prop:"imageUrl",label:"二维码",align:"center",width:"130"},{default:d((({row:e})=>[s(R,{placement:"bottom",trigger:"hover"},{reference:d((()=>[s(G,{src:e.imageUrl,class:"code-image--small"},null,8,["src"])])),default:d((()=>[s(G,{src:e.imageUrl,class:"code-image"},null,8,["src"])])),_:2},1024)])),_:1}),s(S,{prop:"scanNum",width:"160px",label:"新增客户总数",align:"center"},{header:d((()=>[s(R,{placement:"top",trigger:"hover"},{reference:d((()=>[h("div",null,[m(" 新增客户总数 "),s(N,{class:"el-icon-QuestionFilled"})])])),default:d((()=>[k])),_:1})])),_:1}),s(S,{prop:"receiveNum",width:"160px",label:"新客领取总数",align:"center"},{header:d((()=>[s(R,{placement:"top",trigger:"hover"},{reference:d((()=>[h("div",null,[m(" 新客领取总数 "),s(N,{class:"el-icon-QuestionFilled"})])])),default:d((()=>[x])),_:1})])),_:1}),s(S,{prop:"createBy",label:"创建人",align:"center"}),s(S,{prop:"updateTime",label:"最近操作时间",align:"center",width:"200"}),s(S,{label:"操作",align:"center",width:"180",fixed:"right"},{default:d((({row:t})=>[s(B,{text:"",onClick:l=>e.$router.push({path:"detail",query:{groupId:t.id}})},{default:d((()=>[m(" 详情|统计 ")])),_:2},1032,["onClick"]),s(B,{text:"",onClick:e=>w.handleDownload(t.imageUrl,t.name)},{default:d((()=>[m("下载")])),_:2},1032,["onClick"]),s(B,{text:"",class:"copy-btn","data-clipboard-text":t.imageUrl},{default:d((()=>[m("复制")])),_:2},1032,["data-clipboard-text"]),s(L,{style:{"margin-left":"10px"}},{dropdown:d((()=>[s(z,null,{default:d((()=>[s($,null,{default:d((()=>[s(B,{text:"",onClick:l=>e.$router.push({path:"add",query:{groupCodeId:t.id}})},{default:d((()=>[m(" 编辑 ")])),_:2},1032,["onClick"])])),_:2},1024),s($,null,{default:d((()=>[s(B,{text:"",onClick:e=>w.handleRemove(t.id)},{default:d((()=>[m("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:d((()=>[s(B,{text:""},{default:d((()=>[s(F,{class:"el-icon-MoreFilled"})])),_:1})])),_:2},1024)])),_:1})])),_:1},8,["data","onSelectionChange"])),[[O,y.loading]]),g(s(D,{total:y.total,page:y.query.pageNum,"onUpdate:page":t[3]||(t[3]=e=>y.query.pageNum=e),limit:y.query.pageSize,"onUpdate:limit":t[4]||(t[4]=e=>y.query.pageSize=e),onPagination:w.getGroupCodes},null,8,["total","page","limit","onPagination"]),[[b,y.total>0]])])])}],["__scopeId","data-v-97e0e230"]]);export{U as default};
