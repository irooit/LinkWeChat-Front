import{_ as e}from"../index-044285d2.js";import{g as t}from"./group-e56f61ac.js";import{_ as a}from"./quill-image-resize-module-c051113e.js";import{aU as s,ai as l,aq as r,V as i,o,c as p,a as n,_ as u,U as m,Y as d,T as h,R as g,X as y,K as c,a9 as b}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const C={name:"",components:{ChartLine:s((()=>e((()=>import("./ChartLine-b009fc4d.js")),["assets/js/ChartLine-b009fc4d.js","assets/js/echarts-8e7b9cd7.js","assets/js/tslib-a4e99503.js","assets/js/zrender-da4e2cf7.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css","assets/js/lodash.merge-f1a4e0c2.js","assets/css/ChartLine-9d5ca891.css"]))),ChartBar:s((()=>e((()=>import("./ChartBar-39a01942.js")),["assets/js/ChartBar-39a01942.js","assets/js/echarts-8e7b9cd7.js","assets/js/tslib-a4e99503.js","assets/js/zrender-da4e2cf7.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css","assets/js/lodash.merge-f1a4e0c2.js","assets/css/ChartBar-e0d67a11.css"])))},props:{type:{type:String,default:""},legend:{type:[Array,String],default:null},request:{type:Function,default:()=>{}},requestExport:{type:Function,default:()=>{}},option:{type:Object,default:null}},data:()=>({loading:!1,timeRange:7,total:0,list:[],xData:[],series:[],legendDict:{customerTotalChart:["客群总数"],customerTotalChart:["客群总数"]},dateRange:[],query:{pageNum:void 0,pageSize:void 0,deptIds:[],userIds:[],chatIds:[],ownerIds:[],beginTime:void 0,endTime:void 0},groupChats:[],tableProps:{customerTotalTable:[{prop:"xtime",label:"日期"},{prop:"totalCnt",label:"客户总数"},{prop:"addCnt",label:"新增客户数"},{prop:"lostCnt",label:"流失客户数"},{prop:"netCnt",label:"净增客户数"},{prop:"applyCnt",label:"昨日发送申请数"}],customerGroupTotalTable:[{prop:"xtime",label:"日期"},{prop:"totalCnt",label:"客群总数"},{prop:"addCnt",label:"新增客群数"},{prop:"dissolveCnt",label:"解散客群数"}],customerGroupMemberTotalTable:[{prop:"xtime",label:"日期"},{prop:"totalCnt",label:"客群成员总数"},{prop:"addCnt",label:"新增客群成员数"},{prop:"quitCnt",label:"流失客群成员数"}],customerContactTable:[{prop:"xtime",label:"日期"},{prop:"chatCnt",label:"单聊总数"},{prop:"messageCnt",label:"发送消息数"},{prop:"replyPercentage",label:"已回复聊天占比"},{prop:"avgReplyTime",label:"平均回复时长(分)"}],customerGroupContactTable:[{prop:"xtime",label:"日期"},{prop:"chatTotal",label:"群聊总数"},{prop:"msgTotal",label:"群聊消息数"},{prop:"memberHasMsg",label:"发送消息群成员数"}]},userArray:[],dialogVisible:!1,dialogType:"_users"}),computed:{},watch:{},created(){this.setTime(7)},mounted(){},methods:{getList(e){this.type.includes("Table")&&(this.query.pageSize||(this.query.pageSize=10)),this.dateRange?(this.query.beginTime=this.dateRange[0],this.query.endTime=this.dateRange[1]):(this.query.beginTime="",this.query.endTime=""),"_users"===this.dialogType?Array.isArray(this.userArray)?(this.query.deptIds=this.userArray.filter((e=>e.isParty)).map((e=>e.id)).join(","),this.query.userIds=this.userArray.filter((e=>!e.isParty)).map((e=>e.userId)).join(",")):this.query.deptIds=this.query.userIds="":"_groupOwners"===this.dialogType&&(Array.isArray(this.userArray)?this.query.ownerIds=this.userArray.filter((e=>!e.isParty)).map((e=>e.userId)).join(","):this.query.ownerIds=""),this.loading=!0,e&&(this.query.pageNum=e),this.request(this.query).then((({rows:e,total:t,data:a})=>{if(this.series=[],(a=a||e)&&a.length)if(this.type.includes("Chart"))if(this.xData=a.map((e=>e.xtime)),"customerTotalChart,customerGroupTotalChart,customerGroupMemberTotalChart".includes(this.type))this.series=a.map((e=>e.totalCnt));else if("realDataChart"===this.type)this.series.push(a.map((e=>e.addCnt))),this.series.push(a.map((e=>e.lostCnt))),this.series.push(a.map((e=>e.netCnt))),this.series.push(a.map((e=>e.applyCnt)));else{let e={singleChatTotalChart:"chatCnt",sendMessageNumChart:"messageCnt",replySingleChatChart:"replyPercentage",averageReplyDurationChart:"avgReplyTime",groupChatTotalChart:"chatTotal",groupChatMessageNumChart:"msgTotal",sendMessageGroupMemberChart:"memberHasMsg"};this.series=a.map((t=>t[e[this.type]]))}else"staffCustomerBar"===this.type?(this.xData=a.map((e=>e.userName)),this.series=a.map((e=>e.totalCnt))):this.type.includes("Table")&&(this.list=a,this.total=Number(t))})).catch((e=>{})).finally((()=>{this.loading=!1}))},getGroupList(e){t(e).then((({rows:e})=>{this.groupChats=e})).catch((()=>{}))},getTime(e){const t=e?new Date(e):new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toJSON().substr(0,10)},setTime(e){if(this.timeRange=e,e){let t=new Date;t.setDate(t.getDate()-e),this.dateRange=[this.getTime(t),this.getTime()],this.getList()}else this.dateRange=null},showDialog(e){this.dialogType=e,this.dialogVisible=!0},getSelectUser(e){this.userArray=e,this.query[this.dialogType]=e.map((e=>e.userId)).join(","),["customerGroupMemberTotalChart","customerGroupMemberTotalTable"].includes(this.type)&&(this.query.chatIds="",this.getGroupList({userIds:this.query[this.dialogType]})),this.getList()},exprotTable(){let e=Object.assign({},this.query,{pageNum:void 0,pageSize:void 0}),t="customerGroupMemberTotalTable"==this.type?"客群分析-客群成员数据报表.xlsx":"customerTotalTable"==this.type?"客户分析-数据报表.xlsx":"客群分析-数据报表.xlsx";this.$exportData(this.requestExport.bind(null,e),t)}}},T={class:"operation"};const f=a(C,[["render",function(e,t,a,s,C,f){const j=l("el-button"),x=l("el-button-group"),q=l("el-date-picker"),D=l("el-input"),v=l("el-option"),_=l("el-select"),w=l("ChartLine"),k=l("el-table-column"),I=l("el-table"),R=l("pagination"),A=l("ChartBar"),M=l("SelectUser"),L=r("loading");return i((o(),p("div",null,[n("div",T,[u(x,null,{default:m((()=>[u(j,{type:"primary",plain:7!=C.timeRange,onClick:t[0]||(t[0]=e=>f.setTime(7))},{default:m((()=>[d("近一周")])),_:1},8,["plain"]),u(j,{type:"primary",plain:30!=C.timeRange,onClick:t[1]||(t[1]=e=>f.setTime(30))},{default:m((()=>[d("近一月")])),_:1},8,["plain"]),u(j,{type:"primary",plain:!!C.timeRange,onClick:t[2]||(t[2]=e=>f.setTime())},{default:m((()=>[d("自定义")])),_:1},8,["plain"])])),_:1}),C.timeRange?y("",!0):(o(),h(q,g({key:0,modelValue:C.dateRange,"onUpdate:modelValue":t[3]||(t[3]=e=>C.dateRange=e),class:"ml20",style:{width:"260px"},"value-format":"YYYY-MM-DD",type:"daterange",clearable:!1},e.pickerOptions,{"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:t[4]||(t[4]=e=>f.getList(1))}),null,16,["modelValue"])),a.type.toLowerCase().includes("group")?(o(),h(D,{key:1,style:{width:"180px","margin-left":"20px"},"model-value":C.userArray.map((e=>e.name))+"",readonly:"",onClick:t[5]||(t[5]=e=>f.showDialog("_groupOwners")),placeholder:"请选择群主"},null,8,["model-value"])):y("",!0),["customerGroupMemberTotalChart","customerGroupMemberTotalTable"].includes(a.type)?(o(),h(_,{key:2,style:{"margin-left":"20px"},modelValue:C.query.chatIds,"onUpdate:modelValue":t[6]||(t[6]=e=>C.query.chatIds=e),placeholder:"请选择群聊",clearable:"",onChange:t[7]||(t[7]=e=>f.getList())},{default:m((()=>[(o(!0),p(c,null,b(C.groupChats,(e=>(o(),h(v,{key:e.chatId,label:e.groupName,value:e.chatId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):y("",!0),["customerTotalChart","customerTotalTable","realDataChart","customerContactTable"].includes(a.type)?(o(),h(D,{key:3,style:{width:"180px","margin-left":"20px"},"model-value":C.userArray.map((e=>e.name))+"",readonly:"",onClick:t[8]||(t[8]=e=>f.showDialog("_users")),placeholder:"请选择部门或员工"},null,8,["model-value"])):y("",!0),a.type.includes("Table")?(o(),h(j,{key:4,class:"fr",type:"primary",onClick:f.exprotTable},{default:m((()=>[d("导出 Excel")])),_:1},8,["onClick"])):y("",!0)]),a.type.includes("Chart")?(o(),h(w,{key:0,xData:C.xData,legend:a.legend||C.legendDict[a.type],series:C.series},null,8,["xData","legend","series"])):a.type.includes("Table")?(o(),p(c,{key:1},[u(I,{data:C.list,style:{width:"100%"}},{default:m((()=>[(o(!0),p(c,null,b(C.tableProps[a.type],((e,t)=>(o(),h(k,{key:t,prop:e.prop,label:e.label,align:"center"},null,8,["prop","label"])))),128))])),_:1},8,["data"]),u(R,{total:C.total,page:C.query.pageNum,"onUpdate:page":t[9]||(t[9]=e=>C.query.pageNum=e),limit:C.query.pageSize,"onUpdate:limit":t[10]||(t[10]=e=>C.query.pageSize=e),onPagination:t[11]||(t[11]=e=>f.getList())},null,8,["total","page","limit"])],64)):"staffCustomerBar".includes(a.type)?(o(),h(A,{key:2,xData:C.xData,series:C.series},null,8,["xData","series"])):"rowEchart".includes("vChart")?(o(),h(w,{key:3,xData:C.xData,legend:a.legend||C.legendDict[a.type],series:C.series,option:a.option},null,8,["xData","legend","series","option"])):y("",!0),u(M,{visible:C.dialogVisible,"onUpdate:visible":t[12]||(t[12]=e=>C.dialogVisible=e),title:"组织架构",defaultValues:C.userArray,onSuccess:f.getSelectUser,isOnlyLeaf:"_groupOwners"===C.dialogType},null,8,["visible","defaultValues","onSuccess","isOnlyLeaf"])])),[[L,C.loading]])}]]);export{f as default};
