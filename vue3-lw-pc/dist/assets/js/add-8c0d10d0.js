import{e,a as t,d as s}from"./api-3d61a394.js";import i from"./IdentityAttachment-8108ffd0.js";import a from"./PreviewInPhone-9ed75a0f.js";import{_ as l}from"./quill-image-resize-module-c051113e.js";import{ai as r,aq as o,o as m,c as n,a as d,_ as c,U as p,K as h,a9 as u,T as f,Y as g,Z as v,X as j,V as y,bl as U,bj as b}from"./@vue-e400fd81.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./index-0bf429ac.js";import"./scriptCenter-9e8c6ca2.js";import"./modleCenter-5112f339.js";import"./DragTable-97e90e96.js";import"./sortablejs-b0ad9b27.js";import"./MessageContentForm-5a22ed37.js";import"./staff-48996164.js";import"./PicTitContent-8b500b6d.js";import"./PosterAdd-51b39872.js";import"./index-618cff16.js";import"./tag-13936295.js";import"./fabric-8da0df30.js";import"./poster-241340a9.js";import"./liveCodeTable-73b404a8.js";import"./group-16414119.js";import"./pullNews-68e01d94.js";import"./TemplateLibrary-f59d0076.js";import"./welcome-6ff4c53e.js";const k={components:{IdentityAttachment:i,PreviewInPhone:a},data:()=>({id:"",active:0,loading:!1,tagList:[],userList:[],showSelectTag:!1,dialogVisibleSelectUser:!1,form:{linkName:"",tagIds:"",tagNames:"",skipVerify:1,attachments:[],weUserList:"",weUserNames:""},templateInfo:"",attachmentsData:{templateInfo:"",attachments:[]},previewData:[],rules:{linkName:[{required:!0,message:"请输入链接名称",trigger:"blur"}],weUserList:[{required:!0,message:"请选择链接员工",trigger:"blur"}]},detail:{linkUrl:"",linkShortUrl:""}}),created(){this.$route.query.id&&(this.id=this.$route.query.id,this.getDetail())},methods:{copyFn(e){const t=document.createElement("input");t.style.cssText="opacity: 0;",t.type="text",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),this.$message({message:"复制成功",type:"success"})},submit(){this.$refs.form.validate((s=>{if(s){if(!this.templateInfo)return void this.msgError("欢迎语不能为空！");this.loading=!0,null==this.form.attachments&&(this.form.attachments=[]),this.form.attachments.unshift({content:this.templateInfo,msgType:"text"}),this.id?e(this.form).then((e=>{200==e.code&&(this.msgSuccess("操作成功"),this.detail=e.data,this.active=1),this.loading=!1})).catch((()=>{this.loading=!1})):t(this.form).then((e=>{200==e.code&&(this.msgSuccess("操作成功"),this.detail=e.data,this.active=1),this.loading=!1})).catch((()=>{this.loading=!1}))}}))},nextFn(e){this.active=1,s(e).then((e=>{200==e.code&&(this.detail=e.data)}))},onSelectUser(){this.dialogVisibleSelectUser=!0},selectedUser(e){e.length>100?this.msgError("最多选择100名成员"):(this.userList=e,this.form.weUserList=e.map((e=>e.weUserId)).join(","),this.form.weUserNames=e.map((e=>e.name)).join(","))},getSelectTag(e){this.tagList=e,this.form.tagIds=e.map((e=>e.tagId)).join(","),this.form.tagNames=e.map((e=>e.name)).join(",")},changeInfo(e){this.templateInfo=e},getAttentment(e){this.form.attachments=e},getPhoneData(e){this.previewData=e},getDetail(){s(this.id).then((e=>{if(200==e.code){if(this.form=e.data,this.form.tagIds){let e=this.form.tagIds.split(","),t=this.form.tagNames.split(","),s=[];e.forEach(((e,i)=>{s.push({name:t[i],tagId:e})})),this.tagList=s}if(this.form.weUserList){let e=this.form.weUserList.split(","),t=this.form.weUserNames.split(","),s=[];e.forEach(((e,i)=>{s.push({name:t[i],weUserId:e})})),this.userList=s}if(this.form.linkAttachments){let e=[];this.form.linkAttachments.forEach((t=>{"text"==t.msgType?this.templateInfo=t.content:e.push(t)}));let t=this.setAttachments(e);this.attachmentsData={templateInfo:this.templateInfo,attachments:t},this.previewData=t}}}))},setAttachments(e){let t=[];return e&&e.length&&e.forEach((e=>{if("image"===e.msgType){let s={id:e.materialId,mediaType:"0",materialUrl:e.picUrl};t.push(s)}else if("video"===e.msgType){let s={id:e.materialId,mediaType:"2",materialUrl:e.fileUrl,coverUrl:e.picUrl,digest:e.description,materialName:e.title};t.push(s)}else if("file"===e.msgType){let s={id:e.materialId,mediaType:"3",materialUrl:e.fileUrl,digest:e.description,materialName:e.title};t.push(s)}else if("text"===e.msgType){let s={id:e.materialId,mediaType:"4",content:e.content};t.push(s)}else if("link"===e.msgType){let s={id:e.materialId,mediaType:"9",content:e.content,coverUrl:e.picUrl,materialUrl:e.linkUrl,materialName:e.title};t.push(s)}else if("miniprogram"===e.msgType){let s={id:e.materialId,mediaType:"11",digest:e.appId,materialName:e.title,coverUrl:e.picUrl,materialUrl:e.fileUrl};t.push(s)}else if("news"===e.msgType){let s={id:e.materialId,mediaType:"12",digest:e.description,materialUrl:e.fileUrl,coverUrl:e.picUrl,content:e.content,materialName:e.title};t.push(s)}else if("posters"===e.msgType){let s={id:e.materialId,mediaType:"5",materialUrl:e.fileUrl,materialName:e.title};t.push(s)}})),t}}},I=e=>(U("data-v-a65ec6a8"),e=e(),b(),e),w={class:"g-card"},T={style:{"margin-top":"var(--card-margin)"}},_={key:0,class:"flex"},S={style:{width:"calc(100% - 425px)","padding-right":"var(--card-margin)"}},x={class:"g-card"},L=I((()=>d("div",{class:"card-title"},"基础信息",-1))),C=I((()=>d("div",{class:"sub-des"},"开启后，客户添加该企业微信时，无需好友验证，将会自动添加成功",-1))),N=I((()=>d("div",{class:"sub-des"},"添加成功后，该客户将会自动设置以上选择标签",-1))),D=I((()=>d("div",{class:"sub-des"},"最多选择100名成员，平均分配",-1))),V={key:0},P={class:"g-card"},q=I((()=>d("div",{class:"card-title"},"欢迎语配置",-1))),A={class:"g-card",style:{width:"425px","margin-top":"0"}},E=I((()=>d("div",{class:"card-title"},"欢迎语预览",-1))),F={key:1,class:"g-card"},$={class:"code-wrapper"},z={class:"code-success"},K={class:"check"},M=I((()=>d("div",{class:"code-text"},"获客链接创建成功，支持复制链接即可使用",-1))),O={style:{"text-align":"left"}},Z=I((()=>d("div",{class:"sub-des"},"企微官方的获客长链接，可直接使用",-1))),B={style:{"text-align":"left"}},J=I((()=>d("div",{class:"sub-des"},"系统生成的获客短链，满足短链场景",-1))),X={class:"g-card ac g-footer-sticky"};const Y=l(k,[["render",function(e,t,s,i,a,l){const U=r("el-step"),b=r("el-steps"),k=r("el-input"),I=r("el-form-item"),Y=r("el-switch"),G=r("el-tag"),H=r("el-button"),Q=r("el-col"),R=r("el-row"),W=r("IdentityAttachment"),ee=r("el-form"),te=r("PreviewInPhone"),se=r("el-icon-Check"),ie=r("SelectTag"),ae=r("SelectUser"),le=o("loading");return m(),n("div",null,[d("div",w,[c(b,{active:a.active,"align-center":"","finish-status":"success"},{default:p((()=>[c(U,{title:"链接配置"}),c(U,{title:"生成链接"})])),_:1},8,["active"])]),d("div",T,[0==a.active?(m(),n("div",_,[d("div",S,[c(ee,{model:a.form,rules:a.rules,ref:"form","label-width":"140px"},{default:p((()=>[d("div",x,[L,c(R,null,{default:p((()=>[c(Q,{sm:24,md:18},{default:p((()=>[c(I,{label:"链接名称",prop:"linkName"},{default:p((()=>[c(k,{modelValue:a.form.linkName,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.linkName=e),placeholder:"请输入链接名称","show-word-limit":"",maxlength:"15"},null,8,["modelValue"])])),_:1}),c(I,{label:"自动通过好友"},{default:p((()=>[c(Y,{modelValue:a.form.skipVerify,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.skipVerify=e),"active-value":1,"inactive-value":0},null,8,["modelValue"]),C])),_:1}),c(I,{label:"新客户标签"},{default:p((()=>[N,(m(!0),n(h,null,u(a.tagList,((e,t)=>(m(),n(h,null,[e.name?(m(),f(G,{key:t},{default:p((()=>[g(v(e.name),1)])),_:2},1024)):j("",!0)],64)))),256)),d("div",null,[c(H,{type:"primary",icon:"el-icon-plus",onClick:t[2]||(t[2]=e=>a.showSelectTag=!0)},{default:p((()=>[g(v(a.tagList.length?"编辑":"添加")+"标签 ",1)])),_:1})])])),_:1}),c(I,{label:"链接员工",prop:"weUserList"},{default:p((()=>[D,a.userList.length>0?(m(),n("div",V,[(m(!0),n(h,null,u(a.userList,((e,t)=>(m(),f(G,{key:t},{default:p((()=>[g(v(e.name),1)])),_:2},1024)))),128))])):j("",!0),c(H,{type:"primary",icon:"el-icon-plus",onClick:l.onSelectUser},{default:p((()=>[g(v(a.userList.length?"修改":"选择")+"链接员工 ",1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})]),d("div",P,[q,c(R,null,{default:p((()=>[c(Q,{sm:24,md:18},{default:p((()=>[c(W,{onPhoneData:l.getPhoneData,onSuccess:l.getAttentment,onChangeInfo:l.changeInfo,baseData:a.attachmentsData},null,8,["onPhoneData","onSuccess","onChangeInfo","baseData"])])),_:1})])),_:1})])])),_:1},8,["model","rules"])]),d("div",A,[E,c(te,{list:a.previewData,templateInfo:a.templateInfo},null,8,["list","templateInfo"])])])):(m(),n("div",F,[d("div",$,[d("div",z,[d("div",K,[c(se,{class:"el-icon-check"})])]),M,c(ee,{"label-width":"140px",style:{display:"inline-block"}},{default:p((()=>[c(I,{label:"获客链接:"},{default:p((()=>[d("div",O,[g(v(a.detail.linkUrl)+" ",1),c(H,{text:"",onClick:t[3]||(t[3]=e=>l.copyFn(a.detail.linkUrl))},{default:p((()=>[g("复制")])),_:1})]),Z])),_:1}),c(I,{label:"获客短链:"},{default:p((()=>[d("div",B,[g(v(a.detail.linkShortUrl)+" ",1),c(H,{text:"",onClick:t[4]||(t[4]=e=>l.copyFn(a.detail.linkShortUrl))},{default:p((()=>[g("复制")])),_:1})]),J])),_:1})])),_:1})])]))]),d("div",X,[0===a.active?(m(),n(h,{key:0},[c(H,{onClick:t[5]||(t[5]=t=>e.$router.back())},{default:p((()=>[g("取消")])),_:1}),y((m(),f(H,{type:"primary",disabled:a.loading,onClick:l.submit},{default:p((()=>[g("确定")])),_:1},8,["disabled","onClick"])),[[le,a.loading]])],64)):(m(),f(H,{key:1,type:"primary",onClick:t[6]||(t[6]=t=>e.$router.back())},{default:p((()=>[g("完成")])),_:1}))]),c(ie,{visible:a.showSelectTag,"onUpdate:visible":t[7]||(t[7]=e=>a.showSelectTag=e),type:"1",selected:a.tagList,onSuccess:l.getSelectTag},null,8,["visible","selected","onSuccess"]),c(ae,{defaultValues:a.userList,visible:a.dialogVisibleSelectUser,"onUpdate:visible":t[8]||(t[8]=e=>a.dialogVisibleSelectUser=e),title:"选择员工",isOnlyLeaf:!0,onSuccess:l.selectedUser},null,8,["defaultValues","visible","onSuccess"])])}],["__scopeId","data-v-a65ec6a8"]]);export{Y as default};
