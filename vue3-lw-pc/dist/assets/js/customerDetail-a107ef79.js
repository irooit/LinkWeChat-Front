import{H as e,Z as a,I as t,$ as s}from"../index-044285d2.js";import{g as r}from"./businessConver-2b86f97c.js";import l from"./infoTab-e903796b.js";import i from"./record-d8133c69.js";import{ai as o,o as c,c as d,a as m,_ as n,Y as p,Z as u,P as g,Q as j,K as y,a9 as f,T as b,U as h,X as v,V as T,$ as k,bl as _,bj as S}from"./@vue-e400fd81.js";import{_ as I}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./record-table-6037d986.js";import"./detail-c77f4d42.js";import"./chatListClassTab-fcdefbef.js";import"./chatList-cf9d0aa9.js";import"./ChatContent-f938bb33.js";import"./benz-amr-recorder-259e7c16.js";import"./content-6f300c2d.js";import"./MaterialCard-ea409fb9.js";const U={name:"CustomerDetail",components:{InfoTab:l,record:i},data:()=>({datePickerVisible:!1,customer:{},birthday:"",pickerOptions:{disabledDate:e=>e.getTime()>Date.now()},dictAddType:e,dictJoinGroupType:a,dictTrackState:t,active:"0",lastSyncTime:null,openTrack:["0"],trajectoryType:{0:"全部",1:"客户动态",2:"员工动态",3:"互动动态",4:"商机阶段"}}),created(){e().then((e=>this.dictAddType=e)),this.getDetail(),this.getStage()},methods:{getStage(){r().then((e=>{this.stageList=e.data}))},setValue(e){let a="";return this.stageList.forEach((t=>{t.stageVal==e&&(a=t.stageKey)})),a},getDetail(){s({...this.$route.query,delFlag:this.$route.query.isDelete?1:0}).then((({data:e})=>{e.companyTags&&(e.companyTags=e.companyTags.split(",")),this.customer=e,this.birthday=e.birthday}))},changeTrack(e){this.openTrack.includes(e)||this.openTrack.push(e),this.active=e},sync(){this.$refs.record[this.active].sync()}}},w=e=>(_("data-v-e6cc8f63"),e=e(),S(),e),C={class:"g-card flex aic mb20"},A={class:"ml10"},N={class:"mt10"},V={class:"mt10 gap10"},x={key:1},L={class:"flex"},$={style:{width:"calc(100% - 425px)","padding-right":"var(--card-margin)"}},q={class:"g-card"},D=w((()=>m("div",{class:"g-card-title"},"社交关系",-1))),z={class:"g-card"},J=w((()=>m("div",{class:"g-card-title"},"客户画像",-1))),M={style:{width:"425px","margin-top":"0"}},K={class:"g-card-title fcbw"},Z=w((()=>m("span",{class:"card-title"},"客户轨迹",-1))),B={class:"flex track-tab-wrap mb15"};const E=I(U,[["render",function(e,a,t,s,r,l){const i=o("el-image"),_=o("el-icon-Avatar"),S=o("el-tag"),I=o("el-table-column"),U=o("el-table"),w=o("el-tab-pane"),E=o("el-tabs"),G=o("info-tab"),H=o("ButtonSync"),O=o("el-option"),P=o("el-select"),X=o("record"),F=o("el-card");return c(),d("div",null,[m("div",C,[n(i,{class:"avatar",src:r.customer.avatar,fit:"fill"},null,8,["src"]),m("div",A,[m("div",null,[p(u(r.customer.customerName+(r.customer.corpName?"-"+r.customer.corpName:""))+" ",1),n(_,{class:g(["el-icon-Avatar",{1:"man",2:"woman"}[r.customer.gender]])},null,8,["class"])]),m("div",N,[m("span",{style:j({color:1===r.customer.customerType?"#4bde03":"#f9a90b"})},u({1:"@微信",2:"@企业微信"}[r.customer.customerType]),5)]),m("div",V,[r.customer.tagNames?(c(!0),d(y,{key:0},f(r.customer.tagNames.split(","),((e,a)=>(c(),b(S,{key:a},{default:h((()=>[p(u(e),1)])),_:2},1024)))),128)):(c(),d("div",x,"暂无标签"))])])]),m("div",L,[m("div",$,[m("div",q,[D,n(E,{"model-value":"1"},{default:h((()=>[n(w,{label:`跟进员工(${r.customer.trackUsers?r.customer.trackUsers.length:0})`,name:"1"},{default:h((()=>[n(U,{data:r.customer.trackUsers},{default:h((()=>[n(I,{label:"员工",align:"center",prop:"userName"}),n(I,{prop:"addMethod",label:"添加方式",align:"center"},{default:h((({row:e})=>[p(u(r.dictAddType[e.addMethod+""]),1)])),_:1}),n(I,{label:"添加时间",align:"center",prop:"firstAddTime"}),n(I,{prop:"trackState",label:"商机阶段",align:"center"},{default:h((({row:e})=>[e.trackState?(c(),b(S,{key:0},{default:h((()=>[p(u(l.setValue(e.trackState)),1)])),_:2},1024)):v("",!0)])),_:1})])),_:1},8,["data"])])),_:1},8,["label"]),n(w,{label:`所在客群(${r.customer.groups?r.customer.groups.length:0})`,name:"2"},{default:h((()=>[n(U,{data:r.customer.groups},{default:h((()=>[n(I,{label:"群名",align:"center",prop:"groupName"}),n(I,{label:"群主",align:"center",prop:"leaderName"}),n(I,{label:"入群时间",align:"center",prop:"joinTime"}),n(I,{prop:"joinScene",label:"入群方式",align:"center"},{default:h((({row:e})=>[p(u(r.dictJoinGroupType[e.joinScene+""]),1)])),_:1})])),_:1},8,["data"])])),_:1},8,["label"])])),_:1})]),m("div",z,[J,n(E,{"model-value":"0"},{default:h((()=>[(c(!0),d(y,null,f(r.customer.trackUsers,((a,t)=>(c(),b(w,{key:t,label:a.userName,lazy:"","data-id":a.trackUserId},{default:h((()=>[n(G,{stageList:e.stageList,userId:a.trackUserId},null,8,["stageList","userId"])])),_:2},1032,["label","data-id"])))),128))])),_:1})])]),m("div",M,[n(F,{class:"g-card",style:{padding:"0"}},{header:h((()=>[m("div",K,[Z,n(H,{class:"btn-sync",lastSyncTime:r.lastSyncTime,onClick:l.sync},{default:h((()=>[p("同步")])),_:1},8,["lastSyncTime","onClick"])])])),default:h((()=>[m("div",B,[n(P,{modelValue:r.active,"onUpdate:modelValue":a[0]||(a[0]=e=>r.active=e),placeholder:"请选择",onChange:l.changeTrack},{default:h((()=>[(c(!0),d(y,null,f(r.trajectoryType,((e,a)=>(c(),b(O,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])]),(c(!0),d(y,null,f(r.openTrack,((t,s)=>(c(),d(y,{key:s},[r.customer.trackUsers?T((c(),b(X,{key:0,ref_for:!0,ref:"record",userId:e.userId,userIdAll:r.customer.trackUsers.map((e=>e.trackUserId)).join(),lastSyncTime:r.lastSyncTime,"onUpdate:lastSyncTime":a[1]||(a[1]=e=>r.lastSyncTime=e),trajectoryType:0==t?null:t},null,8,["userId","userIdAll","lastSyncTime","trajectoryType"])),[[k,t===r.active]]):v("",!0)],64)))),128))])),_:1})])])])}],["__scopeId","data-v-e6cc8f63"]]);export{E as default};
