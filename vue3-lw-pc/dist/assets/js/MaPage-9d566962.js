import{g as e,a as t,r as i}from"./index-0bf429ac.js";import a from"./AddOrEditMaterialDialog-00cd185a.js";import{u as l,b as o}from"./staff-48996164.js";import{d as s}from"./common-07456f0f.js";import{r,d,D as p}from"../index-044285d2.js";import{ai as n,aq as m,o as u,c as g,a as c,K as h,a9 as y,P as f,Z as b,T as v,U as j,_ as x,Y as V,X as w,aa as k,V as C,O as T,$ as _,bl as U,bj as q}from"./@vue-e400fd81.js";import{_ as F}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const I=window.lwConfig.services.wecom+"/material";const D={name:"MaPage",components:{AddOrEditMaterialDialog:a},props:{type:{type:String,default:"0"},selected:{type:[Array,String],default:""}},data(){return{posterType:[{value:"1",label:"通用海报"},{value:"2",label:"裂变海报"}],flag:!1,reUp:!0,textVisible:!1,actionUrl:"",headers:window.lwConfig.headers,groupList:[],groupVisible:!1,groupForm:{mediaType:this.type,name:""},groupRules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}]},groupIndex:0,delObj:{updateOrDel:1,moduleType:1,ids:[]},loading:!0,query:{pageNum:1,pageSize:10,materialName:"",mediaType:"0",categoryId:""},list:[],total:0,treeData:[{}],group:"",groupDialogVisible:!1,groupProps:{expandTrigger:"hover",checkStrictly:!0,children:"children",label:"name",value:"id",emitPath:!1},form:{weMaterialImgAoList:[]},dialogVisible:!1,treeFormRules:{name:[{required:!0,message:"不能为空",trigger:"blur"}]}}},watch:{},computed:{},created(){this.query.mediaType=this.type,this.getTree(!0)},mounted(){},methods:{reUploade(){this.$refs.upload.clearFiles(),this.reUp=!0},downloadFn(){var e;r({url:I+"/importTemplate",responseType:"blob",params:e}).then((e=>{if(!e)return;const t=new Blob([e],{type:"application/vnd.ms-excel"});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(t,"咨询记录");else{const e=URL.createObjectURL(t),i=document.createElement("a");i.style.display="none",i.href=e,i.download=d(new Date,"YYYY-MM-DD")+"_文本模板.xlsx",i.click(),URL.revokeObjectURL(i.href)}}))},importText(){this.textVisible=!0,this.reUp=!0},addGroup(){this.groupForm={mediaType:this.type,name:""},this.groupVisible=!0},switchGroup(e,t){this.groupIndex=e,this.query.categoryId=t.id,this.getList(1)},onAddOrUpdateGroup(){this.$refs.groupForm.validate((e=>{if(this.groupForm.id){let e={id:this.groupForm.id,name:this.groupForm.name,mediaType:this.type};this.groupForm=e}e&&(this.groupForm.id?l:o)(this.groupForm).then((e=>{this.groupVisible=!1,this.groupForm={name:"",mediaType:this.type},this.$refs.groupForm.clearValidate(),this.getTree()}))}))},onGroupCommand(e,t){"1"!==t.id?"groupEdit"==e?this.editGroup(t):"groupRemove"==e&&this.removeGroup(t.id):this.msgInfo("默认分组不可操作！")},editGroup(e){this.groupForm=JSON.parse(JSON.stringify(e)),this.groupVisible=!0},removeGroup(e){this.$confirm("是否确认删除当前分组？删除后该分组下素材移动到默认分组中，该操作不可撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.delObj.ids=[],this.delObj.ids.push(e),s(this.delObj).then((e=>{this.getTree(!0)}))})).catch((()=>{}))},resetQuery(){this.query.materialName="",delete this.query.type,this.getList(1)},getTree(t){e(this.type).then((({data:e})=>{e.forEach((e=>{e.children=null})),this.treeData=[{id:"",name:"全部",parentId:"0",hasParent:!1,hasChildren:!0,children:e||[]}],this.groupList=e,t&&(this.query.categoryId=e[0].id,this.groupIndex=0,this.getList(1))}))},getList(e){e&&(this.query.pageNum=e),this.loading=!0,t(this.query).then((({rows:e,total:t})=>{e.forEach((e=>{e.tagIds&&e.tagNames&&(e.tagIds=e.tagIds.split(","),e.tagNames=e.tagNames.split(","),e.tags=[],e.tagIds.forEach(((t,i)=>{e.tags.push({tagId:t,name:e.tagNames[i]})})))})),this.list=e.sort(((e,t)=>+new Date(t.updateTime)-+new Date(e.updateTime))),this.total=+t,this.loading=!1,this.$emit("listChange",this.list)})).catch((()=>{this.loading=!1}))},edit(e){let t=this.type;5==t||12==t?this.$router.push({path:5==t?"posterAdd":"articleAdd",query:{type:t,id:e&&e.id,categoryId:this.query.categoryId}}):(this.form=Object.assign({},e||{categoryId:this.query.categoryId}),this.dialogVisible=!0)},remove(e){const t=e||this.selected+"";this.$confirm("是否确认删除当前素材？该操作不可撤销，请谨慎操作。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return i(t)})).then((()=>{this.getTree(),this.getList(),this.msgSuccess("删除成功")}))},detail(e){this.$router.push({path:"detail",query:{type:this.type,id:e.id}})},moveGroup(){let e={};e.cateGoreId=this.group,e.moduleType=1,e.updateOrDel=0,e.ids=this.selected,s(e).then((e=>{200===e.code&&(this.$message.success(e.msg),this.groupDialogVisible=!1,this.getTree(),this.getList(1),this.group="")}))},download(e){window.open(e.materialUrl)},submitImport(){if(!this.file)return this.msgInfo("请先上传文件！"),!1;var e,t,i;(e=p({file:this.file}),t=this.query.categoryId,i=this.type,r({url:I+"/importData",method:"post",params:{categoryId:t,mediaType:i},data:e})).then((e=>{200===e.code&&(this.msgSuccess(e.data),this.textVisible=!1,this.getTree(),this.getList(1))}))},setFileData(e,t){this.file=e.raw,this.reUp=!1},removeFileData(e,t){this.file=null,this.reUp=!0}}},L=e=>(U("data-v-e3914bec"),e=e(),q(),e),O={class:""},G={class:"g-left-right",style:{height:"calc(100vh - 182px)"}},N={class:"left g-card"},S={class:"title"},$=L((()=>c("div",{class:"title-name"},"素材分组",-1))),M={class:"item-list"},A=["onClick"],E={class:"name"},R={class:"dot"},z={class:"right"},B={class:"g-card fxnone"},P={class:"mt20 g-card pad20"},Y={class:"mid-action"},J={class:""},K={class:""},Q=L((()=>c("div",null,"选择分组",-1))),W={style:{position:"relative",margin:"10px 0"}},X={style:{"text-align":"right"}},Z={class:"dialog-footer"},H={style:{display:"flex"}},ee={style:{"font-size":"12px"}},te={key:0,style:{margin:"3px 0"}},ie={class:"dialog-footer"};const ae=F(D,[["render",function(e,t,i,a,l,o){var s;const r=n("el-icon-MoreFilled"),d=n("el-dropdown-item"),p=n("el-dropdown-menu"),U=n("el-dropdown"),q=n("el-input"),F=n("el-option"),I=n("el-select"),D=n("el-button"),L=n("el-cascader"),ae=n("el-popover"),le=n("pagination"),oe=n("el-form-item"),se=n("el-form"),re=n("el-dialog"),de=n("AddOrEditMaterialDialog"),pe=n("el-upload"),ne=m("loading");return u(),g("div",O,[c("div",G,[c("div",N,[c("div",S,[$,c("div",{class:"title-btn",onClick:t[0]||(t[0]=(...e)=>o.addGroup&&o.addGroup(...e))},"添加")]),c("div",M,[(u(!0),g(h,null,y(l.groupList,((e,t)=>(u(),g("div",{class:f(["item",{active:l.groupIndex==t}]),key:e.id,onClick:i=>o.switchGroup(t,e)},[c("div",E,b(e.name+" ("+e.number+")"),1),0===e.flag?(u(),v(U,{key:0,class:"dropdown",onCommand:t=>o.onGroupCommand(t,e)},{dropdown:j((()=>[x(p,null,{default:j((()=>[x(d,{command:"groupEdit"},{default:j((()=>[V("修改分组")])),_:1}),x(d,{command:"groupRemove"},{default:j((()=>[V("删除分组")])),_:1})])),_:1})])),default:j((()=>[c("span",R,[x(r,{class:"el-icon-MoreFilled content-icon"})])])),_:2},1032,["onCommand"])):w("",!0)],10,A)))),128))])]),c("div",z,[c("div",B,[x(q,{modelValue:l.query.materialName,"onUpdate:modelValue":t[1]||(t[1]=e=>l.query.materialName=e),placeholder:"请输入素材标题",clearable:"","prefix-icon":"el-icon-search",style:{width:"240px"},onKeyup:t[2]||(t[2]=k((e=>o.getList(1)),["enter"]))},null,8,["modelValue"]),"5"===i.type?(u(),v(I,{key:0,modelValue:l.query.type,"onUpdate:modelValue":t[3]||(t[3]=e=>l.query.type=e),style:{width:"240px"},placeholder:"请选择海报类型",class:"ml10"},{default:j((()=>[(u(!0),g(h,null,y(l.posterType,(e=>(u(),v(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):w("",!0),x(D,{class:"ml10",type:"primary",onClick:t[4]||(t[4]=e=>o.getList(1))},{default:j((()=>[V("查询")])),_:1}),x(D,{onClick:o.resetQuery},{default:j((()=>[V("重置")])),_:1},8,["onClick"])]),c("div",P,[C((u(),g("div",null,[c("div",Y,[c("div",J,[x(D,{type:"primary",onClick:t[5]||(t[5]=e=>o.edit())},{default:j((()=>{var t;return[V("新建"+b(null==(t=e.$dictMaterialType[i.type])?void 0:t.name),1)]})),_:1}),"4"===i.type?(u(),v(D,{key:0,onClick:o.importText,plain:""},{default:j((()=>[V("导入文本")])),_:1},8,["onClick"])):w("",!0)]),c("div",K,[x(ae,{placement:"top",width:"260",visible:l.groupDialogVisible},{reference:j((()=>[x(D,{onClick:t[8]||(t[8]=e=>l.groupDialogVisible=!0),style:{"margin-right":"10px"},disabled:0===i.selected.length,type:"primary"},{default:j((()=>[V(" 批量分组 ")])),_:1},8,["disabled"])])),default:j((()=>[Q,c("div",W,[x(L,{modelValue:l.group,"onUpdate:modelValue":t[6]||(t[6]=e=>l.group=e),options:l.treeData[0].children,props:l.groupProps},null,8,["modelValue","options","props"])]),c("div",X,[x(D,{onClick:t[7]||(t[7]=e=>l.groupDialogVisible=!1)},{default:j((()=>[V("取消")])),_:1}),x(D,{type:"primary",onClick:o.moveGroup},{default:j((()=>[V("确定")])),_:1},8,["onClick"])])])),_:1},8,["visible"]),x(D,{onClick:t[9]||(t[9]=e=>o.remove()),disabled:0===i.selected.length},{default:j((()=>[V("批量删除")])),_:1},8,["disabled"])])])])),[[ne,l.loading]]),T(e.$slots,"default",{list:l.list},void 0,!0),C(x(le,{total:l.total,page:l.query.pageNum,"onUpdate:page":t[10]||(t[10]=e=>l.query.pageNum=e),limit:l.query.pageSize,"onUpdate:limit":t[11]||(t[11]=e=>l.query.pageSize=e),onPagination:t[12]||(t[12]=e=>o.getList())},null,8,["total","page","limit"]),[[_,l.total>0]])])])]),l.groupVisible?(u(),v(re,{key:0,title:(l.groupForm.id?"修改":"新建")+"分组",modelValue:l.groupVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>l.groupVisible=e),width:"30%"},{footer:j((()=>[c("div",Z,[x(D,{onClick:t[14]||(t[14]=e=>l.groupVisible=!1)},{default:j((()=>[V("取 消")])),_:1}),x(D,{type:"primary",onClick:o.onAddOrUpdateGroup},{default:j((()=>[V("确 定")])),_:1},8,["onClick"])])])),default:j((()=>[x(se,{model:l.groupForm,rules:l.groupRules,ref:"groupForm"},{default:j((()=>[x(oe,{label:"分组名称",prop:"name","label-width":"80px"},{default:j((()=>[x(q,{modelValue:l.groupForm.name,"onUpdate:modelValue":t[13]||(t[13]=e=>l.groupForm.name=e),clearable:"",autocomplete:"off",maxlength:"15","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])):w("",!0),x(de,{type:i.type,data:l.form,title:(l.form.id?"编辑":"新建")+(null==(s=e.$dictMaterialType[i.type])?void 0:s.name),modelValue:l.dialogVisible,"onUpdate:modelValue":t[16]||(t[16]=e=>l.dialogVisible=e),onSuccess:t[17]||(t[17]=e=>(o.getTree(),o.getList(1)))},null,8,["type","data","title","modelValue"]),l.textVisible?(u(),v(re,{key:1,title:"导入文本",width:"30%",modelValue:l.textVisible,"onUpdate:modelValue":t[19]||(t[19]=e=>l.textVisible=e)},{footer:j((()=>[c("div",ie,[x(D,{onClick:t[18]||(t[18]=e=>l.textVisible=!1)},{default:j((()=>[V("取 消")])),_:1}),x(D,{type:"primary",onClick:o.submitImport},{default:j((()=>[V("确 定")])),_:1},8,["onClick"])])])),default:j((()=>[x(se,{model:l.groupForm,rules:l.groupRules,ref:"groupForm"},{default:j((()=>[x(oe,{label:"选择表格",prop:"name","label-width":"80px"},{default:j((()=>[c("div",H,[x(pe,{accept:".xls, .xlsx",action:l.actionUrl,limit:1,headers:l.headers,ref:"upload","on-change":o.setFileData,"auto-upload":!1,"on-remove":o.removeFileData},{default:j((()=>[c("div",ee,[x(D,{type:"primary",plain:"",disabled:!l.reUp},{default:j((()=>[V("上传文件")])),_:1},8,["disabled"]),l.reUp?(u(),g("p",te,"仅支持xls、xlsx格式文件")):w("",!0)])])),_:1},8,["action","headers","on-change","on-remove"]),c("div",null,[l.reUp?(u(),v(D,{key:0,style:{"margin-left":"10px"},text:"",plain:"",onClick:o.downloadFn},{default:j((()=>[V("下载模板")])),_:1},8,["onClick"])):(u(),v(D,{key:1,plain:"",text:"",onClick:o.reUploade},{default:j((()=>[V("重新上传")])),_:1},8,["onClick"]))])])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])):w("",!0)])}],["__scopeId","data-v-e3914bec"]]);export{ae as default};
