import{d as e}from"../index-044285d2.js";import s from"./SelectFassionGroup-4cc11c95.js";import{_ as t}from"./quill-image-resize-module-c051113e.js";import{ai as a,o as i,c as o,a as r,_ as l,U as m,O as d,R as n,K as p,Y as f,T as u,X as h,Q as c}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const g={name:"task-steps-base",components:{SelectFassionGroup:s},data:()=>({form:{fassionType:1,scopeType:1,fassionName:"",fassionStartTime:"",fassionEndTime:"",executeUserOrGroup:null},dateRange:[],ruleForm:{fassionName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],fassionStartTime:[{required:!0,message:"请选择任务时间",trigger:"blur"}]},pickerOptions:{disabledDate(e){let s=Date.now()-864e5;return e.getTime()<s}}}),props:{isDetail:{type:Boolean,default:!1},baseData:{type:Object,defalult:{}}},watch:{dateRange:{deep:!0,handler(s,t){if(s&&s[0]){let t=new Date,a=t.getMinutes();t.setMinutes(a+1);let i=e(t,"HH:mm:ss");if(e(t,"YYYY-MM-DD")===e(s[0],"YYYY-MM-DD")){e(s[0],"HH:mm:ss")<i&&(this.dateRange[0]=e(new Date,"YYYY-MM-DD HH:mm:ss"))}}}},baseData:{handler(e){this.form=e,this.setData()},immediate:!0}},methods:{gotoNext(){this.$refs.ruleForm.validate((e=>{e&&(1==this.form.scopeType?1==this.form.fassionType?(this.$store.loading=!0,this.$refs.customerRangeForm.getCustomerList().then((e=>{(null==e?void 0:e.length)&&(this.form.senderList=e,this.$emit("next",1))})).finally((()=>{this.$store.loading=!1}))):2==this.form.fassionType&&this.$refs.fassionGroup.checkData()&&this.$emit("next",1):this.$emit("next",1))}))},setData(){this.form.fassionStartTime&&this.form.fassionEndTime&&(this.dateRange=[this.form.fassionStartTime,this.form.fassionEndTime])},setChange(e){e&&e[0]?this.form.fassionStartTime=e[0]:this.form.fassionStartTime="",e&&e[1]?this.form.fassionEndTime=e[1]:this.form.fassionEndTime="",this.$emit("update",this.form)},getData(e){this.form.executeUserOrGroup=e,this.$emit("update",this.form)}}},j={key:0,class:"g-footer-sticky",style:{"text-align":"center"}};const b=t(g,[["render",function(e,s,t,g,b,y){const D=a("el-input"),T=a("el-form-item"),Y=a("el-date-picker"),_=a("el-radio"),k=a("el-radio-group"),x=a("CustomerRangeForm"),$=a("SelectFassionGroup"),v=a("el-form"),w=a("el-button");return i(),o("div",null,[r("div",{class:"g-card",style:c(t.isDetail?"":"margin-top: 20px;")},[l(v,{model:b.form,rules:b.ruleForm,ref:"ruleForm","label-width":"140px",labelPosition:"right"},{default:m((()=>[l(T,{label:"任务名称",prop:"fassionName"},{default:m((()=>[l(D,{disabled:t.isDetail,modelValue:b.form.fassionName,"onUpdate:modelValue":s[0]||(s[0]=e=>b.form.fassionName=e),placeholder:"请输入名称",maxlength:"15","show-word-limit":"",clearable:""},null,8,["disabled","modelValue"])])),_:1}),d(e.$slots,"default"),l(T,{label:"任务时间",prop:"fassionStartTime"},{default:m((()=>[l(Y,n({disabled:t.isDetail,onChange:y.setChange,modelValue:b.dateRange,"onUpdate:modelValue":s[1]||(s[1]=e=>b.dateRange=e)},b.pickerOptions,{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right","value-format":"YYYY-MM-DD HH:mm:ss"}),null,16,["disabled","onChange","modelValue"])])),_:1}),1==b.form.fassionType?(i(),o(p,{key:0},[l(T,{label:"选择老客",required:""},{default:m((()=>[l(k,{modelValue:b.form.scopeType,"onUpdate:modelValue":s[2]||(s[2]=e=>b.form.scopeType=e),disabled:t.isDetail},{default:m((()=>[l(_,{label:0},{default:m((()=>[f("全部客户")])),_:1}),l(_,{label:1},{default:m((()=>[f("部分客户")])),_:1})])),_:1},8,["modelValue","disabled"])])),_:1}),1==b.form.scopeType?(i(),u(T,{key:0},{default:m((()=>[l(x,{ref:"customerRangeForm",isTrans:"",data:b.form.weCustomersQuery,"onUpdate:data":s[3]||(s[3]=e=>b.form.weCustomersQuery=e),disabled:t.isDetail,isDetail:t.isDetail},null,8,["data","disabled","isDetail"])])),_:1})):h("",!0)],64)):h("",!0),2==b.form.fassionType?(i(),o(p,{key:1},[l(T,{label:"选择客群",required:""},{default:m((()=>[l(k,{modelValue:b.form.scopeType,"onUpdate:modelValue":s[4]||(s[4]=e=>b.form.scopeType=e),disabled:t.isDetail},{default:m((()=>[l(_,{label:0},{default:m((()=>[f("全部")])),_:1}),l(_,{label:1},{default:m((()=>[f("选择群主")])),_:1})])),_:1},8,["modelValue","disabled"])])),_:1}),1==b.form.scopeType?(i(),u(T,{key:0},{default:m((()=>[l($,{isDetail:t.isDetail,ref:"fassionGroup",dataObj:b.form.executeUserOrGroup,onUpdate:y.getData},null,8,["isDetail","dataObj","onUpdate"])])),_:1})):h("",!0)],64)):h("",!0)])),_:3},8,["model","rules"])],4),t.isDetail?h("",!0):(i(),o("div",j,[l(w,{plain:"",onClick:s[5]||(s[5]=s=>e.$router.go(-1))},{default:m((()=>[f("取消")])),_:1}),l(w,{type:"primary",onClick:y.gotoNext},{default:m((()=>[f("下一步")])),_:1},8,["onClick"])]))])}]]);export{b as default};
