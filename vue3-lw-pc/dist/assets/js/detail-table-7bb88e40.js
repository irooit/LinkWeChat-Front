import{n as e,o as t}from"./api-0004a25c.js";import i from"./SubDetail-10d2f221.js";import{d as a}from"../index-044285d2.js";import{ai as l,aq as s,o as r,c as o,_ as n,U as u,Y as d,a as m,V as p,T as c,Z as b,$ as j,bl as h,bj as g}from"./@vue-e400fd81.js";import{_ as f}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const y={name:"task-customer-detail-table",components:{SubDetailVue:i},data:()=>({loading:!1,list:[],total:0,qrUserName:"",query:{customerName:"",pageNum:1,pageSize:10,weUserId:""},dialogVisible:!1,userArray:[],userArrayStr:"",detailVisible:!1,detailId:"",exportLoading:!1}),methods:{exportFn(){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,e(this.query)))).then((e=>{if(null!=e){let t=new Blob([e],{type:"application/vnd.ms-excel"}),i=window.URL.createObjectURL(t);const l=document.createElement("a");l.href=i,l.download="裂变明细"+a(new Date)+".xlsx",l.click(),URL.revokeObjectURL(i)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},getDetailTable(e){this.detailId=e,this.detailVisible=!0},getList(){this.loading=!0,this.query.fissionId=this.$route.query.id,t(this.query).then((e=>{this.loading=!1,this.list=e.rows,this.total=Number(e.total)}))},search(){this.query.pageNum=1,this.getList()},resetQuery(){this.query.weUserId="",this.query.customerName="",this.userArray=[],this.qrUserName="",this.search()},getSelectUser(e){this.userArray=e,this.qrUserName=this.userArray.map((function(e,t){return e.name})).join(","),this.query.weUserId=this.userArray.map((function(e,t){return e.userId})).join(",")}},created(){this.search()}},v={class:"g-card"},q={class:"mid-action"},U=(e=>(h("data-v-2de16103"),e=e(),g(),e))((()=>m("div",null,null,-1))),N=["onClick"];const w=f(y,[["render",function(e,t,i,a,h,g){const f=l("el-input"),y=l("el-form-item"),w=l("el-button"),I=l("el-form"),V=l("el-table-column"),x=l("el-table"),S=l("pagination"),_=l("SelectUser"),k=l("SubDetailVue"),L=s("loading");return r(),o("div",null,[n(I,{ref:"queryForm",model:h.query,inline:"",class:"top-search","label-position":"left","label-width":""},{default:u((()=>[n(y,{label:"",prop:"customerName"},{default:u((()=>[n(f,{clearable:"",modelValue:h.query.customerName,"onUpdate:modelValue":t[0]||(t[0]=e=>h.query.customerName=e),placeholder:"请输入老客名称"},null,8,["modelValue"])])),_:1}),n(y,{label:""},{default:u((()=>[n(f,{"model-value":h.qrUserName,readonly:"",onClick:t[1]||(t[1]=e=>h.dialogVisible=!0),placeholder:"请选择发送员工"},null,8,["model-value"])])),_:1}),n(y,{label:""},{default:u((()=>[n(w,{type:"primary",onClick:g.search},{default:u((()=>[d("查询")])),_:1},8,["onClick"]),n(w,{onClick:g.resetQuery},{default:u((()=>[d("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),m("div",v,[m("div",q,[U,m("div",null,[p((r(),c(w,{type:"primary",onClick:g.exportFn},{default:u((()=>[d("导出Excel")])),_:1},8,["onClick"])),[[L,h.exportLoading]])])]),p((r(),c(x,{data:h.list},{default:u((()=>[n(V,{prop:"oldCustomerName",label:"老客",align:"center"}),n(V,{prop:"sendWeUserName",label:"发送员工",align:"center"}),n(V,{prop:"inviterState",label:"裂变状态",align:"center"},{default:u((({row:e})=>[d(b(1==e.inviterState?"已完成":2==e.inviterState?"未完成":""),1)])),_:1}),n(V,{prop:"inviterNumber",label:"裂变新客数",align:"center"},{default:u((({row:e})=>[m("a",{class:"self_a",onClick:t=>g.getDetailTable(e.fissionInviterRecordId)},b(e.inviterNumber),9,N)])),_:1})])),_:1},8,["data"])),[[L,h.loading]]),p(n(S,{total:h.total,page:h.query.pageNum,"onUpdate:page":t[2]||(t[2]=e=>h.query.pageNum=e),limit:h.query.pageSize,"onUpdate:limit":t[3]||(t[3]=e=>h.query.pageSize=e),onPagination:g.getList},null,8,["total","page","limit","onPagination"]),[[j,h.total>0]])]),n(_,{visible:h.dialogVisible,"onUpdate:visible":t[4]||(t[4]=e=>h.dialogVisible=e),title:"组织架构",defaultValues:h.userArray,onSuccess:g.getSelectUser},null,8,["visible","defaultValues","onSuccess"]),n(k,{visible:h.detailVisible,"onUpdate:visible":t[5]||(t[5]=e=>h.detailVisible=e),fissionInviterRecordId:h.detailId},null,8,["visible","fissionInviterRecordId"])])}],["__scopeId","data-v-2de16103"]]);export{w as default};
