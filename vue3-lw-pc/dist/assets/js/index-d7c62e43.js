import{S as e}from"./sortablejs-b0ad9b27.js";import{u as t,d as s,a as l,b as a,g as i}from"./businessConver-2b86f97c.js";import{_ as o}from"./quill-image-resize-module-c051113e.js";import{ai as d,aq as r,o as n,c as m,a as u,_ as h,U as p,Y as g,V as c,T as f,X as b,Z as j,K as w,a9 as y,bl as S,bj as V}from"./@vue-e400fd81.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const _={name:"business-conversion-attr",components:{},data:()=>({dialogVisible:!1,loading:!1,list:[],dialog:{title:"新建阶段",state:"add",show:!1},form:{stageKey:"",stageDesc:""},rules:{stageKey:[{required:!0,message:"阶段名称不能为空",trigger:"blur"}],stageDesc:[{required:!0,message:"阶段描述不能为空",trigger:"blur"}]},infoType:[{name:"待跟进",key:1},{name:"跟进中",key:2},{name:"已结束",key:3}],deleteId:null,delObj:{show:!1,num:null,stageKey:"",stageVal:"",newStage:""},addId:""}),methods:{rowClassRender:({row:e})=>2==e.stageState?"item":"",setValue(e){let t="";return this.infoType.forEach((s=>{s.key==e&&(t=s.name)})),t},updateSort(){this.list.forEach(((e,t)=>{e.sort=t+1})),t(this.list)},dragSort(){const t=this.$refs.table.$el.querySelectorAll(".el-table__body-wrapper table > tbody")[0];this.sortable=e.create(t,{draggable:".item",ghostClass:"sortable-ghost",setData:function(e){e.setData("Text","")},onEnd:e=>{if(e.oldIndex!==e.newIndex){const t=this.list.splice(e.oldIndex,1)[0];this.list.splice(e.newIndex,0,t),this.updateSort()}}})},deleteSubmit(){this.delObj.newStage?s({id:this.deleteId,growStageVal:this.delObj.stageVal}).then((e=>{this.msgSuccess("操作成功！"),this.delObj.show=!1,this.getList("delete")})).catch((()=>{this.msgError("操作失败！"),this.delObj.show=!1})):this.msgError("请选择新阶段！")},deleteFn(e){this.delObj={show:!1,num:null,stageKey:e.stageKey,stageVal:e.stageVal,newStage:""},this.deleteId=e.id,l(e.stageVal).then((t=>{t.data.customerNumbwe?(this.delObj.num=t.data.customerNumbwe,this.delObj.show=!0):this.$confirm(`是否删除【${e.stageKey}】阶段？删除后立即生效且不可撤销，请谨慎操作。`,"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{s({id:e.id}).then((e=>{this.msgSuccess("操作成功！"),this.getList("delete")}))})).catch((()=>{}))}))},editFn(e){this.form=e,this.dialog.show=!0},submit(){this.$refs.form.validate((e=>{e&&(!this.form.id&&(this.form.sort=this.list.length+1),(this.form.id?t:a)(this.form.id?[this.form]:this.form).then((e=>{this.form.id||(this.addId=e.data.id),this.getList(1),this.msgSuccess("操作成功！"),this.dialog.show=!1})).catch((e=>{this.msgError("操作失败！"),this.dialog.show=!1})))}))},resetSort(){let e=JSON.parse(JSON.stringify(this.list)),t={};e.forEach(((s,l)=>{s.id==this.addId&&(t=s,e.splice(l,1))}));let s=e.findLastIndex((e=>2==e.stageState));-1!==s?e.splice(s+1,0,t):e.splice(1,0,t),this.list=JSON.parse(JSON.stringify(e)),this.addId="",this.updateSort()},setField(e){this.form={stageKey:""},this.dialog.show=!0},newInputConfirm(){},getList(e){this.loading=!0,i(this.query).then((t=>{this.loading=!1,this.list=t.data,"init"==e&&this.dragSort(),"delete"==e&&this.updateSort(),this.addId&&this.resetSort()}))}},mounted(){this.getList("init")},created(){this.$store.setBusininessDesc("\n          <div>可自定义修改企业客户的画像信息项供企业个性化使用</div>\n        ")}},v={class:"g-card"},k={class:"g-card-title mid-action"},x=(e=>(S("data-v-444a95a3"),e=e(),V(),e))((()=>u("div",null,"操作",-1)));const O=o(_,[["render",function(e,t,s,l,a,i){const o=d("el-button"),S=d("svg-icon"),V=d("el-table-column"),_=d("el-table"),O=d("el-option"),C=d("el-select"),I=d("el-form-item"),K=d("el-form"),D=d("el-dialog"),q=d("el-input"),E=r("loading");return n(),m("div",null,[u("div",v,[u("div",k,[h(o,{type:"primary",onClick:i.setField},{default:p((()=>[g("新建阶段")])),_:1},8,["onClick"])]),c((n(),f(_,{ref:"table","row-key":"id",data:a.list,"row-class-name":i.rowClassRender},{default:p((()=>[h(V,{label:"",width:"50",align:"left"},{default:p((({row:e})=>[2==e.stageState?(n(),f(S,{key:0,icon:"dragIcon"})):b("",!0)])),_:1}),h(V,{label:"阶段名称",align:"center",prop:"stageKey"}),h(V,{label:"阶段描述",align:"center",prop:"stageDesc"}),h(V,{label:"阶段状态",align:"center",prop:"stageState"},{default:p((({row:e})=>[g(j(i.setValue(e.stageState)),1)])),_:1}),h(V,{label:"操作",align:"center",width:"200",fixed:"right"},{header:p((()=>[x])),default:p((({row:e})=>[h(o,{text:"",disabled:1==e.isDefault&&2!=e.stageState,onClick:t=>i.editFn(e)},{default:p((()=>[g("编辑")])),_:2},1032,["disabled","onClick"]),h(o,{text:"",disabled:1==e.isDefault&&2!=e.stageState,onClick:t=>i.deleteFn(e)},{default:p((()=>[g(" 删除 ")])),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data","row-class-name"])),[[E,a.loading]])]),h(D,{title:"提示",modelValue:a.delObj.show,"onUpdate:modelValue":t[2]||(t[2]=e=>a.delObj.show=e),"close-on-click-modal":!1},{footer:p((()=>[u("div",null,[h(o,{onClick:t[1]||(t[1]=e=>a.delObj.show=!1)},{default:p((()=>[g("取 消")])),_:1}),h(o,{type:"primary",onClick:i.deleteSubmit},{default:p((()=>[g("确 定")])),_:1},8,["onClick"])])])),default:p((()=>[u("div",null,[u("span",null," 当前共有【"+j(a.delObj.num)+"】个客户正处于【"+j(a.delObj.stageKey)+"】阶段，删除阶段需要为这些客户分配一个新状态，分配后立即生效且不可撤销，请谨慎操作。 ",1),h(K,{ref:"form",rules:a.rules,model:a.form,"label-position":"left","label-width":"120px"},{default:p((()=>[h(I,{label:"新阶段"},{default:p((()=>[h(C,{modelValue:a.delObj.newStage,"onUpdate:modelValue":t[0]||(t[0]=e=>a.delObj.newStage=e)},{default:p((()=>[(n(!0),m(w,null,y(a.list,((e,t)=>(n(),f(O,{key:t,label:e.stageKey,value:e.stageVal},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),h(D,{title:a.dialog.title,modelValue:a.dialog.show,"onUpdate:modelValue":t[6]||(t[6]=e=>a.dialog.show=e),"close-on-click-modal":!1},{footer:p((()=>[u("div",null,[h(o,{onClick:t[5]||(t[5]=e=>a.dialog.show=!1)},{default:p((()=>[g("取 消")])),_:1}),h(o,{type:"primary",onClick:i.submit},{default:p((()=>[g("确 定")])),_:1},8,["onClick"])])])),default:p((()=>[u("div",null,[h(K,{ref:"form",rules:a.rules,model:a.form,"label-position":"left","label-width":"120px"},{default:p((()=>[h(I,{label:"阶段名称",prop:"stageKey"},{default:p((()=>[h(q,{style:{width:"250px"},modelValue:a.form.stageKey,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.stageKey=e),placeholder:"请输入阶段名称",maxlength:"10","show-word-limit":""},null,8,["modelValue"])])),_:1}),h(I,{label:"阶段描述",prop:"stageDesc"},{default:p((()=>[h(q,{style:{width:"250px"},type:"textarea",modelValue:a.form.stageDesc,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.stageDesc=e),placeholder:"请输入阶段描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue"])])}],["__scopeId","data-v-444a95a3"]]);export{O as default};
