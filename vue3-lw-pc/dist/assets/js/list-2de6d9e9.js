import{_ as e}from"../index-044285d2.js";import{g as s,s as i,u as l,b as t,r as a,a as o}from"./appManage-10b8c536.js";import{_ as d}from"./quill-image-resize-module-c051113e.js";import{aU as r,ai as m,aq as n,o as g,c,V as u,K as p,a9 as f,a as b,_ as h,Z as j,U as V,Y as M,X as y,T as _,bl as v,bj as k}from"./@vue-e400fd81.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const I={components:{HistoryMsg:r((()=>e((()=>import("./HistoryMsg-01688956.js")),["assets/js/HistoryMsg-01688956.js","assets/js/appManage-10b8c536.js","assets/index-044285d2.js","assets/js/js-cookie-8253c38e.js","assets/js/@vue-e400fd81.js","assets/js/vue-router-f8d53be7.js","assets/js/element-plus-68ba2566.js","assets/js/lodash-es-d4f5f48c.js","assets/js/@element-plus-214e0f7b.js","assets/js/@popperjs-b78c3215.js","assets/js/@ctrl-91de2ec7.js","assets/js/dayjs-c17bc6b2.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/async-validator-cf877c1f.js","assets/js/memoize-one-63ab667a.js","assets/js/normalize-wheel-es-3222b0a2.js","assets/js/@floating-ui-36fbce82.js","assets/css/element-plus-3888a320.css","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/js/pinia-1b56b17e.js","assets/js/vue-demi-71ba0ef2.js","assets/js/jsencrypt-43f479c1.js","assets/js/crypto-js-d6a67473.js","assets/js/ali-oss-912914b8.js","assets/js/axios-fb5f9e0e.js","assets/js/@vueuse-4025ce01.js","assets/js/path-browserify-289407ee.js","assets/js/nprogress-a39edb90.js","assets/css/nprogress-771398e6.css","assets/js/clipboard-7a0da8dc.js","assets/css/index-b5531375.css","assets/css/normalize-9d9ae4af.css"]))),MsgForm:r((()=>e((()=>import("./MsgForm-8a3748ce.js")),["assets/js/MsgForm-8a3748ce.js","assets/js/quill-image-resize-module-c051113e.js","assets/js/quill-c6b3d2fb.js","assets/js/@babel-efd68da6.js","assets/js/to-fast-properties-1160b370.js","assets/js/quill-delta-a1872f89.js","assets/js/fast-diff-d5a53119.js","assets/js/lodash.clonedeep-1b6eefdc.js","assets/js/lodash.isequal-e7d08617.js","assets/js/@vueup-7cf8cfdd.js","assets/js/@vue-e400fd81.js","assets/css/@vueup-da05906a.css","assets/css/quill-image-resize-module-44eb40f8.css","assets/css/MsgForm-dedc1a82.css"])))},props:{},data:()=>({query:{},form:{},list:[],dialogVisible:!1,disabled:!1,loading:!1,rules:Object.freeze({agentId:[{required:!0,message:"必填项",trigger:"blur"}],name:[{required:!0,message:"必填项",trigger:"blur"}],description:[{required:!0,message:"必填项",trigger:"blur"}],logoUrl:[{required:!0,message:"必填项",trigger:"change"}]}),formMsg:{},dialogVisibleHistoryMsg:!1,dialogVisibleSendMsg:!1,disabledMsg:!1}),watch:{},computed:{},created(){this.getList(),this.$store.setBusininessDesc("<div>企业微信自建应用管理，支持通过应用发送应用消息</div> ")},mounted(){},methods:{getList(e){this.loading=!0,s().then((({data:e,total:s})=>{e.forEach((e=>{e.allowPartyName=(e.allowPartyName||"").split(","),e.allowUserinfoName=(e.allowUserinfoName||"").split(",")})),this.list=e})).finally((()=>{this.loading=!1}))},sync(e){i(e.id).then((({data:s})=>{Object.assign(e,s),this.getList(),this.msgSuccess("操作成功")}))},edit(e,s){this.form=Object.assign({},e||{}),this.dialogVisible=!0,this.disabled=!(s||!e),this.$nextTick((()=>{this.$refs.form.clearValidate()}))},submit(){this.$refs.form.validate((e=>{e&&(this.form.agentId=Number(this.form.agentId),(this.form.id?l:t)(this.form).then((()=>{this.msgSuccess("操作成功"),this.dialogVisible=!1,this.getList()})).catch((()=>{this.dialogVisible=!1})))}))},remove(e){this.$confirm("是否确认删除？该操作不可撤销，请谨慎操作。",{title:"警告",confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return a(e)})).then((()=>{this.getList(),this.msgSuccess("删除成功")}))},submitSendMsg(e){e?(e.id?o.update:o.add)(e).then((()=>{this.msgSuccess("操作成功"),this.dialogVisibleSendMsg=!1,this.dialogVisibleHistoryMsg&&this.$refs.historyMsg.getList()})).catch((()=>{this.dialogVisibleSendMsg=!1})):this.dialogVisibleSendMsg=!1}}},U=e=>(v("data-v-8afa2965"),e=e(),k(),e),x={class:"list-wrap"},S={class:"list-item"},w={class:"flex"},C={class:""},q={class:"title blod toe"},N={class:"desc"},H={class:"flex aic mt10"},L=U((()=>b("div",{class:"list-label"},"AgentId",-1))),E={class:"flex aic mt10"},O=U((()=>b("div",{class:"list-label"},"可见范围",-1))),T={class:"list-action fxbw"},A={class:"ac flex aic cp theme list-item",style:{"justify-content":"center"}},$=U((()=>b("div",{class:"dialog-tip"},"如何获取：企微后台->应用管理->自建应用详情->AgentId",-1))),z=U((()=>b("div",{class:"dialog-tip"},"如何获取：企微后台->应用管理->自建应用详情->Secret",-1)));const D=d(I,[["render",function(e,s,i,l,t,a){const o=m("el-image"),d=m("el-button"),r=m("TagEllipsis"),v=m("el-icon-plus"),k=m("el-input"),I=m("el-form-item"),U=m("upload"),D=m("el-form"),P=m("el-dialog"),B=m("HistoryMsg"),F=m("MsgForm"),K=n("loading");return g(),c("div",null,[u((g(),c("ul",x,[(g(!0),c(p,null,f(t.list,((e,s)=>(g(),c("li",{key:s,class:"list"},[b("div",S,[b("div",w,[h(o,{src:e.logoUrl,fit:"fill"},null,8,["src"]),b("div",C,[b("div",q,j(e.name),1),b("div",N,j(e.description),1),h(d,{type:"primary",plain:"",onClick:s=>a.sync(e)},{default:V((()=>[M("同步")])),_:2},1032,["onClick"])])]),b("div",H,[L,M(" "+j(e.agentId),1)]),b("div",E,[O,h(r,{list:e.allowPartyName},null,8,["list"])]),b("div",T,[h(d,{text:"",onClick:s=>{t.formMsg={agentName:e.name,agentId:e.agentId},t.disabledMsg=!1,t.dialogVisibleSendMsg=!0}},{default:V((()=>[M(" 发送消息 ")])),_:2},1032,["onClick"]),h(d,{text:"",onClick:s=>{t.formMsg={agentName:e.name,agentId:e.agentId},t.dialogVisibleHistoryMsg=!0}},{default:V((()=>[M(" 历史消息 ")])),_:2},1032,["onClick"]),h(d,{text:"",onClick:s=>a.edit(e)},{default:V((()=>[M("编辑")])),_:2},1032,["onClick"]),h(d,{text:"",onClick:s=>a.remove(e.id)},{default:V((()=>[M("删除")])),_:2},1032,["onClick"])])])])))),128)),b("li",{class:"list",onClick:s[0]||(s[0]=e=>a.edit())},[b("div",A,[h(v,{class:"el-icon-plus"}),M(" 添加应用 ")])])])),[[K,t.loading]]),h(P,{title:t.form.id?"编辑":"添加",modelValue:t.dialogVisible,"onUpdate:modelValue":s[7]||(s[7]=e=>t.dialogVisible=e),"close-on-click-modal":!1,width:"580px"},{footer:V((()=>[b("div",null,[h(d,{onClick:s[6]||(s[6]=e=>t.dialogVisible=!1)},{default:V((()=>[M("取 消")])),_:1}),h(d,{type:"primary",onClick:a.submit},{default:V((()=>[M("确 定")])),_:1},8,["onClick"])])])),default:V((()=>[h(D,{ref:"form","label-position":"right",model:t.form,rules:t.rules,"label-width":"80px"},{default:V((()=>[h(I,{label:"应用ID",prop:"agentId"},{default:V((()=>[h(k,{modelValue:t.form.agentId,"onUpdate:modelValue":s[1]||(s[1]=e=>t.form.agentId=e),placeholder:"请输入应用 AgentId"},null,8,["modelValue"]),$])),_:1}),h(I,{label:"应用密钥",prop:"secret",rules:{required:!t.form.agentId,message:"必填项",trigger:"blur"}},{default:V((()=>[h(k,{modelValue:t.form.secret,"onUpdate:modelValue":s[2]||(s[2]=e=>t.form.secret=e),placeholder:"请输入应用 Secret"},null,8,["modelValue"]),z])),_:1},8,["rules"]),t.form.id?(g(),c(p,{key:0},[h(I,{label:"应用名称",prop:"name"},{default:V((()=>[h(k,{modelValue:t.form.name,"onUpdate:modelValue":s[3]||(s[3]=e=>t.form.name=e),maxlength:"16","show-word-limit":"",placeholder:"请输入应用名称"},null,8,["modelValue"])])),_:1}),h(I,{label:"应用描述",prop:"description"},{default:V((()=>[h(k,{type:"textarea",modelValue:t.form.description,"onUpdate:modelValue":s[4]||(s[4]=e=>t.form.description=e),maxlength:"60","show-word-limit":"",placeholder:"请输入应用描述"},null,8,["modelValue"])])),_:1}),h(I,{label:"应用头像",prop:"logoUrl"},{default:V((()=>[h(U,{class:"image-uploader",fileUrl:t.form.logoUrl,"onUpdate:fileUrl":s[5]||(s[5]=e=>t.form.logoUrl=e),type:"0"},null,8,["fileUrl"])])),_:1})],64)):y("",!0)])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),h(P,{title:"历史消息",modelValue:t.dialogVisibleHistoryMsg,"onUpdate:modelValue":s[9]||(s[9]=e=>t.dialogVisibleHistoryMsg=e),"close-on-click-modal":!1},{default:V((()=>[t.dialogVisibleHistoryMsg?(g(),_(B,{key:0,ref:"historyMsg",id:t.formMsg.agentId,onEdit:s[8]||(s[8]=(e,s)=>{t.dialogVisibleSendMsg=!0,t.disabledMsg="detail"===s,t.formMsg=Object.assign({agentId:t.formMsg.agentId,agentName:t.formMsg.agentName},e)})},null,8,["id"])):y("",!0)])),_:1},8,["modelValue"]),h(P,{title:"发送消息",modelValue:t.dialogVisibleSendMsg,"onUpdate:modelValue":s[10]||(s[10]=e=>t.dialogVisibleSendMsg=e),"close-on-click-modal":!1},{default:V((()=>[t.dialogVisibleSendMsg?(g(),_(F,{key:0,data:t.formMsg,disabled:t.disabledMsg,onSubmit:a.submitSendMsg},null,8,["data","disabled","onSubmit"])):y("",!0)])),_:1},8,["modelValue"])])}],["__scopeId","data-v-8afa2965"]]);export{D as default};
