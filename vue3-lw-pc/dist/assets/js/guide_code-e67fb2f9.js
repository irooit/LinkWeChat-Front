import e from"./PreviewInStore-85980d06.js";import{l as t,c as s}from"./store-1f3cfa19.js";import{A as i}from"./AddMaterial-51d9aa5c.js";import{_ as a}from"./quill-image-resize-module-c051113e.js";import{ai as r,o as l,c as o,a as m,_ as d,U as c,T as n,Y as p,K as u,a9 as f,Z as h,X as g,bl as j,bj as v}from"./@vue-e400fd81.js";import"./code-ab4e587b.js";import"./quill-c6b3d2fb.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./PreviewInPhone-9ed75a0f.js";import"./index-0bf429ac.js";import"./scriptCenter-9e8c6ca2.js";import"./modleCenter-5112f339.js";import"./DragTable-97e90e96.js";import"./sortablejs-b0ad9b27.js";import"./MessageContentForm-5a22ed37.js";import"./staff-48996164.js";import"./PicTitContent-8b500b6d.js";import"./PosterAdd-51b39872.js";import"./index-618cff16.js";import"./tag-13936295.js";import"./fabric-8da0df30.js";import"./poster-241340a9.js";import"./liveCodeTable-73b404a8.js";import"./group-16414119.js";import"./pullNews-68e01d94.js";import"./TemplateLibrary-f59d0076.js";import"./welcome-6ff4c53e.js";function b(e,t,s){""!=t&&(Number.isNaN(Number(t))||Number(t)<1||Number(t)>10||t.toString().indexOf(".")>-1)?s("请输入 1-100 的正整数"):s()}const S={name:"guide-add",data:()=>({currentActive:1,dialogVisibleSelectUser:!1,selectedUserList:[],dialogVisibleSelectTag:!1,selectedTagList:[],form:{addOrUpdate:!0,raidus:3,outOfRangeTip:"您所在区域暂未开设门店，可联系客服或手动搜索",codeState:1,storeCodeType:1,customerServiceName:"",customerServiceId:""},materialData:{templateInfo:"",attachments:[]},loading:!1,rule:{raidus:[{required:!0,message:"请输入门店范围",trigger:"blur"},{validator:b,trigger:"change"}],outOfRangeTip:[{required:!0,message:"请输入超出范围提示",trigger:"blur"}]}}),components:{PreviewClient:e,AddMaterial:i},created(){this.init()},methods:{setChange(e){1===e&&(this.selectUserList=[],this.form.customerServiceName="",this.form.customerServiceId="")},onSelectUser(){this.dialogVisibleSelectUser=!0},selectedUser(e){this.selectedUserList=e,e&&e.length?(this.form.customerServiceName=e[0].name,this.form.customerServiceId=e[0].userId):(this.form.customerServiceName="",this.form.customerServiceId="")},submitSelectTag(e){this.selectedTagList=e},cancelFn(){this.$router.back()},nextStep(){this.$refs.form.validate((e=>{e&&(0===this.form.codeState?this.form.customerServiceId?this.currentActive=2:this.msgError("开启了活码员工客服， 请选择员工"):this.currentActive=2)}))},getWelData(e){this.submit(e)},submit(e){if(this.loading=!0,this.selectedTagList.length){let e=[],t=[];this.selectedTagList.forEach((s=>{e.push(s.name),t.push(s.tagId)})),this.form.tagIds=t.join(","),this.form.tagNames=e.join(",")}let s=e.attachments,i={...this.form,attachments:[{content:e.templateInfo,msgType:"text"}]};i.attachments.push(...s),i.addOrUpdate=!i.id,t(i).then((({data:e})=>{this.msgSuccess("操作成功"),this.$router.back(),this.loading=!1}))},init(){s(1).then((({data:e})=>{if(null==e?void 0:e.id){if(this.form=e,this.form.customerServiceId){let e={name:this.form.customerServiceName,userId:this.form.customerServiceId};this.selectedUserList=[e]}if(this.materialData={templateInfo:this.form.weQrAttachments?this.form.weQrAttachments[0].content:"",attachments:this.form.weQrAttachments},this.form.tagIds){this.selectedTagList=[];let e=this.form.tagIds.split(","),t=this.form.tagNames.split(",");e.forEach(((e,s)=>{this.selectedTagList.push({tagId:e,name:t[s]})}))}}}))}}},y=e=>(j("data-v-63ca7e5f"),e=e(),v(),e),T={class:"g-card"},U={class:"g-card"},w=y((()=>m("div",{class:"sub-des"},"开启后，当客户超过范围时显示该员工客服的二维码",-1))),I={key:0},_=y((()=>m("div",{class:"sub-des"},"添加成功后，该客户将会自动设置以上选择标签",-1))),x={class:"g-card mt20 pad20"},L={class:"g-card",style:{height:"100%",display:"flex"}};const V=a(S,[["render",function(e,t,s,i,a,j){const v=r("el-step"),b=r("el-steps"),S=r("el-input"),y=r("el-form-item"),V=r("el-switch"),k=r("el-tag"),C=r("el-button"),A=r("el-form"),N=r("el-col"),O=r("preview-client"),D=r("el-row"),q=r("AddMaterial"),P=r("SelectUser"),R=r("SelectTag");return l(),o("div",null,[m("div",T,[d(b,{active:a.currentActive,"align-center":"","finish-status":"success"},{default:c((()=>[d(v,{title:"活码设置"}),d(v,{title:"欢迎语"})])),_:1},8,["active"])]),1===a.currentActive?(l(),n(D,{key:0,gutter:10,type:"flex",style:{"margin-top":"10px"}},{default:c((()=>[d(N,null,{default:c((()=>[d(A,{model:a.form,ref:"form",rules:a.rule,"label-width":"120px","label-position":"right"},{default:c((()=>[m("div",U,[d(y,{label:"门店范围：",prop:"raidus"},{default:c((()=>[p(" 距离门店半径 "),d(S,{modelValue:a.form.raidus,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.raidus=e),style:{width:"50px"}},null,8,["modelValue"]),p(" 公里范围内，客户可扫码添加门店群 ")])),_:1}),d(y,{label:"超出范围提示：",prop:"outOfRangeTip"},{default:c((()=>[d(S,{modelValue:a.form.outOfRangeTip,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.outOfRangeTip=e),style:{width:"350px"},type:"textarea",maxlength:"30","show-word-limit":"",placeholder:"请输入",autosize:{minRows:3,maxRows:20},clearable:""},null,8,["modelValue"])])),_:1}),d(y,{label:"活码员工客服："},{default:c((()=>[d(V,{onChange:j.setChange,modelValue:a.form.codeState,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.codeState=e),"active-value":0,"inactive-value":1},null,8,["onChange","modelValue"]),w,0===a.form.codeState?(l(),o(u,{key:0},[a.selectedUserList.length>0?(l(),o("div",I,[(l(!0),o(u,null,f(a.selectedUserList,((e,t)=>(l(),n(k,{key:t},{default:c((()=>[p(h(e.name),1)])),_:2},1024)))),128))])):g("",!0),d(C,{type:"primary",plain:"",icon:"el-icon-plus",onClick:j.onSelectUser},{default:c((()=>[p(h(a.selectedUserList.length?"编辑":"选择")+"员工 ",1)])),_:1},8,["onClick"])],64)):g("",!0)])),_:1}),d(y,{label:"新客户标签"},{default:c((()=>[(l(!0),o(u,null,f(a.selectedTagList,((e,t)=>(l(),o(u,{key:t},[e.name?(l(),n(k,{key:0},{default:c((()=>[p(h(e.name),1)])),_:2},1024)):g("",!0)],64)))),128)),m("div",null,[d(C,{type:"primary",icon:"el-icon-plus",onClick:t[3]||(t[3]=e=>a.dialogVisibleSelectTag=!0)},{default:c((()=>[p(h(0==a.selectedTagList.length?"添加":"编辑")+"标签 ",1)])),_:1})]),_])),_:1})]),m("div",x,[d(C,{plain:"",onClick:j.cancelFn},{default:c((()=>[p("取消")])),_:1},8,["onClick"]),d(C,{type:"primary",onClick:t[4]||(t[4]=e=>j.nextStep())},{default:c((()=>[p("下一步")])),_:1})])])),_:1},8,["model","rules"])])),_:1}),d(N,{style:{"flex-basis":"350px"}},{default:c((()=>[m("div",L,[d(O,{showTip:!0,name:"专属门店导购",value:a.form},null,8,["value"])])])),_:1})])),_:1})):g("",!0),2===a.currentActive?(l(),n(q,{key:1,moduleType:4,otherType:4,onUpdate:t[5]||(t[5]=e=>a.currentActive=1),onSubmit:j.getWelData,baseData:a.materialData,isTransData:"",showModle:!0},null,8,["onSubmit","baseData"])):g("",!0),d(P,{visible:a.dialogVisibleSelectUser,"onUpdate:visible":t[6]||(t[6]=e=>a.dialogVisibleSelectUser=e),title:"选择员工",isOnlyLeaf:!0,isSigleSelect:!0,defaultValues:a.selectedUserList,onSuccess:j.selectedUser},null,8,["visible","defaultValues","onSuccess"]),d(R,{visible:a.dialogVisibleSelectTag,"onUpdate:visible":t[7]||(t[7]=e=>a.dialogVisibleSelectTag=e),selected:a.selectedTagList,onSuccess:j.submitSelectTag},null,8,["visible","selected","onSuccess"])])}],["__scopeId","data-v-63ca7e5f"]]);export{V as default};
