import e from"./PreviewInPhone-9ed75a0f.js";import{g as t}from"./index-0bf429ac.js";import{l as a,a as i}from"./scriptCenter-9e8c6ca2.js";import{t as l,a as s}from"./modleCenter-5112f339.js";import{D as r}from"./DragTable-97e90e96.js";import{M as o,a as m}from"./MessageContentForm-5a22ed37.js";import{c as n}from"./clipboard-7a0da8dc.js";import{g as p}from"./poster-241340a9.js";import{T as d}from"./TemplateLibrary-f59d0076.js";import{ai as h,o as c,c as g,_ as u,U as y,Y as f,X as T,Z as k,a as b,T as U,V as j,$ as L,bl as I,bj as w}from"./@vue-e400fd81.js";import{_ as v}from"./quill-image-resize-module-c051113e.js";import"./quill-c6b3d2fb.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./sortablejs-b0ad9b27.js";import"./staff-48996164.js";import"./PicTitContent-8b500b6d.js";import"./PosterAdd-51b39872.js";import"./index-618cff16.js";import"./tag-13936295.js";import"./fabric-8da0df30.js";import"./liveCodeTable-73b404a8.js";import"./group-16414119.js";import"./pullNews-68e01d94.js";import"./welcome-6ff4c53e.js";const x={name:"add-material",components:{PreviewInPhone:e,DragTable:r,MaterialCenter:o,getPosterInfo:p,TemplateLibrary:d,MessageContentForm:m},data:()=>({titleOne:"欢迎语",lableOne:"欢迎语",titleTwo:"欢迎语附件",templateInfo:"",userInfo:"",editMaterialForm:{},choseDialog:!1,ids:[],groupProps:{expandTrigger:"hover",checkStrictly:!0,children:"children",label:"name",value:"id",emitPath:!1},mobForm:{welcomeMsg:"",materialMsgList:[],userIds:"",userNames:""},form:{weMaterialImgAoList:[]},talkForm:{},treeData:[{}],talkRules:Object.freeze({categoryId:[{required:!0,message:"不能为空",trigger:"change"}],talkTitle:[{required:!0,message:"不能为空",trigger:"blur"}]}),type:void 0,dialogVisible:!1,talkLoading:!1,talkList:[],users:[],selectedUserList:[],dialogVisibleSelectUser:!1,isedit:!1,welcomVisible:!1,fontType:"",maxlength:9,libraryLoading:!1}),props:{baseData:{type:Object,default:()=>({templateInfo:"",attachments:[]})},maxlengthTwo:{type:Number,default:9},talkId:{type:n.string,default:null},modelId:{type:n.string,default:null},talkType:{type:n.string,default:null},templateType:{type:Number,default:1},tplType:{type:String,default:null},moduleType:{type:Number,default:4},iswelcom:{type:Boolean,default:!1},showModle:{type:Boolean,default:!0},otherType:{type:Number,default:null},showPhone:{type:Boolean,default:!0},liveUrl:{type:String,default:null},showFooter:{type:Boolean,default:!0}},watch:{talkForm:{handler(e){this.changeInfo(e.templateInfo)},deep:!0},maxlengthTwo:{handler(e){this.maxlength=e}},baseData(e){e.templateInfo&&(this.form.templateInfo=e.templateInfo,this.form.attachments=e.attachments,this.form.templateInfo&&(this.talkForm=this.form,this.talkList=this.form.attachments))},talkId:{handler(e){e&&this.getDeatil(e)},immediate:!0},modelId:{handler(e){e&&this.getTelDeatil(e)},immediate:!0}},methods:{changeInfo(e){this.$emit("changeInfo",e)},dialogClose(e,t){this.dialogVisible=e,t&&(this.talkList=[...t],this.$emit("phoneData",this.talkList),this.$emit("success",this.setResult()))},setResult(){let e=[];return this.talkList.forEach((t=>{let a={};switch(a.materialId=t.id,t.mediaType){case"0":a.picUrl=t.materialUrl,a.msgType="image";break;case"2":a.picUrl=t.coverUrl,a.fileUrl=t.materialUrl,a.description=t.digest,a.title=t.materialName,a.msgType="video";break;case"3":a.picUrl=this.filPicType(t.materialUrl),a.fileUrl=t.materialUrl,a.description=t.digest,a.title=t.materialName,a.msgType="file";break;case"4":a.content=t.content,a.msgType="text";break;case"5":a.fileUrl=t.materialUrl,a.msgType="posters";break;case"9":a.content=t.content,a.picUrl=t.coverUrl,a.linkUrl=t.materialUrl,a.title=t.materialName,a.msgType="link";break;case"11":a.picUrl=t.coverUrl,a.fileUrl=t.materialUrl,a.appId=t.digest,a.title=t.materialName,a.msgType="miniprogram";break;case"12":a.fileUrl=t.materialUrl,a.description=t.digest,a.content=t.content,a.picUrl=t.coverUrl,a.title=t.materialName,a.msgType="news"}e.push(a)})),e},filPicType(e){let t=JSON.parse(JSON.stringify(e));t=t.split(".");let a=t[t.length-1];return"pdf"===a?window.lwConfig.DEFAULT_H5_PDF:["doc","docx"].includes(a)?window.lwConfig.DEFAULT_H5_WORDE:["ppt","pptx","pps","pptsx"].includes(a)?window.lwConfig.DEFAULT_H5_PPT:""},dealType(){if(4===this.moduleType)switch(this.otherType){case 1:case 4:this.titleOne="欢迎语",this.lableOne="欢迎语",this.titleTwo="欢迎语附件";break;case 2:this.titleOne="群发内容",this.lableOne="内容",this.titleTwo="群发附件";break;case 3:this.titleOne="动态内容",this.lableOne="动态文本"}else this.iswelcom?(this.titleOne="欢迎语",this.lableOne="欢迎语",this.titleTwo="欢迎语附件"):2===this.templateType?(this.lableOne="群发内容",this.titleTwo="群发附件"):3===this.templateType?(this.lableOne=" SOP内容",this.titleTwo="群发附件"):(this.titleOne="欢迎语",this.lableOne="消息内容",this.titleTwo="话术素材")},selectModle(){this.libraryLoading=!0,this.selectObj?(this.talkForm=this.selectObj,this.welcomVisible=!1,this.talkList=[...this.selectObj.weMaterialList],this.$emit("phoneData",[...this.selectObj.weMaterialList]),this.$emit("changeInfo",this.selectObj.templateInfo),this.$emit("success",this.setResult())):this.$message.error("请选择模板"),this.libraryLoading=!1},changeObj(e){e&&l(e).then((e=>{this.selectObj=e.data}))},setUserData(){this.selectedUserList=[];let e=[];this.talkForm.userIds&&(e=this.talkForm.userIds.split(",").map(((e,t)=>({userId:e,name:this.talkForm.userNames.split(",")[t]})))),this.users=e},onSelectUser(){this.selectedUserList=[];let e=[];this.talkForm.userIds&&(e=this.talkForm.userIds.split(",").map(((e,t)=>({userId:e,name:this.talkForm.userNames.split(",")[t]})))),this.selectedUserList=e,this.dialogVisibleSelectUser=!0},selectedUser(e){let t=[],a=[];const i=e.map((e=>(t.push(e.userId),a.push(e.name),{userId:e.userId,name:e.name})));this.users=i,this.talkForm.userIds=t.join(","),this.talkForm.userNames=a.join(",")},getDeatil(e){a(e).then((e=>{this.talkForm=e.data,this.talkList=e.data.weMaterialList})).catch((()=>{}))},getTelDeatil(e){l(e).then((e=>{this.talkForm=e.data,this.talkList=e.data.weMaterialList,this.setUserData()})).catch((()=>{}))},getEdit(e){this.type=e.mediaType,this.editMaterialForm=JSON.parse(JSON.stringify(e))},setData(e){this.talkList=e,this.$emit("phoneData",this.talkList),this.$emit("success",this.setResult())},getItemArry(e){this.talkList=this.talkList.concat(e),this.$emit("phoneData",this.talkList),this.$emit("success",this.setResult())},centerSubmit(){},selectCenter(){},choseCenter(){this.choseDialog=!0},getIds(e){this.ids=e},moveGroup(e){this.type="",this.type=e,3===this.otherType&&"2"==e?this.choseDialog=!0:this.dialogVisible=!0},getTree(){var e=null;0==this.talkType?e=13:1==this.talkType&&(e=14),2==this.templateType?e=17:3==this.templateType&&(e=16),t(e).then((({data:e})=>{this.treeData=[{id:"",name:"全部",parentId:"0",hasParent:!1,hasChildren:!0,children:e||[]}]}))},tackSubmit(){return this.talkLoading=!0,[3,4].includes(this.moduleType)&&!this.talkForm.templateInfo?(this.templateInfo="请输入"+this.lableOne,void(this.talkLoading=!1)):(this.templateInfo="",this.talkForm.userIds||2!=this.tplType?(this.userInfo="","0"===this.talkType?this.talkForm.talkType=0:"1"===this.talkType&&(this.talkForm.talkType=1),this.templateType||(this.talkForm.talkMaterialList=[],this.talkList.forEach(((e,t)=>{this.talkForm.talkMaterialList.push({materialId:e.id,sort:t})}))),void this.$refs.talkform.validate((e=>{if(e){let e=JSON.parse(JSON.stringify(this.talkForm));4===this.moduleType?(this.talkLoading=!0,e.attachments=[],0!==this.talkList.length&&this.dealOtherModleType(e),this.$emit("submit",e),setTimeout((()=>{this.talkLoading=!1}),5e3)):(e.attachmentList=[],e.weTlpMaterialList=[],this.talkId&&(e.talkId=this.talkId),this.modelId&&(e.modelId=this.modelId),this.templateType&&(this.talkForm.weTlpMaterialList=[],this.dealTemplateType(e)),(this.templateType?s:i)(e).then((()=>{this.msgSuccess("操作成功"),this.$router.push("list"),this.$refs.talkForm.resetFields(),this.talkForm={},this.talkLoading=!1})).catch((()=>{this.talkLoading=!1})))}else this.talkLoading=!1}))):(this.userInfo="请选择员工",void(this.talkLoading=!1)))},dealOtherModleType(e){this.talkList.forEach((t=>{let a={};switch(a.title=t.materialName,a.realType=+t.mediaType,a.materialId=t.id,t.mediaType){case"0":a.picUrl=t.materialUrl,a.msgType="image";break;case"2":a.picUrl=t.coverUrl,a.fileUrl=t.materialUrl,a.description=t.digest,a.msgType="video";break;case"3":a.picUrl=this.filPicType(t.materialUrl),a.fileUrl=t.materialUrl,a.description=t.digest,a.msgType="file";break;case"4":a.content=t.content,a.msgType="text";break;case"5":a.fileUrl=t.materialUrl,a.msgType="posters";break;case"9":a.content=t.content,a.picUrl=t.coverUrl,a.linkUrl=t.materialUrl,a.msgType="link",3===this.otherType&&(a.materialName=t.materialName);break;case"11":a.picUrl=t.coverUrl,a.fileUrl=t.materialUrl,a.appId=t.digest,a.msgType="miniprogram";break;case"12":a.fileUrl=t.materialUrl,a.description=t.digest,a.content=t.content,a.picUrl=t.coverUrl,a.msgType="news"}e.attachments.push(a)}))},dealTemplateType(e){this.talkList.forEach((t=>{let a={};switch(a.msgType=t.mediaType,a.materialId=t.id,"0"!=t.mediaType&&(a.title=t.materialName),t.mediaType){case"0":case"5":a.picUrl=t.materialUrl;break;case"2":a.picUrl=t.coverUrl,a.fileUrl=t.materialUrl,a.description=t.digest;break;case"3":a.fileUrl=t.materialUrl,a.description=t.digest;break;case"4":a.content=t.content;break;case"4":break;case"9":a.content=t.content,a.picUrl=t.coverUrl,a.linkUrl=t.materialUrl;break;case"11":a.picUrl=t.coverUrl,a.fileUrl=t.materialUrl,a.appId=t.digest;break;case"12":a.fileUrl=t.materialUrl,a.description=t.digest,a.content=t.content,a.picUrl=t.coverUrl}e.attachmentList.push(a),e.weTlpMaterialList.push({materialId:t.id})})),e.templateType=this.templateType,e.tplType=this.tplType},getCancel(){this.$router.back()},goBack(){let e=JSON.parse(JSON.stringify(this.talkForm));e.attachments=[],0!==this.talkList.length&&this.dealOtherModleType(e),this.$emit("update",e)}},mounted(){if(this.$route.query.categoryId){let e={categoryId:this.$route.query.categoryId};this.talkForm={...e}}1!=this.templateType&&4!=this.moduleType&&this.getTree(),this.baseData.templateInfo&&(this.talkForm=this.baseData,this.talkList=this.baseData.attachments),3===this.otherType||3==this.tplType?this.maxlength=1:this.maxlength=this.maxlengthTwo,[3,4].includes(this.moduleType)?this.fontType="附件":this.fontType="素材"}},F={key:0,style:{"margin-bottom":"10px"}},D=(e=>(I("data-v-8c42507a"),e=e(),w(),e))((()=>b("div",{class:"sub-des"},"如果员工既没有活码欢迎语，也没有个人欢迎语，则发送默认欢迎语",-1))),O={key:0,class:"title"},_={style:{"text-align":"left"},class:"flex"},C={class:"ml20"},M={style:{"margin-top":"10px","margin-left":"150px"}},N={class:"dialog-footer"};const V=v(x,[["render",function(e,t,a,i,l,s){const r=h("el-button"),o=h("TextareaExtend"),m=h("el-form-item"),n=h("el-icon-QuestionFilled"),p=h("el-popover"),d=h("el-dropdown-item"),I=h("el-dropdown-menu"),w=h("el-dropdown"),v=h("DragTable"),x=h("MessageContentForm"),V=h("TemplateLibrary"),S=h("el-dialog"),$=h("MaterialCenter"),P=h("SelectUser");return c(),g("div",null,[u(m,{label:"欢迎语",required:"",style:{"margin-right":"200px !important"},error:l.templateInfo},{default:y((()=>[a.showModle?(c(),g("div",F,[u(r,{type:"primary",onClick:t[0]||(t[0]=e=>l.welcomVisible=!0)},{default:y((()=>[f("从模板库中选择")])),_:1})])):T("",!0),D,u(o,{modelValue:l.talkForm.templateInfo,"onUpdate:modelValue":t[1]||(t[1]=e=>l.talkForm.templateInfo=e),toolbar:["emoji","insertCustomerNickName"],maxlength:"2000","show-word-limit":"",placeholder:"请输入",autosize:{minRows:5,maxRows:20},clearable:"",autofocus:!1},null,8,["modelValue"])])),_:1},8,["error"]),u(m,null,{label:y((()=>[3!==a.otherType?(c(),g("div",O,[f(k(l.titleTwo)+" ",1),u(p,{trigger:"hover",content:"最多添加"+l.maxlength+"个素材",placement:"top-start"},{reference:y((()=>[u(n,{class:"el-icon-QuestionFilled"})])),_:1},8,["content"])])):T("",!0)])),default:y((()=>[b("div",null,[b("div",null,[b("div",_,[u(p,{trigger:"hover",content:"最多添加"+l.maxlength+"个"+l.fontType+"，如需修改请删除已有"+l.fontType+"后重新尝试",placement:"top-start",disabled:l.talkList.length<l.maxlength},{reference:y((()=>[u(w,{onCommand:s.moveGroup,disabled:l.talkList.length>l.maxlength||l.talkList.length===l.maxlength},{dropdown:y((()=>[u(I,{trigger:"click"},{default:y((()=>[u(d,{command:"0"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("图片")])),_:1})])),_:1}),u(d,{command:"9"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("图文")])),_:1})])),_:1}),3!=this.otherType?(c(),U(d,{key:0,command:"11"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("小程序")])),_:1})])),_:1})):T("",!0),u(d,{command:"12"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("文章")])),_:1})])),_:1}),3!=this.otherType?(c(),U(d,{key:1,command:"2"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("视频")])),_:1})])),_:1})):T("",!0),u(d,{command:"3"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("文件")])),_:1})])),_:1}),u(d,{command:"5"},{default:y((()=>[u(r,{text:""},{default:y((()=>[f("海报")])),_:1})])),_:1})])),_:1})])),default:y((()=>[u(r,{type:"primary"},{default:y((()=>[f("+ "+k("新建"+l.fontType),1)])),_:1})])),_:1},8,["onCommand","disabled"])])),_:1},8,["content","disabled"]),u(p,{trigger:"hover",content:"最多添加"+l.maxlength+"个"+l.fontType+"，如需修改请删除已有"+l.fontType+"后重新尝试",placement:"top-start",disabled:l.talkList.length<l.maxlength},{reference:y((()=>[b("div",C,[u(r,{onClick:s.choseCenter,disabled:l.talkList.length>l.maxlength||l.talkList.length===l.maxlength},{default:y((()=>[f(" 从素材中心选择 ")])),_:1},8,["onClick","disabled"])])])),_:1},8,["content","disabled"])])])])])),_:1}),j(b("div",M,[u(v,{tableData2:l.talkList,onSetData:s.setData,onGetEdit:s.getEdit,dargAble:[2].includes(a.moduleType)},null,8,["tableData2","onSetData","onGetEdit","dargAble"])],512),[[L,l.talkList.length]]),u(x,{materialDialogVisible:l.dialogVisible,materialForm:l.form,materialType:l.type,editMaterialForm:l.editMaterialForm,onDialogClose:s.dialogClose,materialTalkList:l.talkList,moduleType:a.moduleType,maxlength:l.maxlength},null,8,["materialDialogVisible","materialForm","materialType","editMaterialForm","onDialogClose","materialTalkList","moduleType","maxlength"]),l.welcomVisible?(c(),U(S,{key:0,title:2===a.otherType?"选择群发模板":"选择欢迎语模板",modelValue:l.welcomVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>l.welcomVisible=e),width:"60%","append-to-body":"","close-on-click-modal":!1},{footer:y((()=>[b("div",N,[u(r,{type:"primary",onClick:s.selectModle,loading:l.libraryLoading},{default:y((()=>[f("确 定")])),_:1},8,["onClick","loading"]),u(r,{onClick:t[2]||(t[2]=e=>l.welcomVisible=!1)},{default:y((()=>[f("取 消")])),_:1})])])),default:y((()=>[u(V,{onChangeObj:s.changeObj,isGroup:2===a.otherType},null,8,["onChangeObj","isGroup"])])),_:1},8,["title","modelValue"])):T("",!0),b("template",null,[u($,{choseDialog:l.choseDialog,"onUpdate:choseDialog":t[4]||(t[4]=e=>l.choseDialog=e),talkListLength:l.talkList.length,onItemArry:s.getItemArry,templateType:a.templateType,tplType:a.tplType,moduleType:a.moduleType,maxlength:l.maxlength,noApplets:3===a.otherType},null,8,["choseDialog","talkListLength","onItemArry","templateType","tplType","moduleType","maxlength","noApplets"])]),u(P,{defaultValues:l.selectedUserList,visible:l.dialogVisibleSelectUser,"onUpdate:visible":t[5]||(t[5]=e=>l.dialogVisibleSelectUser=e),title:"选择使用员工",onSuccess:s.selectedUser},null,8,["defaultValues","visible","onSuccess"])])}],["__scopeId","data-v-8c42507a"]]);export{V as default};
