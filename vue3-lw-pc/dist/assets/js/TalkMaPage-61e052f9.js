import{g as e}from"./index-0bf429ac.js";import{g as t,u as i,b as o}from"./staff-48996164.js";import{d as s}from"./common-07456f0f.js";import a from"./PreviewInPhone-9ed75a0f.js";import{g as l,s as r}from"./scriptCenter-9e8c6ca2.js";import{g as d,r as p}from"./welcome-6ff4c53e.js";import{t as n}from"./modleCenter-5112f339.js";import{ai as u,aq as m,o as h,c,a as g,Z as y,K as f,a9 as v,P as j,T as w,U as b,_ as T,Y as q,X as V,aa as C,V as k,O as I,$ as F,bl as x,bj as _}from"./@vue-e400fd81.js";import{_ as D}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";const L={name:"TalkMaPage",components:{PreviewInPhone:a},props:{type:{type:String,default:"0"},selected:{type:[Array,String],default:""}},data(){return{showPreviewDialog:!1,previewList:[],headers:window.lwConfig.headers,groupList:[],groupVisible:!1,groupForm:{mediaType:this.type,name:""},groupRules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}]},groupIndex:0,delObj:{updateOrDel:1,moduleType:2,ids:[]},times:null,submitLoading:!1,audioType:["amr"],loading:!0,query:{pageNum:1,pageSize:10},list:[],total:0,treeData:[{}],treeProps:{children:"children",label:"name"},treeForm:{},treeDialogVisible:!1,group:"",groupDialogVisible:!1,groupProps:{expandTrigger:"hover",checkStrictly:!0,children:"children",label:"name",value:"id",emitPath:!1},form:{},dialogVisible:!1,templateInfo:""}},watch:{},computed:{},created(){this.query.mediaType=this.type,this.getTree(),this.getCodeCategoryListFn()},mounted(){},methods:{showPreview(e){this.templateInfo=e.templateInfo,this.getDeatil(e.id),this.showPreviewDialog=!0},getDeatil(e){this.loading=!0,n(e).then((e=>{this.previewList=e.data.weMaterialList,this.loading=!1})).catch((()=>{this.loading=!1}))},addGroup(){this.groupForm={mediaType:this.type,name:""},this.groupVisible=!0},getCodeCategoryListFn(){t({mediaType:this.type}).then((e=>{200==e.code&&(this.groupList=e.data,this.query.categoryId=this.groupList[0].id,this.groupIndex=0,this.query.pageNum=1,this.getList())}))},switchGroup(e,t){this.groupIndex=e,this.query.categoryId=t.id,this.search()},search(){this.query.pageNum=1,this.getList()},onAddOrUpdateGroup(){this.$refs.groupForm.validate((e=>{if(this.groupForm.id){let e={id:this.groupForm.id,name:this.groupForm.name,mediaType:this.type};this.groupForm=e}e&&(this.groupForm.id?i:o)(this.groupForm).then((e=>{this.groupVisible=!1,this.groupForm={name:"",mediaType:this.type},this.$refs.groupForm.clearValidate(),this.getCodeCategoryListFn(),this.getTree()}))}))},onGroupCommand(e,t){"1"!==t.id?"groupEdit"==e?this.editGroup(t):"groupRemove"==e&&this.removeGroup(t.id):this.msgInfo("默认分组不可操作！")},editGroup(e){this.groupForm=JSON.parse(JSON.stringify(e)),this.groupVisible=!0},removeGroup(e){this.$confirm("是否确认删除当前分组？删除后该分组下数据移动到默认分组中，该操作不可撤销，请谨慎操作。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.delObj.ids=[],this.delObj.ids.push(e),["13","14"].includes(this.type)?this.delObj.moduleType=2:["16","17"].includes(this.type)&&(this.delObj.moduleType=3),s(this.delObj).then((e=>{200===e.code&&(this.$message.success(e.msg),this.getCodeCategoryListFn(),this.getTree(),this.group="")}))})).catch((()=>{}))},resetQuery(){["13","14"].includes(this.type)?this.query.talkTitle="":["16","17"].includes(this.type)&&(this.query.templateInfo=""),this.search()},getTree(){e(this.type).then((({data:e})=>{e.forEach((e=>{e.children=null})),this.treeData=[{id:"",name:"全部",parentId:"0",hasParent:!1,hasChildren:!0,children:e||[]}]}))},getList(e){e&&(this.query.pageNum=e),this.loading=!0,["13","14"].includes(this.type)?("13"===this.query.mediaType?this.query.talkType=0:"14"===this.query.mediaType&&(this.query.talkType=1),l(this.query).then((({rows:e,total:t})=>{this.list=e.sort(((e,t)=>+new Date(t.updateTime)-+new Date(e.updateTime))),this.total=+t,this.loading=!1,this.$emit("listChange",this.list)})).catch((()=>{this.loading=!1}))):["16","17"].includes(this.type)&&d(this.query).then((({rows:e,total:t})=>{this.list=e.sort(((e,t)=>+new Date(t.updateTime)-+new Date(e.updateTime))),this.total=+t,this.loading=!1,this.$emit("listChange",this.list)})).catch((()=>{this.loading=!1}))},edit(e,t){switch(t){case 13:case 14:1!=e&&e?this.$router.push({path:"add",query:{type:this.type,id:e}}):this.$router.push({path:"add",query:{type:this.type,categoryId:this.query.categoryId}});break;case 16:case 17:e&&1!==e?this.$router.push({path:"add",query:{tplType:this.type,id:e}}):this.$router.push({path:"add",query:{tplType:this.type,categoryId:this.query.categoryId}})}},remove(e){var t;const i=e||this.selected+"";let o=this;this.$confirm("是否确认删除当前"+(null==(t=this.$dictMaterialType[this.type])?void 0:t.name)+"？该操作不可撤销，请谨慎操作。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return["13","14"].includes(o.type)?r(i):["16","17"].includes(o.type)?p(i):void 0})).then((()=>{this.getList(),this.msgSuccess("删除成功")}))},detail(e){this.$router.push({path:"detail",query:{talkId:e}})},moveGroup(){let e={};e.cateGoreId=this.group,["13","14"].includes(this.type)?e.moduleType=2:["16","17"].includes(this.type)&&(e.moduleType=3),e.updateOrDel=0,e.ids=this.selected,s(e).then((e=>{this.getCodeCategoryListFn(),this.getTree()}))}}},P={class:"page h100"},$={class:"g-left-right"},G={class:"left g-card"},O={class:"title"},U={class:"title-name"},M={class:"item-list"},S=["onClick"],N={class:"name"},z={class:"dot"},B={class:"right"},A={class:"g-card fxnone"},E={class:"mt20 g-card pad20"},K={class:"mid-action"},R={class:""},J={class:""},Q=(e=>(x("data-v-114a3c25"),e=e(),_(),e))((()=>g("div",null,"选择分组",-1))),X={style:{position:"relative",margin:"10px 0"}},Y={style:{"text-align":"right"}},Z={class:"dialog-footer"},H={class:"dialog-footer"};const W=D(L,[["render",function(e,t,i,o,s,a){var l,r,d;const p=u("el-icon-MoreFilled"),n=u("el-dropdown-item"),x=u("el-dropdown-menu"),_=u("el-dropdown"),D=u("el-input"),L=u("el-button"),W=u("el-cascader"),ee=u("el-popover"),te=u("pagination"),ie=u("el-form-item"),oe=u("el-form"),se=u("el-dialog"),ae=u("PreviewInPhone"),le=m("loading");return h(),c("div",P,[g("div",$,[g("div",G,[g("div",O,[g("div",U,y(null==(l=e.$dictMaterialType[i.type])?void 0:l.name)+"分组",1),g("div",{class:"title-btn",onClick:t[0]||(t[0]=(...e)=>a.addGroup&&a.addGroup(...e))},"添加")]),g("div",M,[(h(!0),c(f,null,v(s.groupList,((e,t)=>(h(),c("div",{class:j(["item",{active:s.groupIndex==t}]),key:e.id,onClick:i=>a.switchGroup(t,e)},[g("div",N,y(e.name+" ("+e.number+")"),1),0===e.flag?(h(),w(_,{key:0,class:"dropdown",onCommand:t=>a.onGroupCommand(t,e)},{dropdown:b((()=>[T(x,null,{default:b((()=>[T(n,{command:"groupEdit"},{default:b((()=>[q("修改分组")])),_:1}),T(n,{command:"groupRemove"},{default:b((()=>[q("删除分组")])),_:1})])),_:1})])),default:b((()=>[g("span",z,[T(p,{class:"el-icon-MoreFilled content-icon"})])])),_:2},1032,["onCommand"])):V("",!0)],10,S)))),128))])]),g("div",B,[g("div",A,[["13","14"].includes(i.type)?(h(),w(D,{key:0,modelValue:s.query.talkTitle,"onUpdate:modelValue":t[1]||(t[1]=e=>s.query.talkTitle=e),placeholder:"请输入"+(null==(r=e.$dictMaterialType[i.type])?void 0:r.name)+"标题",clearable:"","prefix-icon":"el-icon-search",style:{width:"300px"},onKeyup:t[2]||(t[2]=C((e=>a.search()),["enter"]))},null,8,["modelValue","placeholder"])):(h(),w(D,{key:1,modelValue:s.query.templateInfo,"onUpdate:modelValue":t[3]||(t[3]=e=>s.query.templateInfo=e),placeholder:"请输入"+(null==(d=e.$dictMaterialType[i.type])?void 0:d.name)+"标题",clearable:"","prefix-icon":"el-icon-search",style:{width:"300px"},onKeyup:t[4]||(t[4]=C((e=>a.search()),["enter"]))},null,8,["modelValue","placeholder"])),T(L,{class:"ml10",type:"primary",onClick:t[5]||(t[5]=e=>a.getList(1))},{default:b((()=>[q("查询")])),_:1}),T(L,{onClick:a.resetQuery},{default:b((()=>[q("重置")])),_:1},8,["onClick"])]),g("div",E,[k((h(),c("div",null,[g("div",K,[g("div",R,[T(L,{type:"primary",onClick:t[6]||(t[6]=e=>a.edit(1,~~i.type))},{default:b((()=>{var t;return[q("新建"+y(null==(t=e.$dictMaterialType[i.type])?void 0:t.name),1)]})),_:1})]),g("div",J,[T(ee,{placement:"top",width:"260",modelValue:s.groupDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>s.groupDialogVisible=e)},{reference:b((()=>[T(L,{class:"mr10",disabled:0===i.selected.length,type:"primary"},{default:b((()=>[q("批量分组")])),_:1},8,["disabled"])])),default:b((()=>[Q,g("div",X,[T(W,{modelValue:s.group,"onUpdate:modelValue":t[7]||(t[7]=e=>s.group=e),options:s.treeData[0].children,props:s.groupProps},null,8,["modelValue","options","props"])]),g("div",Y,[T(L,{onClick:t[8]||(t[8]=e=>s.groupDialogVisible=!1)},{default:b((()=>[q("取消")])),_:1}),T(L,{type:"primary",onClick:a.moveGroup},{default:b((()=>[q("确定")])),_:1},8,["onClick"])])])),_:1},8,["modelValue"]),T(L,{onClick:t[10]||(t[10]=e=>a.remove()),disabled:0===i.selected.length},{default:b((()=>[q("批量删除")])),_:1},8,["disabled"])])]),I(e.$slots,"default",{list:s.list},void 0,!0)])),[[le,s.loading]]),k(T(te,{total:s.total,page:s.query.pageNum,"onUpdate:page":t[11]||(t[11]=e=>s.query.pageNum=e),limit:s.query.pageSize,"onUpdate:limit":t[12]||(t[12]=e=>s.query.pageSize=e),onPagination:t[13]||(t[13]=e=>a.getList())},null,8,["total","page","limit"]),[[F,s.total>0]])])])]),s.groupVisible?(h(),w(se,{key:0,title:(s.groupForm.id?"修改":"新建")+"分组",modelValue:s.groupVisible,"onUpdate:modelValue":t[16]||(t[16]=e=>s.groupVisible=e),width:"30%"},{footer:b((()=>[g("div",Z,[T(L,{onClick:t[15]||(t[15]=e=>s.groupVisible=!1)},{default:b((()=>[q("取 消")])),_:1}),T(L,{type:"primary",onClick:a.onAddOrUpdateGroup},{default:b((()=>[q("确 定")])),_:1},8,["onClick"])])])),default:b((()=>[T(oe,{model:s.groupForm,rules:s.groupRules,ref:"groupForm"},{default:b((()=>[T(ie,{label:"分组名称",prop:"name","label-width":"80px"},{default:b((()=>[T(D,{modelValue:s.groupForm.name,"onUpdate:modelValue":t[14]||(t[14]=e=>s.groupForm.name=e),clearable:"",autocomplete:"off",maxlength:"15","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])):V("",!0),T(se,{title:"预览",modelValue:s.showPreviewDialog,"onUpdate:modelValue":t[18]||(t[18]=e=>s.showPreviewDialog=e),width:"50%"},{footer:b((()=>[g("span",H,[T(L,{type:"primary",onClick:t[17]||(t[17]=e=>s.showPreviewDialog=!1)},{default:b((()=>[q("关闭")])),_:1})])])),default:b((()=>[g("div",null,[T(ae,{list:s.previewList,templateInfo:s.templateInfo},null,8,["list","templateInfo"])])])),_:1},8,["modelValue"])])}],["__scopeId","data-v-114a3c25"]]);export{W as default};
