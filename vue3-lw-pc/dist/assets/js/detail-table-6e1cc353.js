import{i as e,j as t}from"./api-0004a25c.js";import i from"./SubDetail-10d2f221.js";import{d as a}from"../index-044285d2.js";import s from"./SelectGroup-e6b2682d.js";import{ai as l,aq as r,o,c as n,_ as u,U as p,Y as m,a as d,V as c,T as h,Z as g,P as b,$ as j,bl as f,bj as y}from"./@vue-e400fd81.js";import{_ as v}from"./quill-image-resize-module-c051113e.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./group-e56f61ac.js";const q={name:"task-group-detail-table",components:{SubDetailVue:i,SelectGroup:s},data:()=>({groupNames:"",groupList:[],showSelectModal:!1,loading:!1,list:[],total:0,qrUserName:"",query:{customerName:"",pageNum:1,pageSize:10,weUserId:"",chatId:"",fissionId:""},dialogVisible:!1,userArray:[],userArrayStr:"",detailVisible:!1,detailId:"",exportLoading:!1}),methods:{setSelectData(e){e&&e.length?(this.groupList=e,this.query.chatId=this.groupList.map((e=>e.chatId)).join(","),this.groupNames=this.groupList.map((e=>e.groupName)).join(",")):(this.groupList=[],this.query.chatId="",this.groupNames="")},exportFn(){this.$confirm("确认导出吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.exportLoading=!0,e(this.query)))).then((e=>{if(null!=e){let t=new Blob([e],{type:"application/vnd.ms-excel"}),i=window.URL.createObjectURL(t);const s=document.createElement("a");s.href=i,s.download="裂变明细"+a(new Date)+".xlsx",s.click(),URL.revokeObjectURL(i)}})).catch((e=>{})).finally((()=>{this.exportLoading=!1}))},getDetailTable(e){this.detailId=e,this.detailVisible=!0},getList(){this.loading=!0,this.query.fissionId=this.$route.query.id,t(this.query).then((e=>{this.loading=!1,this.list=e.rows,this.total=Number(e.total)}))},search(){this.query.pageNum=1,this.getList()},resetQuery(){this.query.weUserId="",this.query.customerName="",this.userArray=[],this.groupList=[],this.query.chatId="",this.groupNames="",this.qrUserName="",this.search()},getSelectUser(e){this.userArray=e,this.qrUserName=this.userArray.map((function(e,t){return e.name})).join(","),this.query.weUserId=this.userArray.map((function(e,t){return e.userId})).join(",")}},created(){this.search()}},N={class:"g-card"},S={class:"mid-action"},U=(e=>(f("data-v-03feaca5"),e=e(),y(),e))((()=>d("div",null,null,-1))),I=["onClick"];const w=v(q,[["render",function(e,t,i,a,s,f){const y=l("el-input"),v=l("el-form-item"),q=l("el-button"),w=l("el-form"),L=l("el-table-column"),V=l("el-table"),_=l("pagination"),k=l("SelectUser"),x=l("SubDetailVue"),C=l("select-group"),D=r("loading");return o(),n("div",null,[u(w,{ref:"queryForm",model:s.query,inline:"",class:"top-search","label-position":"left","label-width":""},{default:p((()=>[u(v,{label:"",prop:"customerName"},{default:p((()=>[u(y,{clearable:"",modelValue:s.query.customerName,"onUpdate:modelValue":t[0]||(t[0]=e=>s.query.customerName=e),placeholder:"请输入客户名称"},null,8,["modelValue"])])),_:1}),u(v,{label:""},{default:p((()=>[u(y,{"model-value":s.groupNames,readonly:"",onClick:t[1]||(t[1]=e=>s.showSelectModal=!0),placeholder:"请选择客群"},null,8,["model-value"])])),_:1}),u(v,{label:""},{default:p((()=>[u(y,{"model-value":s.qrUserName,readonly:"",onClick:t[2]||(t[2]=e=>s.dialogVisible=!0),placeholder:"请选择发送员工"},null,8,["model-value"])])),_:1}),u(v,{label:""},{default:p((()=>[u(q,{type:"primary",onClick:f.search},{default:p((()=>[m("查询")])),_:1},8,["onClick"]),u(q,{onClick:f.resetQuery},{default:p((()=>[m("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),d("div",N,[d("div",S,[U,d("div",null,[c((o(),h(q,{type:"primary",onClick:f.exportFn},{default:p((()=>[m("导出Excel")])),_:1},8,["onClick"])),[[D,s.exportLoading]])])]),c((o(),h(V,{data:s.list},{default:p((()=>[u(L,{prop:"customerName",label:"客户",align:"center"}),u(L,{prop:"chatName",label:"所在客群",align:"center"}),u(L,{prop:"sendUserName",label:"发送员工",align:"center"}),u(L,{prop:"inviterState",label:"裂变状态",align:"center"},{default:p((({row:e})=>[m(g(1==e.inviterState?"已完成":2==e.inviterState?"未完成":""),1)])),_:1}),u(L,{prop:"inviterNumber",label:"裂变新客数",align:"center"},{default:p((({row:e})=>[d("a",{class:b({self_a:e.inviterNumber}),onClick:t=>f.getDetailTable(e.fissionInviterRecordId)},g(e.inviterNumber||"-"),11,I)])),_:1})])),_:1},8,["data"])),[[D,s.loading]]),c(u(_,{total:s.total,page:s.query.pageNum,"onUpdate:page":t[3]||(t[3]=e=>s.query.pageNum=e),limit:s.query.pageSize,"onUpdate:limit":t[4]||(t[4]=e=>s.query.pageSize=e),onPagination:f.getList},null,8,["total","page","limit","onPagination"]),[[j,s.total>0]])]),u(k,{visible:s.dialogVisible,"onUpdate:visible":t[5]||(t[5]=e=>s.dialogVisible=e),title:"组织架构",defaultValues:s.userArray,onSuccess:f.getSelectUser},null,8,["visible","defaultValues","onSuccess"]),u(x,{visible:s.detailVisible,"onUpdate:visible":t[6]||(t[6]=e=>s.detailVisible=e),fissionInviterRecordId:s.detailId,fissionType:"group"},null,8,["visible","fissionInviterRecordId"]),u(C,{visible:s.showSelectModal,"onUpdate:visible":t[7]||(t[7]=e=>s.showSelectModal=e),defaults:s.groupList,onSubmit:f.setSelectData},null,8,["visible","defaults","onSubmit"])])}],["__scopeId","data-v-03feaca5"]]);export{w as default};
