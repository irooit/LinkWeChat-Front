import{i as t,j as e,k as s,t as a}from"./organization-9bed3593.js";import i from"./add-08aaac45.js";import{ai as l,aq as o,o as n,c as r,a as d,_ as c,U as u,aa as p,V as m,K as h,a9 as j,P as f,Y as v,Z as g,T as b,X as y,bl as k,bj as S}from"./@vue-e400fd81.js";import{_ as O}from"./quill-image-resize-module-c051113e.js";import"../index-044285d2.js";import"./js-cookie-8253c38e.js";/* empty css                      */import"./vue-router-f8d53be7.js";import"./element-plus-68ba2566.js";import"./lodash-es-d4f5f48c.js";import"./@element-plus-214e0f7b.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./dayjs-c17bc6b2.js";import"./@babel-efd68da6.js";import"./to-fast-properties-1160b370.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./pinia-1b56b17e.js";import"./vue-demi-71ba0ef2.js";import"./jsencrypt-43f479c1.js";import"./crypto-js-d6a67473.js";import"./ali-oss-912914b8.js";import"./axios-fb5f9e0e.js";import"./@vueuse-4025ce01.js";import"./path-browserify-289407ee.js";import"./nprogress-a39edb90.js";import"./clipboard-7a0da8dc.js";import"./quill-c6b3d2fb.js";import"./quill-delta-a1872f89.js";import"./fast-diff-d5a53119.js";import"./lodash.clonedeep-1b6eefdc.js";import"./lodash.isequal-e7d08617.js";import"./@vueup-7cf8cfdd.js";import"./SelectDept-7a07b4de.js";const C={name:"manage-center-roles",data(){return{roles:[],activeId:void 0,roleObj:{users:[]},currentStatus:"detail",defaultProps:{children:"children",label:"label",disabled:this.isDisabled},menuOptions:[],dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],keywords:"",loading:!1}},components:{AddOrEdit:i},created(){this.getList(),this.getMenuTreeselect()},methods:{isDisabled:()=>!0,setName(){let t="";return this.dataScopeOptions.map((e=>{e.value==this.roleObj.dataScope&&(t=e.label)})),t},updateFn(){this.getList("edit"===this.currentStatus),this.currentStatus="detail"},cancel(){this.$confirm(`是否确认取消${"add"===this.currentStatus?"新建":"编辑"}角色？取消后不可恢复。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.currentStatus="detail",this.getRoleDetailFn(this.roleObj.roleId)})).catch((function(){}))},getList(e){this.loading=!0,t(this.keywords).then((({rows:t})=>{var s;this.roles=t,null==this.activeId&&(null==(s=this.roles)?void 0:s.length)&&(this.activeId=t[0].roleId,e=!0),!0===e&&this.getRoleDetailFn(this.activeId)})).finally((()=>{this.loading=!1}))},getRoleDetailFn(t){t&&e(t).then((t=>{if(this.roleObj=t.data,this.roleObj.menus){let t=this.roleObj.menus.map((t=>t.menuId));this.$refs.menu.setCheckedKeys(t)}}))},addFn(){"detail"!==this.currentStatus?this.$confirm(`是否确认取消${"add"===this.currentStatus?"新建":"编辑"}角色？取消后不可恢复。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.currentStatus="add"})).catch((function(){})):this.currentStatus="add"},switchRole(t){"detail"!==this.currentStatus?this.$confirm(`是否确认取消${"add"===this.currentStatus?"新建":"编辑"}角色？取消后不可恢复。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.currentStatus="detail",this.getRoleDetailFn(this.activeId=t.roleId)})).catch((function(){})):this.getRoleDetailFn(this.activeId=t.roleId)},edtiFn(){this.currentStatus="edit"},deleteFn(){this.$confirm("是否确认删除角色？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{s(this.roleObj.roleId).then((t=>{this.activeId=void 0,this.getList()}))})).catch((function(){}))},getMenuTreeselect(){a().then((t=>{this.menuOptions=t.data}))}}},I={class:"g-left-right"},w={class:"left g-card"},x={class:"title"},F=(t=>(k("data-v-5ee3546a"),t=t(),S(),t))((()=>d("div",{class:"title-name"},"角色列表",-1))),T={class:"mt20"},_={class:"item-list"},$=["onClick"],B={class:"name"},D={style:{"margin-left":"10px"}},L={class:"right g-card mt0"},R={class:"title-name"},U={key:0},q={style:{"margin-top":"20px"}},z={class:"g-footer-sticky bottom"},K={key:1},N={key:2};const V=O(C,[["render",function(t,e,s,a,i,k){var S;const O=l("el-button"),C=l("el-input"),V=l("Empty"),E=l("el-tag"),M=l("el-form-item"),P=l("el-tree"),A=l("el-form"),J=l("add-or-edit"),X=o("loading");return n(),r("div",I,[d("div",w,[d("div",x,[F,d("div",{class:"title-btn",onClick:e[0]||(e[0]=(...t)=>k.addFn&&k.addFn(...t))},"新建")]),d("div",T,[c(C,{modelValue:i.keywords,"onUpdate:modelValue":e[1]||(e[1]=t=>i.keywords=t),onKeyup:p(k.getList,["enter"]),placeholder:"请输入角色名称",clearable:"",onChange:k.getList},{append:u((()=>[c(O,{icon:"el-icon-search",onClick:k.getList},null,8,["onClick"])])),_:1},8,["modelValue","onKeyup","onChange"])]),m((n(),r("div",_,[(null==(S=i.roles)?void 0:S.length)?(n(!0),r(h,{key:0},j(i.roles,((t,e)=>(n(),r("div",{class:f(["item",{active:i.activeId==t.roleId}]),key:e,onClick:e=>k.switchRole(t)},[d("div",B,[v(g(t.roleName)+" ",1),d("span",D,"("+g(t.userCount)+")",1)])],10,$)))),128)):(n(),b(V,{key:1,description:"暂无相关数据"}))])),[[X,i.loading]])]),d("div",L,[d("div",R,g("detail"===i.currentStatus?`角色详情 -- ${i.roleObj.roleName}`:"add"===i.currentStatus?"新建角色":"编辑角色"),1),"detail"===i.currentStatus?(n(),r("div",U,[d("div",q,[c(A,{ref:"codeForm","label-position":"right","label-width":"80px"},{default:u((()=>[c(M,{label:"角色员工"},{default:u((()=>[(n(!0),r(h,null,j(i.roleObj.users,((t,e)=>(n(),r(h,{key:e},[t.userName?(n(),b(E,{key:0},{default:u((()=>[v(g(t.userName),1)])),_:2},1024)):y("",!0)],64)))),128))])),_:1}),c(M,{label:"功能权限"},{default:u((()=>[c(P,{data:i.menuOptions,"show-checkbox":"",ref:"menu","node-key":"id",disabled:"","empty-text":"加载中，请稍后",props:i.defaultProps},null,8,["data","props"])])),_:1})])),_:1},512)]),d("div",z,[c(O,{plain:"",type:"danger",onClick:k.deleteFn},{default:u((()=>[v("删除")])),_:1},8,["onClick"]),c(O,{type:"primary",onClick:k.edtiFn},{default:u((()=>[v("编辑")])),_:1},8,["onClick"])])])):"add"===i.currentStatus?(n(),r("div",K,[c(J,{key:"1",status:i.currentStatus,onUpdate:k.updateFn,onCancel:k.cancel,list:i.menuOptions},null,8,["status","onUpdate","onCancel","list"])])):(n(),r("div",N,[c(J,{key:"2",status:i.currentStatus,data:i.roleObj,onUpdate:k.updateFn,onCancel:k.cancel,list:i.menuOptions},null,8,["status","data","onUpdate","onCancel","list"])]))])])}],["__scopeId","data-v-5ee3546a"]]);export{V as default};
